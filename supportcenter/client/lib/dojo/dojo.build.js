if(typeof dojo=="undefined"){
var dj_global=this;
var dj_currentContext=this;
function dj_undef(_1,_2){
return (typeof (_2||dj_currentContext)[_1]=="undefined");
}
if(dj_undef("djConfig",this)){
var djConfig={};
}
if(dj_undef("dojo",this)){
var dojo={};
}
dojo.global=function(){
return dj_currentContext;
};
dojo.locale=djConfig.locale;
dojo.version={major:0,minor:4,patch:3,flag:"",revision:Number("$Rev: 8617 $".match(/[0-9]+/)[0]),toString:function(){
with(dojo.version){
return major+"."+minor+"."+patch+flag+" ("+revision+")";
}
}};
dojo.evalProp=function(_3,_4,_5){
if((!_4)||(!_3)){
return undefined;
}
if(!dj_undef(_3,_4)){
return _4[_3];
}
return (_5?(_4[_3]={}):undefined);
};
dojo.parseObjPath=function(_6,_7,_8){
var _9=(_7||dojo.global());
var _a=_6.split(".");
var _b=_a.pop();
for(var i=0,l=_a.length;i<l&&_9;i++){
_9=dojo.evalProp(_a[i],_9,_8);
}
return {obj:_9,prop:_b};
};
dojo.evalObjPath=function(_e,_f){
if(typeof _e!="string"){
return dojo.global();
}
if(_e.indexOf(".")==-1){
return dojo.evalProp(_e,dojo.global(),_f);
}
var ref=dojo.parseObjPath(_e,dojo.global(),_f);
if(ref){
return dojo.evalProp(ref.prop,ref.obj,_f);
}
return null;
};
dojo.errorToString=function(_11){
if(!dj_undef("message",_11)){
return _11.message;
}else{
if(!dj_undef("description",_11)){
return _11.description;
}else{
return _11;
}
}
};
dojo.raise=function(_12,_13){
if(_13){
_12=_12+": "+dojo.errorToString(_13);
}else{
_12=dojo.errorToString(_12);
}
try{
if(djConfig.isDebug){
dojo.hostenv.println("FATAL exception raised: "+_12);
}
}
catch(e){
}
throw _13||Error(_12);
};
dojo.debug=function(){
};
dojo.debugShallow=function(obj){
};
dojo.profile={start:function(){
},end:function(){
},stop:function(){
},dump:function(){
}};
function dj_eval(_15){
return dj_global.eval?dj_global.eval(_15):eval(_15);
}
dojo.unimplemented=function(_16,_17){
var _18="'"+_16+"' not implemented";
if(_17!=null){
_18+=" "+_17;
}
dojo.raise(_18);
};
dojo.deprecated=function(_19,_1a,_1b){
var _1c="DEPRECATED: "+_19;
if(_1a){
_1c+=" "+_1a;
}
if(_1b){
_1c+=" -- will be removed in version: "+_1b;
}
dojo.debug(_1c);
};
dojo.render=(function(){
function vscaffold(_1d,_1e){
var tmp={capable:false,support:{builtin:false,plugin:false},prefixes:_1d};
for(var i=0;i<_1e.length;i++){
tmp[_1e[i]]=false;
}
return tmp;
}
return {name:"",ver:dojo.version,os:{win:false,linux:false,osx:false},html:vscaffold(["html"],["ie","opera","khtml","safari","moz"]),svg:vscaffold(["svg"],["corel","adobe","batik"]),vml:vscaffold(["vml"],["ie"]),swf:vscaffold(["Swf","Flash","Mm"],["mm"]),swt:vscaffold(["Swt"],["ibm"])};
})();
dojo.hostenv=(function(){
var _21={isDebug:false,allowQueryConfig:false,baseScriptUri:"",baseRelativePath:"",libraryScriptUri:"",iePreventClobber:false,ieClobberMinimal:true,preventBackButtonFix:true,delayMozLoadingFix:false,searchIds:[],parseWidgets:true};
if(typeof djConfig=="undefined"){
djConfig=_21;
}else{
for(var _22 in _21){
if(typeof djConfig[_22]=="undefined"){
djConfig[_22]=_21[_22];
}
}
}
return {name_:"(unset)",version_:"(unset)",getName:function(){
return this.name_;
},getVersion:function(){
return this.version_;
},getText:function(uri){
dojo.unimplemented("getText","uri="+uri);
}};
})();
dojo.hostenv.getBaseScriptUri=function(){
if(djConfig.baseScriptUri.length){
return djConfig.baseScriptUri;
}
var uri=new String(djConfig.libraryScriptUri||djConfig.baseRelativePath);
if(!uri){
dojo.raise("Nothing returned by getLibraryScriptUri(): "+uri);
}
var _25=uri.lastIndexOf("/");
djConfig.baseScriptUri=djConfig.baseRelativePath;
return djConfig.baseScriptUri;
};
(function(){
var _26={pkgFileName:"__package__",loading_modules_:{},loaded_modules_:{},addedToLoadingCount:[],removedFromLoadingCount:[],inFlightCount:0,modulePrefixes_:{dojo:{name:"dojo",value:"src"}},setModulePrefix:function(_27,_28){
this.modulePrefixes_[_27]={name:_27,value:_28};
},moduleHasPrefix:function(_29){
var mp=this.modulePrefixes_;
return Boolean(mp[_29]&&mp[_29].value);
},getModulePrefix:function(_2b){
if(this.moduleHasPrefix(_2b)){
return this.modulePrefixes_[_2b].value;
}
return _2b;
},getTextStack:[],loadUriStack:[],loadedUris:[],post_load_:false,modulesLoadedListeners:[],unloadListeners:[],loadNotifying:false};
for(var _2c in _26){
dojo.hostenv[_2c]=_26[_2c];
}
})();
dojo.hostenv.loadPath=function(_2d,_2e,cb){
var uri;
if(_2d.charAt(0)=="/"||_2d.match(/^\w+:/)){
uri=_2d;
}else{
uri=this.getBaseScriptUri()+_2d;
}
if(djConfig.cacheBust&&dojo.render.html.capable){
uri+="?"+String(djConfig.cacheBust).replace(/\W+/g,"");
}
try{
return !_2e?this.loadUri(uri,cb):this.loadUriAndCheck(uri,_2e,cb);
}
catch(e){
dojo.debug(e);
return false;
}
};
dojo.hostenv.loadUri=function(uri,cb){
if(this.loadedUris[uri]){
return true;
}
var _33=this.getText(uri,null,true);
if(!_33){
return false;
}
this.loadedUris[uri]=true;
if(cb){
_33="("+_33+")";
}
var _34=dj_eval(_33);
if(cb){
cb(_34);
}
return true;
};
dojo.hostenv.loadUriAndCheck=function(uri,_36,cb){
var ok=true;
try{
ok=this.loadUri(uri,cb);
}
catch(e){
dojo.debug("failed loading ",uri," with error: ",e);
}
return Boolean(ok&&this.findModule(_36,false));
};
dojo.loaded=function(){
};
dojo.unloaded=function(){
};
dojo.hostenv.loaded=function(){
this.loadNotifying=true;
this.post_load_=true;
var mll=this.modulesLoadedListeners;
for(var x=0;x<mll.length;x++){
mll[x]();
}
this.modulesLoadedListeners=[];
this.loadNotifying=false;
dojo.loaded();
};
dojo.hostenv.unloaded=function(){
var mll=this.unloadListeners;
while(mll.length){
(mll.pop())();
}
dojo.unloaded();
};
dojo.addOnLoad=function(obj,_3d){
var dh=dojo.hostenv;
if(arguments.length==1){
dh.modulesLoadedListeners.push(obj);
}else{
if(arguments.length>1){
dh.modulesLoadedListeners.push(function(){
obj[_3d]();
});
}
}
if(dh.post_load_&&dh.inFlightCount==0&&!dh.loadNotifying){
dh.callLoaded();
}
};
dojo.addOnUnload=function(obj,_40){
var dh=dojo.hostenv;
if(arguments.length==1){
dh.unloadListeners.push(obj);
}else{
if(arguments.length>1){
dh.unloadListeners.push(function(){
obj[_40]();
});
}
}
};
dojo.hostenv.modulesLoaded=function(){
if(this.post_load_){
return;
}
if(this.loadUriStack.length==0&&this.getTextStack.length==0){
if(this.inFlightCount>0){
dojo.debug("files still in flight!");
return;
}
dojo.hostenv.callLoaded();
}
};
dojo.hostenv.callLoaded=function(){
if(typeof setTimeout=="object"||(djConfig["useXDomain"]&&dojo.render.html.opera)){
setTimeout("dojo.hostenv.loaded();",0);
}else{
dojo.hostenv.loaded();
}
};
dojo.hostenv.getModuleSymbols=function(_42){
var _43=_42.split(".");
for(var i=_43.length;i>0;i--){
var _45=_43.slice(0,i).join(".");
if((i==1)&&!this.moduleHasPrefix(_45)){
_43[0]="../"+_43[0];
}else{
var _46=this.getModulePrefix(_45);
if(_46!=_45){
_43.splice(0,i,_46);
break;
}
}
}
return _43;
};
dojo.hostenv._global_omit_module_check=false;
dojo.hostenv.loadModule=function(_47,_48,_49){
if(!_47){
return;
}
_49=this._global_omit_module_check||_49;
var _4a=this.findModule(_47,false);
if(_4a){
return _4a;
}
if(dj_undef(_47,this.loading_modules_)){
this.addedToLoadingCount.push(_47);
}
this.loading_modules_[_47]=1;
var _4b=_47.replace(/\./g,"/")+".js";
var _4c=_47.split(".");
var _4d=this.getModuleSymbols(_47);
var _4e=((_4d[0].charAt(0)!="/")&&!_4d[0].match(/^\w+:/));
var _4f=_4d[_4d.length-1];
var ok;
if(_4f=="*"){
_47=_4c.slice(0,-1).join(".");
while(_4d.length){
_4d.pop();
_4d.push(this.pkgFileName);
_4b=_4d.join("/")+".js";
if(_4e&&_4b.charAt(0)=="/"){
_4b=_4b.slice(1);
}
ok=this.loadPath(_4b,!_49?_47:null);
if(ok){
break;
}
_4d.pop();
}
}else{
_4b=_4d.join("/")+".js";
_47=_4c.join(".");
var _51=!_49?_47:null;
ok=this.loadPath(_4b,_51);
if(!ok&&!_48){
_4d.pop();
while(_4d.length){
_4b=_4d.join("/")+".js";
ok=this.loadPath(_4b,_51);
if(ok){
break;
}
_4d.pop();
_4b=_4d.join("/")+"/"+this.pkgFileName+".js";
if(_4e&&_4b.charAt(0)=="/"){
_4b=_4b.slice(1);
}
ok=this.loadPath(_4b,_51);
if(ok){
break;
}
}
}
if(!ok&&!_49){
dojo.raise("Could not load '"+_47+"'; last tried '"+_4b+"'");
}
}
if(!_49&&!this["isXDomain"]){
_4a=this.findModule(_47,false);
if(!_4a){
dojo.raise("symbol '"+_47+"' is not defined after loading '"+_4b+"'");
}
}
return _4a;
};
dojo.hostenv.startPackage=function(_52){
var _53=String(_52);
var _54=_53;
var _55=_52.split(/\./);
if(_55[_55.length-1]=="*"){
_55.pop();
_54=_55.join(".");
}
var _56=dojo.evalObjPath(_54,true);
this.loaded_modules_[_53]=_56;
this.loaded_modules_[_54]=_56;
return _56;
};
dojo.hostenv.findModule=function(_57,_58){
var lmn=String(_57);
if(this.loaded_modules_[lmn]){
return this.loaded_modules_[lmn];
}
if(_58){
dojo.raise("no loaded module named '"+_57+"'");
}
return null;
};
dojo.kwCompoundRequire=function(_5a){
var _5b=_5a["common"]||[];
var _5c=_5a[dojo.hostenv.name_]?_5b.concat(_5a[dojo.hostenv.name_]||[]):_5b.concat(_5a["default"]||[]);
for(var x=0;x<_5c.length;x++){
var _5e=_5c[x];
if(_5e.constructor==Array){
dojo.hostenv.loadModule.apply(dojo.hostenv,_5e);
}else{
dojo.hostenv.loadModule(_5e);
}
}
};
dojo.require=function(_5f){
dojo.hostenv.loadModule.apply(dojo.hostenv,arguments);
};
dojo.requireIf=function(_60,_61){
var _62=arguments[0];
if((_62===true)||(_62=="common")||(_62&&dojo.render[_62].capable)){
var _63=[];
for(var i=1;i<arguments.length;i++){
_63.push(arguments[i]);
}
dojo.require.apply(dojo,_63);
}
};
dojo.requireAfterIf=dojo.requireIf;
dojo.provide=function(_65){
return dojo.hostenv.startPackage.apply(dojo.hostenv,arguments);
};
dojo.registerModulePath=function(_66,_67){
return dojo.hostenv.setModulePrefix(_66,_67);
};
if(djConfig["modulePaths"]){
for(var param in djConfig["modulePaths"]){
dojo.registerModulePath(param,djConfig["modulePaths"][param]);
}
}
dojo.setModulePrefix=function(_68,_69){
dojo.deprecated("dojo.setModulePrefix(\""+_68+"\", \""+_69+"\")","replaced by dojo.registerModulePath","0.5");
return dojo.registerModulePath(_68,_69);
};
dojo.exists=function(obj,_6b){
var p=_6b.split(".");
for(var i=0;i<p.length;i++){
if(!obj[p[i]]){
return false;
}
obj=obj[p[i]];
}
return true;
};
dojo.hostenv.normalizeLocale=function(_6e){
var _6f=_6e?_6e.toLowerCase():dojo.locale;
if(_6f=="root"){
_6f="ROOT";
}
return _6f;
};
dojo.hostenv.searchLocalePath=function(_70,_71,_72){
_70=dojo.hostenv.normalizeLocale(_70);
var _73=_70.split("-");
var _74=[];
for(var i=_73.length;i>0;i--){
_74.push(_73.slice(0,i).join("-"));
}
_74.push(false);
if(_71){
_74.reverse();
}
for(var j=_74.length-1;j>=0;j--){
var loc=_74[j]||"ROOT";
var _78=_72(loc);
if(_78){
break;
}
}
};
dojo.hostenv.localesGenerated;
dojo.hostenv.registerNlsPrefix=function(){
dojo.registerModulePath("nls","nls");
};
dojo.hostenv.preloadLocalizations=function(){
if(dojo.hostenv.localesGenerated){
dojo.hostenv.registerNlsPrefix();
function preload(_79){
_79=dojo.hostenv.normalizeLocale(_79);
dojo.hostenv.searchLocalePath(_79,true,function(loc){
for(var i=0;i<dojo.hostenv.localesGenerated.length;i++){
if(dojo.hostenv.localesGenerated[i]==loc){
dojo["require"]("nls.dojo_"+loc);
return true;
}
}
return false;
});
}
preload();
var _7c=djConfig.extraLocale||[];
for(var i=0;i<_7c.length;i++){
preload(_7c[i]);
}
}
dojo.hostenv.preloadLocalizations=function(){
};
};
dojo.requireLocalization=function(_7e,_7f,_80,_81){
dojo.hostenv.preloadLocalizations();
var _82=dojo.hostenv.normalizeLocale(_80);
var _83=[_7e,"nls",_7f].join(".");
var _84="";
if(_81){
var _85=_81.split(",");
for(var i=0;i<_85.length;i++){
if(_82.indexOf(_85[i])==0){
if(_85[i].length>_84.length){
_84=_85[i];
}
}
}
if(!_84){
_84="ROOT";
}
}
var _87=_81?_84:_82;
var _88=dojo.hostenv.findModule(_83);
var _89=null;
if(_88){
if(djConfig.localizationComplete&&_88._built){
return;
}
var _8a=_87.replace("-","_");
var _8b=_83+"."+_8a;
_89=dojo.hostenv.findModule(_8b);
}
if(!_89){
_88=dojo.hostenv.startPackage(_83);
var _8c=dojo.hostenv.getModuleSymbols(_7e);
var _8d=_8c.concat("nls").join("/");
var _8e;
dojo.hostenv.searchLocalePath(_87,_81,function(loc){
var _90=loc.replace("-","_");
var _91=_83+"."+_90;
var _92=false;
if(!dojo.hostenv.findModule(_91)){
dojo.hostenv.startPackage(_91);
var _93=[_8d];
if(loc!="ROOT"){
_93.push(loc);
}
_93.push(_7f);
var _94=_93.join("/")+".js";
_92=dojo.hostenv.loadPath(_94,null,function(_95){
var _96=function(){
};
_96.prototype=_8e;
_88[_90]=new _96();
for(var j in _95){
_88[_90][j]=_95[j];
}
});
}else{
_92=true;
}
if(_92&&_88[_90]){
_8e=_88[_90];
}else{
_88[_90]=_8e;
}
if(_81){
return true;
}
});
}
if(_81&&_82!=_84){
_88[_82.replace("-","_")]=_88[_84.replace("-","_")];
}
};
(function(){
var _98=djConfig.extraLocale;
if(_98){
if(!_98 instanceof Array){
_98=[_98];
}
var req=dojo.requireLocalization;
dojo.requireLocalization=function(m,b,_9c,_9d){
req(m,b,_9c,_9d);
if(_9c){
return;
}
for(var i=0;i<_98.length;i++){
req(m,b,_98[i],_9d);
}
};
}
})();
dojo.hostenv.resetXd=function(){
this.isXDomain=djConfig.useXDomain||false;
this.xdTimer=0;
this.xdInFlight={};
this.xdOrderedReqs=[];
this.xdDepMap={};
this.xdContents=[];
this.xdDefList=[];
};
dojo.hostenv.resetXd();
dojo.hostenv.createXdPackage=function(_9f,_a0,_a1){
var _a2=[];
var _a3=/dojo.(requireLocalization|require|requireIf|requireAll|provide|requireAfterIf|requireAfter|kwCompoundRequire|conditionalRequire|hostenv\.conditionalLoadModule|.hostenv\.loadModule|hostenv\.moduleLoaded)\(([\w\W]*?)\)/mg;
var _a4;
while((_a4=_a3.exec(_9f))!=null){
if(_a4[1]=="requireLocalization"){
eval(_a4[0]);
}else{
_a2.push("\""+_a4[1]+"\", "+_a4[2]);
}
}
var _a5=[];
_a5.push("dojo.hostenv.packageLoaded({\n");
if(_a2.length>0){
_a5.push("depends: [");
for(var i=0;i<_a2.length;i++){
if(i>0){
_a5.push(",\n");
}
_a5.push("["+_a2[i]+"]");
}
_a5.push("],");
}
_a5.push("\ndefinePackage: function(dojo){");
_a5.push(_9f);
_a5.push("\n}, resourceName: '"+_a0+"', resourcePath: '"+_a1+"'});");
return _a5.join("");
};
dojo.hostenv.loadPath=function(_a7,_a8,cb){
var _aa=_a7.indexOf(":");
var _ab=_a7.indexOf("/");
var uri;
var _ad=false;
if(_aa>0&&_aa<_ab){
uri=_a7;
this.isXDomain=_ad=true;
}else{
uri=this.getBaseScriptUri()+_a7;
_aa=uri.indexOf(":");
_ab=uri.indexOf("/");
if(_aa>0&&_aa<_ab&&(!location.host||uri.indexOf("http://"+location.host)!=0)){
this.isXDomain=_ad=true;
}
}
if(djConfig.cacheBust&&dojo.render.html.capable){
uri+="?"+String(djConfig.cacheBust).replace(/\W+/g,"");
}
try{
return ((!_a8||this.isXDomain)?this.loadUri(uri,cb,_ad,_a8):this.loadUriAndCheck(uri,_a8,cb));
}
catch(e){
dojo.debug(e);
return false;
}
};
dojo.hostenv.loadUri=function(uri,cb,_b0,_b1){
if(this.loadedUris[uri]){
return 1;
}
if(this.isXDomain&&_b1){
if(uri.indexOf("__package__")!=-1){
_b1+=".*";
}
this.xdOrderedReqs.push(_b1);
if(_b0||uri.indexOf("/nls/")==-1){
this.xdInFlight[_b1]=true;
this.inFlightCount++;
}
if(!this.xdTimer){
this.xdTimer=setInterval("dojo.hostenv.watchInFlightXDomain();",100);
}
this.xdStartTime=(new Date()).getTime();
}
if(_b0){
var _b2=uri.lastIndexOf(".");
if(_b2<=0){
_b2=uri.length-1;
}
var _b3=uri.substring(0,_b2)+".xd";
if(_b2!=uri.length-1){
_b3+=uri.substring(_b2,uri.length);
}
var _b4=document.createElement("script");
_b4.type="text/javascript";
_b4.src=_b3;
if(!this.headElement){
this.headElement=document.getElementsByTagName("head")[0];
if(!this.headElement){
this.headElement=document.getElementsByTagName("html")[0];
}
}
this.headElement.appendChild(_b4);
}else{
var _b5=this.getText(uri,null,true);
if(_b5==null){
return 0;
}
if(this.isXDomain&&uri.indexOf("/nls/")==-1){
var pkg=this.createXdPackage(_b5,_b1,uri);
dj_eval(pkg);
}else{
if(cb){
_b5="("+_b5+")";
}
var _b7=dj_eval(_b5);
if(cb){
cb(_b7);
}
}
}
this.loadedUris[uri]=true;
return 1;
};
dojo.hostenv.packageLoaded=function(pkg){
var _b9=pkg.depends;
var _ba=null;
var _bb=null;
var _bc=[];
if(_b9&&_b9.length>0){
var dep=null;
var _be=0;
var _bf=false;
for(var i=0;i<_b9.length;i++){
dep=_b9[i];
if(dep[0]=="provide"||dep[0]=="hostenv.moduleLoaded"){
_bc.push(dep[1]);
}else{
if(!_ba){
_ba=[];
}
if(!_bb){
_bb=[];
}
var _c1=this.unpackXdDependency(dep);
if(_c1.requires){
_ba=_ba.concat(_c1.requires);
}
if(_c1.requiresAfter){
_bb=_bb.concat(_c1.requiresAfter);
}
}
var _c2=dep[0];
var _c3=_c2.split(".");
if(_c3.length==2){
dojo[_c3[0]][_c3[1]].apply(dojo[_c3[0]],dep.slice(1));
}else{
dojo[_c2].apply(dojo,dep.slice(1));
}
}
var _c4=this.xdContents.push({content:pkg.definePackage,resourceName:pkg["resourceName"],resourcePath:pkg["resourcePath"],isDefined:false})-1;
for(var i=0;i<_bc.length;i++){
this.xdDepMap[_bc[i]]={requires:_ba,requiresAfter:_bb,contentIndex:_c4};
}
for(var i=0;i<_bc.length;i++){
this.xdInFlight[_bc[i]]=false;
}
}
};
dojo.hostenv.xdLoadFlattenedBundle=function(_c5,_c6,_c7,_c8){
_c7=_c7||"root";
var _c9=dojo.hostenv.normalizeLocale(_c7).replace("-","_");
var _ca=[_c5,"nls",_c6].join(".");
var _cb=dojo.hostenv.startPackage(_ca);
_cb[_c9]=_c8;
var _cc=[_c5,_c9,_c6].join(".");
var _cd=dojo.hostenv.xdBundleMap[_cc];
if(_cd){
for(var _ce in _cd){
_cb[_ce]=_c8;
}
}
};
dojo.hostenv.xdBundleMap={};
dojo.xdRequireLocalization=function(_cf,_d0,_d1,_d2){
var _d3=_d2.split(",");
var _d4=dojo.hostenv.normalizeLocale(_d1);
var _d5="";
for(var i=0;i<_d3.length;i++){
if(_d4.indexOf(_d3[i])==0){
if(_d3[i].length>_d5.length){
_d5=_d3[i];
}
}
}
var _d7=_d5.replace("-","_");
var _d8=dojo.evalObjPath([_cf,"nls",_d0].join("."));
if(_d8&&_d8[_d7]){
bundle[_d4.replace("-","_")]=_d8[_d7];
}else{
var _d9=[_cf,(_d7||"root"),_d0].join(".");
var _da=dojo.hostenv.xdBundleMap[_d9];
if(!_da){
_da=dojo.hostenv.xdBundleMap[_d9]={};
}
_da[_d4.replace("-","_")]=true;
dojo.require(_cf+".nls"+(_d5?"."+_d5:"")+"."+_d0);
}
};
(function(){
var _db=djConfig.extraLocale;
if(_db){
if(!_db instanceof Array){
_db=[_db];
}
dojo._xdReqLoc=dojo.xdRequireLocalization;
dojo.xdRequireLocalization=function(m,b,_de,_df){
dojo._xdReqLoc(m,b,_de,_df);
if(_de){
return;
}
for(var i=0;i<_db.length;i++){
dojo._xdReqLoc(m,b,_db[i],_df);
}
};
}
})();
dojo.hostenv.unpackXdDependency=function(dep){
var _e2=null;
var _e3=null;
switch(dep[0]){
case "requireIf":
case "requireAfterIf":
case "conditionalRequire":
if((dep[1]===true)||(dep[1]=="common")||(dep[1]&&dojo.render[dep[1]].capable)){
_e2=[{name:dep[2],content:null}];
}
break;
case "requireAll":
dep.shift();
_e2=dep;
dojo.hostenv.flattenRequireArray(_e2);
break;
case "kwCompoundRequire":
case "hostenv.conditionalLoadModule":
var _e4=dep[1];
var _e5=_e4["common"]||[];
var _e2=(_e4[dojo.hostenv.name_])?_e5.concat(_e4[dojo.hostenv.name_]||[]):_e5.concat(_e4["default"]||[]);
dojo.hostenv.flattenRequireArray(_e2);
break;
case "require":
case "requireAfter":
case "hostenv.loadModule":
_e2=[{name:dep[1],content:null}];
break;
}
if(dep[0]=="requireAfterIf"||dep[0]=="requireIf"){
_e3=_e2;
_e2=null;
}
return {requires:_e2,requiresAfter:_e3};
};
dojo.hostenv.xdWalkReqs=function(){
var _e6=null;
var req;
for(var i=0;i<this.xdOrderedReqs.length;i++){
req=this.xdOrderedReqs[i];
if(this.xdDepMap[req]){
_e6=[req];
_e6[req]=true;
this.xdEvalReqs(_e6);
}
}
};
dojo.hostenv.xdEvalReqs=function(_e9){
while(_e9.length>0){
var req=_e9[_e9.length-1];
var pkg=this.xdDepMap[req];
if(pkg){
var _ec=pkg.requires;
if(_ec&&_ec.length>0){
var _ed;
for(var i=0;i<_ec.length;i++){
_ed=_ec[i].name;
if(_ed&&!_e9[_ed]){
_e9.push(_ed);
_e9[_ed]=true;
this.xdEvalReqs(_e9);
}
}
}
var _ef=this.xdContents[pkg.contentIndex];
if(!_ef.isDefined){
var _f0=_ef.content;
_f0["resourceName"]=_ef["resourceName"];
_f0["resourcePath"]=_ef["resourcePath"];
this.xdDefList.push(_f0);
_ef.isDefined=true;
}
this.xdDepMap[req]=null;
var _ec=pkg.requiresAfter;
if(_ec&&_ec.length>0){
var _ed;
for(var i=0;i<_ec.length;i++){
_ed=_ec[i].name;
if(_ed&&!_e9[_ed]){
_e9.push(_ed);
_e9[_ed]=true;
this.xdEvalReqs(_e9);
}
}
}
}
_e9.pop();
}
};
dojo.hostenv.clearXdInterval=function(){
clearInterval(this.xdTimer);
this.xdTimer=0;
};
dojo.hostenv.watchInFlightXDomain=function(){
var _f1=(djConfig.xdWaitSeconds||15)*1000;
if(this.xdStartTime+_f1<(new Date()).getTime()){
this.clearXdInterval();
var _f2="";
for(var _f3 in this.xdInFlight){
if(this.xdInFlight[_f3]){
_f2+=_f3+" ";
}
}
dojo.raise("Could not load cross-domain packages: "+_f2);
}
for(var _f3 in this.xdInFlight){
if(this.xdInFlight[_f3]){
return;
}
}
this.clearXdInterval();
this.xdWalkReqs();
var _f4=this.xdDefList.length;
for(var i=0;i<_f4;i++){
var _f6=dojo.hostenv.xdDefList[i];
if(djConfig["debugAtAllCosts"]&&_f6["resourceName"]){
if(!this["xdDebugQueue"]){
this.xdDebugQueue=[];
}
this.xdDebugQueue.push({resourceName:_f6.resourceName,resourcePath:_f6.resourcePath});
}else{
_f6(dojo);
}
}
for(var i=0;i<this.xdContents.length;i++){
var _f7=this.xdContents[i];
if(_f7.content&&!_f7.isDefined){
_f7.content(dojo);
}
}
this.resetXd();
if(this["xdDebugQueue"]&&this.xdDebugQueue.length>0){
this.xdDebugFileLoaded();
}else{
this.xdNotifyLoaded();
}
};
dojo.hostenv.xdNotifyLoaded=function(){
this.inFlightCount=0;
if(this._djInitFired&&!this.loadNotifying){
this.callLoaded();
}
};
dojo.hostenv.flattenRequireArray=function(_f8){
if(_f8){
for(var i=0;i<_f8.length;i++){
if(_f8[i] instanceof Array){
_f8[i]={name:_f8[i][0],content:null};
}else{
_f8[i]={name:_f8[i],content:null};
}
}
}
};
dojo.hostenv.xdHasCalledPreload=false;
dojo.hostenv.xdRealCallLoaded=dojo.hostenv.callLoaded;
dojo.hostenv.callLoaded=function(){
if(this.xdHasCalledPreload||dojo.hostenv.getModulePrefix("dojo")=="src"||!this.localesGenerated){
this.xdRealCallLoaded();
}else{
if(this.localesGenerated){
this.registerNlsPrefix=function(){
dojo.registerModulePath("nls",dojo.hostenv.getModulePrefix("dojo")+"/../nls");
};
this.preloadLocalizations();
}
}
this.xdHasCalledPreload=true;
};
}
if(typeof window!="undefined"){
(function(){
if(djConfig.allowQueryConfig){
var _fa=document.location.toString();
var _fb=_fa.split("?",2);
if(_fb.length>1){
var _fc=_fb[1];
var _fd=_fc.split("&");
for(var x in _fd){
var sp=_fd[x].split("=");
if((sp[0].length>9)&&(sp[0].substr(0,9)=="djConfig.")){
var opt=sp[0].substr(9);
try{
djConfig[opt]=eval(sp[1]);
}
catch(e){
djConfig[opt]=sp[1];
}
}
}
}
}
if(((djConfig["baseScriptUri"]=="")||(djConfig["baseRelativePath"]==""))&&(document&&document.getElementsByTagName)){
var _101=document.getElementsByTagName("script");
var _102=/(__package__|dojo|bootstrap1)\.js([\?\.]|$)/i;
for(var i=0;i<_101.length;i++){
var src=_101[i].getAttribute("src");
if(!src){
continue;
}
var m=src.match(_102);
if(m){
var root=src.substring(0,m.index);
if(src.indexOf("bootstrap1")>-1){
root+="../";
}
if(!this["djConfig"]){
djConfig={};
}
if(djConfig["baseScriptUri"]==""){
djConfig["baseScriptUri"]=root;
}
if(djConfig["baseRelativePath"]==""){
djConfig["baseRelativePath"]=root;
}
break;
}
}
}
var dr=dojo.render;
var drh=dojo.render.html;
var drs=dojo.render.svg;
var dua=(drh.UA=navigator.userAgent);
var dav=(drh.AV=navigator.appVersion);
var t=true;
var f=false;
drh.capable=t;
drh.support.builtin=t;
dr.ver=parseFloat(drh.AV);
dr.os.mac=dav.indexOf("Macintosh")>=0;
dr.os.win=dav.indexOf("Windows")>=0;
dr.os.linux=dav.indexOf("X11")>=0;
drh.opera=dua.indexOf("Opera")>=0;
drh.khtml=(dav.indexOf("Konqueror")>=0)||(dav.indexOf("Safari")>=0);
drh.safari=dav.indexOf("Safari")>=0;
var _10e=dua.indexOf("Gecko");
drh.mozilla=drh.moz=(_10e>=0)&&(!drh.khtml);
if(drh.mozilla){
drh.geckoVersion=dua.substring(_10e+6,_10e+14);
}
drh.ie=(document.all)&&(!drh.opera);
drh.ie50=drh.ie&&dav.indexOf("MSIE 5.0")>=0;
drh.ie55=drh.ie&&dav.indexOf("MSIE 5.5")>=0;
drh.ie60=drh.ie&&dav.indexOf("MSIE 6.0")>=0;
drh.ie70=drh.ie&&dav.indexOf("MSIE 7.0")>=0;
var cm=document["compatMode"];
drh.quirks=(cm=="BackCompat")||(cm=="QuirksMode")||drh.ie55||drh.ie50;
dojo.locale=dojo.locale||(drh.ie?navigator.userLanguage:navigator.language).toLowerCase();
dr.vml.capable=drh.ie;
drs.capable=f;
drs.support.plugin=f;
drs.support.builtin=f;
var tdoc=window["document"];
var tdi=tdoc["implementation"];
if((tdi)&&(tdi["hasFeature"])&&(tdi.hasFeature("org.w3c.dom.svg","1.0"))){
drs.capable=t;
drs.support.builtin=t;
drs.support.plugin=f;
}
if(drh.safari){
var tmp=dua.split("AppleWebKit/")[1];
var ver=parseFloat(tmp.split(" ")[0]);
if(ver>=420){
drs.capable=t;
drs.support.builtin=t;
drs.support.plugin=f;
}
}else{
}
})();
dojo.hostenv.startPackage("dojo.hostenv");
dojo.render.name=dojo.hostenv.name_="browser";
dojo.hostenv.searchIds=[];
dojo.hostenv._XMLHTTP_PROGIDS=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];
dojo.hostenv.getXmlhttpObject=function(){
var http=null;
var _115=null;
try{
http=new XMLHttpRequest();
}
catch(e){
}
if(!http){
for(var i=0;i<3;++i){
var _117=dojo.hostenv._XMLHTTP_PROGIDS[i];
try{
http=new ActiveXObject(_117);
}
catch(e){
_115=e;
}
if(http){
dojo.hostenv._XMLHTTP_PROGIDS=[_117];
break;
}
}
}
if(!http){
return dojo.raise("XMLHTTP not available",_115);
}
return http;
};
dojo.hostenv._blockAsync=false;
dojo.hostenv.getText=function(uri,_119,_11a){
if(!_119){
this._blockAsync=true;
}
var http=this.getXmlhttpObject();
function isDocumentOk(http){
var stat=http["status"];
return Boolean((!stat)||((200<=stat)&&(300>stat))||(stat==304));
}
if(_119){
var _11e=this,_11f=null,gbl=dojo.global();
var xhr=dojo.evalObjPath("dojo.io.XMLHTTPTransport");
http.onreadystatechange=function(){
if(_11f){
gbl.clearTimeout(_11f);
_11f=null;
}
if(_11e._blockAsync||(xhr&&xhr._blockAsync)){
_11f=gbl.setTimeout(function(){
http.onreadystatechange.apply(this);
},10);
}else{
if(4==http.readyState){
if(isDocumentOk(http)){
_119(http.responseText);
}
}
}
};
}
http.open("GET",uri,_119?true:false);
try{
http.send(null);
if(_119){
return null;
}
if(!isDocumentOk(http)){
var err=Error("Unable to load "+uri+" status:"+http.status);
err.status=http.status;
err.responseText=http.responseText;
throw err;
}
}
catch(e){
this._blockAsync=false;
if((_11a)&&(!_119)){
return null;
}else{
throw e;
}
}
this._blockAsync=false;
return http.responseText;
};
dojo.hostenv.defaultDebugContainerId="dojoDebug";
dojo.hostenv._println_buffer=[];
dojo.hostenv._println_safe=false;
dojo.hostenv.println=function(line){
if(!dojo.hostenv._println_safe){
dojo.hostenv._println_buffer.push(line);
}else{
try{
var _124=document.getElementById(djConfig.debugContainerId?djConfig.debugContainerId:dojo.hostenv.defaultDebugContainerId);
if(!_124){
_124=dojo.body();
}
var div=document.createElement("div");
div.appendChild(document.createTextNode(line));
_124.appendChild(div);
}
catch(e){
try{
document.write("<div>"+line+"</div>");
}
catch(e2){
window.status=line;
}
}
}
};
dojo.addOnLoad(function(){
dojo.hostenv._println_safe=true;
while(dojo.hostenv._println_buffer.length>0){
dojo.hostenv.println(dojo.hostenv._println_buffer.shift());
}
});
function dj_addNodeEvtHdlr(node,_127,fp){
var _129=node["on"+_127]||function(){
};
node["on"+_127]=function(){
fp.apply(node,arguments);
_129.apply(node,arguments);
};
return true;
}
dojo.hostenv._djInitFired=false;
function dj_load_init(e){
dojo.hostenv._djInitFired=true;
var type=(e&&e.type)?e.type.toLowerCase():"load";
if(arguments.callee.initialized||(type!="domcontentloaded"&&type!="load")){
return;
}
arguments.callee.initialized=true;
if(typeof (_timer)!="undefined"){
clearInterval(_timer);
delete _timer;
}
var _12c=function(){
if(dojo.render.html.ie){
dojo.hostenv.makeWidgets();
}
};
if(dojo.hostenv.inFlightCount==0){
_12c();
dojo.hostenv.modulesLoaded();
}else{
dojo.hostenv.modulesLoadedListeners.unshift(_12c);
}
}
if(document.addEventListener){
if(dojo.render.html.opera||(dojo.render.html.moz&&(djConfig["enableMozDomContentLoaded"]===true))){
document.addEventListener("DOMContentLoaded",dj_load_init,null);
}
window.addEventListener("load",dj_load_init,null);
}
if(dojo.render.html.ie&&dojo.render.os.win){
document.attachEvent("onreadystatechange",function(e){
if(document.readyState=="complete"){
dj_load_init();
}
});
}
if(/(WebKit|khtml)/i.test(navigator.userAgent)){
var _timer=setInterval(function(){
if(/loaded|complete/.test(document.readyState)){
dj_load_init();
}
},10);
}
if(dojo.render.html.ie){
dj_addNodeEvtHdlr(window,"beforeunload",function(){
dojo.hostenv._unloading=true;
window.setTimeout(function(){
dojo.hostenv._unloading=false;
},0);
});
}
dj_addNodeEvtHdlr(window,"unload",function(){
dojo.hostenv.unloaded();
if((!dojo.render.html.ie)||(dojo.render.html.ie&&dojo.hostenv._unloading)){
dojo.hostenv.unloaded();
}
});
dojo.hostenv.makeWidgets=function(){
var sids=[];
if(djConfig.searchIds&&djConfig.searchIds.length>0){
sids=sids.concat(djConfig.searchIds);
}
if(dojo.hostenv.searchIds&&dojo.hostenv.searchIds.length>0){
sids=sids.concat(dojo.hostenv.searchIds);
}
if((djConfig.parseWidgets)||(sids.length>0)){
if(dojo.evalObjPath("dojo.widget.Parse")){
var _12f=new dojo.xml.Parse();
if(sids.length>0){
for(var x=0;x<sids.length;x++){
var _131=document.getElementById(sids[x]);
if(!_131){
continue;
}
var frag=_12f.parseElement(_131,null,true);
dojo.widget.getParser().createComponents(frag);
}
}else{
if(djConfig.parseWidgets){
var frag=_12f.parseElement(dojo.body(),null,true);
dojo.widget.getParser().createComponents(frag);
}
}
}
}
};
dojo.addOnLoad(function(){
if(!dojo.render.html.ie){
dojo.hostenv.makeWidgets();
}
});
try{
if(dojo.render.html.ie){
document.namespaces.add("v","urn:schemas-microsoft-com:vml");
document.createStyleSheet().addRule("v\\:*","behavior:url(#default#VML)");
}
}
catch(e){
}
dojo.hostenv.writeIncludes=function(){
};
if(!dj_undef("document",this)){
dj_currentDocument=this.document;
}
dojo.doc=function(){
return dj_currentDocument;
};
dojo.body=function(){
return dojo.doc().body||dojo.doc().getElementsByTagName("body")[0];
};
dojo.byId=function(id,doc){
if((id)&&((typeof id=="string")||(id instanceof String))){
if(!doc){
doc=dj_currentDocument;
}
var ele=doc.getElementById(id);
if(ele&&(ele.id!=id)&&doc.all){
ele=null;
eles=doc.all[id];
if(eles){
if(eles.length){
for(var i=0;i<eles.length;i++){
if(eles[i].id==id){
ele=eles[i];
break;
}
}
}else{
ele=eles;
}
}
}
return ele;
}
return id;
};
dojo.setContext=function(_137,_138){
dj_currentContext=_137;
dj_currentDocument=_138;
};
dojo._fireCallback=function(_139,_13a,_13b){
if((_13a)&&((typeof _139=="string")||(_139 instanceof String))){
_139=_13a[_139];
}
return (_13a?_139.apply(_13a,_13b||[]):_139());
};
dojo.withGlobal=function(_13c,_13d,_13e,_13f){
var rval;
var _141=dj_currentContext;
var _142=dj_currentDocument;
try{
dojo.setContext(_13c,_13c.document);
rval=dojo._fireCallback(_13d,_13e,_13f);
}
finally{
dojo.setContext(_141,_142);
}
return rval;
};
dojo.withDoc=function(_143,_144,_145,_146){
var rval;
var _148=dj_currentDocument;
try{
dj_currentDocument=_143;
rval=dojo._fireCallback(_144,_145,_146);
}
finally{
dj_currentDocument=_148;
}
return rval;
};
}
(function(){
if(typeof dj_usingBootstrap!="undefined"){
return;
}
var _149=false;
var _14a=false;
var _14b=false;
if((typeof this["load"]=="function")&&((typeof this["Packages"]=="function")||(typeof this["Packages"]=="object"))){
_149=true;
}else{
if(typeof this["load"]=="function"){
_14a=true;
}else{
if(window.widget){
_14b=true;
}
}
}
var tmps=[];
if((this["djConfig"])&&((djConfig["isDebug"])||(djConfig["debugAtAllCosts"]))){
tmps.push("debug.js");
}
if((this["djConfig"])&&(djConfig["debugAtAllCosts"])&&(!_149)&&(!_14b)){
tmps.push("browser_debug.js");
}
var _14d=djConfig["baseScriptUri"];
if((this["djConfig"])&&(djConfig["baseLoaderUri"])){
_14d=djConfig["baseLoaderUri"];
}
for(var x=0;x<tmps.length;x++){
var _14f=_14d+"src/"+tmps[x];
if(_149||_14a){
load(_14f);
}else{
try{
document.write("<scr"+"ipt type='text/javascript' src='"+_14f+"'></scr"+"ipt>");
}
catch(e){
var _150=document.createElement("script");
_150.src=_14f;
document.getElementsByTagName("head")[0].appendChild(_150);
}
}
}
})();
dojo.provide("dojo.dom");
dojo.dom.ELEMENT_NODE=1;
dojo.dom.ATTRIBUTE_NODE=2;
dojo.dom.TEXT_NODE=3;
dojo.dom.CDATA_SECTION_NODE=4;
dojo.dom.ENTITY_REFERENCE_NODE=5;
dojo.dom.ENTITY_NODE=6;
dojo.dom.PROCESSING_INSTRUCTION_NODE=7;
dojo.dom.COMMENT_NODE=8;
dojo.dom.DOCUMENT_NODE=9;
dojo.dom.DOCUMENT_TYPE_NODE=10;
dojo.dom.DOCUMENT_FRAGMENT_NODE=11;
dojo.dom.NOTATION_NODE=12;
dojo.dom.dojoml="http://www.dojotoolkit.org/2004/dojoml";
dojo.dom.xmlns={svg:"http://www.w3.org/2000/svg",smil:"http://www.w3.org/2001/SMIL20/",mml:"http://www.w3.org/1998/Math/MathML",cml:"http://www.xml-cml.org",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",xul:"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul",xbl:"http://www.mozilla.org/xbl",fo:"http://www.w3.org/1999/XSL/Format",xsl:"http://www.w3.org/1999/XSL/Transform",xslt:"http://www.w3.org/1999/XSL/Transform",xi:"http://www.w3.org/2001/XInclude",xforms:"http://www.w3.org/2002/01/xforms",saxon:"http://icl.com/saxon",xalan:"http://xml.apache.org/xslt",xsd:"http://www.w3.org/2001/XMLSchema",dt:"http://www.w3.org/2001/XMLSchema-datatypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",dc:"http://purl.org/dc/elements/1.1/",dcq:"http://purl.org/dc/qualifiers/1.0","soap-env":"http://schemas.xmlsoap.org/soap/envelope/",wsdl:"http://schemas.xmlsoap.org/wsdl/",AdobeExtensions:"http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"};
dojo.dom.isNode=function(wh){
if(typeof Element=="function"){
try{
return wh instanceof Element;
}
catch(e){
}
}else{
return wh&&!isNaN(wh.nodeType);
}
};
dojo.dom.getUniqueId=function(){
var _152=dojo.doc();
do{
var id="dj_unique_"+(++arguments.callee._idIncrement);
}while(_152.getElementById(id));
return id;
};
dojo.dom.getUniqueId._idIncrement=0;
dojo.dom.firstElement=dojo.dom.getFirstChildElement=function(_154,_155){
var node=_154.firstChild;
while(node&&node.nodeType!=dojo.dom.ELEMENT_NODE){
node=node.nextSibling;
}
if(_155&&node&&node.tagName&&node.tagName.toLowerCase()!=_155.toLowerCase()){
node=dojo.dom.nextElement(node,_155);
}
return node;
};
dojo.dom.lastElement=dojo.dom.getLastChildElement=function(_157,_158){
var node=_157.lastChild;
while(node&&node.nodeType!=dojo.dom.ELEMENT_NODE){
node=node.previousSibling;
}
if(_158&&node&&node.tagName&&node.tagName.toLowerCase()!=_158.toLowerCase()){
node=dojo.dom.prevElement(node,_158);
}
return node;
};
dojo.dom.nextElement=dojo.dom.getNextSiblingElement=function(node,_15b){
if(!node){
return null;
}
do{
node=node.nextSibling;
}while(node&&node.nodeType!=dojo.dom.ELEMENT_NODE);
if(node&&_15b&&_15b.toLowerCase()!=node.tagName.toLowerCase()){
return dojo.dom.nextElement(node,_15b);
}
return node;
};
dojo.dom.prevElement=dojo.dom.getPreviousSiblingElement=function(node,_15d){
if(!node){
return null;
}
if(_15d){
_15d=_15d.toLowerCase();
}
do{
node=node.previousSibling;
}while(node&&node.nodeType!=dojo.dom.ELEMENT_NODE);
if(node&&_15d&&_15d.toLowerCase()!=node.tagName.toLowerCase()){
return dojo.dom.prevElement(node,_15d);
}
return node;
};
dojo.dom.moveChildren=function(_15e,_15f,trim){
var _161=0;
if(trim){
while(_15e.hasChildNodes()&&_15e.firstChild.nodeType==dojo.dom.TEXT_NODE){
_15e.removeChild(_15e.firstChild);
}
while(_15e.hasChildNodes()&&_15e.lastChild.nodeType==dojo.dom.TEXT_NODE){
_15e.removeChild(_15e.lastChild);
}
}
while(_15e.hasChildNodes()){
_15f.appendChild(_15e.firstChild);
_161++;
}
return _161;
};
dojo.dom.copyChildren=function(_162,_163,trim){
var _165=_162.cloneNode(true);
return this.moveChildren(_165,_163,trim);
};
dojo.dom.replaceChildren=function(node,_167){
var _168=[];
if(dojo.render.html.ie){
for(var i=0;i<node.childNodes.length;i++){
_168.push(node.childNodes[i]);
}
}
dojo.dom.removeChildren(node);
node.appendChild(_167);
for(var i=0;i<_168.length;i++){
dojo.dom.destroyNode(_168[i]);
}
};
dojo.dom.removeChildren=function(node){
var _16b=node.childNodes.length;
while(node.hasChildNodes()){
dojo.dom.removeNode(node.firstChild);
}
return _16b;
};
dojo.dom.replaceNode=function(node,_16d){
return node.parentNode.replaceChild(_16d,node);
};
dojo.dom.destroyNode=function(node){
if(node.parentNode){
node=dojo.dom.removeNode(node);
}
if(node.nodeType!=3){
if(dojo.evalObjPath("dojo.event.browser.clean",false)){
dojo.event.browser.clean(node);
}
if(dojo.render.html.ie){
node.outerHTML="";
}
}
};
dojo.dom.removeNode=function(node){
if(node&&node.parentNode){
return node.parentNode.removeChild(node);
}
};
dojo.dom.getAncestors=function(node,_171,_172){
var _173=[];
var _174=(_171&&(_171 instanceof Function||typeof _171=="function"));
while(node){
if(!_174||_171(node)){
_173.push(node);
}
if(_172&&_173.length>0){
return _173[0];
}
node=node.parentNode;
}
if(_172){
return null;
}
return _173;
};
dojo.dom.getAncestorsByTag=function(node,tag,_177){
tag=tag.toLowerCase();
return dojo.dom.getAncestors(node,function(el){
return ((el.tagName)&&(el.tagName.toLowerCase()==tag));
},_177);
};
dojo.dom.getFirstAncestorByTag=function(node,tag){
return dojo.dom.getAncestorsByTag(node,tag,true);
};
dojo.dom.isDescendantOf=function(node,_17c,_17d){
if(_17d&&node){
node=node.parentNode;
}
while(node){
if(node==_17c){
return true;
}
node=node.parentNode;
}
return false;
};
dojo.dom.innerXML=function(node){
if(node.innerXML){
return node.innerXML;
}else{
if(node.xml){
return node.xml;
}else{
if(typeof XMLSerializer!="undefined"){
return (new XMLSerializer()).serializeToString(node);
}
}
}
};
dojo.dom.createDocument=function(){
var doc=null;
var _180=dojo.doc();
if(!dj_undef("ActiveXObject")){
var _181=["MSXML2","Microsoft","MSXML","MSXML3"];
for(var i=0;i<_181.length;i++){
try{
doc=new ActiveXObject(_181[i]+".XMLDOM");
}
catch(e){
}
if(doc){
break;
}
}
}else{
if((_180.implementation)&&(_180.implementation.createDocument)){
doc=_180.implementation.createDocument("","",null);
}
}
return doc;
};
dojo.dom.createDocumentFromText=function(str,_184){
if(!_184){
_184="text/xml";
}
if(!dj_undef("DOMParser")){
var _185=new DOMParser();
return _185.parseFromString(str,_184);
}else{
if(!dj_undef("ActiveXObject")){
var _186=dojo.dom.createDocument();
if(_186){
_186.async=false;
_186.loadXML(str);
return _186;
}else{
dojo.debug("toXml didn't work?");
}
}else{
var _187=dojo.doc();
if(_187.createElement){
var tmp=_187.createElement("xml");
tmp.innerHTML=str;
if(_187.implementation&&_187.implementation.createDocument){
var _189=_187.implementation.createDocument("foo","",null);
for(var i=0;i<tmp.childNodes.length;i++){
_189.importNode(tmp.childNodes.item(i),true);
}
return _189;
}
return ((tmp.document)&&(tmp.document.firstChild?tmp.document.firstChild:tmp));
}
}
}
return null;
};
dojo.dom.prependChild=function(node,_18c){
if(_18c.firstChild){
_18c.insertBefore(node,_18c.firstChild);
}else{
_18c.appendChild(node);
}
return true;
};
dojo.dom.insertBefore=function(node,ref,_18f){
if((_18f!=true)&&(node===ref||node.nextSibling===ref)){
return false;
}
var _190=ref.parentNode;
_190.insertBefore(node,ref);
return true;
};
dojo.dom.insertAfter=function(node,ref,_193){
var pn=ref.parentNode;
if(ref==pn.lastChild){
if((_193!=true)&&(node===ref)){
return false;
}
pn.appendChild(node);
}else{
return this.insertBefore(node,ref.nextSibling,_193);
}
return true;
};
dojo.dom.insertAtPosition=function(node,ref,_197){
if((!node)||(!ref)||(!_197)){
return false;
}
switch(_197.toLowerCase()){
case "before":
return dojo.dom.insertBefore(node,ref);
case "after":
return dojo.dom.insertAfter(node,ref);
case "first":
if(ref.firstChild){
return dojo.dom.insertBefore(node,ref.firstChild);
}else{
ref.appendChild(node);
return true;
}
break;
default:
ref.appendChild(node);
return true;
}
};
dojo.dom.insertAtIndex=function(node,_199,_19a){
var _19b=_199.childNodes;
if(!_19b.length||_19b.length==_19a){
_199.appendChild(node);
return true;
}
if(_19a==0){
return dojo.dom.prependChild(node,_199);
}
return dojo.dom.insertAfter(node,_19b[_19a-1]);
};
dojo.dom.textContent=function(node,text){
if(arguments.length>1){
var _19e=dojo.doc();
dojo.dom.replaceChildren(node,_19e.createTextNode(text));
return text;
}else{
if(node.textContent!=undefined){
return node.textContent;
}
var _19f="";
if(node==null){
return _19f;
}
for(var i=0;i<node.childNodes.length;i++){
switch(node.childNodes[i].nodeType){
case 1:
case 5:
_19f+=dojo.dom.textContent(node.childNodes[i]);
break;
case 3:
case 2:
case 4:
_19f+=node.childNodes[i].nodeValue;
break;
default:
break;
}
}
return _19f;
}
};
dojo.dom.hasParent=function(node){
return Boolean(node&&node.parentNode&&dojo.dom.isNode(node.parentNode));
};
dojo.dom.isTag=function(node){
if(node&&node.tagName){
for(var i=1;i<arguments.length;i++){
if(node.tagName==String(arguments[i])){
return String(arguments[i]);
}
}
}
return "";
};
dojo.dom.setAttributeNS=function(elem,_1a5,_1a6,_1a7){
if(elem==null||((elem==undefined)&&(typeof elem=="undefined"))){
dojo.raise("No element given to dojo.dom.setAttributeNS");
}
if(!((elem.setAttributeNS==undefined)&&(typeof elem.setAttributeNS=="undefined"))){
elem.setAttributeNS(_1a5,_1a6,_1a7);
}else{
var _1a8=elem.ownerDocument;
var _1a9=_1a8.createNode(2,_1a6,_1a5);
_1a9.nodeValue=_1a7;
elem.setAttributeNode(_1a9);
}
};
dojo.provide("dojo.xml.Parse");
dojo.require("dojo.dom");
dojo.xml.Parse=function(){
var isIE=((dojo.render.html.capable)&&(dojo.render.html.ie));
function getTagName(node){
try{
return node.tagName.toLowerCase();
}
catch(e){
return "";
}
}
function getDojoTagName(node){
var _1ad=getTagName(node);
if(!_1ad){
return "";
}
if((dojo.widget)&&(dojo.widget.tags[_1ad])){
return _1ad;
}
var p=_1ad.indexOf(":");
if(p>=0){
return _1ad;
}
if(_1ad.substr(0,5)=="dojo:"){
return _1ad;
}
if(dojo.render.html.capable&&dojo.render.html.ie&&node.scopeName!="HTML"){
return node.scopeName.toLowerCase()+":"+_1ad;
}
if(_1ad.substr(0,4)=="dojo"){
return "dojo:"+_1ad.substring(4);
}
var djt=node.getAttribute("dojoType")||node.getAttribute("dojotype");
if(djt){
if(djt.indexOf(":")<0){
djt="dojo:"+djt;
}
return djt.toLowerCase();
}
djt=node.getAttributeNS&&node.getAttributeNS(dojo.dom.dojoml,"type");
if(djt){
return "dojo:"+djt.toLowerCase();
}
try{
djt=node.getAttribute("dojo:type");
}
catch(e){
}
if(djt){
return "dojo:"+djt.toLowerCase();
}
if((dj_global["djConfig"])&&(!djConfig["ignoreClassNames"])){
var _1b0=node.className||node.getAttribute("class");
if((_1b0)&&(_1b0.indexOf)&&(_1b0.indexOf("dojo-")!=-1)){
var _1b1=_1b0.split(" ");
for(var x=0,c=_1b1.length;x<c;x++){
if(_1b1[x].slice(0,5)=="dojo-"){
return "dojo:"+_1b1[x].substr(5).toLowerCase();
}
}
}
}
return "";
}
this.parseElement=function(node,_1b5,_1b6,_1b7){
var _1b8=getTagName(node);
if(isIE&&_1b8.indexOf("/")==0){
return null;
}
try{
var attr=node.getAttribute("parseWidgets");
if(attr&&attr.toLowerCase()=="false"){
return {};
}
}
catch(e){
}
var _1ba=true;
if(_1b6){
var _1bb=getDojoTagName(node);
_1b8=_1bb||_1b8;
_1ba=Boolean(_1bb);
}
var _1bc={};
_1bc[_1b8]=[];
var pos=_1b8.indexOf(":");
if(pos>0){
var ns=_1b8.substring(0,pos);
_1bc["ns"]=ns;
if((dojo.ns)&&(!dojo.ns.allow(ns))){
_1ba=false;
}
}
if(_1ba){
var _1bf=this.parseAttributes(node);
for(var attr in _1bf){
if((!_1bc[_1b8][attr])||(typeof _1bc[_1b8][attr]!="array")){
_1bc[_1b8][attr]=[];
}
_1bc[_1b8][attr].push(_1bf[attr]);
}
_1bc[_1b8].nodeRef=node;
_1bc.tagName=_1b8;
_1bc.index=_1b7||0;
}
var _1c0=0;
for(var i=0;i<node.childNodes.length;i++){
var tcn=node.childNodes.item(i);
switch(tcn.nodeType){
case dojo.dom.ELEMENT_NODE:
var ctn=getDojoTagName(tcn)||getTagName(tcn);
if(!_1bc[ctn]){
_1bc[ctn]=[];
}
_1bc[ctn].push(this.parseElement(tcn,true,_1b6,_1c0));
if((tcn.childNodes.length==1)&&(tcn.childNodes.item(0).nodeType==dojo.dom.TEXT_NODE)){
_1bc[ctn][_1bc[ctn].length-1].value=tcn.childNodes.item(0).nodeValue;
}
_1c0++;
break;
case dojo.dom.TEXT_NODE:
if(node.childNodes.length==1){
_1bc[_1b8].push({value:node.childNodes.item(0).nodeValue});
}
break;
default:
break;
}
}
return _1bc;
};
this.parseAttributes=function(node){
var _1c5={};
var atts=node.attributes;
var _1c7,i=0;
while((_1c7=atts[i++])){
if(isIE){
if(!_1c7){
continue;
}
if((typeof _1c7=="object")&&(typeof _1c7.nodeValue=="undefined")||(_1c7.nodeValue==null)||(_1c7.nodeValue=="")){
continue;
}
}
var nn=_1c7.nodeName.split(":");
nn=(nn.length==2)?nn[1]:_1c7.nodeName;
_1c5[nn]={value:_1c7.nodeValue};
}
return _1c5;
};
};
dojo.provide("dojo.lang.common");
dojo.lang.inherits=function(_1ca,_1cb){
if(!dojo.lang.isFunction(_1cb)){
dojo.raise("dojo.inherits: superclass argument ["+_1cb+"] must be a function (subclass: ["+_1ca+"']");
}
_1ca.prototype=new _1cb();
_1ca.prototype.constructor=_1ca;
_1ca.superclass=_1cb.prototype;
_1ca["super"]=_1cb.prototype;
};
dojo.lang._mixin=function(obj,_1cd){
var tobj={};
for(var x in _1cd){
if((typeof tobj[x]=="undefined")||(tobj[x]!=_1cd[x])){
obj[x]=_1cd[x];
}
}
if(dojo.render.html.ie&&(typeof (_1cd["toString"])=="function")&&(_1cd["toString"]!=obj["toString"])&&(_1cd["toString"]!=tobj["toString"])){
obj.toString=_1cd.toString;
}
return obj;
};
dojo.lang.mixin=function(obj,_1d1){
for(var i=1,l=arguments.length;i<l;i++){
dojo.lang._mixin(obj,arguments[i]);
}
return obj;
};
dojo.lang.extend=function(_1d4,_1d5){
for(var i=1,l=arguments.length;i<l;i++){
dojo.lang._mixin(_1d4.prototype,arguments[i]);
}
return _1d4;
};
dojo.inherits=dojo.lang.inherits;
dojo.mixin=dojo.lang.mixin;
dojo.extend=dojo.lang.extend;
dojo.lang.find=function(_1d8,_1d9,_1da,_1db){
if(!dojo.lang.isArrayLike(_1d8)&&dojo.lang.isArrayLike(_1d9)){
dojo.deprecated("dojo.lang.find(value, array)","use dojo.lang.find(array, value) instead","0.5");
var temp=_1d8;
_1d8=_1d9;
_1d9=temp;
}
var _1dd=dojo.lang.isString(_1d8);
if(_1dd){
_1d8=_1d8.split("");
}
if(_1db){
var step=-1;
var i=_1d8.length-1;
var end=-1;
}else{
var step=1;
var i=0;
var end=_1d8.length;
}
if(_1da){
while(i!=end){
if(_1d8[i]===_1d9){
return i;
}
i+=step;
}
}else{
while(i!=end){
if(_1d8[i]==_1d9){
return i;
}
i+=step;
}
}
return -1;
};
dojo.lang.indexOf=dojo.lang.find;
dojo.lang.findLast=function(_1e1,_1e2,_1e3){
return dojo.lang.find(_1e1,_1e2,_1e3,true);
};
dojo.lang.lastIndexOf=dojo.lang.findLast;
dojo.lang.inArray=function(_1e4,_1e5){
return dojo.lang.find(_1e4,_1e5)>-1;
};
dojo.lang.isObject=function(it){
if(typeof it=="undefined"){
return false;
}
return (typeof it=="object"||it===null||dojo.lang.isArray(it)||dojo.lang.isFunction(it));
};
dojo.lang.isArray=function(it){
return (it&&it instanceof Array||typeof it=="array");
};
dojo.lang.isArrayLike=function(it){
if((!it)||(dojo.lang.isUndefined(it))){
return false;
}
if(dojo.lang.isString(it)){
return false;
}
if(dojo.lang.isFunction(it)){
return false;
}
if(dojo.lang.isArray(it)){
return true;
}
if((it.tagName)&&(it.tagName.toLowerCase()=="form")){
return false;
}
if(dojo.lang.isNumber(it.length)&&isFinite(it.length)){
return true;
}
return false;
};
dojo.lang.isFunction=function(it){
return (it instanceof Function||typeof it=="function");
};
(function(){
if((dojo.render.html.capable)&&(dojo.render.html["safari"])){
dojo.lang.isFunction=function(it){
if((typeof (it)=="function")&&(it=="[object NodeList]")){
return false;
}
return (it instanceof Function||typeof it=="function");
};
}
})();
dojo.lang.isString=function(it){
return (typeof it=="string"||it instanceof String);
};
dojo.lang.isAlien=function(it){
if(!it){
return false;
}
return !dojo.lang.isFunction(it)&&/\{\s*\[native code\]\s*\}/.test(String(it));
};
dojo.lang.isBoolean=function(it){
return (it instanceof Boolean||typeof it=="boolean");
};
dojo.lang.isNumber=function(it){
return (it instanceof Number||typeof it=="number");
};
dojo.lang.isUndefined=function(it){
return ((typeof (it)=="undefined")&&(it==undefined));
};
dojo.provide("dojo.lang.func");
dojo.require("dojo.lang.common");
dojo.lang.hitch=function(_1f0,_1f1){
var args=[];
for(var x=2;x<arguments.length;x++){
args.push(arguments[x]);
}
var fcn=(dojo.lang.isString(_1f1)?_1f0[_1f1]:_1f1)||function(){
};
return function(){
var ta=args.concat([]);
for(var x=0;x<arguments.length;x++){
ta.push(arguments[x]);
}
return fcn.apply(_1f0,ta);
};
};
dojo.lang.anonCtr=0;
dojo.lang.anon={};
dojo.lang.nameAnonFunc=function(_1f7,_1f8,_1f9){
var nso=(_1f8||dojo.lang.anon);
if((_1f9)||((dj_global["djConfig"])&&(djConfig["slowAnonFuncLookups"]==true))){
for(var x in nso){
try{
if(nso[x]===_1f7){
return x;
}
}
catch(e){
}
}
}
var ret="__"+dojo.lang.anonCtr++;
while(typeof nso[ret]!="undefined"){
ret="__"+dojo.lang.anonCtr++;
}
nso[ret]=_1f7;
return ret;
};
dojo.lang.forward=function(_1fd){
return function(){
return this[_1fd].apply(this,arguments);
};
};
dojo.lang.curry=function(_1fe,func){
var _200=[];
_1fe=_1fe||dj_global;
if(dojo.lang.isString(func)){
func=_1fe[func];
}
for(var x=2;x<arguments.length;x++){
_200.push(arguments[x]);
}
var _202=(func["__preJoinArity"]||func.length)-_200.length;
function gather(_203,_204,_205){
var _206=_205;
var _207=_204.slice(0);
for(var x=0;x<_203.length;x++){
_207.push(_203[x]);
}
_205=_205-_203.length;
if(_205<=0){
var res=func.apply(_1fe,_207);
_205=_206;
return res;
}else{
return function(){
return gather(arguments,_207,_205);
};
}
}
return gather([],_200,_202);
};
dojo.lang.curryArguments=function(_20a,func,args,_20d){
var _20e=[];
var x=_20d||0;
for(x=_20d;x<args.length;x++){
_20e.push(args[x]);
}
return dojo.lang.curry.apply(dojo.lang,[_20a,func].concat(_20e));
};
dojo.lang.tryThese=function(){
for(var x=0;x<arguments.length;x++){
try{
if(typeof arguments[x]=="function"){
var ret=(arguments[x]());
if(ret){
return ret;
}
}
}
catch(e){
dojo.debug(e);
}
}
};
dojo.lang.delayThese=function(farr,cb,_214,_215){
if(!farr.length){
if(typeof _215=="function"){
_215();
}
return;
}
if((typeof _214=="undefined")&&(typeof cb=="number")){
_214=cb;
cb=function(){
};
}else{
if(!cb){
cb=function(){
};
if(!_214){
_214=0;
}
}
}
setTimeout(function(){
(farr.shift())();
cb();
dojo.lang.delayThese(farr,cb,_214,_215);
},_214);
};
dojo.provide("dojo.lang.array");
dojo.require("dojo.lang.common");
dojo.lang.mixin(dojo.lang,{has:function(obj,name){
try{
return typeof obj[name]!="undefined";
}
catch(e){
return false;
}
},isEmpty:function(obj){
if(dojo.lang.isObject(obj)){
var tmp={};
var _21a=0;
for(var x in obj){
if(obj[x]&&(!tmp[x])){
_21a++;
break;
}
}
return _21a==0;
}else{
if(dojo.lang.isArrayLike(obj)||dojo.lang.isString(obj)){
return obj.length==0;
}
}
},map:function(arr,obj,_21e){
var _21f=dojo.lang.isString(arr);
if(_21f){
arr=arr.split("");
}
if(dojo.lang.isFunction(obj)&&(!_21e)){
_21e=obj;
obj=dj_global;
}else{
if(dojo.lang.isFunction(obj)&&_21e){
var _220=obj;
obj=_21e;
_21e=_220;
}
}
if(Array.map){
var _221=Array.map(arr,_21e,obj);
}else{
var _221=[];
for(var i=0;i<arr.length;++i){
_221.push(_21e.call(obj,arr[i]));
}
}
if(_21f){
return _221.join("");
}else{
return _221;
}
},reduce:function(arr,_224,obj,_226){
var _227=_224;
if(arguments.length==2){
_226=_224;
_227=arr[0];
arr=arr.slice(1);
}else{
if(arguments.length==3){
if(dojo.lang.isFunction(obj)){
_226=obj;
obj=null;
}
}else{
if(dojo.lang.isFunction(obj)){
var tmp=_226;
_226=obj;
obj=tmp;
}
}
}
var ob=obj||dj_global;
dojo.lang.map(arr,function(val){
_227=_226.call(ob,_227,val);
});
return _227;
},forEach:function(_22b,_22c,_22d){
if(dojo.lang.isString(_22b)){
_22b=_22b.split("");
}
if(Array.forEach){
Array.forEach(_22b,_22c,_22d);
}else{
if(!_22d){
_22d=dj_global;
}
for(var i=0,l=_22b.length;i<l;i++){
_22c.call(_22d,_22b[i],i,_22b);
}
}
},_everyOrSome:function(_230,arr,_232,_233){
if(dojo.lang.isString(arr)){
arr=arr.split("");
}
if(Array.every){
return Array[_230?"every":"some"](arr,_232,_233);
}else{
if(!_233){
_233=dj_global;
}
for(var i=0,l=arr.length;i<l;i++){
var _236=_232.call(_233,arr[i],i,arr);
if(_230&&!_236){
return false;
}else{
if((!_230)&&(_236)){
return true;
}
}
}
return Boolean(_230);
}
},every:function(arr,_238,_239){
return this._everyOrSome(true,arr,_238,_239);
},some:function(arr,_23b,_23c){
return this._everyOrSome(false,arr,_23b,_23c);
},filter:function(arr,_23e,_23f){
var _240=dojo.lang.isString(arr);
if(_240){
arr=arr.split("");
}
var _241;
if(Array.filter){
_241=Array.filter(arr,_23e,_23f);
}else{
if(!_23f){
if(arguments.length>=3){
dojo.raise("thisObject doesn't exist!");
}
_23f=dj_global;
}
_241=[];
for(var i=0;i<arr.length;i++){
if(_23e.call(_23f,arr[i],i,arr)){
_241.push(arr[i]);
}
}
}
if(_240){
return _241.join("");
}else{
return _241;
}
},unnest:function(){
var out=[];
for(var i=0;i<arguments.length;i++){
if(dojo.lang.isArrayLike(arguments[i])){
var add=dojo.lang.unnest.apply(this,arguments[i]);
out=out.concat(add);
}else{
out.push(arguments[i]);
}
}
return out;
},toArray:function(_246,_247){
var _248=[];
for(var i=_247||0;i<_246.length;i++){
_248.push(_246[i]);
}
return _248;
}});
dojo.provide("dojo.lang.extras");
dojo.require("dojo.lang.common");
dojo.lang.setTimeout=function(func,_24b){
var _24c=window,_24d=2;
if(!dojo.lang.isFunction(func)){
_24c=func;
func=_24b;
_24b=arguments[2];
_24d++;
}
if(dojo.lang.isString(func)){
func=_24c[func];
}
var args=[];
for(var i=_24d;i<arguments.length;i++){
args.push(arguments[i]);
}
return dojo.global().setTimeout(function(){
func.apply(_24c,args);
},_24b);
};
dojo.lang.clearTimeout=function(_250){
dojo.global().clearTimeout(_250);
};
dojo.lang.getNameInObj=function(ns,item){
if(!ns){
ns=dj_global;
}
for(var x in ns){
if(ns[x]===item){
return new String(x);
}
}
return null;
};
dojo.lang.shallowCopy=function(obj,deep){
var i,ret;
if(obj===null){
return null;
}
if(dojo.lang.isObject(obj)){
ret=new obj.constructor();
for(i in obj){
if(dojo.lang.isUndefined(ret[i])){
ret[i]=deep?dojo.lang.shallowCopy(obj[i],deep):obj[i];
}
}
}else{
if(dojo.lang.isArray(obj)){
ret=[];
for(i=0;i<obj.length;i++){
ret[i]=deep?dojo.lang.shallowCopy(obj[i],deep):obj[i];
}
}else{
ret=obj;
}
}
return ret;
};
dojo.lang.firstValued=function(){
for(var i=0;i<arguments.length;i++){
if(typeof arguments[i]!="undefined"){
return arguments[i];
}
}
return undefined;
};
dojo.lang.getObjPathValue=function(_259,_25a,_25b){
with(dojo.parseObjPath(_259,_25a,_25b)){
return dojo.evalProp(prop,obj,_25b);
}
};
dojo.lang.setObjPathValue=function(_25c,_25d,_25e,_25f){
dojo.deprecated("dojo.lang.setObjPathValue","use dojo.parseObjPath and the '=' operator","0.6");
if(arguments.length<4){
_25f=true;
}
with(dojo.parseObjPath(_25c,_25e,_25f)){
if(obj&&(_25f||(prop in obj))){
obj[prop]=_25d;
}
}
};
dojo.provide("dojo.lang.declare");
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.extras");
dojo.lang.declare=function(_260,_261,init,_263){
if((dojo.lang.isFunction(_263))||((!_263)&&(!dojo.lang.isFunction(init)))){
var temp=_263;
_263=init;
init=temp;
}
var _265=[];
if(dojo.lang.isArray(_261)){
_265=_261;
_261=_265.shift();
}
if(!init){
init=dojo.evalObjPath(_260,false);
if((init)&&(!dojo.lang.isFunction(init))){
init=null;
}
}
var ctor=dojo.lang.declare._makeConstructor();
var scp=(_261?_261.prototype:null);
if(scp){
scp.prototyping=true;
ctor.prototype=new _261();
scp.prototyping=false;
}
ctor.superclass=scp;
ctor.mixins=_265;
for(var i=0,l=_265.length;i<l;i++){
dojo.lang.extend(ctor,_265[i].prototype);
}
ctor.prototype.initializer=null;
ctor.prototype.declaredClass=_260;
if(dojo.lang.isArray(_263)){
dojo.lang.extend.apply(dojo.lang,[ctor].concat(_263));
}else{
dojo.lang.extend(ctor,(_263)||{});
}
dojo.lang.extend(ctor,dojo.lang.declare._common);
ctor.prototype.constructor=ctor;
ctor.prototype.initializer=(ctor.prototype.initializer)||(init)||(function(){
});
var _26a=dojo.parseObjPath(_260,null,true);
_26a.obj[_26a.prop]=ctor;
return ctor;
};
dojo.lang.declare._makeConstructor=function(){
return function(){
var self=this._getPropContext();
var s=self.constructor.superclass;
if((s)&&(s.constructor)){
if(s.constructor==arguments.callee){
this._inherited("constructor",arguments);
}else{
this._contextMethod(s,"constructor",arguments);
}
}
var ms=(self.constructor.mixins)||([]);
for(var i=0,m;(m=ms[i]);i++){
(((m.prototype)&&(m.prototype.initializer))||(m)).apply(this,arguments);
}
if((!this.prototyping)&&(self.initializer)){
self.initializer.apply(this,arguments);
}
};
};
dojo.lang.declare._common={_getPropContext:function(){
return (this.___proto||this);
},_contextMethod:function(_270,_271,args){
var _273,_274=this.___proto;
this.___proto=_270;
try{
_273=_270[_271].apply(this,(args||[]));
}
catch(e){
throw e;
}
finally{
this.___proto=_274;
}
return _273;
},_inherited:function(prop,args){
var p=this._getPropContext();
do{
if((!p.constructor)||(!p.constructor.superclass)){
return;
}
p=p.constructor.superclass;
}while(!(prop in p));
return (dojo.lang.isFunction(p[prop])?this._contextMethod(p,prop,args):p[prop]);
},inherited:function(prop,args){
dojo.deprecated("'inherited' method is dangerous, do not up-call! 'inherited' is slated for removal in 0.5; name your super class (or use superclass property) instead.","0.5");
this._inherited(prop,args);
}};
dojo.declare=dojo.lang.declare;
dojo.provide("dojo.ns");
dojo.ns={namespaces:{},failed:{},loading:{},loaded:{},register:function(name,_27b,_27c,_27d){
if(!_27d||!this.namespaces[name]){
this.namespaces[name]=new dojo.ns.Ns(name,_27b,_27c);
}
},allow:function(name){
if(this.failed[name]){
return false;
}
if((djConfig.excludeNamespace)&&(dojo.lang.inArray(djConfig.excludeNamespace,name))){
return false;
}
return ((name==this.dojo)||(!djConfig.includeNamespace)||(dojo.lang.inArray(djConfig.includeNamespace,name)));
},get:function(name){
return this.namespaces[name];
},require:function(name){
var ns=this.namespaces[name];
if((ns)&&(this.loaded[name])){
return ns;
}
if(!this.allow(name)){
return false;
}
if(this.loading[name]){
dojo.debug("dojo.namespace.require: re-entrant request to load namespace \""+name+"\" must fail.");
return false;
}
var req=dojo.require;
this.loading[name]=true;
try{
if(name=="dojo"){
req("dojo.namespaces.dojo");
}else{
if(!dojo.hostenv.moduleHasPrefix(name)){
dojo.registerModulePath(name,"../"+name);
}
req([name,"manifest"].join("."),false,true);
}
if(!this.namespaces[name]){
this.failed[name]=true;
}
}
finally{
this.loading[name]=false;
}
return this.namespaces[name];
}};
dojo.ns.Ns=function(name,_284,_285){
this.name=name;
this.module=_284;
this.resolver=_285;
this._loaded=[];
this._failed=[];
};
dojo.ns.Ns.prototype.resolve=function(name,_287,_288){
if(!this.resolver||djConfig["skipAutoRequire"]){
return false;
}
var _289=this.resolver(name,_287);
if((_289)&&(!this._loaded[_289])&&(!this._failed[_289])){
var req=dojo.require;
req(_289,false,true);
if(dojo.hostenv.findModule(_289,false)){
this._loaded[_289]=true;
}else{
if(!_288){
dojo.raise("dojo.ns.Ns.resolve: module '"+_289+"' not found after loading via namespace '"+this.name+"'");
}
this._failed[_289]=true;
}
}
return Boolean(this._loaded[_289]);
};
dojo.registerNamespace=function(name,_28c,_28d){
dojo.ns.register.apply(dojo.ns,arguments);
};
dojo.registerNamespaceResolver=function(name,_28f){
var n=dojo.ns.namespaces[name];
if(n){
n.resolver=_28f;
}
};
dojo.registerNamespaceManifest=function(_291,path,name,_294,_295){
dojo.registerModulePath(name,path);
dojo.registerNamespace(name,_294,_295);
};
dojo.registerNamespace("dojo","dojo.widget");
dojo.provide("dojo.event.common");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.extras");
dojo.require("dojo.lang.func");
dojo.event=new function(){
this._canTimeout=dojo.lang.isFunction(dj_global["setTimeout"])||dojo.lang.isAlien(dj_global["setTimeout"]);
function interpolateArgs(args,_297){
var dl=dojo.lang;
var ao={srcObj:dj_global,srcFunc:null,adviceObj:dj_global,adviceFunc:null,aroundObj:null,aroundFunc:null,adviceType:(args.length>2)?args[0]:"after",precedence:"last",once:false,delay:null,rate:0,adviceMsg:false,maxCalls:-1};
switch(args.length){
case 0:
return;
case 1:
return;
case 2:
ao.srcFunc=args[0];
ao.adviceFunc=args[1];
break;
case 3:
if((dl.isObject(args[0]))&&(dl.isString(args[1]))&&(dl.isString(args[2]))){
ao.adviceType="after";
ao.srcObj=args[0];
ao.srcFunc=args[1];
ao.adviceFunc=args[2];
}else{
if((dl.isString(args[1]))&&(dl.isString(args[2]))){
ao.srcFunc=args[1];
ao.adviceFunc=args[2];
}else{
if((dl.isObject(args[0]))&&(dl.isString(args[1]))&&(dl.isFunction(args[2]))){
ao.adviceType="after";
ao.srcObj=args[0];
ao.srcFunc=args[1];
var _29a=dl.nameAnonFunc(args[2],ao.adviceObj,_297);
ao.adviceFunc=_29a;
}else{
if((dl.isFunction(args[0]))&&(dl.isObject(args[1]))&&(dl.isString(args[2]))){
ao.adviceType="after";
ao.srcObj=dj_global;
var _29a=dl.nameAnonFunc(args[0],ao.srcObj,_297);
ao.srcFunc=_29a;
ao.adviceObj=args[1];
ao.adviceFunc=args[2];
}
}
}
}
break;
case 4:
if((dl.isObject(args[0]))&&(dl.isObject(args[2]))){
ao.adviceType="after";
ao.srcObj=args[0];
ao.srcFunc=args[1];
ao.adviceObj=args[2];
ao.adviceFunc=args[3];
}else{
if((dl.isString(args[0]))&&(dl.isString(args[1]))&&(dl.isObject(args[2]))){
ao.adviceType=args[0];
ao.srcObj=dj_global;
ao.srcFunc=args[1];
ao.adviceObj=args[2];
ao.adviceFunc=args[3];
}else{
if((dl.isString(args[0]))&&(dl.isFunction(args[1]))&&(dl.isObject(args[2]))){
ao.adviceType=args[0];
ao.srcObj=dj_global;
var _29a=dl.nameAnonFunc(args[1],dj_global,_297);
ao.srcFunc=_29a;
ao.adviceObj=args[2];
ao.adviceFunc=args[3];
}else{
if((dl.isString(args[0]))&&(dl.isObject(args[1]))&&(dl.isString(args[2]))&&(dl.isFunction(args[3]))){
ao.srcObj=args[1];
ao.srcFunc=args[2];
var _29a=dl.nameAnonFunc(args[3],dj_global,_297);
ao.adviceObj=dj_global;
ao.adviceFunc=_29a;
}else{
if(dl.isObject(args[1])){
ao.srcObj=args[1];
ao.srcFunc=args[2];
ao.adviceObj=dj_global;
ao.adviceFunc=args[3];
}else{
if(dl.isObject(args[2])){
ao.srcObj=dj_global;
ao.srcFunc=args[1];
ao.adviceObj=args[2];
ao.adviceFunc=args[3];
}else{
ao.srcObj=ao.adviceObj=ao.aroundObj=dj_global;
ao.srcFunc=args[1];
ao.adviceFunc=args[2];
ao.aroundFunc=args[3];
}
}
}
}
}
}
break;
case 6:
ao.srcObj=args[1];
ao.srcFunc=args[2];
ao.adviceObj=args[3];
ao.adviceFunc=args[4];
ao.aroundFunc=args[5];
ao.aroundObj=dj_global;
break;
default:
ao.srcObj=args[1];
ao.srcFunc=args[2];
ao.adviceObj=args[3];
ao.adviceFunc=args[4];
ao.aroundObj=args[5];
ao.aroundFunc=args[6];
ao.once=args[7];
ao.delay=args[8];
ao.rate=args[9];
ao.adviceMsg=args[10];
ao.maxCalls=(!isNaN(parseInt(args[11])))?args[11]:-1;
break;
}
if(dl.isFunction(ao.aroundFunc)){
var _29a=dl.nameAnonFunc(ao.aroundFunc,ao.aroundObj,_297);
ao.aroundFunc=_29a;
}
if(dl.isFunction(ao.srcFunc)){
ao.srcFunc=dl.getNameInObj(ao.srcObj,ao.srcFunc);
}
if(dl.isFunction(ao.adviceFunc)){
ao.adviceFunc=dl.getNameInObj(ao.adviceObj,ao.adviceFunc);
}
if((ao.aroundObj)&&(dl.isFunction(ao.aroundFunc))){
ao.aroundFunc=dl.getNameInObj(ao.aroundObj,ao.aroundFunc);
}
if(!ao.srcObj){
dojo.raise("bad srcObj for srcFunc: "+ao.srcFunc);
}
if(!ao.adviceObj){
dojo.raise("bad adviceObj for adviceFunc: "+ao.adviceFunc);
}
if(!ao.adviceFunc){
dojo.debug("bad adviceFunc for srcFunc: "+ao.srcFunc);
dojo.debugShallow(ao);
}
return ao;
}
this.connect=function(){
if(arguments.length==1){
var ao=arguments[0];
}else{
var ao=interpolateArgs(arguments,true);
}
if(dojo.lang.isString(ao.srcFunc)&&(ao.srcFunc.toLowerCase()=="onkey")){
if(dojo.render.html.ie){
ao.srcFunc="onkeydown";
this.connect(ao);
}
ao.srcFunc="onkeypress";
}
if(dojo.lang.isArray(ao.srcObj)&&ao.srcObj!=""){
var _29c={};
for(var x in ao){
_29c[x]=ao[x];
}
var mjps=[];
dojo.lang.forEach(ao.srcObj,function(src){
if((dojo.render.html.capable)&&(dojo.lang.isString(src))){
src=dojo.byId(src);
}
_29c.srcObj=src;
mjps.push(dojo.event.connect.call(dojo.event,_29c));
});
return mjps;
}
var mjp=dojo.event.MethodJoinPoint.getForMethod(ao.srcObj,ao.srcFunc);
if(ao.adviceFunc){
var mjp2=dojo.event.MethodJoinPoint.getForMethod(ao.adviceObj,ao.adviceFunc);
}
mjp.kwAddAdvice(ao);
return mjp;
};
this.log=function(a1,a2){
var _2a4;
if((arguments.length==1)&&(typeof a1=="object")){
_2a4=a1;
}else{
_2a4={srcObj:a1,srcFunc:a2};
}
_2a4.adviceFunc=function(){
var _2a5=[];
for(var x=0;x<arguments.length;x++){
_2a5.push(arguments[x]);
}
dojo.debug("("+_2a4.srcObj+")."+_2a4.srcFunc,":",_2a5.join(", "));
};
this.kwConnect(_2a4);
};
this.connectBefore=function(){
var args=["before"];
for(var i=0;i<arguments.length;i++){
args.push(arguments[i]);
}
return this.connect.apply(this,args);
};
this.connectAround=function(){
var args=["around"];
for(var i=0;i<arguments.length;i++){
args.push(arguments[i]);
}
return this.connect.apply(this,args);
};
this.connectOnce=function(){
var ao=interpolateArgs(arguments,true);
ao.once=true;
return this.connect(ao);
};
this.connectRunOnce=function(){
var ao=interpolateArgs(arguments,true);
ao.maxCalls=1;
return this.connect(ao);
};
this._kwConnectImpl=function(_2ad,_2ae){
var fn=(_2ae)?"disconnect":"connect";
if(typeof _2ad["srcFunc"]=="function"){
_2ad.srcObj=_2ad["srcObj"]||dj_global;
var _2b0=dojo.lang.nameAnonFunc(_2ad.srcFunc,_2ad.srcObj,true);
_2ad.srcFunc=_2b0;
}
if(typeof _2ad["adviceFunc"]=="function"){
_2ad.adviceObj=_2ad["adviceObj"]||dj_global;
var _2b0=dojo.lang.nameAnonFunc(_2ad.adviceFunc,_2ad.adviceObj,true);
_2ad.adviceFunc=_2b0;
}
_2ad.srcObj=_2ad["srcObj"]||dj_global;
_2ad.adviceObj=_2ad["adviceObj"]||_2ad["targetObj"]||dj_global;
_2ad.adviceFunc=_2ad["adviceFunc"]||_2ad["targetFunc"];
return dojo.event[fn](_2ad);
};
this.kwConnect=function(_2b1){
return this._kwConnectImpl(_2b1,false);
};
this.disconnect=function(){
if(arguments.length==1){
var ao=arguments[0];
}else{
var ao=interpolateArgs(arguments,true);
}
if(!ao.adviceFunc){
return;
}
if(dojo.lang.isString(ao.srcFunc)&&(ao.srcFunc.toLowerCase()=="onkey")){
if(dojo.render.html.ie){
ao.srcFunc="onkeydown";
this.disconnect(ao);
}
ao.srcFunc="onkeypress";
}
if(!ao.srcObj[ao.srcFunc]){
return null;
}
var mjp=dojo.event.MethodJoinPoint.getForMethod(ao.srcObj,ao.srcFunc,true);
mjp.removeAdvice(ao.adviceObj,ao.adviceFunc,ao.adviceType,ao.once);
return mjp;
};
this.kwDisconnect=function(_2b4){
return this._kwConnectImpl(_2b4,true);
};
};
dojo.event.MethodInvocation=function(_2b5,obj,args){
this.jp_=_2b5;
this.object=obj;
this.args=[];
for(var x=0;x<args.length;x++){
this.args[x]=args[x];
}
this.around_index=-1;
};
dojo.event.MethodInvocation.prototype.proceed=function(){
this.around_index++;
if(this.around_index>=this.jp_.around.length){
return this.jp_.object[this.jp_.methodname].apply(this.jp_.object,this.args);
}else{
var ti=this.jp_.around[this.around_index];
var mobj=ti[0]||dj_global;
var meth=ti[1];
return mobj[meth].call(mobj,this);
}
};
dojo.event.MethodJoinPoint=function(obj,_2bd){
this.object=obj||dj_global;
this.methodname=_2bd;
this.methodfunc=this.object[_2bd];
this.squelch=false;
};
dojo.event.MethodJoinPoint.getForMethod=function(obj,_2bf){
if(!obj){
obj=dj_global;
}
var ofn=obj[_2bf];
if(!ofn){
ofn=obj[_2bf]=function(){
};
if(!obj[_2bf]){
dojo.raise("Cannot set do-nothing method on that object "+_2bf);
}
}else{
if((typeof ofn!="function")&&(!dojo.lang.isFunction(ofn))&&(!dojo.lang.isAlien(ofn))){
return null;
}
}
var _2c1=_2bf+"$joinpoint";
var _2c2=_2bf+"$joinpoint$method";
var _2c3=obj[_2c1];
if(!_2c3){
var _2c4=false;
if(dojo.event["browser"]){
if((obj["attachEvent"])||(obj["nodeType"])||(obj["addEventListener"])){
_2c4=true;
dojo.event.browser.addClobberNodeAttrs(obj,[_2c1,_2c2,_2bf]);
}
}
var _2c5=ofn.length;
obj[_2c2]=ofn;
_2c3=obj[_2c1]=new dojo.event.MethodJoinPoint(obj,_2c2);
if(!_2c4){
obj[_2bf]=function(){
return _2c3.run.apply(_2c3,arguments);
};
}else{
obj[_2bf]=function(){
var args=[];
if(!arguments.length){
var evt=null;
try{
if(obj.ownerDocument){
evt=obj.ownerDocument.parentWindow.event;
}else{
if(obj.documentElement){
evt=obj.documentElement.ownerDocument.parentWindow.event;
}else{
if(obj.event){
evt=obj.event;
}else{
evt=window.event;
}
}
}
}
catch(e){
evt=window.event;
}
if(evt){
args.push(dojo.event.browser.fixEvent(evt,this));
}
}else{
for(var x=0;x<arguments.length;x++){
if((x==0)&&(dojo.event.browser.isEvent(arguments[x]))){
args.push(dojo.event.browser.fixEvent(arguments[x],this));
}else{
args.push(arguments[x]);
}
}
}
return _2c3.run.apply(_2c3,args);
};
}
obj[_2bf].__preJoinArity=_2c5;
}
return _2c3;
};
dojo.lang.extend(dojo.event.MethodJoinPoint,{squelch:false,unintercept:function(){
this.object[this.methodname]=this.methodfunc;
this.before=[];
this.after=[];
this.around=[];
},disconnect:dojo.lang.forward("unintercept"),run:function(){
var obj=this.object||dj_global;
var args=arguments;
var _2cb=[];
for(var x=0;x<args.length;x++){
_2cb[x]=args[x];
}
var _2cd=function(marr){
if(!marr){
dojo.debug("Null argument to unrollAdvice()");
return;
}
var _2cf=marr[0]||dj_global;
var _2d0=marr[1];
if(!_2cf[_2d0]){
dojo.raise("function \""+_2d0+"\" does not exist on \""+_2cf+"\"");
}
var _2d1=marr[2]||dj_global;
var _2d2=marr[3];
var msg=marr[6];
var _2d4=marr[7];
if(_2d4>-1){
if(_2d4==0){
return;
}
marr[7]--;
}
var _2d5;
var to={args:[],jp_:this,object:obj,proceed:function(){
return _2cf[_2d0].apply(_2cf,to.args);
}};
to.args=_2cb;
var _2d7=parseInt(marr[4]);
var _2d8=((!isNaN(_2d7))&&(marr[4]!==null)&&(typeof marr[4]!="undefined"));
if(marr[5]){
var rate=parseInt(marr[5]);
var cur=new Date();
var _2db=false;
if((marr["last"])&&((cur-marr.last)<=rate)){
if(dojo.event._canTimeout){
if(marr["delayTimer"]){
clearTimeout(marr.delayTimer);
}
var tod=parseInt(rate*2);
var mcpy=dojo.lang.shallowCopy(marr);
marr.delayTimer=setTimeout(function(){
mcpy[5]=0;
_2cd(mcpy);
},tod);
}
return;
}else{
marr.last=cur;
}
}
if(_2d2){
_2d1[_2d2].call(_2d1,to);
}else{
if((_2d8)&&((dojo.render.html)||(dojo.render.svg))){
dj_global["setTimeout"](function(){
if(msg){
_2cf[_2d0].call(_2cf,to);
}else{
_2cf[_2d0].apply(_2cf,args);
}
},_2d7);
}else{
if(msg){
_2cf[_2d0].call(_2cf,to);
}else{
_2cf[_2d0].apply(_2cf,args);
}
}
}
};
var _2de=function(){
if(this.squelch){
try{
return _2cd.apply(this,arguments);
}
catch(e){
dojo.debug(e);
}
}else{
return _2cd.apply(this,arguments);
}
};
if((this["before"])&&(this.before.length>0)){
dojo.lang.forEach(this.before.concat(new Array()),_2de);
}
var _2df;
try{
if((this["around"])&&(this.around.length>0)){
var mi=new dojo.event.MethodInvocation(this,obj,args);
_2df=mi.proceed();
}else{
if(this.methodfunc){
_2df=this.object[this.methodname].apply(this.object,args);
}
}
}
catch(e){
if(!this.squelch){
dojo.debug(e,"when calling",this.methodname,"on",this.object,"with arguments",args);
dojo.raise(e);
}
}
if((this["after"])&&(this.after.length>0)){
dojo.lang.forEach(this.after.concat(new Array()),_2de);
}
return (this.methodfunc)?_2df:null;
},getArr:function(kind){
var type="after";
if((typeof kind=="string")&&(kind.indexOf("before")!=-1)){
type="before";
}else{
if(kind=="around"){
type="around";
}
}
if(!this[type]){
this[type]=[];
}
return this[type];
},kwAddAdvice:function(args){
this.addAdvice(args["adviceObj"],args["adviceFunc"],args["aroundObj"],args["aroundFunc"],args["adviceType"],args["precedence"],args["once"],args["delay"],args["rate"],args["adviceMsg"],args["maxCalls"]);
},addAdvice:function(_2e4,_2e5,_2e6,_2e7,_2e8,_2e9,once,_2eb,rate,_2ed,_2ee){
var arr=this.getArr(_2e8);
if(!arr){
dojo.raise("bad this: "+this);
}
var ao=[_2e4,_2e5,_2e6,_2e7,_2eb,rate,_2ed,_2ee];
if(once){
if(this.hasAdvice(_2e4,_2e5,_2e8,arr)>=0){
return;
}
}
if(_2e9=="first"){
arr.unshift(ao);
}else{
arr.push(ao);
}
},hasAdvice:function(_2f1,_2f2,_2f3,arr){
if(!arr){
arr=this.getArr(_2f3);
}
var ind=-1;
for(var x=0;x<arr.length;x++){
var aao=(typeof _2f2=="object")?(new String(_2f2)).toString():_2f2;
var a1o=(typeof arr[x][1]=="object")?(new String(arr[x][1])).toString():arr[x][1];
if((arr[x][0]==_2f1)&&(a1o==aao)){
ind=x;
}
}
return ind;
},removeAdvice:function(_2f9,_2fa,_2fb,once){
var arr=this.getArr(_2fb);
var ind=this.hasAdvice(_2f9,_2fa,_2fb,arr);
if(ind==-1){
return false;
}
while(ind!=-1){
arr.splice(ind,1);
if(once){
break;
}
ind=this.hasAdvice(_2f9,_2fa,_2fb,arr);
}
return true;
}});
dojo.require("dojo.event.common");
dojo.provide("dojo.event.topic");
dojo.event.topic=new function(){
this.topics={};
this.getTopic=function(_2ff){
if(!this.topics[_2ff]){
this.topics[_2ff]=new this.TopicImpl(_2ff);
}
return this.topics[_2ff];
};
this.registerPublisher=function(_300,obj,_302){
var _300=this.getTopic(_300);
_300.registerPublisher(obj,_302);
};
this.subscribe=function(_303,obj,_305){
var _303=this.getTopic(_303);
_303.subscribe(obj,_305);
};
this.unsubscribe=function(_306,obj,_308){
var _306=this.getTopic(_306);
_306.unsubscribe(obj,_308);
};
this.destroy=function(_309){
this.getTopic(_309).destroy();
delete this.topics[_309];
};
this.publishApply=function(_30a,args){
var _30a=this.getTopic(_30a);
_30a.sendMessage.apply(_30a,args);
};
this.publish=function(_30c,_30d){
var _30c=this.getTopic(_30c);
var args=[];
for(var x=1;x<arguments.length;x++){
args.push(arguments[x]);
}
_30c.sendMessage.apply(_30c,args);
};
};
dojo.event.topic.TopicImpl=function(_310){
this.topicName=_310;
this.subscribe=function(_311,_312){
var tf=_312||_311;
var to=(!_312)?dj_global:_311;
return dojo.event.kwConnect({srcObj:this,srcFunc:"sendMessage",adviceObj:to,adviceFunc:tf});
};
this.unsubscribe=function(_315,_316){
var tf=(!_316)?_315:_316;
var to=(!_316)?null:_315;
return dojo.event.kwDisconnect({srcObj:this,srcFunc:"sendMessage",adviceObj:to,adviceFunc:tf});
};
this._getJoinPoint=function(){
return dojo.event.MethodJoinPoint.getForMethod(this,"sendMessage");
};
this.setSquelch=function(_319){
this._getJoinPoint().squelch=_319;
};
this.destroy=function(){
this._getJoinPoint().disconnect();
};
this.registerPublisher=function(_31a,_31b){
dojo.event.connect(_31a,_31b,this,"sendMessage");
};
this.sendMessage=function(_31c){
};
};
dojo.provide("dojo.event.browser");
dojo.require("dojo.event.common");
dojo.require("dojo.lang.common");
dojo._ie_clobber=new function(){
this.clobberNodes=[];
function nukeProp(node,prop){
try{
node[prop]=null;
}
catch(e){
}
try{
delete node[prop];
}
catch(e){
}
try{
node.removeAttribute(prop);
}
catch(e){
}
}
this.clobber=function(_31f){
var na;
var tna;
if(_31f){
tna=_31f.all||_31f.getElementsByTagName("*");
na=[_31f];
for(var x=0;x<tna.length;x++){
if(tna[x]["__doClobber__"]){
na.push(tna[x]);
}
}
}else{
try{
window.onload=null;
}
catch(e){
}
na=(this.clobberNodes.length)?this.clobberNodes:document.all;
}
tna=null;
var _323={};
for(var i=na.length-1;i>=0;i=i-1){
var el=na[i];
try{
if(el&&el["__clobberAttrs__"]){
for(var j=0;j<el.__clobberAttrs__.length;j++){
nukeProp(el,el.__clobberAttrs__[j]);
}
nukeProp(el,"__clobberAttrs__");
nukeProp(el,"__doClobber__");
}
}
catch(e){
}
}
na=null;
};
};
if(dojo.render.html.ie){
dojo.addOnUnload(function(){
dojo._ie_clobber.clobber();
try{
if((dojo["widget"])&&(dojo.widget["manager"])){
dojo.widget.manager.destroyAll();
}
}
catch(e){
}
if(dojo.widget){
for(var name in dojo.widget._templateCache){
if(dojo.widget._templateCache[name].node){
dojo.dom.destroyNode(dojo.widget._templateCache[name].node);
dojo.widget._templateCache[name].node=null;
delete dojo.widget._templateCache[name].node;
}
}
}
try{
window.onload=null;
}
catch(e){
}
try{
window.onunload=null;
}
catch(e){
}
dojo._ie_clobber.clobberNodes=[];
});
}
dojo.event.browser=new function(){
var _328=0;
this.normalizedEventName=function(_329){
switch(_329){
case "CheckboxStateChange":
case "DOMAttrModified":
case "DOMMenuItemActive":
case "DOMMenuItemInactive":
case "DOMMouseScroll":
case "DOMNodeInserted":
case "DOMNodeRemoved":
case "RadioStateChange":
return _329;
break;
default:
var lcn=_329.toLowerCase();
return (lcn.indexOf("on")==0)?lcn.substr(2):lcn;
break;
}
};
this.clean=function(node){
if(dojo.render.html.ie){
dojo._ie_clobber.clobber(node);
}
};
this.addClobberNode=function(node){
if(!dojo.render.html.ie){
return;
}
if(!node["__doClobber__"]){
node.__doClobber__=true;
dojo._ie_clobber.clobberNodes.push(node);
node.__clobberAttrs__=[];
}
};
this.addClobberNodeAttrs=function(node,_32e){
if(!dojo.render.html.ie){
return;
}
this.addClobberNode(node);
for(var x=0;x<_32e.length;x++){
node.__clobberAttrs__.push(_32e[x]);
}
};
this.removeListener=function(node,_331,fp,_333){
if(!_333){
var _333=false;
}
_331=dojo.event.browser.normalizedEventName(_331);
if(_331=="key"){
if(dojo.render.html.ie){
this.removeListener(node,"onkeydown",fp,_333);
}
_331="keypress";
}
if(node.removeEventListener){
node.removeEventListener(_331,fp,_333);
}
};
this.addListener=function(node,_335,fp,_337,_338){
if(!node){
return;
}
if(!_337){
var _337=false;
}
_335=dojo.event.browser.normalizedEventName(_335);
if(_335=="key"){
if(dojo.render.html.ie){
this.addListener(node,"onkeydown",fp,_337,_338);
}
_335="keypress";
}
if(!_338){
var _339=function(evt){
if(!evt){
evt=window.event;
}
var ret=fp(dojo.event.browser.fixEvent(evt,this));
if(_337){
dojo.event.browser.stopEvent(evt);
}
return ret;
};
}else{
_339=fp;
}
if(node.addEventListener){
node.addEventListener(_335,_339,_337);
return _339;
}else{
_335="on"+_335;
if(typeof node[_335]=="function"){
var _33c=node[_335];
node[_335]=function(e){
_33c(e);
return _339(e);
};
}else{
node[_335]=_339;
}
if(dojo.render.html.ie){
this.addClobberNodeAttrs(node,[_335]);
}
return _339;
}
};
this.isEvent=function(obj){
return (typeof obj!="undefined")&&(obj)&&(typeof Event!="undefined")&&(obj.eventPhase);
};
this.currentEvent=null;
this.callListener=function(_33f,_340){
if(typeof _33f!="function"){
dojo.raise("listener not a function: "+_33f);
}
dojo.event.browser.currentEvent.currentTarget=_340;
return _33f.call(_340,dojo.event.browser.currentEvent);
};
this._stopPropagation=function(){
dojo.event.browser.currentEvent.cancelBubble=true;
};
this._preventDefault=function(){
dojo.event.browser.currentEvent.returnValue=false;
};
this.keys={KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_HELP:47,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_NUMPAD_MULTIPLY:106,KEY_NUMPAD_PLUS:107,KEY_NUMPAD_ENTER:108,KEY_NUMPAD_MINUS:109,KEY_NUMPAD_PERIOD:110,KEY_NUMPAD_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145};
this.revKeys=[];
for(var key in this.keys){
this.revKeys[this.keys[key]]=key;
}
this.fixEvent=function(evt,_343){
if(!evt){
if(window["event"]){
evt=window.event;
}
}
if(evt["type"]!=null&&(evt["type"].indexOf("key")==0)){
evt.keys=this.revKeys;
for(var key in this.keys){
evt[key]=this.keys[key];
}
if(evt["type"]=="keydown"&&dojo.render.html.ie){
switch(evt.keyCode){
case evt.KEY_SHIFT:
case evt.KEY_CTRL:
case evt.KEY_ALT:
case evt.KEY_CAPS_LOCK:
case evt.KEY_LEFT_WINDOW:
case evt.KEY_RIGHT_WINDOW:
case evt.KEY_SELECT:
case evt.KEY_NUM_LOCK:
case evt.KEY_SCROLL_LOCK:
case evt.KEY_NUMPAD_0:
case evt.KEY_NUMPAD_1:
case evt.KEY_NUMPAD_2:
case evt.KEY_NUMPAD_3:
case evt.KEY_NUMPAD_4:
case evt.KEY_NUMPAD_5:
case evt.KEY_NUMPAD_6:
case evt.KEY_NUMPAD_7:
case evt.KEY_NUMPAD_8:
case evt.KEY_NUMPAD_9:
case evt.KEY_NUMPAD_PERIOD:
break;
case evt.KEY_NUMPAD_MULTIPLY:
case evt.KEY_NUMPAD_PLUS:
case evt.KEY_NUMPAD_ENTER:
case evt.KEY_NUMPAD_MINUS:
case evt.KEY_NUMPAD_DIVIDE:
break;
case evt.KEY_PAUSE:
case evt.KEY_TAB:
case evt.KEY_BACKSPACE:
case evt.KEY_ENTER:
case evt.KEY_ESCAPE:
case evt.KEY_PAGE_UP:
case evt.KEY_PAGE_DOWN:
case evt.KEY_END:
case evt.KEY_HOME:
case evt.KEY_LEFT_ARROW:
case evt.KEY_UP_ARROW:
case evt.KEY_RIGHT_ARROW:
case evt.KEY_DOWN_ARROW:
case evt.KEY_INSERT:
case evt.KEY_DELETE:
case evt.KEY_F1:
case evt.KEY_F2:
case evt.KEY_F3:
case evt.KEY_F4:
case evt.KEY_F5:
case evt.KEY_F6:
case evt.KEY_F7:
case evt.KEY_F8:
case evt.KEY_F9:
case evt.KEY_F10:
case evt.KEY_F11:
case evt.KEY_F12:
case evt.KEY_F12:
case evt.KEY_F13:
case evt.KEY_F14:
case evt.KEY_F15:
case evt.KEY_CLEAR:
case evt.KEY_HELP:
evt.key=evt.keyCode;
break;
default:
if(evt.ctrlKey||evt.altKey){
var _345=evt.keyCode;
if(_345>=65&&_345<=90&&evt.shiftKey==false){
_345+=32;
}
if(_345>=1&&_345<=26&&evt.ctrlKey){
_345+=96;
}
evt.key=String.fromCharCode(_345);
}
}
}else{
if(evt["type"]=="keypress"){
if(dojo.render.html.opera){
if(evt.which==0){
evt.key=evt.keyCode;
}else{
if(evt.which>0){
switch(evt.which){
case evt.KEY_SHIFT:
case evt.KEY_CTRL:
case evt.KEY_ALT:
case evt.KEY_CAPS_LOCK:
case evt.KEY_NUM_LOCK:
case evt.KEY_SCROLL_LOCK:
break;
case evt.KEY_PAUSE:
case evt.KEY_TAB:
case evt.KEY_BACKSPACE:
case evt.KEY_ENTER:
case evt.KEY_ESCAPE:
evt.key=evt.which;
break;
default:
var _345=evt.which;
if((evt.ctrlKey||evt.altKey||evt.metaKey)&&(evt.which>=65&&evt.which<=90&&evt.shiftKey==false)){
_345+=32;
}
evt.key=String.fromCharCode(_345);
}
}
}
}else{
if(dojo.render.html.ie){
if(!evt.ctrlKey&&!evt.altKey&&evt.keyCode>=evt.KEY_SPACE){
evt.key=String.fromCharCode(evt.keyCode);
}
}else{
if(dojo.render.html.safari){
switch(evt.keyCode){
case 25:
evt.key=evt.KEY_TAB;
evt.shift=true;
break;
case 63232:
evt.key=evt.KEY_UP_ARROW;
break;
case 63233:
evt.key=evt.KEY_DOWN_ARROW;
break;
case 63234:
evt.key=evt.KEY_LEFT_ARROW;
break;
case 63235:
evt.key=evt.KEY_RIGHT_ARROW;
break;
case 63236:
evt.key=evt.KEY_F1;
break;
case 63237:
evt.key=evt.KEY_F2;
break;
case 63238:
evt.key=evt.KEY_F3;
break;
case 63239:
evt.key=evt.KEY_F4;
break;
case 63240:
evt.key=evt.KEY_F5;
break;
case 63241:
evt.key=evt.KEY_F6;
break;
case 63242:
evt.key=evt.KEY_F7;
break;
case 63243:
evt.key=evt.KEY_F8;
break;
case 63244:
evt.key=evt.KEY_F9;
break;
case 63245:
evt.key=evt.KEY_F10;
break;
case 63246:
evt.key=evt.KEY_F11;
break;
case 63247:
evt.key=evt.KEY_F12;
break;
case 63250:
evt.key=evt.KEY_PAUSE;
break;
case 63272:
evt.key=evt.KEY_DELETE;
break;
case 63273:
evt.key=evt.KEY_HOME;
break;
case 63275:
evt.key=evt.KEY_END;
break;
case 63276:
evt.key=evt.KEY_PAGE_UP;
break;
case 63277:
evt.key=evt.KEY_PAGE_DOWN;
break;
case 63302:
evt.key=evt.KEY_INSERT;
break;
case 63248:
case 63249:
case 63289:
break;
default:
evt.key=evt.charCode>=evt.KEY_SPACE?String.fromCharCode(evt.charCode):evt.keyCode;
}
}else{
evt.key=evt.charCode>0?String.fromCharCode(evt.charCode):evt.keyCode;
}
}
}
}
}
}
if(dojo.render.html.ie){
if(!evt.target){
evt.target=evt.srcElement;
}
if(!evt.currentTarget){
evt.currentTarget=(_343?_343:evt.srcElement);
}
if(!evt.layerX){
evt.layerX=evt.offsetX;
}
if(!evt.layerY){
evt.layerY=evt.offsetY;
}
var doc=(evt.srcElement&&evt.srcElement.ownerDocument)?evt.srcElement.ownerDocument:document;
var _347=((dojo.render.html.ie55)||(doc["compatMode"]=="BackCompat"))?doc.body:doc.documentElement;
if(!evt.pageX){
evt.pageX=evt.clientX+(_347.scrollLeft||0);
}
if(!evt.pageY){
evt.pageY=evt.clientY+(_347.scrollTop||0);
}
if(evt.type=="mouseover"){
evt.relatedTarget=evt.fromElement;
}
if(evt.type=="mouseout"){
evt.relatedTarget=evt.toElement;
}
this.currentEvent=evt;
evt.callListener=this.callListener;
evt.stopPropagation=this._stopPropagation;
evt.preventDefault=this._preventDefault;
}
return evt;
};
this.stopEvent=function(evt){
if(window.event){
evt.cancelBubble=true;
evt.returnValue=false;
}else{
evt.preventDefault();
evt.stopPropagation();
}
};
};
dojo.kwCompoundRequire({common:["dojo.event.common","dojo.event.topic"],browser:["dojo.event.browser"],dashboard:["dojo.event.browser"]});
dojo.provide("dojo.event.*");
dojo.provide("dojo.widget.Manager");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.func");
dojo.require("dojo.event.*");
dojo.widget.manager=new function(){
this.widgets=[];
this.widgetIds=[];
this.topWidgets={};
var _349={};
var _34a=[];
this.getUniqueId=function(_34b){
var _34c;
do{
_34c=_34b+"_"+(_349[_34b]!=undefined?++_349[_34b]:_349[_34b]=0);
}while(this.getWidgetById(_34c));
return _34c;
};
this.add=function(_34d){
this.widgets.push(_34d);
if(!_34d.extraArgs["id"]){
_34d.extraArgs["id"]=_34d.extraArgs["ID"];
}
if(_34d.widgetId==""){
if(_34d["id"]){
_34d.widgetId=_34d["id"];
}else{
if(_34d.extraArgs["id"]){
_34d.widgetId=_34d.extraArgs["id"];
}else{
_34d.widgetId=this.getUniqueId(_34d.ns+"_"+_34d.widgetType);
}
}
}
if(this.widgetIds[_34d.widgetId]){
dojo.debug("widget ID collision on ID: "+_34d.widgetId);
}
this.widgetIds[_34d.widgetId]=_34d;
};
this.destroyAll=function(){
for(var x=this.widgets.length-1;x>=0;x--){
try{
this.widgets[x].destroy(true);
delete this.widgets[x];
}
catch(e){
}
}
};
this.remove=function(_34f){
if(dojo.lang.isNumber(_34f)){
var tw=this.widgets[_34f].widgetId;
delete this.topWidgets[tw];
delete this.widgetIds[tw];
this.widgets.splice(_34f,1);
}else{
this.removeById(_34f);
}
};
this.removeById=function(id){
if(!dojo.lang.isString(id)){
id=id["widgetId"];
if(!id){
dojo.debug("invalid widget or id passed to removeById");
return;
}
}
for(var i=0;i<this.widgets.length;i++){
if(this.widgets[i].widgetId==id){
this.remove(i);
break;
}
}
};
this.getWidgetById=function(id){
if(dojo.lang.isString(id)){
return this.widgetIds[id];
}
return id;
};
this.getWidgetsByType=function(type){
var lt=type.toLowerCase();
var _356=(type.indexOf(":")<0?function(x){
return x.widgetType.toLowerCase();
}:function(x){
return x.getNamespacedType();
});
var ret=[];
dojo.lang.forEach(this.widgets,function(x){
if(_356(x)==lt){
ret.push(x);
}
});
return ret;
};
this.getWidgetsByFilter=function(_35b,_35c){
var ret=[];
dojo.lang.every(this.widgets,function(x){
if(_35b(x)){
ret.push(x);
if(_35c){
return false;
}
}
return true;
});
return (_35c?ret[0]:ret);
};
this.getAllWidgets=function(){
return this.widgets.concat();
};
this.getWidgetByNode=function(node){
var w=this.getAllWidgets();
node=dojo.byId(node);
for(var i=0;i<w.length;i++){
if(w[i].domNode==node){
return w[i];
}
}
return null;
};
this.byId=this.getWidgetById;
this.byType=this.getWidgetsByType;
this.byFilter=this.getWidgetsByFilter;
this.byNode=this.getWidgetByNode;
var _362={};
var _363=["dojo.widget"];
for(var i=0;i<_363.length;i++){
_363[_363[i]]=true;
}
this.registerWidgetPackage=function(_365){
if(!_363[_365]){
_363[_365]=true;
_363.push(_365);
}
};
this.getWidgetPackageList=function(){
return dojo.lang.map(_363,function(elt){
return (elt!==true?elt:undefined);
});
};
this.getImplementation=function(_367,_368,_369,ns){
var impl=this.getImplementationName(_367,ns);
if(impl){
var ret=_368?new impl(_368):new impl();
return ret;
}
};
function buildPrefixCache(){
for(var _36d in dojo.render){
if(dojo.render[_36d]["capable"]===true){
var _36e=dojo.render[_36d].prefixes;
for(var i=0;i<_36e.length;i++){
_34a.push(_36e[i].toLowerCase());
}
}
}
}
var _370=function(_371,_372){
if(!_372){
return null;
}
for(var i=0,l=_34a.length,_375;i<=l;i++){
_375=(i<l?_372[_34a[i]]:_372);
if(!_375){
continue;
}
for(var name in _375){
if(name.toLowerCase()==_371){
return _375[name];
}
}
}
return null;
};
var _377=function(_378,_379){
var _37a=dojo.evalObjPath(_379,false);
return (_37a?_370(_378,_37a):null);
};
this.getImplementationName=function(_37b,ns){
var _37d=_37b.toLowerCase();
ns=ns||"dojo";
var imps=_362[ns]||(_362[ns]={});
var impl=imps[_37d];
if(impl){
return impl;
}
if(!_34a.length){
buildPrefixCache();
}
var _380=dojo.ns.get(ns);
if(!_380){
dojo.ns.register(ns,ns+".widget");
_380=dojo.ns.get(ns);
}
if(_380){
_380.resolve(_37b);
}
impl=_377(_37d,_380.module);
if(impl){
return (imps[_37d]=impl);
}
_380=dojo.ns.require(ns);
if((_380)&&(_380.resolver)){
_380.resolve(_37b);
impl=_377(_37d,_380.module);
if(impl){
return (imps[_37d]=impl);
}
}
dojo.deprecated("dojo.widget.Manager.getImplementationName","Could not locate widget implementation for \""+_37b+"\" in \""+_380.module+"\" registered to namespace \""+_380.name+"\". "+"Developers must specify correct namespaces for all non-Dojo widgets","0.5");
for(var i=0;i<_363.length;i++){
impl=_377(_37d,_363[i]);
if(impl){
return (imps[_37d]=impl);
}
}
throw new Error("Could not locate widget implementation for \""+_37b+"\" in \""+_380.module+"\" registered to namespace \""+_380.name+"\"");
};
this.resizing=false;
this.onWindowResized=function(){
if(this.resizing){
return;
}
try{
this.resizing=true;
for(var id in this.topWidgets){
var _383=this.topWidgets[id];
if(_383.checkSize){
_383.checkSize();
}
}
}
catch(e){
}
finally{
this.resizing=false;
}
};
if(typeof window!="undefined"){
dojo.addOnLoad(this,"onWindowResized");
dojo.event.connect(window,"onresize",this,"onWindowResized");
}
};
(function(){
var dw=dojo.widget;
var dwm=dw.manager;
var h=dojo.lang.curry(dojo.lang,"hitch",dwm);
var g=function(_388,_389){
dw[(_389||_388)]=h(_388);
};
g("add","addWidget");
g("destroyAll","destroyAllWidgets");
g("remove","removeWidget");
g("removeById","removeWidgetById");
g("getWidgetById");
g("getWidgetById","byId");
g("getWidgetsByType");
g("getWidgetsByFilter");
g("getWidgetsByType","byType");
g("getWidgetsByFilter","byFilter");
g("getWidgetByNode","byNode");
dw.all=function(n){
var _38b=dwm.getAllWidgets.apply(dwm,arguments);
if(arguments.length>0){
return _38b[n];
}
return _38b;
};
g("registerWidgetPackage");
g("getImplementation","getWidgetImplementation");
g("getImplementationName","getWidgetImplementationName");
dw.widgets=dwm.widgets;
dw.widgetIds=dwm.widgetIds;
dw.root=dwm.root;
})();
dojo.provide("dojo.uri.Uri");
dojo.uri=new function(){
this.dojoUri=function(uri){
return new dojo.uri.Uri(dojo.hostenv.getBaseScriptUri(),uri);
};
this.moduleUri=function(_38d,uri){
var loc=dojo.hostenv.getModuleSymbols(_38d).join("/");
if(!loc){
return null;
}
if(loc.lastIndexOf("/")!=loc.length-1){
loc+="/";
}
var _390=loc.indexOf(":");
var _391=loc.indexOf("/");
if(loc.charAt(0)!="/"&&(_390==-1||_390>_391)){
loc=dojo.hostenv.getBaseScriptUri()+loc;
}
return new dojo.uri.Uri(loc,uri);
};
this.Uri=function(){
var uri=arguments[0];
for(var i=1;i<arguments.length;i++){
if(!arguments[i]){
continue;
}
var _394=new dojo.uri.Uri(arguments[i].toString());
var _395=new dojo.uri.Uri(uri.toString());
if((_394.path=="")&&(_394.scheme==null)&&(_394.authority==null)&&(_394.query==null)){
if(_394.fragment!=null){
_395.fragment=_394.fragment;
}
_394=_395;
}else{
if(_394.scheme==null){
_394.scheme=_395.scheme;
if(_394.authority==null){
_394.authority=_395.authority;
if(_394.path.charAt(0)!="/"){
var path=_395.path.substring(0,_395.path.lastIndexOf("/")+1)+_394.path;
var segs=path.split("/");
for(var j=0;j<segs.length;j++){
if(segs[j]=="."){
if(j==segs.length-1){
segs[j]="";
}else{
segs.splice(j,1);
j--;
}
}else{
if(j>0&&!(j==1&&segs[0]=="")&&segs[j]==".."&&segs[j-1]!=".."){
if(j==segs.length-1){
segs.splice(j,1);
segs[j-1]="";
}else{
segs.splice(j-1,2);
j-=2;
}
}
}
}
_394.path=segs.join("/");
}
}
}
}
uri="";
if(_394.scheme!=null){
uri+=_394.scheme+":";
}
if(_394.authority!=null){
uri+="//"+_394.authority;
}
uri+=_394.path;
if(_394.query!=null){
uri+="?"+_394.query;
}
if(_394.fragment!=null){
uri+="#"+_394.fragment;
}
}
this.uri=uri.toString();
var _399="^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$";
var r=this.uri.match(new RegExp(_399));
this.scheme=r[2]||(r[1]?"":null);
this.authority=r[4]||(r[3]?"":null);
this.path=r[5];
this.query=r[7]||(r[6]?"":null);
this.fragment=r[9]||(r[8]?"":null);
if(this.authority!=null){
_399="^((([^:]+:)?([^@]+))@)?([^:]*)(:([0-9]+))?$";
r=this.authority.match(new RegExp(_399));
this.user=r[3]||null;
this.password=r[4]||null;
this.host=r[5];
this.port=r[7]||null;
}
this.toString=function(){
return this.uri;
};
};
};
dojo.kwCompoundRequire({common:[["dojo.uri.Uri",false,false]]});
dojo.provide("dojo.uri.*");
dojo.provide("dojo.html.common");
dojo.require("dojo.lang.common");
dojo.require("dojo.dom");
dojo.lang.mixin(dojo.html,dojo.dom);
dojo.html.body=function(){
dojo.deprecated("dojo.html.body() moved to dojo.body()","0.5");
return dojo.body();
};
dojo.html.getEventTarget=function(evt){
if(!evt){
evt=dojo.global().event||{};
}
var t=(evt.srcElement?evt.srcElement:(evt.target?evt.target:null));
while((t)&&(t.nodeType!=1)){
t=t.parentNode;
}
return t;
};
dojo.html.getViewport=function(){
var _39d=dojo.global();
var _39e=dojo.doc();
var w=0;
var h=0;
if(dojo.render.html.mozilla){
w=_39e.documentElement.clientWidth;
h=_39d.innerHeight;
}else{
if(!dojo.render.html.opera&&_39d.innerWidth){
w=_39d.innerWidth;
h=_39d.innerHeight;
}else{
if(!dojo.render.html.opera&&dojo.exists(_39e,"documentElement.clientWidth")){
var w2=_39e.documentElement.clientWidth;
if(!w||w2&&w2<w){
w=w2;
}
h=_39e.documentElement.clientHeight;
}else{
if(dojo.body().clientWidth){
w=dojo.body().clientWidth;
h=dojo.body().clientHeight;
}
}
}
}
return {width:w,height:h};
};
dojo.html.getScroll=function(){
var _3a2=dojo.global();
var _3a3=dojo.doc();
var top=_3a2.pageYOffset||_3a3.documentElement.scrollTop||dojo.body().scrollTop||0;
var left=_3a2.pageXOffset||_3a3.documentElement.scrollLeft||dojo.body().scrollLeft||0;
return {top:top,left:left,offset:{x:left,y:top}};
};
dojo.html.getParentByType=function(node,type){
var _3a8=dojo.doc();
var _3a9=dojo.byId(node);
type=type.toLowerCase();
while((_3a9)&&(_3a9.nodeName.toLowerCase()!=type)){
if(_3a9==(_3a8["body"]||_3a8["documentElement"])){
return null;
}
_3a9=_3a9.parentNode;
}
return _3a9;
};
dojo.html.getAttribute=function(node,attr){
node=dojo.byId(node);
if((!node)||(!node.getAttribute)){
return null;
}
var ta=typeof attr=="string"?attr:new String(attr);
var v=node.getAttribute(ta.toUpperCase());
if((v)&&(typeof v=="string")&&(v!="")){
return v;
}
if(v&&v.value){
return v.value;
}
if((node.getAttributeNode)&&(node.getAttributeNode(ta))){
return (node.getAttributeNode(ta)).value;
}else{
if(node.getAttribute(ta)){
return node.getAttribute(ta);
}else{
if(node.getAttribute(ta.toLowerCase())){
return node.getAttribute(ta.toLowerCase());
}
}
}
return null;
};
dojo.html.hasAttribute=function(node,attr){
return dojo.html.getAttribute(dojo.byId(node),attr)?true:false;
};
dojo.html.getCursorPosition=function(e){
e=e||dojo.global().event;
var _3b1={x:0,y:0};
if(e.pageX||e.pageY){
_3b1.x=e.pageX;
_3b1.y=e.pageY;
}else{
var de=dojo.doc().documentElement;
var db=dojo.body();
_3b1.x=e.clientX+((de||db)["scrollLeft"])-((de||db)["clientLeft"]);
_3b1.y=e.clientY+((de||db)["scrollTop"])-((de||db)["clientTop"]);
}
return _3b1;
};
dojo.html.isTag=function(node){
node=dojo.byId(node);
if(node&&node.tagName){
for(var i=1;i<arguments.length;i++){
if(node.tagName.toLowerCase()==String(arguments[i]).toLowerCase()){
return String(arguments[i]).toLowerCase();
}
}
}
return "";
};
if(dojo.render.html.ie&&!dojo.render.html.ie70){
if(window.location.href.substr(0,6).toLowerCase()!="https:"){
(function(){
var _3b6=dojo.doc().createElement("script");
_3b6.src="javascript:'dojo.html.createExternalElement=function(doc, tag){ return doc.createElement(tag); }'";
dojo.doc().getElementsByTagName("head")[0].appendChild(_3b6);
})();
}
}else{
dojo.html.createExternalElement=function(doc,tag){
return doc.createElement(tag);
};
}
dojo.html._callDeprecated=function(_3b9,_3ba,args,_3bc,_3bd){
dojo.deprecated("dojo.html."+_3b9,"replaced by dojo.html."+_3ba+"("+(_3bc?"node, {"+_3bc+": "+_3bc+"}":"")+")"+(_3bd?"."+_3bd:""),"0.5");
var _3be=[];
if(_3bc){
var _3bf={};
_3bf[_3bc]=args[1];
_3be.push(args[0]);
_3be.push(_3bf);
}else{
_3be=args;
}
var ret=dojo.html[_3ba].apply(dojo.html,args);
if(_3bd){
return ret[_3bd];
}else{
return ret;
}
};
dojo.html.getViewportWidth=function(){
return dojo.html._callDeprecated("getViewportWidth","getViewport",arguments,null,"width");
};
dojo.html.getViewportHeight=function(){
return dojo.html._callDeprecated("getViewportHeight","getViewport",arguments,null,"height");
};
dojo.html.getViewportSize=function(){
return dojo.html._callDeprecated("getViewportSize","getViewport",arguments);
};
dojo.html.getScrollTop=function(){
return dojo.html._callDeprecated("getScrollTop","getScroll",arguments,null,"top");
};
dojo.html.getScrollLeft=function(){
return dojo.html._callDeprecated("getScrollLeft","getScroll",arguments,null,"left");
};
dojo.html.getScrollOffset=function(){
return dojo.html._callDeprecated("getScrollOffset","getScroll",arguments,null,"offset");
};
dojo.provide("dojo.a11y");
dojo.require("dojo.uri.*");
dojo.require("dojo.html.common");
dojo.a11y={imgPath:dojo.uri.moduleUri("dojo.widget","templates/images"),doAccessibleCheck:true,accessible:null,checkAccessible:function(){
if(this.accessible===null){
this.accessible=false;
if(this.doAccessibleCheck==true){
this.accessible=this.testAccessible();
}
}
return this.accessible;
},testAccessible:function(){
this.accessible=false;
if(dojo.render.html.ie||dojo.render.html.mozilla){
var div=document.createElement("div");
div.style.backgroundImage="url(\""+this.imgPath+"/tab_close.gif\")";
dojo.body().appendChild(div);
var _3c2=null;
if(window.getComputedStyle){
var _3c3=getComputedStyle(div,"");
_3c2=_3c3.getPropertyValue("background-image");
}else{
_3c2=div.currentStyle.backgroundImage;
}
var _3c4=false;
if(_3c2!=null&&(_3c2=="none"||_3c2=="url(invalid-url:)")){
this.accessible=true;
}
dojo.body().removeChild(div);
}
return this.accessible;
},setCheckAccessible:function(_3c5){
this.doAccessibleCheck=_3c5;
},setAccessibleMode:function(){
if(this.accessible===null){
if(this.checkAccessible()){
dojo.render.html.prefixes.unshift("a11y");
}
}
return this.accessible;
}};
dojo.provide("dojo.widget.Widget");
dojo.require("dojo.lang.func");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.extras");
dojo.require("dojo.lang.declare");
dojo.require("dojo.ns");
dojo.require("dojo.widget.Manager");
dojo.require("dojo.event.*");
dojo.require("dojo.a11y");
dojo.declare("dojo.widget.Widget",null,function(){
this.children=[];
this.extraArgs={};
},{parent:null,isTopLevel:false,disabled:false,isContainer:false,widgetId:"",widgetType:"Widget",ns:"dojo",getNamespacedType:function(){
return (this.ns?this.ns+":"+this.widgetType:this.widgetType).toLowerCase();
},toString:function(){
return "[Widget "+this.getNamespacedType()+", "+(this.widgetId||"NO ID")+"]";
},repr:function(){
return this.toString();
},enable:function(){
this.disabled=false;
},disable:function(){
this.disabled=true;
},onResized:function(){
this.notifyChildrenOfResize();
},notifyChildrenOfResize:function(){
for(var i=0;i<this.children.length;i++){
var _3c7=this.children[i];
if(_3c7.onResized){
_3c7.onResized();
}
}
},create:function(args,_3c9,_3ca,ns){
if(ns){
this.ns=ns;
}
this.satisfyPropertySets(args,_3c9,_3ca);
this.mixInProperties(args,_3c9,_3ca);
this.postMixInProperties(args,_3c9,_3ca);
dojo.widget.manager.add(this);
this.buildRendering(args,_3c9,_3ca);
this.initialize(args,_3c9,_3ca);
this.postInitialize(args,_3c9,_3ca);
this.postCreate(args,_3c9,_3ca);
return this;
},destroy:function(_3cc){
if(this.parent){
this.parent.removeChild(this);
}
this.destroyChildren();
this.uninitialize();
this.destroyRendering(_3cc);
dojo.widget.manager.removeById(this.widgetId);
},destroyChildren:function(){
var _3cd;
var i=0;
while(this.children.length>i){
_3cd=this.children[i];
if(_3cd instanceof dojo.widget.Widget){
this.removeChild(_3cd);
_3cd.destroy();
continue;
}
i++;
}
},getChildrenOfType:function(type,_3d0){
var ret=[];
var _3d2=dojo.lang.isFunction(type);
if(!_3d2){
type=type.toLowerCase();
}
for(var x=0;x<this.children.length;x++){
if(_3d2){
if(this.children[x] instanceof type){
ret.push(this.children[x]);
}
}else{
if(this.children[x].widgetType.toLowerCase()==type){
ret.push(this.children[x]);
}
}
if(_3d0){
ret=ret.concat(this.children[x].getChildrenOfType(type,_3d0));
}
}
return ret;
},getDescendants:function(){
var _3d4=[];
var _3d5=[this];
var elem;
while((elem=_3d5.pop())){
_3d4.push(elem);
if(elem.children){
dojo.lang.forEach(elem.children,function(elem){
_3d5.push(elem);
});
}
}
return _3d4;
},isFirstChild:function(){
return this===this.parent.children[0];
},isLastChild:function(){
return this===this.parent.children[this.parent.children.length-1];
},satisfyPropertySets:function(args){
return args;
},mixInProperties:function(args,frag){
if((args["fastMixIn"])||(frag["fastMixIn"])){
for(var x in args){
this[x]=args[x];
}
return;
}
var _3dc;
var _3dd=dojo.widget.lcArgsCache[this.widgetType];
if(_3dd==null){
_3dd={};
for(var y in this){
_3dd[((new String(y)).toLowerCase())]=y;
}
dojo.widget.lcArgsCache[this.widgetType]=_3dd;
}
var _3df={};
for(var x in args){
if(!this[x]){
var y=_3dd[(new String(x)).toLowerCase()];
if(y){
args[y]=args[x];
x=y;
}
}
if(_3df[x]){
continue;
}
_3df[x]=true;
if((typeof this[x])!=(typeof _3dc)){
if(typeof args[x]!="string"){
this[x]=args[x];
}else{
if(dojo.lang.isString(this[x])){
this[x]=args[x];
}else{
if(dojo.lang.isNumber(this[x])){
this[x]=new Number(args[x]);
}else{
if(dojo.lang.isBoolean(this[x])){
this[x]=(args[x].toLowerCase()=="false")?false:true;
}else{
if(dojo.lang.isFunction(this[x])){
if(args[x].search(/[^\w\.]+/i)==-1){
this[x]=dojo.evalObjPath(args[x],false);
}else{
var tn=dojo.lang.nameAnonFunc(new Function(args[x]),this);
dojo.event.kwConnect({srcObj:this,srcFunc:x,adviceObj:this,adviceFunc:tn});
}
}else{
if(dojo.lang.isArray(this[x])){
this[x]=args[x].split(";");
}else{
if(this[x] instanceof Date){
this[x]=new Date(Number(args[x]));
}else{
if(typeof this[x]=="object"){
if(this[x] instanceof dojo.uri.Uri){
this[x]=dojo.uri.dojoUri(args[x]);
}else{
var _3e1=args[x].split(";");
for(var y=0;y<_3e1.length;y++){
var si=_3e1[y].indexOf(":");
if((si!=-1)&&(_3e1[y].length>si)){
this[x][_3e1[y].substr(0,si).replace(/^\s+|\s+$/g,"")]=_3e1[y].substr(si+1);
}
}
}
}else{
this[x]=args[x];
}
}
}
}
}
}
}
}
}else{
this.extraArgs[x.toLowerCase()]=args[x];
}
}
},postMixInProperties:function(args,frag,_3e5){
},initialize:function(args,frag,_3e8){
return false;
},postInitialize:function(args,frag,_3eb){
return false;
},postCreate:function(args,frag,_3ee){
return false;
},uninitialize:function(){
return false;
},buildRendering:function(args,frag,_3f1){
dojo.unimplemented("dojo.widget.Widget.buildRendering, on "+this.toString()+", ");
return false;
},destroyRendering:function(){
dojo.unimplemented("dojo.widget.Widget.destroyRendering");
return false;
},addedTo:function(_3f2){
},addChild:function(_3f3){
dojo.unimplemented("dojo.widget.Widget.addChild");
return false;
},removeChild:function(_3f4){
for(var x=0;x<this.children.length;x++){
if(this.children[x]===_3f4){
this.children.splice(x,1);
_3f4.parent=null;
break;
}
}
return _3f4;
},getPreviousSibling:function(){
var idx=this.getParentIndex();
if(idx<=0){
return null;
}
return this.parent.children[idx-1];
},getSiblings:function(){
return this.parent.children;
},getParentIndex:function(){
return dojo.lang.indexOf(this.parent.children,this,true);
},getNextSibling:function(){
var idx=this.getParentIndex();
if(idx==this.parent.children.length-1){
return null;
}
if(idx<0){
return null;
}
return this.parent.children[idx+1];
}});
dojo.widget.lcArgsCache={};
dojo.widget.tags={};
dojo.widget.tags.addParseTreeHandler=function(type){
dojo.deprecated("addParseTreeHandler",". ParseTreeHandlers are now reserved for components. Any unfiltered DojoML tag without a ParseTreeHandler is assumed to be a widget","0.5");
};
dojo.widget.tags["dojo:propertyset"]=function(_3f9,_3fa,_3fb){
var _3fc=_3fa.parseProperties(_3f9["dojo:propertyset"]);
};
dojo.widget.tags["dojo:connect"]=function(_3fd,_3fe,_3ff){
var _400=_3fe.parseProperties(_3fd["dojo:connect"]);
};
dojo.widget.buildWidgetFromParseTree=function(type,frag,_403,_404,_405,_406){
dojo.a11y.setAccessibleMode();
var _407=type.split(":");
_407=(_407.length==2)?_407[1]:type;
var _408=_406||_403.parseProperties(frag[frag["ns"]+":"+_407]);
var _409=dojo.widget.manager.getImplementation(_407,null,null,frag["ns"]);
if(!_409){
throw new Error("cannot find \""+type+"\" widget");
}else{
if(!_409.create){
throw new Error("\""+type+"\" widget object has no \"create\" method and does not appear to implement *Widget");
}
}
_408["dojoinsertionindex"]=_405;
var ret=_409.create(_408,frag,_404,frag["ns"]);
return ret;
};
dojo.widget.defineWidget=function(_40b,_40c,_40d,init,_40f){
if(dojo.lang.isString(arguments[3])){
dojo.widget._defineWidget(arguments[0],arguments[3],arguments[1],arguments[4],arguments[2]);
}else{
var args=[arguments[0]],p=3;
if(dojo.lang.isString(arguments[1])){
args.push(arguments[1],arguments[2]);
}else{
args.push("",arguments[1]);
p=2;
}
if(dojo.lang.isFunction(arguments[p])){
args.push(arguments[p],arguments[p+1]);
}else{
args.push(null,arguments[p]);
}
dojo.widget._defineWidget.apply(this,args);
}
};
dojo.widget.defineWidget.renderers="html|svg|vml";
dojo.widget._defineWidget=function(_412,_413,_414,init,_416){
var _417=_412.split(".");
var type=_417.pop();
var regx="\\.("+(_413?_413+"|":"")+dojo.widget.defineWidget.renderers+")\\.";
var r=_412.search(new RegExp(regx));
_417=(r<0?_417.join("."):_412.substr(0,r));
dojo.widget.manager.registerWidgetPackage(_417);
var pos=_417.indexOf(".");
var _41c=(pos>-1)?_417.substring(0,pos):_417;
_416=(_416)||{};
_416.widgetType=type;
if((!init)&&(_416["classConstructor"])){
init=_416.classConstructor;
delete _416.classConstructor;
}
dojo.declare(_412,_414,init,_416);
};
dojo.provide("dojo.widget.Parse");
dojo.require("dojo.widget.Manager");
dojo.require("dojo.dom");
dojo.widget.Parse=function(_41d){
this.propertySetsList=[];
this.fragment=_41d;
this.createComponents=function(frag,_41f){
var _420=[];
var _421=false;
try{
if(frag&&frag.tagName&&(frag!=frag.nodeRef)){
var _422=dojo.widget.tags;
var tna=String(frag.tagName).split(";");
for(var x=0;x<tna.length;x++){
var ltn=tna[x].replace(/^\s+|\s+$/g,"").toLowerCase();
frag.tagName=ltn;
var ret;
if(_422[ltn]){
_421=true;
ret=_422[ltn](frag,this,_41f,frag.index);
_420.push(ret);
}else{
if(ltn.indexOf(":")==-1){
ltn="dojo:"+ltn;
}
ret=dojo.widget.buildWidgetFromParseTree(ltn,frag,this,_41f,frag.index);
if(ret){
_421=true;
_420.push(ret);
}
}
}
}
}
catch(e){
dojo.debug("dojo.widget.Parse: error:",e);
}
if(!_421){
_420=_420.concat(this.createSubComponents(frag,_41f));
}
return _420;
};
this.createSubComponents=function(_427,_428){
var frag,_42a=[];
for(var item in _427){
frag=_427[item];
if(frag&&typeof frag=="object"&&(frag!=_427.nodeRef)&&(frag!=_427.tagName)&&(!dojo.dom.isNode(frag))){
_42a=_42a.concat(this.createComponents(frag,_428));
}
}
return _42a;
};
this.parsePropertySets=function(_42c){
return [];
};
this.parseProperties=function(_42d){
var _42e={};
for(var item in _42d){
if((_42d[item]==_42d.tagName)||(_42d[item]==_42d.nodeRef)){
}else{
var frag=_42d[item];
if(frag.tagName&&dojo.widget.tags[frag.tagName.toLowerCase()]){
}else{
if(frag[0]&&frag[0].value!=""&&frag[0].value!=null){
try{
if(item.toLowerCase()=="dataprovider"){
var _431=this;
this.getDataProvider(_431,frag[0].value);
_42e.dataProvider=this.dataProvider;
}
_42e[item]=frag[0].value;
var _432=this.parseProperties(frag);
for(var _433 in _432){
_42e[_433]=_432[_433];
}
}
catch(e){
dojo.debug(e);
}
}
}
switch(item.toLowerCase()){
case "checked":
case "disabled":
if(typeof _42e[item]!="boolean"){
_42e[item]=true;
}
break;
}
}
}
return _42e;
};
this.getDataProvider=function(_434,_435){
dojo.io.bind({url:_435,load:function(type,_437){
if(type=="load"){
_434.dataProvider=_437;
}
},mimetype:"text/javascript",sync:true});
};
this.getPropertySetById=function(_438){
for(var x=0;x<this.propertySetsList.length;x++){
if(_438==this.propertySetsList[x]["id"][0].value){
return this.propertySetsList[x];
}
}
return "";
};
this.getPropertySetsByType=function(_43a){
var _43b=[];
for(var x=0;x<this.propertySetsList.length;x++){
var cpl=this.propertySetsList[x];
var cpcc=cpl.componentClass||cpl.componentType||null;
var _43f=this.propertySetsList[x]["id"][0].value;
if(cpcc&&(_43f==cpcc[0].value)){
_43b.push(cpl);
}
}
return _43b;
};
this.getPropertySets=function(_440){
var ppl="dojo:propertyproviderlist";
var _442=[];
var _443=_440.tagName;
if(_440[ppl]){
var _444=_440[ppl].value.split(" ");
for(var _445 in _444){
if((_445.indexOf("..")==-1)&&(_445.indexOf("://")==-1)){
var _446=this.getPropertySetById(_445);
if(_446!=""){
_442.push(_446);
}
}else{
}
}
}
return this.getPropertySetsByType(_443).concat(_442);
};
this.createComponentFromScript=function(_447,_448,_449,ns){
_449.fastMixIn=true;
var ltn=(ns||"dojo")+":"+_448.toLowerCase();
if(dojo.widget.tags[ltn]){
return [dojo.widget.tags[ltn](_449,this,null,null,_449)];
}
return [dojo.widget.buildWidgetFromParseTree(ltn,_449,this,null,null,_449)];
};
};
dojo.widget._parser_collection={"dojo":new dojo.widget.Parse()};
dojo.widget.getParser=function(name){
if(!name){
name="dojo";
}
if(!this._parser_collection[name]){
this._parser_collection[name]=new dojo.widget.Parse();
}
return this._parser_collection[name];
};
dojo.widget.createWidget=function(name,_44e,_44f,_450){
var _451=false;
var _452=(typeof name=="string");
if(_452){
var pos=name.indexOf(":");
var ns=(pos>-1)?name.substring(0,pos):"dojo";
if(pos>-1){
name=name.substring(pos+1);
}
var _455=name.toLowerCase();
var _456=ns+":"+_455;
_451=(dojo.byId(name)&&!dojo.widget.tags[_456]);
}
if((arguments.length==1)&&(_451||!_452)){
var xp=new dojo.xml.Parse();
var tn=_451?dojo.byId(name):name;
return dojo.widget.getParser().createComponents(xp.parseElement(tn,null,true))[0];
}
function fromScript(_459,name,_45b,ns){
_45b[_456]={dojotype:[{value:_455}],nodeRef:_459,fastMixIn:true};
_45b.ns=ns;
return dojo.widget.getParser().createComponentFromScript(_459,name,_45b,ns);
}
_44e=_44e||{};
var _45d=false;
var tn=null;
var h=dojo.render.html.capable;
if(h){
tn=document.createElement("span");
}
if(!_44f){
_45d=true;
_44f=tn;
if(h){
dojo.body().appendChild(_44f);
}
}else{
if(_450){
dojo.dom.insertAtPosition(tn,_44f,_450);
}else{
tn=_44f;
}
}
var _45f=fromScript(tn,name.toLowerCase(),_44e,ns);
if((!_45f)||(!_45f[0])||(typeof _45f[0].widgetType=="undefined")){
throw new Error("createWidget: Creation of \""+name+"\" widget failed.");
}
try{
if(_45d&&_45f[0].domNode.parentNode){
_45f[0].domNode.parentNode.removeChild(_45f[0].domNode);
}
}
catch(e){
dojo.debug(e);
}
return _45f[0];
};
dojo.provide("dojo.html.style");
dojo.require("dojo.html.common");
dojo.require("dojo.uri.Uri");
dojo.html.getClass=function(node){
node=dojo.byId(node);
if(!node){
return "";
}
var cs="";
if(node.className){
cs=node.className;
}else{
if(dojo.html.hasAttribute(node,"class")){
cs=dojo.html.getAttribute(node,"class");
}
}
return cs.replace(/^\s+|\s+$/g,"");
};
dojo.html.getClasses=function(node){
var c=dojo.html.getClass(node);
return (c=="")?[]:c.split(/\s+/g);
};
dojo.html.hasClass=function(node,_465){
return (new RegExp("(^|\\s+)"+_465+"(\\s+|$)")).test(dojo.html.getClass(node));
};
dojo.html.prependClass=function(node,_467){
_467+=" "+dojo.html.getClass(node);
return dojo.html.setClass(node,_467);
};
dojo.html.addClass=function(node,_469){
if(dojo.html.hasClass(node,_469)){
return false;
}
_469=(dojo.html.getClass(node)+" "+_469).replace(/^\s+|\s+$/g,"");
return dojo.html.setClass(node,_469);
};
dojo.html.setClass=function(node,_46b){
node=dojo.byId(node);
var cs=new String(_46b);
try{
if(typeof node.className=="string"){
node.className=cs;
}else{
if(node.setAttribute){
node.setAttribute("class",_46b);
node.className=cs;
}else{
return false;
}
}
}
catch(e){
dojo.debug("dojo.html.setClass() failed",e);
}
return true;
};
dojo.html.removeClass=function(node,_46e,_46f){
try{
if(!_46f){
var _470=dojo.html.getClass(node).replace(new RegExp("(^|\\s+)"+_46e+"(\\s+|$)"),"$1$2");
}else{
var _470=dojo.html.getClass(node).replace(_46e,"");
}
dojo.html.setClass(node,_470);
}
catch(e){
dojo.debug("dojo.html.removeClass() failed",e);
}
return true;
};
dojo.html.replaceClass=function(node,_472,_473){
dojo.html.removeClass(node,_473);
dojo.html.addClass(node,_472);
};
dojo.html.classMatchType={ContainsAll:0,ContainsAny:1,IsOnly:2};
dojo.html.getElementsByClass=function(_474,_475,_476,_477,_478){
_478=false;
var _479=dojo.doc();
_475=dojo.byId(_475)||_479;
var _47a=_474.split(/\s+/g);
var _47b=[];
if(_477!=1&&_477!=2){
_477=0;
}
var _47c=new RegExp("(\\s|^)(("+_47a.join(")|(")+"))(\\s|$)");
var _47d=_47a.join(" ").length;
var _47e=[];
if(!_478&&_479.evaluate){
var _47f=".//"+(_476||"*")+"[contains(";
if(_477!=dojo.html.classMatchType.ContainsAny){
_47f+="concat(' ',@class,' '), ' "+_47a.join(" ') and contains(concat(' ',@class,' '), ' ")+" ')";
if(_477==2){
_47f+=" and string-length(@class)="+_47d+"]";
}else{
_47f+="]";
}
}else{
_47f+="concat(' ',@class,' '), ' "+_47a.join(" ') or contains(concat(' ',@class,' '), ' ")+" ')]";
}
var _480=_479.evaluate(_47f,_475,null,XPathResult.ANY_TYPE,null);
var _481=_480.iterateNext();
while(_481){
try{
_47e.push(_481);
_481=_480.iterateNext();
}
catch(e){
break;
}
}
return _47e;
}else{
if(!_476){
_476="*";
}
_47e=_475.getElementsByTagName(_476);
var node,i=0;
outer:
while(node=_47e[i++]){
var _484=dojo.html.getClasses(node);
if(_484.length==0){
continue outer;
}
var _485=0;
for(var j=0;j<_484.length;j++){
if(_47c.test(_484[j])){
if(_477==dojo.html.classMatchType.ContainsAny){
_47b.push(node);
continue outer;
}else{
_485++;
}
}else{
if(_477==dojo.html.classMatchType.IsOnly){
continue outer;
}
}
}
if(_485==_47a.length){
if((_477==dojo.html.classMatchType.IsOnly)&&(_485==_484.length)){
_47b.push(node);
}else{
if(_477==dojo.html.classMatchType.ContainsAll){
_47b.push(node);
}
}
}
}
return _47b;
}
};
dojo.html.getElementsByClassName=dojo.html.getElementsByClass;
dojo.html.toCamelCase=function(_487){
var arr=_487.split("-"),cc=arr[0];
for(var i=1;i<arr.length;i++){
cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1);
}
return cc;
};
dojo.html.toSelectorCase=function(_48b){
return _48b.replace(/([A-Z])/g,"-$1").toLowerCase();
};
if(dojo.render.html.ie){
dojo.html.getComputedStyle=function(node,_48d,_48e){
node=dojo.byId(node);
if(!node||!node.currentStyle){
return _48e;
}
return node.currentStyle[dojo.html.toCamelCase(_48d)];
};
dojo.html.getComputedStyles=function(node){
return node.currentStyle;
};
}else{
dojo.html.getComputedStyle=function(node,_491,_492){
node=dojo.byId(node);
if(!node||!node.style){
return _492;
}
var s=document.defaultView.getComputedStyle(node,null);
return (s&&s[dojo.html.toCamelCase(_491)])||"";
};
dojo.html.getComputedStyles=function(node){
return document.defaultView.getComputedStyle(node,null);
};
}
dojo.html.getStyleProperty=function(node,_496){
node=dojo.byId(node);
return (node&&node.style?node.style[dojo.html.toCamelCase(_496)]:undefined);
};
dojo.html.getStyle=function(node,_498){
var _499=dojo.html.getStyleProperty(node,_498);
return (_499?_499:dojo.html.getComputedStyle(node,_498));
};
dojo.html.setStyle=function(node,_49b,_49c){
node=dojo.byId(node);
if(node&&node.style){
var _49d=dojo.html.toCamelCase(_49b);
node.style[_49d]=_49c;
}
};
dojo.html.setStyleText=function(_49e,text){
try{
_49e.style.cssText=text;
}
catch(e){
_49e.setAttribute("style",text);
}
};
dojo.html.copyStyle=function(_4a0,_4a1){
if(!_4a1.style.cssText){
_4a0.setAttribute("style",_4a1.getAttribute("style"));
}else{
_4a0.style.cssText=_4a1.style.cssText;
}
dojo.html.addClass(_4a0,dojo.html.getClass(_4a1));
};
dojo.html.getUnitValue=function(node,_4a3,_4a4){
var s=dojo.html.getComputedStyle(node,_4a3);
if((!s)||((s=="auto")&&(_4a4))){
return {value:0,units:"px"};
}
var _4a6=s.match(/(\-?[\d.]+)([a-z%]*)/i);
if(!_4a6){
return dojo.html.getUnitValue.bad;
}
return {value:Number(_4a6[1]),units:_4a6[2].toLowerCase()};
};
dojo.html.getUnitValue.bad={value:NaN,units:""};
if(dojo.render.html.ie){
dojo.html.toPixelValue=function(_4a7,_4a8){
if(!_4a8){
return 0;
}
if(_4a8.slice(-2)=="px"){
return parseFloat(_4a8);
}
var _4a9=0;
with(_4a7){
var _4aa=style.left;
var _4ab=runtimeStyle.left;
runtimeStyle.left=currentStyle.left;
try{
style.left=_4a8||0;
_4a9=style.pixelLeft;
style.left=_4aa;
runtimeStyle.left=_4ab;
}
catch(e){
}
}
return _4a9;
};
}else{
dojo.html.toPixelValue=function(_4ac,_4ad){
return (_4ad&&(_4ad.slice(-2)=="px")?parseFloat(_4ad):0);
};
}
dojo.html.getPixelValue=function(node,_4af,_4b0){
return dojo.html.toPixelValue(node,dojo.html.getComputedStyle(node,_4af));
};
dojo.html.setPositivePixelValue=function(node,_4b2,_4b3){
if(isNaN(_4b3)){
return false;
}
node.style[_4b2]=Math.max(0,_4b3)+"px";
return true;
};
dojo.html.styleSheet=null;
dojo.html.insertCssRule=function(_4b4,_4b5,_4b6){
if(!dojo.html.styleSheet){
if(document.createStyleSheet){
dojo.html.styleSheet=document.createStyleSheet();
}else{
if(document.styleSheets[0]){
dojo.html.styleSheet=document.styleSheets[0];
}else{
return null;
}
}
}
if(arguments.length<3){
if(dojo.html.styleSheet.cssRules){
_4b6=dojo.html.styleSheet.cssRules.length;
}else{
if(dojo.html.styleSheet.rules){
_4b6=dojo.html.styleSheet.rules.length;
}else{
return null;
}
}
}
if(dojo.html.styleSheet.insertRule){
var rule=_4b4+" { "+_4b5+" }";
return dojo.html.styleSheet.insertRule(rule,_4b6);
}else{
if(dojo.html.styleSheet.addRule){
return dojo.html.styleSheet.addRule(_4b4,_4b5,_4b6);
}else{
return null;
}
}
};
dojo.html.removeCssRule=function(_4b8){
if(!dojo.html.styleSheet){
dojo.debug("no stylesheet defined for removing rules");
return false;
}
if(dojo.render.html.ie){
if(!_4b8){
_4b8=dojo.html.styleSheet.rules.length;
dojo.html.styleSheet.removeRule(_4b8);
}
}else{
if(document.styleSheets[0]){
if(!_4b8){
_4b8=dojo.html.styleSheet.cssRules.length;
}
dojo.html.styleSheet.deleteRule(_4b8);
}
}
return true;
};
dojo.html._insertedCssFiles=[];
dojo.html.insertCssFile=function(URI,doc,_4bb,_4bc){
if(!URI){
return;
}
if(!doc){
doc=document;
}
var _4bd=dojo.hostenv.getText(URI,false,_4bc);
if(_4bd===null){
return;
}
_4bd=dojo.html.fixPathsInCssText(_4bd,URI);
if(_4bb){
var idx=-1,node,ent=dojo.html._insertedCssFiles;
for(var i=0;i<ent.length;i++){
if((ent[i].doc==doc)&&(ent[i].cssText==_4bd)){
idx=i;
node=ent[i].nodeRef;
break;
}
}
if(node){
var _4c2=doc.getElementsByTagName("style");
for(var i=0;i<_4c2.length;i++){
if(_4c2[i]==node){
return;
}
}
dojo.html._insertedCssFiles.shift(idx,1);
}
}
var _4c3=dojo.html.insertCssText(_4bd,doc);
dojo.html._insertedCssFiles.push({"doc":doc,"cssText":_4bd,"nodeRef":_4c3});
if(_4c3&&djConfig.isDebug){
_4c3.setAttribute("dbgHref",URI);
}
return _4c3;
};
dojo.html.insertCssText=function(_4c4,doc,URI){
if(!_4c4){
return;
}
if(!doc){
doc=document;
}
if(URI){
_4c4=dojo.html.fixPathsInCssText(_4c4,URI);
}
var _4c7=doc.createElement("style");
_4c7.setAttribute("type","text/css");
var head=doc.getElementsByTagName("head")[0];
if(!head){
dojo.debug("No head tag in document, aborting styles");
return;
}else{
head.appendChild(_4c7);
}
if(_4c7.styleSheet){
var _4c9=function(){
try{
_4c7.styleSheet.cssText=_4c4;
}
catch(e){
dojo.debug(e);
}
};
if(_4c7.styleSheet.disabled){
setTimeout(_4c9,10);
}else{
_4c9();
}
}else{
var _4ca=doc.createTextNode(_4c4);
_4c7.appendChild(_4ca);
}
return _4c7;
};
dojo.html.fixPathsInCssText=function(_4cb,URI){
if(!_4cb||!URI){
return;
}
var _4cd,str="",url="",_4d0="[\\t\\s\\w\\(\\)\\/\\.\\\\'\"-:#=&?~]+";
var _4d1=new RegExp("url\\(\\s*("+_4d0+")\\s*\\)");
var _4d2=/(file|https?|ftps?):\/\//;
regexTrim=new RegExp("^[\\s]*(['\"]?)("+_4d0+")\\1[\\s]*?$");
if(dojo.render.html.ie55||dojo.render.html.ie60){
var _4d3=new RegExp("AlphaImageLoader\\((.*)src=['\"]("+_4d0+")['\"]");
while(_4cd=_4d3.exec(_4cb)){
url=_4cd[2].replace(regexTrim,"$2");
if(!_4d2.exec(url)){
url=(new dojo.uri.Uri(URI,url).toString());
}
str+=_4cb.substring(0,_4cd.index)+"AlphaImageLoader("+_4cd[1]+"src='"+url+"'";
_4cb=_4cb.substr(_4cd.index+_4cd[0].length);
}
_4cb=str+_4cb;
str="";
}
while(_4cd=_4d1.exec(_4cb)){
url=_4cd[1].replace(regexTrim,"$2");
if(!_4d2.exec(url)){
url=(new dojo.uri.Uri(URI,url).toString());
}
str+=_4cb.substring(0,_4cd.index)+"url("+url+")";
_4cb=_4cb.substr(_4cd.index+_4cd[0].length);
}
return str+_4cb;
};
dojo.html.setActiveStyleSheet=function(_4d4){
var i=0,a,els=dojo.doc().getElementsByTagName("link");
while(a=els[i++]){
if(a.getAttribute("rel").indexOf("style")!=-1&&a.getAttribute("title")){
a.disabled=true;
if(a.getAttribute("title")==_4d4){
a.disabled=false;
}
}
}
};
dojo.html.getActiveStyleSheet=function(){
var i=0,a,els=dojo.doc().getElementsByTagName("link");
while(a=els[i++]){
if(a.getAttribute("rel").indexOf("style")!=-1&&a.getAttribute("title")&&!a.disabled){
return a.getAttribute("title");
}
}
return null;
};
dojo.html.getPreferredStyleSheet=function(){
var i=0,a,els=dojo.doc().getElementsByTagName("link");
while(a=els[i++]){
if(a.getAttribute("rel").indexOf("style")!=-1&&a.getAttribute("rel").indexOf("alt")==-1&&a.getAttribute("title")){
return a.getAttribute("title");
}
}
return null;
};
dojo.html.applyBrowserClass=function(node){
var drh=dojo.render.html;
var _4e0={dj_ie:drh.ie,dj_ie55:drh.ie55,dj_ie6:drh.ie60,dj_ie7:drh.ie70,dj_iequirks:drh.ie&&drh.quirks,dj_opera:drh.opera,dj_opera8:drh.opera&&(Math.floor(dojo.render.version)==8),dj_opera9:drh.opera&&(Math.floor(dojo.render.version)==9),dj_khtml:drh.khtml,dj_safari:drh.safari,dj_gecko:drh.mozilla};
for(var p in _4e0){
if(_4e0[p]){
dojo.html.addClass(node,p);
}
}
};
dojo.provide("dojo.widget.DomWidget");
dojo.require("dojo.event.*");
dojo.require("dojo.widget.Widget");
dojo.require("dojo.dom");
dojo.require("dojo.html.style");
dojo.require("dojo.xml.Parse");
dojo.require("dojo.uri.*");
dojo.require("dojo.lang.func");
dojo.require("dojo.lang.extras");
dojo.widget._cssFiles={};
dojo.widget._cssStrings={};
dojo.widget._templateCache={};
dojo.widget.defaultStrings={dojoRoot:dojo.hostenv.getBaseScriptUri(),dojoWidgetModuleUri:dojo.uri.moduleUri("dojo.widget"),baseScriptUri:dojo.hostenv.getBaseScriptUri()};
dojo.widget.fillFromTemplateCache=function(obj,_4e3,_4e4,_4e5){
var _4e6=_4e3||obj.templatePath;
var _4e7=dojo.widget._templateCache;
if(!_4e6&&!obj["widgetType"]){
do{
var _4e8="__dummyTemplate__"+dojo.widget._templateCache.dummyCount++;
}while(_4e7[_4e8]);
obj.widgetType=_4e8;
}
var wt=_4e6?_4e6.toString():obj.widgetType;
var ts=_4e7[wt];
if(!ts){
_4e7[wt]={"string":null,"node":null};
if(_4e5){
ts={};
}else{
ts=_4e7[wt];
}
}
if((!obj.templateString)&&(!_4e5)){
obj.templateString=_4e4||ts["string"];
}
if(obj.templateString){
obj.templateString=this._sanitizeTemplateString(obj.templateString);
}
if((!obj.templateNode)&&(!_4e5)){
obj.templateNode=ts["node"];
}
if((!obj.templateNode)&&(!obj.templateString)&&(_4e6)){
var _4eb=this._sanitizeTemplateString(dojo.hostenv.getText(_4e6));
obj.templateString=_4eb;
if(!_4e5){
_4e7[wt]["string"]=_4eb;
}
}
if((!ts["string"])&&(!_4e5)){
ts.string=obj.templateString;
}
};
dojo.widget._sanitizeTemplateString=function(_4ec){
if(_4ec){
_4ec=_4ec.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");
var _4ed=_4ec.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);
if(_4ed){
_4ec=_4ed[1];
}
}else{
_4ec="";
}
return _4ec;
};
dojo.widget._templateCache.dummyCount=0;
dojo.widget.attachProperties=["dojoAttachPoint","id"];
dojo.widget.eventAttachProperty="dojoAttachEvent";
dojo.widget.onBuildProperty="dojoOnBuild";
dojo.widget.waiNames=["waiRole","waiState"];
dojo.widget.wai={waiRole:{name:"waiRole","namespace":"http://www.w3.org/TR/xhtml2",alias:"x2",prefix:"wairole:"},waiState:{name:"waiState","namespace":"http://www.w3.org/2005/07/aaa",alias:"aaa",prefix:""},setAttr:function(node,ns,attr,_4f1){
if(dojo.render.html.ie){
node.setAttribute(this[ns].alias+":"+attr,this[ns].prefix+_4f1);
}else{
node.setAttributeNS(this[ns]["namespace"],attr,this[ns].prefix+_4f1);
}
},getAttr:function(node,ns,attr){
if(dojo.render.html.ie){
return node.getAttribute(this[ns].alias+":"+attr);
}else{
return node.getAttributeNS(this[ns]["namespace"],attr);
}
},removeAttr:function(node,ns,attr){
var _4f8=true;
if(dojo.render.html.ie){
_4f8=node.removeAttribute(this[ns].alias+":"+attr);
}else{
node.removeAttributeNS(this[ns]["namespace"],attr);
}
return _4f8;
}};
dojo.widget.attachTemplateNodes=function(_4f9,_4fa,_4fb){
var _4fc=dojo.dom.ELEMENT_NODE;
function trim(str){
return str.replace(/^\s+|\s+$/g,"");
}
if(!_4f9){
_4f9=_4fa.domNode;
}
if(_4f9.nodeType!=_4fc){
return;
}
var _4fe=_4f9.all||_4f9.getElementsByTagName("*");
var _4ff=_4fa;
for(var x=-1;x<_4fe.length;x++){
var _501=(x==-1)?_4f9:_4fe[x];
var _502=[];
if(!_4fa.widgetsInTemplate||!_501.getAttribute("dojoType")){
for(var y=0;y<this.attachProperties.length;y++){
var _504=_501.getAttribute(this.attachProperties[y]);
if(_504){
_502=_504.split(";");
for(var z=0;z<_502.length;z++){
if(dojo.lang.isArray(_4fa[_502[z]])){
_4fa[_502[z]].push(_501);
}else{
_4fa[_502[z]]=_501;
}
}
break;
}
}
var _506=_501.getAttribute(this.eventAttachProperty);
if(_506){
var evts=_506.split(";");
for(var y=0;y<evts.length;y++){
if((!evts[y])||(!evts[y].length)){
continue;
}
var _508=null;
var tevt=trim(evts[y]);
if(evts[y].indexOf(":")>=0){
var _50a=tevt.split(":");
tevt=trim(_50a[0]);
_508=trim(_50a[1]);
}
if(!_508){
_508=tevt;
}
var tf=function(){
var ntf=new String(_508);
return function(evt){
if(_4ff[ntf]){
_4ff[ntf](dojo.event.browser.fixEvent(evt,this));
}
};
}();
dojo.event.browser.addListener(_501,tevt,tf,false,true);
}
}
for(var y=0;y<_4fb.length;y++){
var _50e=_501.getAttribute(_4fb[y]);
if((_50e)&&(_50e.length)){
var _508=null;
var _50f=_4fb[y].substr(4);
_508=trim(_50e);
var _510=[_508];
if(_508.indexOf(";")>=0){
_510=dojo.lang.map(_508.split(";"),trim);
}
for(var z=0;z<_510.length;z++){
if(!_510[z].length){
continue;
}
var tf=function(){
var ntf=new String(_510[z]);
return function(evt){
if(_4ff[ntf]){
_4ff[ntf](dojo.event.browser.fixEvent(evt,this));
}
};
}();
dojo.event.browser.addListener(_501,_50f,tf,false,true);
}
}
}
}
var _513=_501.getAttribute(this.templateProperty);
if(_513){
_4fa[_513]=_501;
}
dojo.lang.forEach(dojo.widget.waiNames,function(name){
var wai=dojo.widget.wai[name];
var val=_501.getAttribute(wai.name);
if(val){
if(val.indexOf("-")==-1){
dojo.widget.wai.setAttr(_501,wai.name,"role",val);
}else{
var _517=val.split("-");
dojo.widget.wai.setAttr(_501,wai.name,_517[0],_517[1]);
}
}
},this);
var _518=_501.getAttribute(this.onBuildProperty);
if(_518){
eval("var node = baseNode; var widget = targetObj; "+_518);
}
}
};
dojo.widget.getDojoEventsFromStr=function(str){
var re=/(dojoOn([a-z]+)(\s?))=/gi;
var evts=str?str.match(re)||[]:[];
var ret=[];
var lem={};
for(var x=0;x<evts.length;x++){
if(evts[x].length<1){
continue;
}
var cm=evts[x].replace(/\s/,"");
cm=(cm.slice(0,cm.length-1));
if(!lem[cm]){
lem[cm]=true;
ret.push(cm);
}
}
return ret;
};
dojo.declare("dojo.widget.DomWidget",dojo.widget.Widget,function(){
if((arguments.length>0)&&(typeof arguments[0]=="object")){
this.create(arguments[0]);
}
},{templateNode:null,templateString:null,templateCssString:null,preventClobber:false,domNode:null,containerNode:null,widgetsInTemplate:false,addChild:function(_520,_521,pos,ref,_524){
if(!this.isContainer){
dojo.debug("dojo.widget.DomWidget.addChild() attempted on non-container widget");
return null;
}else{
if(_524==undefined){
_524=this.children.length;
}
this.addWidgetAsDirectChild(_520,_521,pos,ref,_524);
this.registerChild(_520,_524);
}
return _520;
},addWidgetAsDirectChild:function(_525,_526,pos,ref,_529){
if((!this.containerNode)&&(!_526)){
this.containerNode=this.domNode;
}
var cn=(_526)?_526:this.containerNode;
if(!pos){
pos="after";
}
if(!ref){
if(!cn){
cn=dojo.body();
}
ref=cn.lastChild;
}
if(!_529){
_529=0;
}
_525.domNode.setAttribute("dojoinsertionindex",_529);
if(!ref){
cn.appendChild(_525.domNode);
}else{
if(pos=="insertAtIndex"){
dojo.dom.insertAtIndex(_525.domNode,ref.parentNode,_529);
}else{
if((pos=="after")&&(ref===cn.lastChild)){
cn.appendChild(_525.domNode);
}else{
dojo.dom.insertAtPosition(_525.domNode,cn,pos);
}
}
}
},registerChild:function(_52b,_52c){
_52b.dojoInsertionIndex=_52c;
var idx=-1;
for(var i=0;i<this.children.length;i++){
if(this.children[i].dojoInsertionIndex<=_52c){
idx=i;
}
}
this.children.splice(idx+1,0,_52b);
_52b.parent=this;
_52b.addedTo(this,idx+1);
delete dojo.widget.manager.topWidgets[_52b.widgetId];
},removeChild:function(_52f){
dojo.dom.removeNode(_52f.domNode);
return dojo.widget.DomWidget.superclass.removeChild.call(this,_52f);
},getFragNodeRef:function(frag){
if(!frag){
return null;
}
if(!frag[this.getNamespacedType()]){
dojo.raise("Error: no frag for widget type "+this.getNamespacedType()+", id "+this.widgetId+" (maybe a widget has set it's type incorrectly)");
}
return frag[this.getNamespacedType()]["nodeRef"];
},postInitialize:function(args,frag,_533){
var _534=this.getFragNodeRef(frag);
if(_533&&(_533.snarfChildDomOutput||!_534)){
_533.addWidgetAsDirectChild(this,"","insertAtIndex","",args["dojoinsertionindex"],_534);
}else{
if(_534){
if(this.domNode&&(this.domNode!==_534)){
this._sourceNodeRef=dojo.dom.replaceNode(_534,this.domNode);
}
}
}
if(_533){
_533.registerChild(this,args.dojoinsertionindex);
}else{
dojo.widget.manager.topWidgets[this.widgetId]=this;
}
if(this.widgetsInTemplate){
var _535=new dojo.xml.Parse();
var _536;
var _537=this.domNode.getElementsByTagName("*");
for(var i=0;i<_537.length;i++){
if(_537[i].getAttribute("dojoAttachPoint")=="subContainerWidget"){
_536=_537[i];
}
if(_537[i].getAttribute("dojoType")){
_537[i].setAttribute("isSubWidget",true);
}
}
if(this.isContainer&&!this.containerNode){
if(_536){
var src=this.getFragNodeRef(frag);
if(src){
dojo.dom.moveChildren(src,_536);
frag["dojoDontFollow"]=true;
}
}else{
dojo.debug("No subContainerWidget node can be found in template file for widget "+this);
}
}
var _53a=_535.parseElement(this.domNode,null,true);
dojo.widget.getParser().createSubComponents(_53a,this);
var _53b=[];
var _53c=[this];
var w;
while((w=_53c.pop())){
for(var i=0;i<w.children.length;i++){
var _53e=w.children[i];
if(_53e._processedSubWidgets||!_53e.extraArgs["issubwidget"]){
continue;
}
_53b.push(_53e);
if(_53e.isContainer){
_53c.push(_53e);
}
}
}
for(var i=0;i<_53b.length;i++){
var _53f=_53b[i];
if(_53f._processedSubWidgets){
dojo.debug("This should not happen: widget._processedSubWidgets is already true!");
return;
}
_53f._processedSubWidgets=true;
if(_53f.extraArgs["dojoattachevent"]){
var evts=_53f.extraArgs["dojoattachevent"].split(";");
for(var j=0;j<evts.length;j++){
var _542=null;
var tevt=dojo.string.trim(evts[j]);
if(tevt.indexOf(":")>=0){
var _544=tevt.split(":");
tevt=dojo.string.trim(_544[0]);
_542=dojo.string.trim(_544[1]);
}
if(!_542){
_542=tevt;
}
if(dojo.lang.isFunction(_53f[tevt])){
dojo.event.kwConnect({srcObj:_53f,srcFunc:tevt,targetObj:this,targetFunc:_542});
}else{
alert(tevt+" is not a function in widget "+_53f);
}
}
}
if(_53f.extraArgs["dojoattachpoint"]){
this[_53f.extraArgs["dojoattachpoint"]]=_53f;
}
}
}
if(this.isContainer&&!frag["dojoDontFollow"]){
dojo.widget.getParser().createSubComponents(frag,this);
}
},buildRendering:function(args,frag){
var ts=dojo.widget._templateCache[this.widgetType];
if(args["templatecsspath"]){
args["templateCssPath"]=args["templatecsspath"];
}
var _548=args["templateCssPath"]||this.templateCssPath;
if(_548&&!dojo.widget._cssFiles[_548.toString()]){
if((!this.templateCssString)&&(_548)){
this.templateCssString=dojo.hostenv.getText(_548);
this.templateCssPath=null;
}
dojo.widget._cssFiles[_548.toString()]=true;
}
if((this["templateCssString"])&&(!dojo.widget._cssStrings[this.templateCssString])){
dojo.html.insertCssText(this.templateCssString,null,_548);
dojo.widget._cssStrings[this.templateCssString]=true;
}
if((!this.preventClobber)&&((this.templatePath)||(this.templateNode)||((this["templateString"])&&(this.templateString.length))||((typeof ts!="undefined")&&((ts["string"])||(ts["node"]))))){
this.buildFromTemplate(args,frag);
}else{
this.domNode=this.getFragNodeRef(frag);
}
this.fillInTemplate(args,frag);
},buildFromTemplate:function(args,frag){
var _54b=false;
if(args["templatepath"]){
args["templatePath"]=args["templatepath"];
}
dojo.widget.fillFromTemplateCache(this,args["templatePath"],null,_54b);
var ts=dojo.widget._templateCache[this.templatePath?this.templatePath.toString():this.widgetType];
if((ts)&&(!_54b)){
if(!this.templateString.length){
this.templateString=ts["string"];
}
if(!this.templateNode){
this.templateNode=ts["node"];
}
}
var _54d=false;
var node=null;
var tstr=this.templateString;
if((!this.templateNode)&&(this.templateString)){
_54d=this.templateString.match(/\$\{([^\}]+)\}/g);
if(_54d){
var hash=this.strings||{};
for(var key in dojo.widget.defaultStrings){
if(dojo.lang.isUndefined(hash[key])){
hash[key]=dojo.widget.defaultStrings[key];
}
}
for(var i=0;i<_54d.length;i++){
var key=_54d[i];
key=key.substring(2,key.length-1);
var kval=(key.substring(0,5)=="this.")?dojo.lang.getObjPathValue(key.substring(5),this):hash[key];
var _554;
if((kval)||(dojo.lang.isString(kval))){
_554=new String((dojo.lang.isFunction(kval))?kval.call(this,key,this.templateString):kval);
while(_554.indexOf("\"")>-1){
_554=_554.replace("\"","&quot;");
}
tstr=tstr.replace(_54d[i],_554);
}
}
}else{
this.templateNode=this.createNodesFromText(this.templateString,true)[0];
if(!_54b){
ts.node=this.templateNode;
}
}
}
if((!this.templateNode)&&(!_54d)){
dojo.debug("DomWidget.buildFromTemplate: could not create template");
return false;
}else{
if(!_54d){
node=this.templateNode.cloneNode(true);
if(!node){
return false;
}
}else{
node=this.createNodesFromText(tstr,true)[0];
}
}
this.domNode=node;
this.attachTemplateNodes();
if(this.isContainer&&this.containerNode){
var src=this.getFragNodeRef(frag);
if(src){
dojo.dom.moveChildren(src,this.containerNode);
}
}
},attachTemplateNodes:function(_556,_557){
if(!_556){
_556=this.domNode;
}
if(!_557){
_557=this;
}
return dojo.widget.attachTemplateNodes(_556,_557,dojo.widget.getDojoEventsFromStr(this.templateString));
},fillInTemplate:function(){
},destroyRendering:function(){
try{
dojo.dom.destroyNode(this.domNode);
delete this.domNode;
}
catch(e){
}
if(this._sourceNodeRef){
try{
dojo.dom.destroyNode(this._sourceNodeRef);
}
catch(e){
}
}
},createNodesFromText:function(){
dojo.unimplemented("dojo.widget.DomWidget.createNodesFromText");
}});
dojo.provide("dojo.html.display");
dojo.require("dojo.html.style");
dojo.html._toggle=function(node,_559,_55a){
node=dojo.byId(node);
_55a(node,!_559(node));
return _559(node);
};
dojo.html.show=function(node){
node=dojo.byId(node);
if(dojo.html.getStyleProperty(node,"display")=="none"){
dojo.html.setStyle(node,"display",(node.dojoDisplayCache||""));
node.dojoDisplayCache=undefined;
}
};
dojo.html.hide=function(node){
node=dojo.byId(node);
if(typeof node["dojoDisplayCache"]=="undefined"){
var d=dojo.html.getStyleProperty(node,"display");
if(d!="none"){
node.dojoDisplayCache=d;
}
}
dojo.html.setStyle(node,"display","none");
};
dojo.html.setShowing=function(node,_55f){
dojo.html[(_55f?"show":"hide")](node);
};
dojo.html.isShowing=function(node){
return (dojo.html.getStyleProperty(node,"display")!="none");
};
dojo.html.toggleShowing=function(node){
return dojo.html._toggle(node,dojo.html.isShowing,dojo.html.setShowing);
};
dojo.html.displayMap={tr:"",td:"",th:"",img:"inline",span:"inline",input:"inline",button:"inline"};
dojo.html.suggestDisplayByTagName=function(node){
node=dojo.byId(node);
if(node&&node.tagName){
var tag=node.tagName.toLowerCase();
return (tag in dojo.html.displayMap?dojo.html.displayMap[tag]:"block");
}
};
dojo.html.setDisplay=function(node,_565){
dojo.html.setStyle(node,"display",((_565 instanceof String||typeof _565=="string")?_565:(_565?dojo.html.suggestDisplayByTagName(node):"none")));
};
dojo.html.isDisplayed=function(node){
return (dojo.html.getComputedStyle(node,"display")!="none");
};
dojo.html.toggleDisplay=function(node){
return dojo.html._toggle(node,dojo.html.isDisplayed,dojo.html.setDisplay);
};
dojo.html.setVisibility=function(node,_569){
dojo.html.setStyle(node,"visibility",((_569 instanceof String||typeof _569=="string")?_569:(_569?"visible":"hidden")));
};
dojo.html.isVisible=function(node){
return (dojo.html.getComputedStyle(node,"visibility")!="hidden");
};
dojo.html.toggleVisibility=function(node){
return dojo.html._toggle(node,dojo.html.isVisible,dojo.html.setVisibility);
};
dojo.html.setOpacity=function(node,_56d,_56e){
node=dojo.byId(node);
var h=dojo.render.html;
if(!_56e){
if(_56d>=1){
if(h.ie){
dojo.html.clearOpacity(node);
return;
}else{
_56d=0.999999;
}
}else{
if(_56d<0){
_56d=0;
}
}
}
if(h.ie){
if(node.nodeName.toLowerCase()=="tr"){
var tds=node.getElementsByTagName("td");
for(var x=0;x<tds.length;x++){
tds[x].style.filter="Alpha(Opacity="+_56d*100+")";
}
}
node.style.filter="Alpha(Opacity="+_56d*100+")";
}else{
if(h.moz){
node.style.opacity=_56d;
node.style.MozOpacity=_56d;
}else{
if(h.safari){
node.style.opacity=_56d;
node.style.KhtmlOpacity=_56d;
}else{
node.style.opacity=_56d;
}
}
}
};
dojo.html.clearOpacity=function(node){
node=dojo.byId(node);
var ns=node.style;
var h=dojo.render.html;
if(h.ie){
try{
if(node.filters&&node.filters.alpha){
ns.filter="";
}
}
catch(e){
}
}else{
if(h.moz){
ns.opacity=1;
ns.MozOpacity=1;
}else{
if(h.safari){
ns.opacity=1;
ns.KhtmlOpacity=1;
}else{
ns.opacity=1;
}
}
}
};
dojo.html.getOpacity=function(node){
node=dojo.byId(node);
var h=dojo.render.html;
if(h.ie){
var opac=(node.filters&&node.filters.alpha&&typeof node.filters.alpha.opacity=="number"?node.filters.alpha.opacity:100)/100;
}else{
var opac=node.style.opacity||node.style.MozOpacity||node.style.KhtmlOpacity||1;
}
return opac>=0.999999?1:Number(opac);
};
dojo.provide("dojo.html.layout");
dojo.require("dojo.html.common");
dojo.require("dojo.html.style");
dojo.require("dojo.html.display");
dojo.html.sumAncestorProperties=function(node,prop){
node=dojo.byId(node);
if(!node){
return 0;
}
var _57a=0;
while(node){
if(dojo.html.getComputedStyle(node,"position")=="fixed"){
return 0;
}
var val=node[prop];
if(val){
_57a+=val-0;
if(node==dojo.body()){
break;
}
}
node=node.parentNode;
}
return _57a;
};
dojo.html.setStyleAttributes=function(node,_57d){
node=dojo.byId(node);
var _57e=_57d.replace(/(;)?\s*$/,"").split(";");
for(var i=0;i<_57e.length;i++){
var _580=_57e[i].split(":");
var name=_580[0].replace(/\s*$/,"").replace(/^\s*/,"").toLowerCase();
var _582=_580[1].replace(/\s*$/,"").replace(/^\s*/,"");
switch(name){
case "opacity":
dojo.html.setOpacity(node,_582);
break;
case "content-height":
dojo.html.setContentBox(node,{height:_582});
break;
case "content-width":
dojo.html.setContentBox(node,{width:_582});
break;
case "outer-height":
dojo.html.setMarginBox(node,{height:_582});
break;
case "outer-width":
dojo.html.setMarginBox(node,{width:_582});
break;
default:
node.style[dojo.html.toCamelCase(name)]=_582;
}
}
};
dojo.html.boxSizing={MARGIN_BOX:"margin-box",BORDER_BOX:"border-box",PADDING_BOX:"padding-box",CONTENT_BOX:"content-box"};
dojo.html.getAbsolutePosition=dojo.html.abs=function(node,_584,_585){
node=dojo.byId(node,node.ownerDocument);
var ret={x:0,y:0};
var bs=dojo.html.boxSizing;
if(!_585){
_585=bs.CONTENT_BOX;
}
var _588=2;
var _589;
switch(_585){
case bs.MARGIN_BOX:
_589=3;
break;
case bs.BORDER_BOX:
_589=2;
break;
case bs.PADDING_BOX:
default:
_589=1;
break;
case bs.CONTENT_BOX:
_589=0;
break;
}
var h=dojo.render.html;
var db=document["body"]||document["documentElement"];
if(h.ie){
with(node.getBoundingClientRect()){
ret.x=left-2;
ret.y=top-2;
}
}else{
if(document.getBoxObjectFor){
_588=1;
try{
var bo=document.getBoxObjectFor(node);
ret.x=bo.x-dojo.html.sumAncestorProperties(node,"scrollLeft");
ret.y=bo.y-dojo.html.sumAncestorProperties(node,"scrollTop");
}
catch(e){
}
}else{
if(node["offsetParent"]){
var _58d;
if((h.safari)&&(node.style.getPropertyValue("position")=="absolute")&&(node.parentNode==db)){
_58d=db;
}else{
_58d=db.parentNode;
}
if(node.parentNode!=db){
var nd=node;
if(dojo.render.html.opera){
nd=db;
}
ret.x-=dojo.html.sumAncestorProperties(nd,"scrollLeft");
ret.y-=dojo.html.sumAncestorProperties(nd,"scrollTop");
}
var _58f=node;
do{
var n=_58f["offsetLeft"];
if(!h.opera||n>0){
ret.x+=isNaN(n)?0:n;
}
var m=_58f["offsetTop"];
ret.y+=isNaN(m)?0:m;
_58f=_58f.offsetParent;
}while((_58f!=_58d)&&(_58f!=null));
}else{
if(node["x"]&&node["y"]){
ret.x+=isNaN(node.x)?0:node.x;
ret.y+=isNaN(node.y)?0:node.y;
}
}
}
}
if(_584){
var _592=dojo.html.getScroll();
ret.y+=_592.top;
ret.x+=_592.left;
}
var _593=[dojo.html.getPaddingExtent,dojo.html.getBorderExtent,dojo.html.getMarginExtent];
if(_588>_589){
for(var i=_589;i<_588;++i){
ret.y+=_593[i](node,"top");
ret.x+=_593[i](node,"left");
}
}else{
if(_588<_589){
for(var i=_589;i>_588;--i){
ret.y-=_593[i-1](node,"top");
ret.x-=_593[i-1](node,"left");
}
}
}
ret.top=ret.y;
ret.left=ret.x;
return ret;
};
dojo.html.isPositionAbsolute=function(node){
return (dojo.html.getComputedStyle(node,"position")=="absolute");
};
dojo.html._sumPixelValues=function(node,_597,_598){
var _599=0;
for(var x=0;x<_597.length;x++){
_599+=dojo.html.getPixelValue(node,_597[x],_598);
}
return _599;
};
dojo.html.getMargin=function(node){
return {width:dojo.html._sumPixelValues(node,["margin-left","margin-right"],(dojo.html.getComputedStyle(node,"position")=="absolute")),height:dojo.html._sumPixelValues(node,["margin-top","margin-bottom"],(dojo.html.getComputedStyle(node,"position")=="absolute"))};
};
dojo.html.getBorder=function(node){
return {width:dojo.html.getBorderExtent(node,"left")+dojo.html.getBorderExtent(node,"right"),height:dojo.html.getBorderExtent(node,"top")+dojo.html.getBorderExtent(node,"bottom")};
};
dojo.html.getBorderExtent=function(node,side){
return (dojo.html.getStyle(node,"border-"+side+"-style")=="none"?0:dojo.html.getPixelValue(node,"border-"+side+"-width"));
};
dojo.html.getMarginExtent=function(node,side){
return dojo.html._sumPixelValues(node,["margin-"+side],dojo.html.isPositionAbsolute(node));
};
dojo.html.getPaddingExtent=function(node,side){
return dojo.html._sumPixelValues(node,["padding-"+side],true);
};
dojo.html.getPadding=function(node){
return {width:dojo.html._sumPixelValues(node,["padding-left","padding-right"],true),height:dojo.html._sumPixelValues(node,["padding-top","padding-bottom"],true)};
};
dojo.html.getPadBorder=function(node){
var pad=dojo.html.getPadding(node);
var _5a6=dojo.html.getBorder(node);
return {width:pad.width+_5a6.width,height:pad.height+_5a6.height};
};
dojo.html.getBoxSizing=function(node){
var h=dojo.render.html;
var bs=dojo.html.boxSizing;
if(((h.ie)||(h.opera))&&node.nodeName.toLowerCase()!="img"){
var cm=document["compatMode"];
if((cm=="BackCompat")||(cm=="QuirksMode")){
return bs.BORDER_BOX;
}else{
return bs.CONTENT_BOX;
}
}else{
if(arguments.length==0){
node=document.documentElement;
}
var _5ab;
if(!h.ie){
_5ab=dojo.html.getStyle(node,"-moz-box-sizing");
if(!_5ab){
_5ab=dojo.html.getStyle(node,"box-sizing");
}
}
return (_5ab?_5ab:bs.CONTENT_BOX);
}
};
dojo.html.isBorderBox=function(node){
return (dojo.html.getBoxSizing(node)==dojo.html.boxSizing.BORDER_BOX);
};
dojo.html.getBorderBox=function(node){
node=dojo.byId(node);
return {width:node.offsetWidth,height:node.offsetHeight};
};
dojo.html.getPaddingBox=function(node){
var box=dojo.html.getBorderBox(node);
var _5b0=dojo.html.getBorder(node);
return {width:box.width-_5b0.width,height:box.height-_5b0.height};
};
dojo.html.getContentBox=function(node){
node=dojo.byId(node);
var _5b2=dojo.html.getPadBorder(node);
return {width:node.offsetWidth-_5b2.width,height:node.offsetHeight-_5b2.height};
};
dojo.html.setContentBox=function(node,args){
node=dojo.byId(node);
var _5b5=0;
var _5b6=0;
var isbb=dojo.html.isBorderBox(node);
var _5b8=(isbb?dojo.html.getPadBorder(node):{width:0,height:0});
var ret={};
if(typeof args.width!="undefined"){
_5b5=args.width+_5b8.width;
ret.width=dojo.html.setPositivePixelValue(node,"width",_5b5);
}
if(typeof args.height!="undefined"){
_5b6=args.height+_5b8.height;
ret.height=dojo.html.setPositivePixelValue(node,"height",_5b6);
}
return ret;
};
dojo.html.getMarginBox=function(node){
var _5bb=dojo.html.getBorderBox(node);
var _5bc=dojo.html.getMargin(node);
return {width:_5bb.width+_5bc.width,height:_5bb.height+_5bc.height};
};
dojo.html.setMarginBox=function(node,args){
node=dojo.byId(node);
var _5bf=0;
var _5c0=0;
var isbb=dojo.html.isBorderBox(node);
var _5c2=(!isbb?dojo.html.getPadBorder(node):{width:0,height:0});
var _5c3=dojo.html.getMargin(node);
var ret={};
if(typeof args.width!="undefined"){
_5bf=args.width-_5c2.width;
_5bf-=_5c3.width;
ret.width=dojo.html.setPositivePixelValue(node,"width",_5bf);
}
if(typeof args.height!="undefined"){
_5c0=args.height-_5c2.height;
_5c0-=_5c3.height;
ret.height=dojo.html.setPositivePixelValue(node,"height",_5c0);
}
return ret;
};
dojo.html.getElementBox=function(node,type){
var bs=dojo.html.boxSizing;
switch(type){
case bs.MARGIN_BOX:
return dojo.html.getMarginBox(node);
case bs.BORDER_BOX:
return dojo.html.getBorderBox(node);
case bs.PADDING_BOX:
return dojo.html.getPaddingBox(node);
case bs.CONTENT_BOX:
default:
return dojo.html.getContentBox(node);
}
};
dojo.html.toCoordinateObject=dojo.html.toCoordinateArray=function(_5c8,_5c9,_5ca){
if(_5c8 instanceof Array||typeof _5c8=="array"){
dojo.deprecated("dojo.html.toCoordinateArray","use dojo.html.toCoordinateObject({left: , top: , width: , height: }) instead","0.5");
while(_5c8.length<4){
_5c8.push(0);
}
while(_5c8.length>4){
_5c8.pop();
}
var ret={left:_5c8[0],top:_5c8[1],width:_5c8[2],height:_5c8[3]};
}else{
if(!_5c8.nodeType&&!(_5c8 instanceof String||typeof _5c8=="string")&&("width" in _5c8||"height" in _5c8||"left" in _5c8||"x" in _5c8||"top" in _5c8||"y" in _5c8)){
var ret={left:_5c8.left||_5c8.x||0,top:_5c8.top||_5c8.y||0,width:_5c8.width||0,height:_5c8.height||0};
}else{
var node=dojo.byId(_5c8);
var pos=dojo.html.abs(node,_5c9,_5ca);
var _5ce=dojo.html.getMarginBox(node);
var ret={left:pos.left,top:pos.top,width:_5ce.width,height:_5ce.height};
}
}
ret.x=ret.left;
ret.y=ret.top;
return ret;
};
dojo.html.setMarginBoxWidth=dojo.html.setOuterWidth=function(node,_5d0){
return dojo.html._callDeprecated("setMarginBoxWidth","setMarginBox",arguments,"width");
};
dojo.html.setMarginBoxHeight=dojo.html.setOuterHeight=function(){
return dojo.html._callDeprecated("setMarginBoxHeight","setMarginBox",arguments,"height");
};
dojo.html.getMarginBoxWidth=dojo.html.getOuterWidth=function(){
return dojo.html._callDeprecated("getMarginBoxWidth","getMarginBox",arguments,null,"width");
};
dojo.html.getMarginBoxHeight=dojo.html.getOuterHeight=function(){
return dojo.html._callDeprecated("getMarginBoxHeight","getMarginBox",arguments,null,"height");
};
dojo.html.getTotalOffset=function(node,type,_5d3){
return dojo.html._callDeprecated("getTotalOffset","getAbsolutePosition",arguments,null,type);
};
dojo.html.getAbsoluteX=function(node,_5d5){
return dojo.html._callDeprecated("getAbsoluteX","getAbsolutePosition",arguments,null,"x");
};
dojo.html.getAbsoluteY=function(node,_5d7){
return dojo.html._callDeprecated("getAbsoluteY","getAbsolutePosition",arguments,null,"y");
};
dojo.html.totalOffsetLeft=function(node,_5d9){
return dojo.html._callDeprecated("totalOffsetLeft","getAbsolutePosition",arguments,null,"left");
};
dojo.html.totalOffsetTop=function(node,_5db){
return dojo.html._callDeprecated("totalOffsetTop","getAbsolutePosition",arguments,null,"top");
};
dojo.html.getMarginWidth=function(node){
return dojo.html._callDeprecated("getMarginWidth","getMargin",arguments,null,"width");
};
dojo.html.getMarginHeight=function(node){
return dojo.html._callDeprecated("getMarginHeight","getMargin",arguments,null,"height");
};
dojo.html.getBorderWidth=function(node){
return dojo.html._callDeprecated("getBorderWidth","getBorder",arguments,null,"width");
};
dojo.html.getBorderHeight=function(node){
return dojo.html._callDeprecated("getBorderHeight","getBorder",arguments,null,"height");
};
dojo.html.getPaddingWidth=function(node){
return dojo.html._callDeprecated("getPaddingWidth","getPadding",arguments,null,"width");
};
dojo.html.getPaddingHeight=function(node){
return dojo.html._callDeprecated("getPaddingHeight","getPadding",arguments,null,"height");
};
dojo.html.getPadBorderWidth=function(node){
return dojo.html._callDeprecated("getPadBorderWidth","getPadBorder",arguments,null,"width");
};
dojo.html.getPadBorderHeight=function(node){
return dojo.html._callDeprecated("getPadBorderHeight","getPadBorder",arguments,null,"height");
};
dojo.html.getBorderBoxWidth=dojo.html.getInnerWidth=function(){
return dojo.html._callDeprecated("getBorderBoxWidth","getBorderBox",arguments,null,"width");
};
dojo.html.getBorderBoxHeight=dojo.html.getInnerHeight=function(){
return dojo.html._callDeprecated("getBorderBoxHeight","getBorderBox",arguments,null,"height");
};
dojo.html.getContentBoxWidth=dojo.html.getContentWidth=function(){
return dojo.html._callDeprecated("getContentBoxWidth","getContentBox",arguments,null,"width");
};
dojo.html.getContentBoxHeight=dojo.html.getContentHeight=function(){
return dojo.html._callDeprecated("getContentBoxHeight","getContentBox",arguments,null,"height");
};
dojo.html.setContentBoxWidth=dojo.html.setContentWidth=function(node,_5e5){
return dojo.html._callDeprecated("setContentBoxWidth","setContentBox",arguments,"width");
};
dojo.html.setContentBoxHeight=dojo.html.setContentHeight=function(node,_5e7){
return dojo.html._callDeprecated("setContentBoxHeight","setContentBox",arguments,"height");
};
dojo.provide("dojo.html.util");
dojo.require("dojo.html.layout");
dojo.html.getElementWindow=function(_5e8){
return dojo.html.getDocumentWindow(_5e8.ownerDocument);
};
dojo.html.getDocumentWindow=function(doc){
if(dojo.render.html.safari&&!doc._parentWindow){
var fix=function(win){
win.document._parentWindow=win;
for(var i=0;i<win.frames.length;i++){
fix(win.frames[i]);
}
};
fix(window.top);
}
if(dojo.render.html.ie&&window!==document.parentWindow&&!doc._parentWindow){
doc.parentWindow.execScript("document._parentWindow = window;","Javascript");
var win=doc._parentWindow;
doc._parentWindow=null;
return win;
}
return doc._parentWindow||doc.parentWindow||doc.defaultView;
};
dojo.html.gravity=function(node,e){
node=dojo.byId(node);
var _5f0=dojo.html.getCursorPosition(e);
with(dojo.html){
var _5f1=getAbsolutePosition(node,true);
var bb=getBorderBox(node);
var _5f3=_5f1.x+(bb.width/2);
var _5f4=_5f1.y+(bb.height/2);
}
with(dojo.html.gravity){
return ((_5f0.x<_5f3?WEST:EAST)|(_5f0.y<_5f4?NORTH:SOUTH));
}
};
dojo.html.gravity.NORTH=1;
dojo.html.gravity.SOUTH=1<<1;
dojo.html.gravity.EAST=1<<2;
dojo.html.gravity.WEST=1<<3;
dojo.html.overElement=function(_5f5,e){
_5f5=dojo.byId(_5f5);
var _5f7=dojo.html.getCursorPosition(e);
var bb=dojo.html.getBorderBox(_5f5);
var _5f9=dojo.html.getAbsolutePosition(_5f5,true,dojo.html.boxSizing.BORDER_BOX);
var top=_5f9.y;
var _5fb=top+bb.height;
var left=_5f9.x;
var _5fd=left+bb.width;
return (_5f7.x>=left&&_5f7.x<=_5fd&&_5f7.y>=top&&_5f7.y<=_5fb);
};
dojo.html.renderedTextContent=function(node){
node=dojo.byId(node);
var _5ff="";
if(node==null){
return _5ff;
}
for(var i=0;i<node.childNodes.length;i++){
switch(node.childNodes[i].nodeType){
case 1:
case 5:
var _601="unknown";
try{
_601=dojo.html.getStyle(node.childNodes[i],"display");
}
catch(E){
}
switch(_601){
case "block":
case "list-item":
case "run-in":
case "table":
case "table-row-group":
case "table-header-group":
case "table-footer-group":
case "table-row":
case "table-column-group":
case "table-column":
case "table-cell":
case "table-caption":
_5ff+="\n";
_5ff+=dojo.html.renderedTextContent(node.childNodes[i]);
_5ff+="\n";
break;
case "none":
break;
default:
if(node.childNodes[i].tagName&&node.childNodes[i].tagName.toLowerCase()=="br"){
_5ff+="\n";
}else{
_5ff+=dojo.html.renderedTextContent(node.childNodes[i]);
}
break;
}
break;
case 3:
case 2:
case 4:
var text=node.childNodes[i].nodeValue;
var _603="unknown";
try{
_603=dojo.html.getStyle(node,"text-transform");
}
catch(E){
}
switch(_603){
case "capitalize":
var _604=text.split(" ");
for(var i=0;i<_604.length;i++){
_604[i]=_604[i].charAt(0).toUpperCase()+_604[i].substring(1);
}
text=_604.join(" ");
break;
case "uppercase":
text=text.toUpperCase();
break;
case "lowercase":
text=text.toLowerCase();
break;
default:
break;
}
switch(_603){
case "nowrap":
break;
case "pre-wrap":
break;
case "pre-line":
break;
case "pre":
break;
default:
text=text.replace(/\s+/," ");
if(/\s$/.test(_5ff)){
text.replace(/^\s/,"");
}
break;
}
_5ff+=text;
break;
default:
break;
}
}
return _5ff;
};
dojo.html.createNodesFromText=function(txt,trim){
if(trim){
txt=txt.replace(/^\s+|\s+$/g,"");
}
var tn=dojo.doc().createElement("div");
tn.style.visibility="hidden";
dojo.body().appendChild(tn);
var _608="none";
if((/^<t[dh][\s\r\n>]/i).test(txt.replace(/^\s+/))){
txt="<table><tbody><tr>"+txt+"</tr></tbody></table>";
_608="cell";
}else{
if((/^<tr[\s\r\n>]/i).test(txt.replace(/^\s+/))){
txt="<table><tbody>"+txt+"</tbody></table>";
_608="row";
}else{
if((/^<(thead|tbody|tfoot)[\s\r\n>]/i).test(txt.replace(/^\s+/))){
txt="<table>"+txt+"</table>";
_608="section";
}
}
}
tn.innerHTML=txt;
if(tn["normalize"]){
tn.normalize();
}
var _609=null;
switch(_608){
case "cell":
_609=tn.getElementsByTagName("tr")[0];
break;
case "row":
_609=tn.getElementsByTagName("tbody")[0];
break;
case "section":
_609=tn.getElementsByTagName("table")[0];
break;
default:
_609=tn;
break;
}
var _60a=[];
for(var x=0;x<_609.childNodes.length;x++){
_60a.push(_609.childNodes[x].cloneNode(true));
}
tn.style.display="none";
dojo.html.destroyNode(tn);
return _60a;
};
dojo.html.placeOnScreen=function(node,_60d,_60e,_60f,_610,_611,_612){
if(_60d instanceof Array||typeof _60d=="array"){
_612=_611;
_611=_610;
_610=_60f;
_60f=_60e;
_60e=_60d[1];
_60d=_60d[0];
}
if(_611 instanceof String||typeof _611=="string"){
_611=_611.split(",");
}
if(!isNaN(_60f)){
_60f=[Number(_60f),Number(_60f)];
}else{
if(!(_60f instanceof Array||typeof _60f=="array")){
_60f=[0,0];
}
}
var _613=dojo.html.getScroll().offset;
var view=dojo.html.getViewport();
node=dojo.byId(node);
var _615=node.style.display;
node.style.display="";
var bb=dojo.html.getBorderBox(node);
var w=bb.width;
var h=bb.height;
node.style.display=_615;
if(!(_611 instanceof Array||typeof _611=="array")){
_611=["TL"];
}
var _619,_61a,_61b=Infinity,_61c;
for(var _61d=0;_61d<_611.length;++_61d){
var _61e=_611[_61d];
var _61f=true;
var tryX=_60d-(_61e.charAt(1)=="L"?0:w)+_60f[0]*(_61e.charAt(1)=="L"?1:-1);
var tryY=_60e-(_61e.charAt(0)=="T"?0:h)+_60f[1]*(_61e.charAt(0)=="T"?1:-1);
if(_610){
tryX-=_613.x;
tryY-=_613.y;
}
if(tryX<0){
tryX=0;
_61f=false;
}
if(tryY<0){
tryY=0;
_61f=false;
}
var x=tryX+w;
if(x>view.width){
x=view.width-w;
_61f=false;
}else{
x=tryX;
}
x=Math.max(_60f[0],x)+_613.x;
var y=tryY+h;
if(y>view.height){
y=view.height-h;
_61f=false;
}else{
y=tryY;
}
y=Math.max(_60f[1],y)+_613.y;
if(_61f){
_619=x;
_61a=y;
_61b=0;
_61c=_61e;
break;
}else{
var dist=Math.pow(x-tryX-_613.x,2)+Math.pow(y-tryY-_613.y,2);
if(_61b>dist){
_61b=dist;
_619=x;
_61a=y;
_61c=_61e;
}
}
}
if(!_612){
node.style.left=_619+"px";
node.style.top=_61a+"px";
}
return {left:_619,top:_61a,x:_619,y:_61a,dist:_61b,corner:_61c};
};
dojo.html.placeOnScreenPoint=function(node,_626,_627,_628,_629){
dojo.deprecated("dojo.html.placeOnScreenPoint","use dojo.html.placeOnScreen() instead","0.5");
return dojo.html.placeOnScreen(node,_626,_627,_628,_629,["TL","TR","BL","BR"]);
};
dojo.html.placeOnScreenAroundElement=function(node,_62b,_62c,_62d,_62e,_62f){
var best,_631=Infinity;
_62b=dojo.byId(_62b);
var _632=_62b.style.display;
_62b.style.display="";
var mb=dojo.html.getElementBox(_62b,_62d);
var _634=mb.width;
var _635=mb.height;
var _636=dojo.html.getAbsolutePosition(_62b,true,_62d);
_62b.style.display=_632;
for(var _637 in _62e){
var pos,_639,_63a;
var _63b=_62e[_637];
_639=_636.x+(_637.charAt(1)=="L"?0:_634);
_63a=_636.y+(_637.charAt(0)=="T"?0:_635);
pos=dojo.html.placeOnScreen(node,_639,_63a,_62c,true,_63b,true);
if(pos.dist==0){
best=pos;
break;
}else{
if(_631>pos.dist){
_631=pos.dist;
best=pos;
}
}
}
if(!_62f){
node.style.left=best.left+"px";
node.style.top=best.top+"px";
}
return best;
};
dojo.html.scrollIntoView=function(node){
if(!node){
return;
}
if(dojo.render.html.ie){
if(dojo.html.getBorderBox(node.parentNode).height<=node.parentNode.scrollHeight){
node.scrollIntoView(false);
}
}else{
if(dojo.render.html.mozilla){
node.scrollIntoView(false);
}else{
var _63d=node.parentNode;
var _63e=_63d.scrollTop+dojo.html.getBorderBox(_63d).height;
var _63f=node.offsetTop+dojo.html.getMarginBox(node).height;
if(_63e<_63f){
_63d.scrollTop+=(_63f-_63e);
}else{
if(_63d.scrollTop>node.offsetTop){
_63d.scrollTop-=(_63d.scrollTop-node.offsetTop);
}
}
}
}
};
dojo.provide("dojo.gfx.color");
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.array");
dojo.gfx.color.Color=function(r,g,b,a){
if(dojo.lang.isArray(r)){
this.r=r[0];
this.g=r[1];
this.b=r[2];
this.a=r[3]||1;
}else{
if(dojo.lang.isString(r)){
var rgb=dojo.gfx.color.extractRGB(r);
this.r=rgb[0];
this.g=rgb[1];
this.b=rgb[2];
this.a=g||1;
}else{
if(r instanceof dojo.gfx.color.Color){
this.r=r.r;
this.b=r.b;
this.g=r.g;
this.a=r.a;
}else{
this.r=r;
this.g=g;
this.b=b;
this.a=a;
}
}
}
};
dojo.gfx.color.Color.fromArray=function(arr){
return new dojo.gfx.color.Color(arr[0],arr[1],arr[2],arr[3]);
};
dojo.extend(dojo.gfx.color.Color,{toRgb:function(_646){
if(_646){
return this.toRgba();
}else{
return [this.r,this.g,this.b];
}
},toRgba:function(){
return [this.r,this.g,this.b,this.a];
},toHex:function(){
return dojo.gfx.color.rgb2hex(this.toRgb());
},toCss:function(){
return "rgb("+this.toRgb().join()+")";
},toString:function(){
return this.toHex();
},blend:function(_647,_648){
var rgb=null;
if(dojo.lang.isArray(_647)){
rgb=_647;
}else{
if(_647 instanceof dojo.gfx.color.Color){
rgb=_647.toRgb();
}else{
rgb=new dojo.gfx.color.Color(_647).toRgb();
}
}
return dojo.gfx.color.blend(this.toRgb(),rgb,_648);
}});
dojo.gfx.color.named={white:[255,255,255],black:[0,0,0],red:[255,0,0],green:[0,255,0],lime:[0,255,0],blue:[0,0,255],navy:[0,0,128],gray:[128,128,128],silver:[192,192,192]};
dojo.gfx.color.blend=function(a,b,_64c){
if(typeof a=="string"){
return dojo.gfx.color.blendHex(a,b,_64c);
}
if(!_64c){
_64c=0;
}
_64c=Math.min(Math.max(-1,_64c),1);
_64c=((_64c+1)/2);
var c=[];
for(var x=0;x<3;x++){
c[x]=parseInt(b[x]+((a[x]-b[x])*_64c));
}
return c;
};
dojo.gfx.color.blendHex=function(a,b,_651){
return dojo.gfx.color.rgb2hex(dojo.gfx.color.blend(dojo.gfx.color.hex2rgb(a),dojo.gfx.color.hex2rgb(b),_651));
};
dojo.gfx.color.extractRGB=function(_652){
var hex="0123456789abcdef";
_652=_652.toLowerCase();
if(_652.indexOf("rgb")==0){
var _654=_652.match(/rgba*\((\d+), *(\d+), *(\d+)/i);
var ret=_654.splice(1,3);
return ret;
}else{
var _656=dojo.gfx.color.hex2rgb(_652);
if(_656){
return _656;
}else{
return dojo.gfx.color.named[_652]||[255,255,255];
}
}
};
dojo.gfx.color.hex2rgb=function(hex){
var _658="0123456789ABCDEF";
var rgb=new Array(3);
if(hex.indexOf("#")==0){
hex=hex.substring(1);
}
hex=hex.toUpperCase();
if(hex.replace(new RegExp("["+_658+"]","g"),"")!=""){
return null;
}
if(hex.length==3){
rgb[0]=hex.charAt(0)+hex.charAt(0);
rgb[1]=hex.charAt(1)+hex.charAt(1);
rgb[2]=hex.charAt(2)+hex.charAt(2);
}else{
rgb[0]=hex.substring(0,2);
rgb[1]=hex.substring(2,4);
rgb[2]=hex.substring(4);
}
for(var i=0;i<rgb.length;i++){
rgb[i]=_658.indexOf(rgb[i].charAt(0))*16+_658.indexOf(rgb[i].charAt(1));
}
return rgb;
};
dojo.gfx.color.rgb2hex=function(r,g,b){
if(dojo.lang.isArray(r)){
g=r[1]||0;
b=r[2]||0;
r=r[0]||0;
}
var ret=dojo.lang.map([r,g,b],function(x){
x=new Number(x);
var s=x.toString(16);
while(s.length<2){
s="0"+s;
}
return s;
});
ret.unshift("#");
return ret.join("");
};
dojo.provide("dojo.lfx.Animation");
dojo.require("dojo.lang.func");
dojo.lfx.Line=function(_661,end){
this.start=_661;
this.end=end;
if(dojo.lang.isArray(_661)){
var diff=[];
dojo.lang.forEach(this.start,function(s,i){
diff[i]=this.end[i]-s;
},this);
this.getValue=function(n){
var res=[];
dojo.lang.forEach(this.start,function(s,i){
res[i]=(diff[i]*n)+s;
},this);
return res;
};
}else{
var diff=end-_661;
this.getValue=function(n){
return (diff*n)+this.start;
};
}
};
if((dojo.render.html.khtml)&&(!dojo.render.html.safari)){
dojo.lfx.easeDefault=function(n){
return (parseFloat("0.5")+((Math.sin((n+parseFloat("1.5"))*Math.PI))/2));
};
}else{
dojo.lfx.easeDefault=function(n){
return (0.5+((Math.sin((n+1.5)*Math.PI))/2));
};
}
dojo.lfx.easeIn=function(n){
return Math.pow(n,3);
};
dojo.lfx.easeOut=function(n){
return (1-Math.pow(1-n,3));
};
dojo.lfx.easeInOut=function(n){
return ((3*Math.pow(n,2))-(2*Math.pow(n,3)));
};
dojo.lfx.IAnimation=function(){
};
dojo.lang.extend(dojo.lfx.IAnimation,{curve:null,duration:1000,easing:null,repeatCount:0,rate:10,handler:null,beforeBegin:null,onBegin:null,onAnimate:null,onEnd:null,onPlay:null,onPause:null,onStop:null,play:null,pause:null,stop:null,connect:function(evt,_671,_672){
if(!_672){
_672=_671;
_671=this;
}
_672=dojo.lang.hitch(_671,_672);
var _673=this[evt]||function(){
};
this[evt]=function(){
var ret=_673.apply(this,arguments);
_672.apply(this,arguments);
return ret;
};
return this;
},fire:function(evt,args){
if(this[evt]){
this[evt].apply(this,(args||[]));
}
return this;
},repeat:function(_677){
this.repeatCount=_677;
return this;
},_active:false,_paused:false});
dojo.lfx.Animation=function(_678,_679,_67a,_67b,_67c,rate){
dojo.lfx.IAnimation.call(this);
if(dojo.lang.isNumber(_678)||(!_678&&_679.getValue)){
rate=_67c;
_67c=_67b;
_67b=_67a;
_67a=_679;
_679=_678;
_678=null;
}else{
if(_678.getValue||dojo.lang.isArray(_678)){
rate=_67b;
_67c=_67a;
_67b=_679;
_67a=_678;
_679=null;
_678=null;
}
}
if(dojo.lang.isArray(_67a)){
this.curve=new dojo.lfx.Line(_67a[0],_67a[1]);
}else{
this.curve=_67a;
}
if(_679!=null&&_679>0){
this.duration=_679;
}
if(_67c){
this.repeatCount=_67c;
}
if(rate){
this.rate=rate;
}
if(_678){
dojo.lang.forEach(["handler","beforeBegin","onBegin","onEnd","onPlay","onStop","onAnimate"],function(item){
if(_678[item]){
this.connect(item,_678[item]);
}
},this);
}
if(_67b&&dojo.lang.isFunction(_67b)){
this.easing=_67b;
}
};
dojo.inherits(dojo.lfx.Animation,dojo.lfx.IAnimation);
dojo.lang.extend(dojo.lfx.Animation,{_startTime:null,_endTime:null,_timer:null,_percent:0,_startRepeatCount:0,play:function(_67f,_680){
if(_680){
clearTimeout(this._timer);
this._active=false;
this._paused=false;
this._percent=0;
}else{
if(this._active&&!this._paused){
return this;
}
}
this.fire("handler",["beforeBegin"]);
this.fire("beforeBegin");
if(_67f>0){
setTimeout(dojo.lang.hitch(this,function(){
this.play(null,_680);
}),_67f);
return this;
}
this._startTime=new Date().valueOf();
if(this._paused){
this._startTime-=(this.duration*this._percent/100);
}
this._endTime=this._startTime+this.duration;
this._active=true;
this._paused=false;
var step=this._percent/100;
var _682=this.curve.getValue(step);
if(this._percent==0){
if(!this._startRepeatCount){
this._startRepeatCount=this.repeatCount;
}
this.fire("handler",["begin",_682]);
this.fire("onBegin",[_682]);
}
this.fire("handler",["play",_682]);
this.fire("onPlay",[_682]);
this._cycle();
return this;
},pause:function(){
clearTimeout(this._timer);
if(!this._active){
return this;
}
this._paused=true;
var _683=this.curve.getValue(this._percent/100);
this.fire("handler",["pause",_683]);
this.fire("onPause",[_683]);
return this;
},gotoPercent:function(pct,_685){
clearTimeout(this._timer);
this._active=true;
this._paused=true;
this._percent=pct;
if(_685){
this.play();
}
return this;
},stop:function(_686){
clearTimeout(this._timer);
var step=this._percent/100;
if(_686){
step=1;
}
var _688=this.curve.getValue(step);
this.fire("handler",["stop",_688]);
this.fire("onStop",[_688]);
this._active=false;
this._paused=false;
return this;
},status:function(){
if(this._active){
return this._paused?"paused":"playing";
}else{
return "stopped";
}
return this;
},_cycle:function(){
clearTimeout(this._timer);
if(this._active){
var curr=new Date().valueOf();
var step=(curr-this._startTime)/(this._endTime-this._startTime);
if(step>=1){
step=1;
this._percent=100;
}else{
this._percent=step*100;
}
if((this.easing)&&(dojo.lang.isFunction(this.easing))){
step=this.easing(step);
}
var _68b=this.curve.getValue(step);
this.fire("handler",["animate",_68b]);
this.fire("onAnimate",[_68b]);
if(step<1){
this._timer=setTimeout(dojo.lang.hitch(this,"_cycle"),this.rate);
}else{
this._active=false;
this.fire("handler",["end"]);
this.fire("onEnd");
if(this.repeatCount>0){
this.repeatCount--;
this.play(null,true);
}else{
if(this.repeatCount==-1){
this.play(null,true);
}else{
if(this._startRepeatCount){
this.repeatCount=this._startRepeatCount;
this._startRepeatCount=0;
}
}
}
}
}
return this;
}});
dojo.lfx.Combine=function(_68c){
dojo.lfx.IAnimation.call(this);
this._anims=[];
this._animsEnded=0;
var _68d=arguments;
if(_68d.length==1&&(dojo.lang.isArray(_68d[0])||dojo.lang.isArrayLike(_68d[0]))){
_68d=_68d[0];
}
dojo.lang.forEach(_68d,function(anim){
this._anims.push(anim);
anim.connect("onEnd",dojo.lang.hitch(this,"_onAnimsEnded"));
},this);
};
dojo.inherits(dojo.lfx.Combine,dojo.lfx.IAnimation);
dojo.lang.extend(dojo.lfx.Combine,{_animsEnded:0,play:function(_68f,_690){
if(!this._anims.length){
return this;
}
this.fire("beforeBegin");
if(_68f>0){
setTimeout(dojo.lang.hitch(this,function(){
this.play(null,_690);
}),_68f);
return this;
}
if(_690||this._anims[0].percent==0){
this.fire("onBegin");
}
this.fire("onPlay");
this._animsCall("play",null,_690);
return this;
},pause:function(){
this.fire("onPause");
this._animsCall("pause");
return this;
},stop:function(_691){
this.fire("onStop");
this._animsCall("stop",_691);
return this;
},_onAnimsEnded:function(){
this._animsEnded++;
if(this._animsEnded>=this._anims.length){
this.fire("onEnd");
}
return this;
},_animsCall:function(_692){
var args=[];
if(arguments.length>1){
for(var i=1;i<arguments.length;i++){
args.push(arguments[i]);
}
}
var _695=this;
dojo.lang.forEach(this._anims,function(anim){
anim[_692](args);
},_695);
return this;
}});
dojo.lfx.Chain=function(_697){
dojo.lfx.IAnimation.call(this);
this._anims=[];
this._currAnim=-1;
var _698=arguments;
if(_698.length==1&&(dojo.lang.isArray(_698[0])||dojo.lang.isArrayLike(_698[0]))){
_698=_698[0];
}
var _699=this;
dojo.lang.forEach(_698,function(anim,i,_69c){
this._anims.push(anim);
if(i<_69c.length-1){
anim.connect("onEnd",dojo.lang.hitch(this,"_playNext"));
}else{
anim.connect("onEnd",dojo.lang.hitch(this,function(){
this.fire("onEnd");
}));
}
},this);
};
dojo.inherits(dojo.lfx.Chain,dojo.lfx.IAnimation);
dojo.lang.extend(dojo.lfx.Chain,{_currAnim:-1,play:function(_69d,_69e){
if(!this._anims.length){
return this;
}
if(_69e||!this._anims[this._currAnim]){
this._currAnim=0;
}
var _69f=this._anims[this._currAnim];
this.fire("beforeBegin");
if(_69d>0){
setTimeout(dojo.lang.hitch(this,function(){
this.play(null,_69e);
}),_69d);
return this;
}
if(_69f){
if(this._currAnim==0){
this.fire("handler",["begin",this._currAnim]);
this.fire("onBegin",[this._currAnim]);
}
this.fire("onPlay",[this._currAnim]);
_69f.play(null,_69e);
}
return this;
},pause:function(){
if(this._anims[this._currAnim]){
this._anims[this._currAnim].pause();
this.fire("onPause",[this._currAnim]);
}
return this;
},playPause:function(){
if(this._anims.length==0){
return this;
}
if(this._currAnim==-1){
this._currAnim=0;
}
var _6a0=this._anims[this._currAnim];
if(_6a0){
if(!_6a0._active||_6a0._paused){
this.play();
}else{
this.pause();
}
}
return this;
},stop:function(){
var _6a1=this._anims[this._currAnim];
if(_6a1){
_6a1.stop();
this.fire("onStop",[this._currAnim]);
}
return _6a1;
},_playNext:function(){
if(this._currAnim==-1||this._anims.length==0){
return this;
}
this._currAnim++;
if(this._anims[this._currAnim]){
this._anims[this._currAnim].play(null,true);
}
return this;
}});
dojo.lfx.combine=function(_6a2){
var _6a3=arguments;
if(dojo.lang.isArray(arguments[0])){
_6a3=arguments[0];
}
if(_6a3.length==1){
return _6a3[0];
}
return new dojo.lfx.Combine(_6a3);
};
dojo.lfx.chain=function(_6a4){
var _6a5=arguments;
if(dojo.lang.isArray(arguments[0])){
_6a5=arguments[0];
}
if(_6a5.length==1){
return _6a5[0];
}
return new dojo.lfx.Chain(_6a5);
};
dojo.require("dojo.html.style");
dojo.provide("dojo.html.color");
dojo.require("dojo.gfx.color");
dojo.require("dojo.lang.common");
dojo.html.getBackgroundColor=function(node){
node=dojo.byId(node);
var _6a7;
do{
_6a7=dojo.html.getStyle(node,"background-color");
if(_6a7.toLowerCase()=="rgba(0, 0, 0, 0)"){
_6a7="transparent";
}
if(node==document.getElementsByTagName("body")[0]){
node=null;
break;
}
node=node.parentNode;
}while(node&&dojo.lang.inArray(["transparent",""],_6a7));
if(_6a7=="transparent"){
_6a7=[255,255,255,0];
}else{
_6a7=dojo.gfx.color.extractRGB(_6a7);
}
return _6a7;
};
dojo.provide("dojo.lfx.html");
dojo.require("dojo.gfx.color");
dojo.require("dojo.lfx.Animation");
dojo.require("dojo.lang.array");
dojo.require("dojo.html.display");
dojo.require("dojo.html.color");
dojo.require("dojo.html.layout");
dojo.lfx.html._byId=function(_6a8){
if(!_6a8){
return [];
}
if(dojo.lang.isArrayLike(_6a8)){
if(!_6a8.alreadyChecked){
var n=[];
dojo.lang.forEach(_6a8,function(node){
n.push(dojo.byId(node));
});
n.alreadyChecked=true;
return n;
}else{
return _6a8;
}
}else{
var n=[];
n.push(dojo.byId(_6a8));
n.alreadyChecked=true;
return n;
}
};
dojo.lfx.html.propertyAnimation=function(_6ab,_6ac,_6ad,_6ae,_6af){
_6ab=dojo.lfx.html._byId(_6ab);
var _6b0={"propertyMap":_6ac,"nodes":_6ab,"duration":_6ad,"easing":_6ae||dojo.lfx.easeDefault};
var _6b1=function(args){
if(args.nodes.length==1){
var pm=args.propertyMap;
if(!dojo.lang.isArray(args.propertyMap)){
var parr=[];
for(var _6b5 in pm){
pm[_6b5].property=_6b5;
parr.push(pm[_6b5]);
}
pm=args.propertyMap=parr;
}
dojo.lang.forEach(pm,function(prop){
if(dj_undef("start",prop)){
if(prop.property!="opacity"){
prop.start=parseInt(dojo.html.getComputedStyle(args.nodes[0],prop.property));
}else{
prop.start=dojo.html.getOpacity(args.nodes[0]);
}
}
});
}
};
var _6b7=function(_6b8){
var _6b9=[];
dojo.lang.forEach(_6b8,function(c){
_6b9.push(Math.round(c));
});
return _6b9;
};
var _6bb=function(n,_6bd){
n=dojo.byId(n);
if(!n||!n.style){
return;
}
for(var s in _6bd){
try{
if(s=="opacity"){
dojo.html.setOpacity(n,_6bd[s]);
}else{
n.style[s]=_6bd[s];
}
}
catch(e){
dojo.debug(e);
}
}
};
var _6bf=function(_6c0){
this._properties=_6c0;
this.diffs=new Array(_6c0.length);
dojo.lang.forEach(_6c0,function(prop,i){
if(dojo.lang.isFunction(prop.start)){
prop.start=prop.start(prop,i);
}
if(dojo.lang.isFunction(prop.end)){
prop.end=prop.end(prop,i);
}
if(dojo.lang.isArray(prop.start)){
this.diffs[i]=null;
}else{
if(prop.start instanceof dojo.gfx.color.Color){
prop.startRgb=prop.start.toRgb();
prop.endRgb=prop.end.toRgb();
}else{
this.diffs[i]=prop.end-prop.start;
}
}
},this);
this.getValue=function(n){
var ret={};
dojo.lang.forEach(this._properties,function(prop,i){
var _6c7=null;
if(dojo.lang.isArray(prop.start)){
}else{
if(prop.start instanceof dojo.gfx.color.Color){
_6c7=(prop.units||"rgb")+"(";
for(var j=0;j<prop.startRgb.length;j++){
_6c7+=Math.round(((prop.endRgb[j]-prop.startRgb[j])*n)+prop.startRgb[j])+(j<prop.startRgb.length-1?",":"");
}
_6c7+=")";
}else{
_6c7=((this.diffs[i])*n)+prop.start+(prop.property!="opacity"?prop.units||"px":"");
}
}
ret[dojo.html.toCamelCase(prop.property)]=_6c7;
},this);
return ret;
};
};
var anim=new dojo.lfx.Animation({beforeBegin:function(){
_6b1(_6b0);
anim.curve=new _6bf(_6b0.propertyMap);
},onAnimate:function(_6ca){
dojo.lang.forEach(_6b0.nodes,function(node){
_6bb(node,_6ca);
});
}},_6b0.duration,null,_6b0.easing);
if(_6af){
for(var x in _6af){
if(dojo.lang.isFunction(_6af[x])){
anim.connect(x,anim,_6af[x]);
}
}
}
return anim;
};
dojo.lfx.html._makeFadeable=function(_6cd){
var _6ce=function(node){
if(dojo.render.html.ie){
if((node.style.zoom.length==0)&&(dojo.html.getStyle(node,"zoom")=="normal")){
node.style.zoom="1";
}
if((node.style.width.length==0)&&(dojo.html.getStyle(node,"width")=="auto")){
node.style.width="auto";
}
}
};
if(dojo.lang.isArrayLike(_6cd)){
dojo.lang.forEach(_6cd,_6ce);
}else{
_6ce(_6cd);
}
};
dojo.lfx.html.fade=function(_6d0,_6d1,_6d2,_6d3,_6d4){
_6d0=dojo.lfx.html._byId(_6d0);
var _6d5={property:"opacity"};
if(!dj_undef("start",_6d1)){
_6d5.start=_6d1.start;
}else{
_6d5.start=function(){
return dojo.html.getOpacity(_6d0[0]);
};
}
if(!dj_undef("end",_6d1)){
_6d5.end=_6d1.end;
}else{
dojo.raise("dojo.lfx.html.fade needs an end value");
}
var anim=dojo.lfx.propertyAnimation(_6d0,[_6d5],_6d2,_6d3);
anim.connect("beforeBegin",function(){
dojo.lfx.html._makeFadeable(_6d0);
});
if(_6d4){
anim.connect("onEnd",function(){
_6d4(_6d0,anim);
});
}
return anim;
};
dojo.lfx.html.fadeIn=function(_6d7,_6d8,_6d9,_6da){
return dojo.lfx.html.fade(_6d7,{end:1},_6d8,_6d9,_6da);
};
dojo.lfx.html.fadeOut=function(_6db,_6dc,_6dd,_6de){
return dojo.lfx.html.fade(_6db,{end:0},_6dc,_6dd,_6de);
};
dojo.lfx.html.fadeShow=function(_6df,_6e0,_6e1,_6e2){
_6df=dojo.lfx.html._byId(_6df);
dojo.lang.forEach(_6df,function(node){
dojo.html.setOpacity(node,0);
});
var anim=dojo.lfx.html.fadeIn(_6df,_6e0,_6e1,_6e2);
anim.connect("beforeBegin",function(){
if(dojo.lang.isArrayLike(_6df)){
dojo.lang.forEach(_6df,dojo.html.show);
}else{
dojo.html.show(_6df);
}
});
return anim;
};
dojo.lfx.html.fadeHide=function(_6e5,_6e6,_6e7,_6e8){
var anim=dojo.lfx.html.fadeOut(_6e5,_6e6,_6e7,function(){
if(dojo.lang.isArrayLike(_6e5)){
dojo.lang.forEach(_6e5,dojo.html.hide);
}else{
dojo.html.hide(_6e5);
}
if(_6e8){
_6e8(_6e5,anim);
}
});
return anim;
};
dojo.lfx.html.wipeIn=function(_6ea,_6eb,_6ec,_6ed){
_6ea=dojo.lfx.html._byId(_6ea);
var _6ee=[];
dojo.lang.forEach(_6ea,function(node){
var _6f0={};
var _6f1,_6f2,_6f3;
with(node.style){
_6f1=top;
_6f2=left;
_6f3=position;
top="-9999px";
left="-9999px";
position="absolute";
display="";
}
var _6f4=dojo.html.getBorderBox(node).height;
with(node.style){
top=_6f1;
left=_6f2;
position=_6f3;
display="none";
}
var anim=dojo.lfx.propertyAnimation(node,{"height":{start:1,end:function(){
return _6f4;
}}},_6eb,_6ec);
anim.connect("beforeBegin",function(){
_6f0.overflow=node.style.overflow;
_6f0.height=node.style.height;
with(node.style){
overflow="hidden";
height="1px";
}
dojo.html.show(node);
});
anim.connect("onEnd",function(){
with(node.style){
overflow=_6f0.overflow;
height=_6f0.height;
}
if(_6ed){
_6ed(node,anim);
}
});
_6ee.push(anim);
});
return dojo.lfx.combine(_6ee);
};
dojo.lfx.html.wipeOut=function(_6f6,_6f7,_6f8,_6f9){
_6f6=dojo.lfx.html._byId(_6f6);
var _6fa=[];
dojo.lang.forEach(_6f6,function(node){
var _6fc={};
var anim=dojo.lfx.propertyAnimation(node,{"height":{start:function(){
return dojo.html.getContentBox(node).height;
},end:1}},_6f7,_6f8,{"beforeBegin":function(){
_6fc.overflow=node.style.overflow;
_6fc.height=node.style.height;
with(node.style){
overflow="hidden";
}
dojo.html.show(node);
},"onEnd":function(){
dojo.html.hide(node);
with(node.style){
overflow=_6fc.overflow;
height=_6fc.height;
}
if(_6f9){
_6f9(node,anim);
}
}});
_6fa.push(anim);
});
return dojo.lfx.combine(_6fa);
};
dojo.lfx.html.slideTo=function(_6fe,_6ff,_700,_701,_702){
_6fe=dojo.lfx.html._byId(_6fe);
var _703=[];
var _704=dojo.html.getComputedStyle;
if(dojo.lang.isArray(_6ff)){
dojo.deprecated("dojo.lfx.html.slideTo(node, array)","use dojo.lfx.html.slideTo(node, {top: value, left: value});","0.5");
_6ff={top:_6ff[0],left:_6ff[1]};
}
dojo.lang.forEach(_6fe,function(node){
var top=null;
var left=null;
var init=(function(){
var _709=node;
return function(){
var pos=_704(_709,"position");
top=(pos=="absolute"?node.offsetTop:parseInt(_704(node,"top"))||0);
left=(pos=="absolute"?node.offsetLeft:parseInt(_704(node,"left"))||0);
if(!dojo.lang.inArray(["absolute","relative"],pos)){
var ret=dojo.html.abs(_709,true);
dojo.html.setStyleAttributes(_709,"position:absolute;top:"+ret.y+"px;left:"+ret.x+"px;");
top=ret.y;
left=ret.x;
}
};
})();
init();
var anim=dojo.lfx.propertyAnimation(node,{"top":{start:top,end:(_6ff.top||0)},"left":{start:left,end:(_6ff.left||0)}},_700,_701,{"beforeBegin":init});
if(_702){
anim.connect("onEnd",function(){
_702(_6fe,anim);
});
}
_703.push(anim);
});
return dojo.lfx.combine(_703);
};
dojo.lfx.html.slideBy=function(_70d,_70e,_70f,_710,_711){
_70d=dojo.lfx.html._byId(_70d);
var _712=[];
var _713=dojo.html.getComputedStyle;
if(dojo.lang.isArray(_70e)){
dojo.deprecated("dojo.lfx.html.slideBy(node, array)","use dojo.lfx.html.slideBy(node, {top: value, left: value});","0.5");
_70e={top:_70e[0],left:_70e[1]};
}
dojo.lang.forEach(_70d,function(node){
var top=null;
var left=null;
var init=(function(){
var _718=node;
return function(){
var pos=_713(_718,"position");
top=(pos=="absolute"?node.offsetTop:parseInt(_713(node,"top"))||0);
left=(pos=="absolute"?node.offsetLeft:parseInt(_713(node,"left"))||0);
if(!dojo.lang.inArray(["absolute","relative"],pos)){
var ret=dojo.html.abs(_718,true);
dojo.html.setStyleAttributes(_718,"position:absolute;top:"+ret.y+"px;left:"+ret.x+"px;");
top=ret.y;
left=ret.x;
}
};
})();
init();
var anim=dojo.lfx.propertyAnimation(node,{"top":{start:top,end:top+(_70e.top||0)},"left":{start:left,end:left+(_70e.left||0)}},_70f,_710).connect("beforeBegin",init);
if(_711){
anim.connect("onEnd",function(){
_711(_70d,anim);
});
}
_712.push(anim);
});
return dojo.lfx.combine(_712);
};
dojo.lfx.html.explode=function(_71c,_71d,_71e,_71f,_720){
var h=dojo.html;
_71c=dojo.byId(_71c);
_71d=dojo.byId(_71d);
var _722=h.toCoordinateObject(_71c,true);
var _723=document.createElement("div");
h.copyStyle(_723,_71d);
if(_71d.explodeClassName){
_723.className=_71d.explodeClassName;
}
with(_723.style){
position="absolute";
display="none";
var _724=h.getStyle(_71c,"background-color");
backgroundColor=_724?_724.toLowerCase():"transparent";
backgroundColor=(backgroundColor=="transparent")?"rgb(221, 221, 221)":backgroundColor;
}
dojo.body().appendChild(_723);
with(_71d.style){
visibility="hidden";
display="block";
}
var _725=h.toCoordinateObject(_71d,true);
with(_71d.style){
display="none";
visibility="visible";
}
var _726={opacity:{start:0.5,end:1}};
dojo.lang.forEach(["height","width","top","left"],function(type){
_726[type]={start:_722[type],end:_725[type]};
});
var anim=new dojo.lfx.propertyAnimation(_723,_726,_71e,_71f,{"beforeBegin":function(){
h.setDisplay(_723,"block");
},"onEnd":function(){
h.setDisplay(_71d,"block");
_723.parentNode.removeChild(_723);
}});
if(_720){
anim.connect("onEnd",function(){
_720(_71d,anim);
});
}
return anim;
};
dojo.lfx.html.implode=function(_729,end,_72b,_72c,_72d){
var h=dojo.html;
_729=dojo.byId(_729);
end=dojo.byId(end);
var _72f=dojo.html.toCoordinateObject(_729,true);
var _730=dojo.html.toCoordinateObject(end,true);
var _731=document.createElement("div");
dojo.html.copyStyle(_731,_729);
if(_729.explodeClassName){
_731.className=_729.explodeClassName;
}
dojo.html.setOpacity(_731,0.3);
with(_731.style){
position="absolute";
display="none";
backgroundColor=h.getStyle(_729,"background-color").toLowerCase();
}
dojo.body().appendChild(_731);
var _732={opacity:{start:1,end:0.5}};
dojo.lang.forEach(["height","width","top","left"],function(type){
_732[type]={start:_72f[type],end:_730[type]};
});
var anim=new dojo.lfx.propertyAnimation(_731,_732,_72b,_72c,{"beforeBegin":function(){
dojo.html.hide(_729);
dojo.html.show(_731);
},"onEnd":function(){
_731.parentNode.removeChild(_731);
}});
if(_72d){
anim.connect("onEnd",function(){
_72d(_729,anim);
});
}
return anim;
};
dojo.lfx.html.highlight=function(_735,_736,_737,_738,_739){
_735=dojo.lfx.html._byId(_735);
var _73a=[];
dojo.lang.forEach(_735,function(node){
var _73c=dojo.html.getBackgroundColor(node);
var bg=dojo.html.getStyle(node,"background-color").toLowerCase();
var _73e=dojo.html.getStyle(node,"background-image");
var _73f=(bg=="transparent"||bg=="rgba(0, 0, 0, 0)");
while(_73c.length>3){
_73c.pop();
}
var rgb=new dojo.gfx.color.Color(_736);
var _741=new dojo.gfx.color.Color(_73c);
var anim=dojo.lfx.propertyAnimation(node,{"background-color":{start:rgb,end:_741}},_737,_738,{"beforeBegin":function(){
if(_73e){
node.style.backgroundImage="none";
}
node.style.backgroundColor="rgb("+rgb.toRgb().join(",")+")";
},"onEnd":function(){
if(_73e){
node.style.backgroundImage=_73e;
}
if(_73f){
node.style.backgroundColor="transparent";
}
if(_739){
_739(node,anim);
}
}});
_73a.push(anim);
});
return dojo.lfx.combine(_73a);
};
dojo.lfx.html.unhighlight=function(_743,_744,_745,_746,_747){
_743=dojo.lfx.html._byId(_743);
var _748=[];
dojo.lang.forEach(_743,function(node){
var _74a=new dojo.gfx.color.Color(dojo.html.getBackgroundColor(node));
var rgb=new dojo.gfx.color.Color(_744);
var _74c=dojo.html.getStyle(node,"background-image");
var anim=dojo.lfx.propertyAnimation(node,{"background-color":{start:_74a,end:rgb}},_745,_746,{"beforeBegin":function(){
if(_74c){
node.style.backgroundImage="none";
}
node.style.backgroundColor="rgb("+_74a.toRgb().join(",")+")";
},"onEnd":function(){
if(_747){
_747(node,anim);
}
}});
_748.push(anim);
});
return dojo.lfx.combine(_748);
};
dojo.lang.mixin(dojo.lfx,dojo.lfx.html);
dojo.kwCompoundRequire({browser:["dojo.lfx.html"],dashboard:["dojo.lfx.html"]});
dojo.provide("dojo.lfx.*");
dojo.provide("dojo.lfx.toggle");
dojo.require("dojo.lfx.*");
dojo.lfx.toggle.plain={show:function(node,_74f,_750,_751){
dojo.html.show(node);
if(dojo.lang.isFunction(_751)){
_751();
}
},hide:function(node,_753,_754,_755){
dojo.html.hide(node);
if(dojo.lang.isFunction(_755)){
_755();
}
}};
dojo.lfx.toggle.fade={show:function(node,_757,_758,_759){
dojo.lfx.fadeShow(node,_757,_758,_759).play();
},hide:function(node,_75b,_75c,_75d){
dojo.lfx.fadeHide(node,_75b,_75c,_75d).play();
}};
dojo.lfx.toggle.wipe={show:function(node,_75f,_760,_761){
dojo.lfx.wipeIn(node,_75f,_760,_761).play();
},hide:function(node,_763,_764,_765){
dojo.lfx.wipeOut(node,_763,_764,_765).play();
}};
dojo.lfx.toggle.explode={show:function(node,_767,_768,_769,_76a){
dojo.lfx.explode(_76a||{x:0,y:0,width:0,height:0},node,_767,_768,_769).play();
},hide:function(node,_76c,_76d,_76e,_76f){
dojo.lfx.implode(node,_76f||{x:0,y:0,width:0,height:0},_76c,_76d,_76e).play();
}};
dojo.provide("dojo.widget.HtmlWidget");
dojo.require("dojo.widget.DomWidget");
dojo.require("dojo.html.util");
dojo.require("dojo.html.display");
dojo.require("dojo.html.layout");
dojo.require("dojo.lang.extras");
dojo.require("dojo.lang.func");
dojo.require("dojo.lfx.toggle");
dojo.declare("dojo.widget.HtmlWidget",dojo.widget.DomWidget,{templateCssPath:null,templatePath:null,lang:"",toggle:"plain",toggleDuration:150,initialize:function(args,frag){
},postMixInProperties:function(args,frag){
if(this.lang===""){
this.lang=null;
}
this.toggleObj=dojo.lfx.toggle[this.toggle.toLowerCase()]||dojo.lfx.toggle.plain;
},createNodesFromText:function(txt,wrap){
return dojo.html.createNodesFromText(txt,wrap);
},destroyRendering:function(_776){
try{
if(this.bgIframe){
this.bgIframe.remove();
delete this.bgIframe;
}
if(!_776&&this.domNode){
dojo.event.browser.clean(this.domNode);
}
dojo.widget.HtmlWidget.superclass.destroyRendering.call(this);
}
catch(e){
}
},isShowing:function(){
return dojo.html.isShowing(this.domNode);
},toggleShowing:function(){
if(this.isShowing()){
this.hide();
}else{
this.show();
}
},show:function(){
if(this.isShowing()){
return;
}
this.animationInProgress=true;
this.toggleObj.show(this.domNode,this.toggleDuration,null,dojo.lang.hitch(this,this.onShow),this.explodeSrc);
},onShow:function(){
this.animationInProgress=false;
this.checkSize();
},hide:function(){
if(!this.isShowing()){
return;
}
this.animationInProgress=true;
this.toggleObj.hide(this.domNode,this.toggleDuration,null,dojo.lang.hitch(this,this.onHide),this.explodeSrc);
},onHide:function(){
this.animationInProgress=false;
},_isResized:function(w,h){
if(!this.isShowing()){
return false;
}
var wh=dojo.html.getMarginBox(this.domNode);
var _77a=w||wh.width;
var _77b=h||wh.height;
if(this.width==_77a&&this.height==_77b){
return false;
}
this.width=_77a;
this.height=_77b;
return true;
},checkSize:function(){
if(!this._isResized()){
return;
}
this.onResized();
},resizeTo:function(w,h){
dojo.html.setMarginBox(this.domNode,{width:w,height:h});
if(this.isShowing()){
this.onResized();
}
},resizeSoon:function(){
if(this.isShowing()){
dojo.lang.setTimeout(this,this.onResized,0);
}
},onResized:function(){
dojo.lang.forEach(this.children,function(_77e){
if(_77e.checkSize){
_77e.checkSize();
}
});
}});
dojo.kwCompoundRequire({common:["dojo.xml.Parse","dojo.widget.Widget","dojo.widget.Parse","dojo.widget.Manager"],browser:["dojo.widget.DomWidget","dojo.widget.HtmlWidget"],dashboard:["dojo.widget.DomWidget","dojo.widget.HtmlWidget"],svg:["dojo.widget.SvgWidget"],rhino:["dojo.widget.SwtWidget"]});
dojo.provide("dojo.widget.*");
dojo.provide("dojo.string.common");
dojo.string.trim=function(str,wh){
if(!str.replace){
return str;
}
if(!str.length){
return str;
}
var re=(wh>0)?(/^\s+/):(wh<0)?(/\s+$/):(/^\s+|\s+$/g);
return str.replace(re,"");
};
dojo.string.trimStart=function(str){
return dojo.string.trim(str,1);
};
dojo.string.trimEnd=function(str){
return dojo.string.trim(str,-1);
};
dojo.string.repeat=function(str,_785,_786){
var out="";
for(var i=0;i<_785;i++){
out+=str;
if(_786&&i<_785-1){
out+=_786;
}
}
return out;
};
dojo.string.pad=function(str,len,c,dir){
var out=String(str);
if(!c){
c="0";
}
if(!dir){
dir=1;
}
while(out.length<len){
if(dir>0){
out=c+out;
}else{
out+=c;
}
}
return out;
};
dojo.string.padLeft=function(str,len,c){
return dojo.string.pad(str,len,c,1);
};
dojo.string.padRight=function(str,len,c){
return dojo.string.pad(str,len,c,-1);
};
dojo.provide("dojo.string");
dojo.require("dojo.string.common");
dojo.provide("dojo.io.common");
dojo.require("dojo.string");
dojo.require("dojo.lang.extras");
dojo.io.transports=[];
dojo.io.hdlrFuncNames=["load","error","timeout"];
dojo.io.Request=function(url,_795,_796,_797){
if((arguments.length==1)&&(arguments[0].constructor==Object)){
this.fromKwArgs(arguments[0]);
}else{
this.url=url;
if(_795){
this.mimetype=_795;
}
if(_796){
this.transport=_796;
}
if(arguments.length>=4){
this.changeUrl=_797;
}
}
};
dojo.lang.extend(dojo.io.Request,{url:"",mimetype:"text/plain",method:"GET",content:undefined,transport:undefined,changeUrl:undefined,formNode:undefined,sync:false,bindSuccess:false,useCache:false,preventCache:false,jsonFilter:function(_798){
if((this.mimetype=="text/json-comment-filtered")||(this.mimetype=="application/json-comment-filtered")){
var _799=_798.indexOf("/*");
var _79a=_798.lastIndexOf("*/");
if((_799==-1)||(_79a==-1)){
dojo.debug("your JSON wasn't comment filtered!");
return "";
}
return _798.substring(_799+2,_79a);
}
return _798;
},load:function(type,data,_79d,_79e){
},error:function(type,_7a0,_7a1,_7a2){
},timeout:function(type,_7a4,_7a5,_7a6){
},handle:function(type,data,_7a9,_7aa){
},timeoutSeconds:0,abort:function(){
},fromKwArgs:function(_7ab){
if(_7ab["url"]){
_7ab.url=_7ab.url.toString();
}
if(_7ab["formNode"]){
_7ab.formNode=dojo.byId(_7ab.formNode);
}
if(!_7ab["method"]&&_7ab["formNode"]&&_7ab["formNode"].method){
_7ab.method=_7ab["formNode"].method;
}
if(!_7ab["handle"]&&_7ab["handler"]){
_7ab.handle=_7ab.handler;
}
if(!_7ab["load"]&&_7ab["loaded"]){
_7ab.load=_7ab.loaded;
}
if(!_7ab["changeUrl"]&&_7ab["changeURL"]){
_7ab.changeUrl=_7ab.changeURL;
}
_7ab.encoding=dojo.lang.firstValued(_7ab["encoding"],djConfig["bindEncoding"],"");
_7ab.sendTransport=dojo.lang.firstValued(_7ab["sendTransport"],djConfig["ioSendTransport"],false);
var _7ac=dojo.lang.isFunction;
for(var x=0;x<dojo.io.hdlrFuncNames.length;x++){
var fn=dojo.io.hdlrFuncNames[x];
if(_7ab[fn]&&_7ac(_7ab[fn])){
continue;
}
if(_7ab["handle"]&&_7ac(_7ab["handle"])){
_7ab[fn]=_7ab.handle;
}
}
dojo.lang.mixin(this,_7ab);
}});
dojo.io.Error=function(msg,type,num){
this.message=msg;
this.type=type||"unknown";
this.number=num||0;
};
dojo.io.transports.addTransport=function(name){
this.push(name);
this[name]=dojo.io[name];
};
dojo.io.bind=function(_7b3){
if(!(_7b3 instanceof dojo.io.Request)){
try{
_7b3=new dojo.io.Request(_7b3);
}
catch(e){
dojo.debug(e);
}
}
var _7b4="";
if(_7b3["transport"]){
_7b4=_7b3["transport"];
if(!this[_7b4]){
dojo.io.sendBindError(_7b3,"No dojo.io.bind() transport with name '"+_7b3["transport"]+"'.");
return _7b3;
}
if(!this[_7b4].canHandle(_7b3)){
dojo.io.sendBindError(_7b3,"dojo.io.bind() transport with name '"+_7b3["transport"]+"' cannot handle this type of request.");
return _7b3;
}
}else{
for(var x=0;x<dojo.io.transports.length;x++){
var tmp=dojo.io.transports[x];
if((this[tmp])&&(this[tmp].canHandle(_7b3))){
_7b4=tmp;
break;
}
}
if(_7b4==""){
dojo.io.sendBindError(_7b3,"None of the loaded transports for dojo.io.bind()"+" can handle the request.");
return _7b3;
}
}
this[_7b4].bind(_7b3);
_7b3.bindSuccess=true;
return _7b3;
};
dojo.io.sendBindError=function(_7b7,_7b8){
if((typeof _7b7.error=="function"||typeof _7b7.handle=="function")&&(typeof setTimeout=="function"||typeof setTimeout=="object")){
var _7b9=new dojo.io.Error(_7b8);
setTimeout(function(){
_7b7[(typeof _7b7.error=="function")?"error":"handle"]("error",_7b9,null,_7b7);
},50);
}else{
dojo.raise(_7b8);
}
};
dojo.io.queueBind=function(_7ba){
if(!(_7ba instanceof dojo.io.Request)){
try{
_7ba=new dojo.io.Request(_7ba);
}
catch(e){
dojo.debug(e);
}
}
var _7bb=_7ba.load;
_7ba.load=function(){
dojo.io._queueBindInFlight=false;
var ret=_7bb.apply(this,arguments);
dojo.io._dispatchNextQueueBind();
return ret;
};
var _7bd=_7ba.error;
_7ba.error=function(){
dojo.io._queueBindInFlight=false;
var ret=_7bd.apply(this,arguments);
dojo.io._dispatchNextQueueBind();
return ret;
};
dojo.io._bindQueue.push(_7ba);
dojo.io._dispatchNextQueueBind();
return _7ba;
};
dojo.io._dispatchNextQueueBind=function(){
if(!dojo.io._queueBindInFlight){
dojo.io._queueBindInFlight=true;
if(dojo.io._bindQueue.length>0){
dojo.io.bind(dojo.io._bindQueue.shift());
}else{
dojo.io._queueBindInFlight=false;
}
}
};
dojo.io._bindQueue=[];
dojo.io._queueBindInFlight=false;
dojo.io.argsFromMap=function(map,_7c0,last){
var enc=/utf/i.test(_7c0||"")?encodeURIComponent:dojo.string.encodeAscii;
var _7c3=[];
var _7c4=new Object();
for(var name in map){
var _7c6=function(elt){
var val=enc(name)+"="+enc(elt);
_7c3[(last==name)?"push":"unshift"](val);
};
if(!_7c4[name]){
var _7c9=map[name];
if(dojo.lang.isArray(_7c9)){
dojo.lang.forEach(_7c9,_7c6);
}else{
_7c6(_7c9);
}
}
}
return _7c3.join("&");
};
dojo.io.setIFrameSrc=function(_7ca,src,_7cc){
try{
var r=dojo.render.html;
if(!_7cc){
if(r.safari){
_7ca.location=src;
}else{
frames[_7ca.name].location=src;
}
}else{
var idoc;
if(r.ie){
idoc=_7ca.contentWindow.document;
}else{
if(r.safari){
idoc=_7ca.document;
}else{
idoc=_7ca.contentWindow;
}
}
if(!idoc){
_7ca.location=src;
return;
}else{
idoc.location.replace(src);
}
}
}
catch(e){
dojo.debug(e);
dojo.debug("setIFrameSrc: "+e);
}
};
dojo.provide("dojo.string.extras");
dojo.require("dojo.string.common");
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.array");
dojo.string.substituteParams=function(_7cf,hash){
var map=(typeof hash=="object")?hash:dojo.lang.toArray(arguments,1);
return _7cf.replace(/\%\{(\w+)\}/g,function(_7d2,key){
if(typeof (map[key])!="undefined"&&map[key]!=null){
return map[key];
}
dojo.raise("Substitution not found: "+key);
});
};
dojo.string.capitalize=function(str){
if(!dojo.lang.isString(str)){
return "";
}
if(arguments.length==0){
str=this;
}
var _7d5=str.split(" ");
for(var i=0;i<_7d5.length;i++){
_7d5[i]=_7d5[i].charAt(0).toUpperCase()+_7d5[i].substring(1);
}
return _7d5.join(" ");
};
dojo.string.isBlank=function(str){
if(!dojo.lang.isString(str)){
return true;
}
return (dojo.string.trim(str).length==0);
};
dojo.string.encodeAscii=function(str){
if(!dojo.lang.isString(str)){
return str;
}
var ret="";
var _7da=escape(str);
var _7db,re=/%u([0-9A-F]{4})/i;
while((_7db=_7da.match(re))){
var num=Number("0x"+_7db[1]);
var _7de=escape("&#"+num+";");
ret+=_7da.substring(0,_7db.index)+_7de;
_7da=_7da.substring(_7db.index+_7db[0].length);
}
ret+=_7da.replace(/\+/g,"%2B");
return ret;
};
dojo.string.escape=function(type,str){
var args=dojo.lang.toArray(arguments,1);
switch(type.toLowerCase()){
case "xml":
case "html":
case "xhtml":
return dojo.string.escapeXml.apply(this,args);
case "sql":
return dojo.string.escapeSql.apply(this,args);
case "regexp":
case "regex":
return dojo.string.escapeRegExp.apply(this,args);
case "javascript":
case "jscript":
case "js":
return dojo.string.escapeJavaScript.apply(this,args);
case "ascii":
return dojo.string.encodeAscii.apply(this,args);
default:
return str;
}
};
dojo.string.escapeXml=function(str,_7e3){
str=str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");
if(!_7e3){
str=str.replace(/'/gm,"&#39;");
}
return str;
};
dojo.string.escapeSql=function(str){
return str.replace(/'/gm,"''");
};
dojo.string.escapeRegExp=function(str){
return str.replace(/\\/gm,"\\\\").replace(/([\f\b\n\t\r[\^$|?*+(){}])/gm,"\\$1");
};
dojo.string.escapeJavaScript=function(str){
return str.replace(/(["'\f\b\n\t\r])/gm,"\\$1");
};
dojo.string.escapeString=function(str){
return ("\""+str.replace(/(["\\])/g,"\\$1")+"\"").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r");
};
dojo.string.summary=function(str,len){
if(!len||str.length<=len){
return str;
}
return str.substring(0,len).replace(/\.+$/,"")+"...";
};
dojo.string.endsWith=function(str,end,_7ec){
if(_7ec){
str=str.toLowerCase();
end=end.toLowerCase();
}
if((str.length-end.length)<0){
return false;
}
return str.lastIndexOf(end)==str.length-end.length;
};
dojo.string.endsWithAny=function(str){
for(var i=1;i<arguments.length;i++){
if(dojo.string.endsWith(str,arguments[i])){
return true;
}
}
return false;
};
dojo.string.startsWith=function(str,_7f0,_7f1){
if(_7f1){
str=str.toLowerCase();
_7f0=_7f0.toLowerCase();
}
return str.indexOf(_7f0)==0;
};
dojo.string.startsWithAny=function(str){
for(var i=1;i<arguments.length;i++){
if(dojo.string.startsWith(str,arguments[i])){
return true;
}
}
return false;
};
dojo.string.has=function(str){
for(var i=1;i<arguments.length;i++){
if(str.indexOf(arguments[i])>-1){
return true;
}
}
return false;
};
dojo.string.normalizeNewlines=function(text,_7f7){
if(_7f7=="\n"){
text=text.replace(/\r\n/g,"\n");
text=text.replace(/\r/g,"\n");
}else{
if(_7f7=="\r"){
text=text.replace(/\r\n/g,"\r");
text=text.replace(/\n/g,"\r");
}else{
text=text.replace(/([^\r])\n/g,"$1\r\n").replace(/\r([^\n])/g,"\r\n$1");
}
}
return text;
};
dojo.string.splitEscaped=function(str,_7f9){
var _7fa=[];
for(var i=0,_7fc=0;i<str.length;i++){
if(str.charAt(i)=="\\"){
i++;
continue;
}
if(str.charAt(i)==_7f9){
_7fa.push(str.substring(_7fc,i));
_7fc=i+1;
}
}
_7fa.push(str.substr(_7fc));
return _7fa;
};
dojo.provide("dojo.undo.browser");
dojo.require("dojo.io.common");
try{
if((!djConfig["preventBackButtonFix"])&&(!dojo.hostenv.post_load_)){
document.write("<iframe style='border: 0px; width: 1px; height: 1px; position: absolute; bottom: 0px; right: 0px; visibility: visible;' name='djhistory' id='djhistory' src='"+(djConfig["dojoIframeHistoryUrl"]||dojo.hostenv.getBaseScriptUri()+"iframe_history.html")+"'></iframe>");
}
}
catch(e){
}
if(dojo.render.html.opera){
dojo.debug("Opera is not supported with dojo.undo.browser, so back/forward detection will not work.");
}
dojo.undo.browser={initialHref:(!dj_undef("window"))?window.location.href:"",initialHash:(!dj_undef("window"))?window.location.hash:"",moveForward:false,historyStack:[],forwardStack:[],historyIframe:null,bookmarkAnchor:null,locationTimer:null,setInitialState:function(args){
this.initialState=this._createState(this.initialHref,args,this.initialHash);
},addToHistory:function(args){
this.forwardStack=[];
var hash=null;
var url=null;
if(!this.historyIframe){
if(djConfig["useXDomain"]&&!djConfig["dojoIframeHistoryUrl"]){
dojo.debug("dojo.undo.browser: When using cross-domain Dojo builds,"+" please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl"+" to the path on your domain to iframe_history.html");
}
this.historyIframe=window.frames["djhistory"];
}
if(!this.bookmarkAnchor){
this.bookmarkAnchor=document.createElement("a");
dojo.body().appendChild(this.bookmarkAnchor);
this.bookmarkAnchor.style.display="none";
}
if(args["changeUrl"]){
hash="#"+((args["changeUrl"]!==true)?args["changeUrl"]:(new Date()).getTime());
if(this.historyStack.length==0&&this.initialState.urlHash==hash){
this.initialState=this._createState(url,args,hash);
return;
}else{
if(this.historyStack.length>0&&this.historyStack[this.historyStack.length-1].urlHash==hash){
this.historyStack[this.historyStack.length-1]=this._createState(url,args,hash);
return;
}
}
this.changingUrl=true;
setTimeout("window.location.href = '"+hash+"'; dojo.undo.browser.changingUrl = false;",1);
this.bookmarkAnchor.href=hash;
if(dojo.render.html.ie){
url=this._loadIframeHistory();
var _801=args["back"]||args["backButton"]||args["handle"];
var tcb=function(_803){
if(window.location.hash!=""){
setTimeout("window.location.href = '"+hash+"';",1);
}
_801.apply(this,[_803]);
};
if(args["back"]){
args.back=tcb;
}else{
if(args["backButton"]){
args.backButton=tcb;
}else{
if(args["handle"]){
args.handle=tcb;
}
}
}
var _804=args["forward"]||args["forwardButton"]||args["handle"];
var tfw=function(_806){
if(window.location.hash!=""){
window.location.href=hash;
}
if(_804){
_804.apply(this,[_806]);
}
};
if(args["forward"]){
args.forward=tfw;
}else{
if(args["forwardButton"]){
args.forwardButton=tfw;
}else{
if(args["handle"]){
args.handle=tfw;
}
}
}
}else{
if(dojo.render.html.moz){
if(!this.locationTimer){
this.locationTimer=setInterval("dojo.undo.browser.checkLocation();",200);
}
}
}
}else{
url=this._loadIframeHistory();
}
this.historyStack.push(this._createState(url,args,hash));
},checkLocation:function(){
if(!this.changingUrl){
var hsl=this.historyStack.length;
if((window.location.hash==this.initialHash||window.location.href==this.initialHref)&&(hsl==1)){
this.handleBackButton();
return;
}
if(this.forwardStack.length>0){
if(this.forwardStack[this.forwardStack.length-1].urlHash==window.location.hash){
this.handleForwardButton();
return;
}
}
if((hsl>=2)&&(this.historyStack[hsl-2])){
if(this.historyStack[hsl-2].urlHash==window.location.hash){
this.handleBackButton();
return;
}
}
}
},iframeLoaded:function(evt,_809){
if(!dojo.render.html.opera){
var _80a=this._getUrlQuery(_809.href);
if(_80a==null){
if(this.historyStack.length==1){
this.handleBackButton();
}
return;
}
if(this.moveForward){
this.moveForward=false;
return;
}
if(this.historyStack.length>=2&&_80a==this._getUrlQuery(this.historyStack[this.historyStack.length-2].url)){
this.handleBackButton();
}else{
if(this.forwardStack.length>0&&_80a==this._getUrlQuery(this.forwardStack[this.forwardStack.length-1].url)){
this.handleForwardButton();
}
}
}
},handleBackButton:function(){
var _80b=this.historyStack.pop();
if(!_80b){
return;
}
var last=this.historyStack[this.historyStack.length-1];
if(!last&&this.historyStack.length==0){
last=this.initialState;
}
if(last){
if(last.kwArgs["back"]){
last.kwArgs["back"]();
}else{
if(last.kwArgs["backButton"]){
last.kwArgs["backButton"]();
}else{
if(last.kwArgs["handle"]){
last.kwArgs.handle("back");
}
}
}
}
this.forwardStack.push(_80b);
},handleForwardButton:function(){
var last=this.forwardStack.pop();
if(!last){
return;
}
if(last.kwArgs["forward"]){
last.kwArgs.forward();
}else{
if(last.kwArgs["forwardButton"]){
last.kwArgs.forwardButton();
}else{
if(last.kwArgs["handle"]){
last.kwArgs.handle("forward");
}
}
}
this.historyStack.push(last);
},_createState:function(url,args,hash){
return {"url":url,"kwArgs":args,"urlHash":hash};
},_getUrlQuery:function(url){
var _812=url.split("?");
if(_812.length<2){
return null;
}else{
return _812[1];
}
},_loadIframeHistory:function(){
var url=(djConfig["dojoIframeHistoryUrl"]||dojo.hostenv.getBaseScriptUri()+"iframe_history.html")+"?"+(new Date()).getTime();
this.moveForward=true;
dojo.io.setIFrameSrc(this.historyIframe,url,false);
return url;
}};
dojo.provide("dojo.io.BrowserIO");
dojo.require("dojo.io.common");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.func");
dojo.require("dojo.string.extras");
dojo.require("dojo.dom");
dojo.require("dojo.undo.browser");
if(!dj_undef("window")){
dojo.io.checkChildrenForFile=function(node){
var _815=false;
var _816=node.getElementsByTagName("input");
dojo.lang.forEach(_816,function(_817){
if(_815){
return;
}
if(_817.getAttribute("type")=="file"){
_815=true;
}
});
return _815;
};
dojo.io.formHasFile=function(_818){
return dojo.io.checkChildrenForFile(_818);
};
dojo.io.updateNode=function(node,_81a){
node=dojo.byId(node);
var args=_81a;
if(dojo.lang.isString(_81a)){
args={url:_81a};
}
args.mimetype="text/html";
args.load=function(t,d,e){
while(node.firstChild){
dojo.dom.destroyNode(node.firstChild);
}
node.innerHTML=d;
};
dojo.io.bind(args);
};
dojo.io.formFilter=function(node){
var type=(node.type||"").toLowerCase();
return !node.disabled&&node.name&&!dojo.lang.inArray(["file","submit","image","reset","button"],type);
};
dojo.io.encodeForm=function(_821,_822,_823){
if((!_821)||(!_821.tagName)||(!_821.tagName.toLowerCase()=="form")){
dojo.raise("Attempted to encode a non-form element.");
}
if(!_823){
_823=dojo.io.formFilter;
}
var enc=/utf/i.test(_822||"")?encodeURIComponent:dojo.string.encodeAscii;
var _825=[];
for(var i=0;i<_821.elements.length;i++){
var elm=_821.elements[i];
if(!elm||elm.tagName.toLowerCase()=="fieldset"||!_823(elm)){
continue;
}
var name=enc(elm.name);
var type=elm.type.toLowerCase();
if(type=="select-multiple"){
for(var j=0;j<elm.options.length;j++){
if(elm.options[j].selected){
_825.push(name+"="+enc(elm.options[j].value));
}
}
}else{
if(dojo.lang.inArray(["radio","checkbox"],type)){
if(elm.checked){
_825.push(name+"="+enc(elm.value));
}
}else{
_825.push(name+"="+enc(elm.value));
}
}
}
var _82b=_821.getElementsByTagName("input");
for(var i=0;i<_82b.length;i++){
var _82c=_82b[i];
if(_82c.type.toLowerCase()=="image"&&_82c.form==_821&&_823(_82c)){
var name=enc(_82c.name);
_825.push(name+"="+enc(_82c.value));
_825.push(name+".x=0");
_825.push(name+".y=0");
}
}
return _825.join("&")+"&";
};
dojo.io.FormBind=function(args){
this.bindArgs={};
if(args&&args.formNode){
this.init(args);
}else{
if(args){
this.init({formNode:args});
}
}
};
dojo.lang.extend(dojo.io.FormBind,{form:null,bindArgs:null,clickedButton:null,init:function(args){
var form=dojo.byId(args.formNode);
if(!form||!form.tagName||form.tagName.toLowerCase()!="form"){
throw new Error("FormBind: Couldn't apply, invalid form");
}else{
if(this.form==form){
return;
}else{
if(this.form){
throw new Error("FormBind: Already applied to a form");
}
}
}
dojo.lang.mixin(this.bindArgs,args);
this.form=form;
this.connect(form,"onsubmit","submit");
for(var i=0;i<form.elements.length;i++){
var node=form.elements[i];
if(node&&node.type&&dojo.lang.inArray(["submit","button"],node.type.toLowerCase())){
this.connect(node,"onclick","click");
}
}
var _832=form.getElementsByTagName("input");
for(var i=0;i<_832.length;i++){
var _833=_832[i];
if(_833.type.toLowerCase()=="image"&&_833.form==form){
this.connect(_833,"onclick","click");
}
}
},onSubmit:function(form){
return true;
},submit:function(e){
e.preventDefault();
if(this.onSubmit(this.form)){
dojo.io.bind(dojo.lang.mixin(this.bindArgs,{formFilter:dojo.lang.hitch(this,"formFilter")}));
}
},click:function(e){
var node=e.currentTarget;
if(node.disabled){
return;
}
this.clickedButton=node;
},formFilter:function(node){
var type=(node.type||"").toLowerCase();
var _83a=false;
if(node.disabled||!node.name){
_83a=false;
}else{
if(dojo.lang.inArray(["submit","button","image"],type)){
if(!this.clickedButton){
this.clickedButton=node;
}
_83a=node==this.clickedButton;
}else{
_83a=!dojo.lang.inArray(["file","submit","reset","button"],type);
}
}
return _83a;
},connect:function(_83b,_83c,_83d){
if(dojo.evalObjPath("dojo.event.connect")){
dojo.event.connect(_83b,_83c,this,_83d);
}else{
var fcn=dojo.lang.hitch(this,_83d);
_83b[_83c]=function(e){
if(!e){
e=window.event;
}
if(!e.currentTarget){
e.currentTarget=e.srcElement;
}
if(!e.preventDefault){
e.preventDefault=function(){
window.event.returnValue=false;
};
}
fcn(e);
};
}
}});
dojo.io.XMLHTTPTransport=new function(){
var _840=this;
var _841={};
this.useCache=false;
this.preventCache=false;
function getCacheKey(url,_843,_844){
return url+"|"+_843+"|"+_844.toLowerCase();
}
function addToCache(url,_846,_847,http){
_841[getCacheKey(url,_846,_847)]=http;
}
function getFromCache(url,_84a,_84b){
return _841[getCacheKey(url,_84a,_84b)];
}
this.clearCache=function(){
_841={};
};
function doLoad(_84c,http,url,_84f,_850){
if(((http.status>=200)&&(http.status<300))||(http.status==304)||(http.status==1223)||(location.protocol=="file:"&&(http.status==0||http.status==undefined))||(location.protocol=="chrome:"&&(http.status==0||http.status==undefined))){
var ret;
if(_84c.method.toLowerCase()=="head"){
var _852=http.getAllResponseHeaders();
ret={};
ret.toString=function(){
return _852;
};
var _853=_852.split(/[\r\n]+/g);
for(var i=0;i<_853.length;i++){
var pair=_853[i].match(/^([^:]+)\s*:\s*(.+)$/i);
if(pair){
ret[pair[1]]=pair[2];
}
}
}else{
if(_84c.mimetype=="text/javascript"){
try{
ret=dj_eval(http.responseText);
}
catch(e){
dojo.debug(e);
dojo.debug(http.responseText);
ret=null;
}
}else{
if(_84c.mimetype.substr(0,9)=="text/json"||_84c.mimetype.substr(0,16)=="application/json"){
try{
ret=dj_eval("("+_84c.jsonFilter(http.responseText)+")");
}
catch(e){
dojo.debug(e);
dojo.debug(http.responseText);
ret=false;
}
}else{
if((_84c.mimetype=="application/xml")||(_84c.mimetype=="text/xml")){
ret=http.responseXML;
if(!ret||typeof ret=="string"||!http.getResponseHeader("Content-Type")){
ret=dojo.dom.createDocumentFromText(http.responseText);
}
}else{
ret=http.responseText;
}
}
}
}
if(_850){
addToCache(url,_84f,_84c.method,http);
}
_84c[(typeof _84c.load=="function")?"load":"handle"]("load",ret,http,_84c);
}else{
var _856=new dojo.io.Error("XMLHttpTransport Error: "+http.status+" "+http.statusText);
_84c[(typeof _84c.error=="function")?"error":"handle"]("error",_856,http,_84c);
}
}
function setHeaders(http,_858){
if(_858["headers"]){
for(var _859 in _858["headers"]){
if(_859.toLowerCase()=="content-type"&&!_858["contentType"]){
_858["contentType"]=_858["headers"][_859];
}else{
http.setRequestHeader(_859,_858["headers"][_859]);
}
}
}
}
this.inFlight=[];
this.inFlightTimer=null;
this.startWatchingInFlight=function(){
if(!this.inFlightTimer){
this.inFlightTimer=setTimeout("dojo.io.XMLHTTPTransport.watchInFlight();",10);
}
};
this.watchInFlight=function(){
var now=null;
if(!dojo.hostenv._blockAsync&&!_840._blockAsync){
for(var x=this.inFlight.length-1;x>=0;x--){
try{
var tif=this.inFlight[x];
if(!tif||tif.http._aborted||!tif.http.readyState){
this.inFlight.splice(x,1);
continue;
}
if(4==tif.http.readyState){
this.inFlight.splice(x,1);
doLoad(tif.req,tif.http,tif.url,tif.query,tif.useCache);
}else{
if(tif.startTime){
if(!now){
now=(new Date()).getTime();
}
if(tif.startTime+(tif.req.timeoutSeconds*1000)<now){
if(typeof tif.http.abort=="function"){
tif.http.abort();
}
this.inFlight.splice(x,1);
tif.req[(typeof tif.req.timeout=="function")?"timeout":"handle"]("timeout",null,tif.http,tif.req);
}
}
}
}
catch(e){
try{
var _85d=new dojo.io.Error("XMLHttpTransport.watchInFlight Error: "+e);
tif.req[(typeof tif.req.error=="function")?"error":"handle"]("error",_85d,tif.http,tif.req);
}
catch(e2){
dojo.debug("XMLHttpTransport error callback failed: "+e2);
}
}
}
}
clearTimeout(this.inFlightTimer);
if(this.inFlight.length==0){
this.inFlightTimer=null;
return;
}
this.inFlightTimer=setTimeout("dojo.io.XMLHTTPTransport.watchInFlight();",10);
};
var _85e=dojo.hostenv.getXmlhttpObject()?true:false;
this.canHandle=function(_85f){
var mlc=_85f["mimetype"].toLowerCase()||"";
return _85e&&((dojo.lang.inArray(["text/plain","text/html","application/xml","text/xml","text/javascript"],mlc))||(mlc.substr(0,9)=="text/json"||mlc.substr(0,16)=="application/json"))&&!(_85f["formNode"]&&dojo.io.formHasFile(_85f["formNode"]));
};
this.multipartBoundary="45309FFF-BD65-4d50-99C9-36986896A96F";
this.bind=function(_861){
if(!_861["url"]){
if(!_861["formNode"]&&(_861["backButton"]||_861["back"]||_861["changeUrl"]||_861["watchForURL"])&&(!djConfig.preventBackButtonFix)){
dojo.deprecated("Using dojo.io.XMLHTTPTransport.bind() to add to browser history without doing an IO request","Use dojo.undo.browser.addToHistory() instead.","0.4");
dojo.undo.browser.addToHistory(_861);
return true;
}
}
var url=_861.url;
var _863="";
if(_861["formNode"]){
var ta=_861.formNode.getAttribute("action");
if((ta)&&(!_861["url"])){
url=ta;
}
var tp=_861.formNode.getAttribute("method");
if((tp)&&(!_861["method"])){
_861.method=tp;
}
_863+=dojo.io.encodeForm(_861.formNode,_861.encoding,_861["formFilter"]);
}
if(url.indexOf("#")>-1){
dojo.debug("Warning: dojo.io.bind: stripping hash values from url:",url);
url=url.split("#")[0];
}
if(_861["file"]){
_861.method="post";
}
if(!_861["method"]){
_861.method="get";
}
if(_861.method.toLowerCase()=="get"){
_861.multipart=false;
}else{
if(_861["file"]){
_861.multipart=true;
}else{
if(!_861["multipart"]){
_861.multipart=false;
}
}
}
if(_861["backButton"]||_861["back"]||_861["changeUrl"]){
dojo.undo.browser.addToHistory(_861);
}
var _866=_861["content"]||{};
if(_861.sendTransport){
_866["dojo.transport"]="xmlhttp";
}
do{
if(_861.postContent){
_863=_861.postContent;
break;
}
if(_866){
_863+=dojo.io.argsFromMap(_866,_861.encoding);
}
if(_861.method.toLowerCase()=="get"||!_861.multipart){
break;
}
var t=[];
if(_863.length){
var q=_863.split("&");
for(var i=0;i<q.length;++i){
if(q[i].length){
var p=q[i].split("=");
t.push("--"+this.multipartBoundary,"Content-Disposition: form-data; name=\""+p[0]+"\"","",p[1]);
}
}
}
if(_861.file){
if(dojo.lang.isArray(_861.file)){
for(var i=0;i<_861.file.length;++i){
var o=_861.file[i];
t.push("--"+this.multipartBoundary,"Content-Disposition: form-data; name=\""+o.name+"\"; filename=\""+("fileName" in o?o.fileName:o.name)+"\"","Content-Type: "+("contentType" in o?o.contentType:"application/octet-stream"),"",o.content);
}
}else{
var o=_861.file;
t.push("--"+this.multipartBoundary,"Content-Disposition: form-data; name=\""+o.name+"\"; filename=\""+("fileName" in o?o.fileName:o.name)+"\"","Content-Type: "+("contentType" in o?o.contentType:"application/octet-stream"),"",o.content);
}
}
if(t.length){
t.push("--"+this.multipartBoundary+"--","");
_863=t.join("\r\n");
}
}while(false);
var _86c=_861["sync"]?false:true;
var _86d=_861["preventCache"]||(this.preventCache==true&&_861["preventCache"]!=false);
var _86e=_861["useCache"]==true||(this.useCache==true&&_861["useCache"]!=false);
if(!_86d&&_86e){
var _86f=getFromCache(url,_863,_861.method);
if(_86f){
doLoad(_861,_86f,url,_863,false);
return;
}
}
var http=dojo.hostenv.getXmlhttpObject(_861);
var _871=false;
if(_86c){
var _872=this.inFlight.push({"req":_861,"http":http,"url":url,"query":_863,"useCache":_86e,"startTime":_861.timeoutSeconds?(new Date()).getTime():0});
this.startWatchingInFlight();
}else{
_840._blockAsync=true;
}
if(_861.method.toLowerCase()=="post"){
if(!_861.user){
http.open("POST",url,_86c);
}else{
http.open("POST",url,_86c,_861.user,_861.password);
}
setHeaders(http,_861);
http.setRequestHeader("Content-Type",_861.multipart?("multipart/form-data; boundary="+this.multipartBoundary):(_861.contentType?_861.contentType:"application/x-www-form-urlencoded"));
try{
http.send(_863);
}
catch(e){
if(typeof http.abort=="function"){
http.abort();
}
doLoad(_861,{status:404},url,_863,_86e);
}
}else{
var _873=url;
if(_863!=""){
_873+=(_873.indexOf("?")>-1?"&":"?")+_863;
}
if(_86d){
_873+=(dojo.string.endsWithAny(_873,"?","&")?"":(_873.indexOf("?")>-1?"&":"?"))+"dojo.preventCache="+new Date().valueOf();
}
if(!_861.user){
http.open(_861.method.toUpperCase(),_873,_86c);
}else{
http.open(_861.method.toUpperCase(),_873,_86c,_861.user,_861.password);
}
setHeaders(http,_861);
try{
http.send(null);
}
catch(e){
if(typeof http.abort=="function"){
http.abort();
}
doLoad(_861,{status:404},url,_863,_86e);
}
}
if(!_86c){
doLoad(_861,http,url,_863,_86e);
_840._blockAsync=false;
}
_861.abort=function(){
try{
http._aborted=true;
}
catch(e){
}
return http.abort();
};
return;
};
dojo.io.transports.addTransport("XMLHTTPTransport");
};
}
dojo.provide("dojo.io.cookie");
dojo.io.cookie.setCookie=function(name,_875,days,path,_878,_879){
var _87a=-1;
if((typeof days=="number")&&(days>=0)){
var d=new Date();
d.setTime(d.getTime()+(days*24*60*60*1000));
_87a=d.toGMTString();
}
_875=escape(_875);
document.cookie=name+"="+_875+";"+(_87a!=-1?" expires="+_87a+";":"")+(path?"path="+path:"")+(_878?"; domain="+_878:"")+(_879?"; secure":"");
};
dojo.io.cookie.set=dojo.io.cookie.setCookie;
dojo.io.cookie.getCookie=function(name){
var idx=document.cookie.lastIndexOf(name+"=");
if(idx==-1){
return null;
}
var _87e=document.cookie.substring(idx+name.length+1);
var end=_87e.indexOf(";");
if(end==-1){
end=_87e.length;
}
_87e=_87e.substring(0,end);
_87e=unescape(_87e);
return _87e;
};
dojo.io.cookie.get=dojo.io.cookie.getCookie;
dojo.io.cookie.deleteCookie=function(name){
dojo.io.cookie.setCookie(name,"-",0);
};
dojo.io.cookie.setObjectCookie=function(name,obj,days,path,_885,_886,_887){
if(arguments.length==5){
_887=_885;
_885=null;
_886=null;
}
var _888=[],_889,_88a="";
if(!_887){
_889=dojo.io.cookie.getObjectCookie(name);
}
if(days>=0){
if(!_889){
_889={};
}
for(var prop in obj){
if(obj[prop]==null){
delete _889[prop];
}else{
if((typeof obj[prop]=="string")||(typeof obj[prop]=="number")){
_889[prop]=obj[prop];
}
}
}
prop=null;
for(var prop in _889){
_888.push(escape(prop)+"="+escape(_889[prop]));
}
_88a=_888.join("&");
}
dojo.io.cookie.setCookie(name,_88a,days,path,_885,_886);
};
dojo.io.cookie.getObjectCookie=function(name){
var _88d=null,_88e=dojo.io.cookie.getCookie(name);
if(_88e){
_88d={};
var _88f=_88e.split("&");
for(var i=0;i<_88f.length;i++){
var pair=_88f[i].split("=");
var _892=pair[1];
if(isNaN(_892)){
_892=unescape(pair[1]);
}
_88d[unescape(pair[0])]=_892;
}
}
return _88d;
};
dojo.io.cookie.isSupported=function(){
if(typeof navigator.cookieEnabled!="boolean"){
dojo.io.cookie.setCookie("__TestingYourBrowserForCookieSupport__","CookiesAllowed",90,null);
var _893=dojo.io.cookie.getCookie("__TestingYourBrowserForCookieSupport__");
navigator.cookieEnabled=(_893=="CookiesAllowed");
if(navigator.cookieEnabled){
this.deleteCookie("__TestingYourBrowserForCookieSupport__");
}
}
return navigator.cookieEnabled;
};
if(!dojo.io.cookies){
dojo.io.cookies=dojo.io.cookie;
}
dojo.kwCompoundRequire({common:["dojo.io.common"],rhino:["dojo.io.RhinoIO"],browser:["dojo.io.BrowserIO","dojo.io.cookie"],dashboard:["dojo.io.BrowserIO","dojo.io.cookie"]});
dojo.provide("dojo.io.*");
dojo.provide("dojo.logging.Logger");
dojo.provide("dojo.logging.LogFilter");
dojo.provide("dojo.logging.Record");
dojo.provide("dojo.log");
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.declare");
dojo.logging.Record=function(_894,_895){
this.level=_894;
this.message="";
this.msgArgs=[];
this.time=new Date();
if(dojo.lang.isArray(_895)){
if(_895.length>0&&dojo.lang.isString(_895[0])){
this.message=_895.shift();
}
this.msgArgs=_895;
}else{
this.message=_895;
}
};
dojo.logging.LogFilter=function(_896){
this.passChain=_896||"";
this.filter=function(_897){
return true;
};
};
dojo.logging.Logger=function(){
this.cutOffLevel=0;
this.propagate=true;
this.parent=null;
this.data=[];
this.filters=[];
this.handlers=[];
};
dojo.extend(dojo.logging.Logger,{_argsToArr:function(args){
var ret=[];
for(var x=0;x<args.length;x++){
ret.push(args[x]);
}
return ret;
},setLevel:function(lvl){
this.cutOffLevel=parseInt(lvl);
},isEnabledFor:function(lvl){
return parseInt(lvl)>=this.cutOffLevel;
},getEffectiveLevel:function(){
if((this.cutOffLevel==0)&&(this.parent)){
return this.parent.getEffectiveLevel();
}
return this.cutOffLevel;
},addFilter:function(flt){
this.filters.push(flt);
return this.filters.length-1;
},removeFilterByIndex:function(_89e){
if(this.filters[_89e]){
delete this.filters[_89e];
return true;
}
return false;
},removeFilter:function(_89f){
for(var x=0;x<this.filters.length;x++){
if(this.filters[x]===_89f){
delete this.filters[x];
return true;
}
}
return false;
},removeAllFilters:function(){
this.filters=[];
},filter:function(rec){
for(var x=0;x<this.filters.length;x++){
if((this.filters[x]["filter"])&&(!this.filters[x].filter(rec))||(rec.level<this.cutOffLevel)){
return false;
}
}
return true;
},addHandler:function(hdlr){
this.handlers.push(hdlr);
return this.handlers.length-1;
},handle:function(rec){
if((!this.filter(rec))||(rec.level<this.cutOffLevel)){
return false;
}
for(var x=0;x<this.handlers.length;x++){
if(this.handlers[x]["handle"]){
this.handlers[x].handle(rec);
}
}
return true;
},log:function(lvl,msg){
if((this.propagate)&&(this.parent)&&(this.parent.rec.level>=this.cutOffLevel)){
this.parent.log(lvl,msg);
return false;
}
this.handle(new dojo.logging.Record(lvl,msg));
return true;
},debug:function(msg){
return this.logType("DEBUG",this._argsToArr(arguments));
},info:function(msg){
return this.logType("INFO",this._argsToArr(arguments));
},warning:function(msg){
return this.logType("WARNING",this._argsToArr(arguments));
},error:function(msg){
return this.logType("ERROR",this._argsToArr(arguments));
},critical:function(msg){
return this.logType("CRITICAL",this._argsToArr(arguments));
},exception:function(msg,e,_8af){
if(e){
var _8b0=[e.name,(e.description||e.message)];
if(e.fileName){
_8b0.push(e.fileName);
_8b0.push("line "+e.lineNumber);
}
msg+=" "+_8b0.join(" : ");
}
this.logType("ERROR",msg);
if(!_8af){
throw e;
}
},logType:function(type,args){
return this.log.apply(this,[dojo.logging.log.getLevel(type),args]);
},warn:function(){
this.warning.apply(this,arguments);
},err:function(){
this.error.apply(this,arguments);
},crit:function(){
this.critical.apply(this,arguments);
}});
dojo.logging.LogHandler=function(_8b3){
this.cutOffLevel=(_8b3)?_8b3:0;
this.formatter=null;
this.data=[];
this.filters=[];
};
dojo.lang.extend(dojo.logging.LogHandler,{setFormatter:function(_8b4){
dojo.unimplemented("setFormatter");
},flush:function(){
},close:function(){
},handleError:function(){
dojo.deprecated("dojo.logging.LogHandler.handleError","use handle()","0.6");
},handle:function(_8b5){
if((this.filter(_8b5))&&(_8b5.level>=this.cutOffLevel)){
this.emit(_8b5);
}
},emit:function(_8b6){
dojo.unimplemented("emit");
}});
void (function(){
var _8b7=["setLevel","addFilter","removeFilterByIndex","removeFilter","removeAllFilters","filter"];
var tgt=dojo.logging.LogHandler.prototype;
var src=dojo.logging.Logger.prototype;
for(var x=0;x<_8b7.length;x++){
tgt[_8b7[x]]=src[_8b7[x]];
}
})();
dojo.logging.log=new dojo.logging.Logger();
dojo.logging.log.levels=[{"name":"DEBUG","level":1},{"name":"INFO","level":2},{"name":"WARNING","level":3},{"name":"ERROR","level":4},{"name":"CRITICAL","level":5}];
dojo.logging.log.loggers={};
dojo.logging.log.getLogger=function(name){
if(!this.loggers[name]){
this.loggers[name]=new dojo.logging.Logger();
this.loggers[name].parent=this;
}
return this.loggers[name];
};
dojo.logging.log.getLevelName=function(lvl){
for(var x=0;x<this.levels.length;x++){
if(this.levels[x].level==lvl){
return this.levels[x].name;
}
}
return null;
};
dojo.logging.log.getLevel=function(name){
for(var x=0;x<this.levels.length;x++){
if(this.levels[x].name.toUpperCase()==name.toUpperCase()){
return this.levels[x].level;
}
}
return null;
};
dojo.declare("dojo.logging.MemoryLogHandler",dojo.logging.LogHandler,{initializer:function(_8c0,_8c1,_8c2,_8c3){
dojo.logging.LogHandler.call(this,_8c0);
this.numRecords=(typeof djConfig["loggingNumRecords"]!="undefined")?djConfig["loggingNumRecords"]:((_8c1)?_8c1:-1);
this.postType=(typeof djConfig["loggingPostType"]!="undefined")?djConfig["loggingPostType"]:(_8c2||-1);
this.postInterval=(typeof djConfig["loggingPostInterval"]!="undefined")?djConfig["loggingPostInterval"]:(_8c2||-1);
},emit:function(_8c4){
if(!djConfig.isDebug){
return;
}
var _8c5=String(dojo.log.getLevelName(_8c4.level)+": "+_8c4.time.toLocaleTimeString())+": "+_8c4.message;
if(!dj_undef("println",dojo.hostenv)){
dojo.hostenv.println(_8c5,_8c4.msgArgs);
}
this.data.push(_8c4);
if(this.numRecords!=-1){
while(this.data.length>this.numRecords){
this.data.shift();
}
}
}});
dojo.logging.logQueueHandler=new dojo.logging.MemoryLogHandler(0,50,0,10000);
dojo.logging.log.addHandler(dojo.logging.logQueueHandler);
dojo.log=dojo.logging.log;
dojo.provide("dojo.logging.ConsoleLogger");
dojo.require("dojo.logging.Logger");
dojo.lang.extend(dojo.logging.MemoryLogHandler,{debug:function(){
dojo.hostenv.println.apply(this,arguments);
},info:function(){
dojo.hostenv.println.apply(this,arguments);
},warn:function(){
dojo.hostenv.println.apply(this,arguments);
},error:function(){
dojo.hostenv.println.apply(this,arguments);
},critical:function(){
dojo.hostenv.println.apply(this,arguments);
},emit:function(_8c6){
if(!djConfig.isDebug){
return;
}
var _8c7=null;
switch(_8c6.level){
case 1:
_8c7="debug";
break;
case 2:
_8c7="info";
break;
case 3:
_8c7="warn";
break;
case 4:
_8c7="error";
break;
case 5:
_8c7="critical";
break;
default:
_8c7="debug";
}
var _8c8=String(dojo.log.getLevelName(_8c6.level)+": "+_8c6.time.toLocaleTimeString())+": "+_8c6.message;
if(_8c6.msgArgs&&_8c6.msgArgs.length>0){
this[_8c7].call(this,_8c8,_8c6.msgArgs);
}else{
this[_8c7].call(this,_8c8);
}
this.data.push(_8c6);
if(this.numRecords!=-1){
while(this.data.length>this.numRecords){
this.data.shift();
}
}
}});
if(!dj_undef("console")&&!dj_undef("info",console)){
dojo.lang.extend(dojo.logging.MemoryLogHandler,{debug:function(){
console.debug.apply(this,arguments);
},info:function(){
console.info.apply(this,arguments);
},warn:function(){
console.warn.apply(this,arguments);
},error:function(){
console.error.apply(this,arguments);
},critical:function(){
console.error.apply(this,arguments);
}});
dojo.lang.extend(dojo.logging.Logger,{exception:function(msg,e,_8cb){
var args=[msg];
if(e){
msg+=" : "+e.name+" "+(e.description||e.message);
args.push(e);
}
this.logType("ERROR",args);
if(!_8cb){
throw e;
}
}});
}
dojo.provide("dojo.debug.console");
dojo.require("dojo.logging.ConsoleLogger");
if(window.console){
if(console.info!=null){
dojo.hostenv.println=function(){
if(!djConfig.isDebug){
return;
}
console.info.apply(console,arguments);
};
dojo.debug=dojo.hostenv.println;
dojo.debugDeep=dojo.debug;
dojo.debugShallow=function(obj,_8ce,sort){
if(!djConfig.isDebug){
return;
}
_8ce=(_8ce!=false);
sort=(sort!=false);
if(obj==null||obj.constructor==null){
return dojo.debug(obj);
}
var type=obj.declaredClass;
if(type==null){
type=obj.constructor.toString().match(/function\s*(.*)\(/);
if(type){
type=type[1];
}
}
if(type){
if(type=="String"||type=="Number"){
return dojo.debug(type+": ",obj);
}
if(_8ce&&!sort){
var _8d1=obj;
}else{
var _8d2=[];
if(_8ce){
for(var prop in obj){
_8d2.push(prop);
}
}else{
for(var prop in obj){
if(typeof obj[prop]!="function"){
_8d2.push(prop);
}else{
dojo.debug(prop);
}
}
}
if(sort){
_8d2.sort();
}
var _8d1={};
dojo.lang.forEach(_8d2,function(prop){
_8d1[prop]=obj[prop];
});
}
return dojo.debug(type+": %o\n%2.o",obj,_8d1);
}
return dojo.debug(obj.constructor+": ",obj);
};
}else{
if(console.log!=null){
dojo.hostenv.println=function(){
if(!djConfig.isDebug){
return;
}
var args=dojo.lang.toArray(arguments);
console.log("DEBUG: "+args.join(" "));
};
dojo.debug=dojo.hostenv.println;
}else{
dojo.debug("dojo.debug.console requires Firebug > 0.4");
}
}
}else{
if(dojo.render.html.opera){
if(opera&&opera.postError){
dojo.hostenv.println=opera.postError;
}else{
dojo.debug("dojo.debug.Opera requires Opera > 8.0");
}
}
}
dojo.kwCompoundRequire({common:["dojo.html.common","dojo.html.style"]});
dojo.provide("dojo.html.*");
dojo.provide("dojo.lang.type");
dojo.require("dojo.lang.common");
dojo.lang.whatAmI=function(_8d6){
dojo.deprecated("dojo.lang.whatAmI","use dojo.lang.getType instead","0.5");
return dojo.lang.getType(_8d6);
};
dojo.lang.whatAmI.custom={};
dojo.lang.getType=function(_8d7){
try{
if(dojo.lang.isArray(_8d7)){
return "array";
}
if(dojo.lang.isFunction(_8d7)){
return "function";
}
if(dojo.lang.isString(_8d7)){
return "string";
}
if(dojo.lang.isNumber(_8d7)){
return "number";
}
if(dojo.lang.isBoolean(_8d7)){
return "boolean";
}
if(dojo.lang.isAlien(_8d7)){
return "alien";
}
if(dojo.lang.isUndefined(_8d7)){
return "undefined";
}
for(var name in dojo.lang.whatAmI.custom){
if(dojo.lang.whatAmI.custom[name](_8d7)){
return name;
}
}
if(dojo.lang.isObject(_8d7)){
return "object";
}
}
catch(e){
}
return "unknown";
};
dojo.lang.isNumeric=function(_8d9){
return (!isNaN(_8d9)&&isFinite(_8d9)&&(_8d9!=null)&&!dojo.lang.isBoolean(_8d9)&&!dojo.lang.isArray(_8d9)&&!/^\s*$/.test(_8d9));
};
dojo.lang.isBuiltIn=function(_8da){
return (dojo.lang.isArray(_8da)||dojo.lang.isFunction(_8da)||dojo.lang.isString(_8da)||dojo.lang.isNumber(_8da)||dojo.lang.isBoolean(_8da)||(_8da==null)||(_8da instanceof Error)||(typeof _8da=="error"));
};
dojo.lang.isPureObject=function(_8db){
return ((_8db!=null)&&dojo.lang.isObject(_8db)&&_8db.constructor==Object);
};
dojo.lang.isOfType=function(_8dc,type,_8de){
var _8df=false;
if(_8de){
_8df=_8de["optional"];
}
if(_8df&&((_8dc===null)||dojo.lang.isUndefined(_8dc))){
return true;
}
if(dojo.lang.isArray(type)){
var _8e0=type;
for(var i in _8e0){
var _8e2=_8e0[i];
if(dojo.lang.isOfType(_8dc,_8e2)){
return true;
}
}
return false;
}else{
if(dojo.lang.isString(type)){
type=type.toLowerCase();
}
switch(type){
case Array:
case "array":
return dojo.lang.isArray(_8dc);
case Function:
case "function":
return dojo.lang.isFunction(_8dc);
case String:
case "string":
return dojo.lang.isString(_8dc);
case Number:
case "number":
return dojo.lang.isNumber(_8dc);
case "numeric":
return dojo.lang.isNumeric(_8dc);
case Boolean:
case "boolean":
return dojo.lang.isBoolean(_8dc);
case Object:
case "object":
return dojo.lang.isObject(_8dc);
case "pureobject":
return dojo.lang.isPureObject(_8dc);
case "builtin":
return dojo.lang.isBuiltIn(_8dc);
case "alien":
return dojo.lang.isAlien(_8dc);
case "undefined":
return dojo.lang.isUndefined(_8dc);
case null:
case "null":
return (_8dc===null);
case "optional":
dojo.deprecated("dojo.lang.isOfType(value, [type, \"optional\"])","use dojo.lang.isOfType(value, type, {optional: true} ) instead","0.5");
return ((_8dc===null)||dojo.lang.isUndefined(_8dc));
default:
if(dojo.lang.isFunction(type)){
return (_8dc instanceof type);
}else{
dojo.raise("dojo.lang.isOfType() was passed an invalid type");
}
}
}
dojo.raise("If we get here, it means a bug was introduced above.");
};
dojo.lang.getObject=function(str){
var _8e4=str.split("."),i=0,obj=dj_global;
do{
obj=obj[_8e4[i++]];
}while(i<_8e4.length&&obj);
return (obj!=dj_global)?obj:null;
};
dojo.lang.doesObjectExist=function(str){
var _8e8=str.split("."),i=0,obj=dj_global;
do{
obj=obj[_8e8[i++]];
}while(i<_8e8.length&&obj);
return (obj&&obj!=dj_global);
};
dojo.provide("dojo.lang.assert");
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.type");
dojo.lang.assert=function(_8eb,_8ec){
if(!_8eb){
var _8ed="An assert statement failed.\n"+"The method dojo.lang.assert() was called with a 'false' value.\n";
if(_8ec){
_8ed+="Here's the assert message:\n"+_8ec+"\n";
}
throw new Error(_8ed);
}
};
dojo.lang.assertType=function(_8ee,type,_8f0){
if(dojo.lang.isString(_8f0)){
dojo.deprecated("dojo.lang.assertType(value, type, \"message\")","use dojo.lang.assertType(value, type) instead","0.5");
}
if(!dojo.lang.isOfType(_8ee,type,_8f0)){
if(!dojo.lang.assertType._errorMessage){
dojo.lang.assertType._errorMessage="Type mismatch: dojo.lang.assertType() failed.";
}
dojo.lang.assert(false,dojo.lang.assertType._errorMessage);
}
};
dojo.lang.assertValidKeywords=function(_8f1,_8f2,_8f3){
var key;
if(!_8f3){
if(!dojo.lang.assertValidKeywords._errorMessage){
dojo.lang.assertValidKeywords._errorMessage="In dojo.lang.assertValidKeywords(), found invalid keyword:";
}
_8f3=dojo.lang.assertValidKeywords._errorMessage;
}
if(dojo.lang.isArray(_8f2)){
for(key in _8f1){
if(!dojo.lang.inArray(_8f2,key)){
dojo.lang.assert(false,_8f3+" "+key);
}
}
}else{
for(key in _8f1){
if(!(key in _8f2)){
dojo.lang.assert(false,_8f3+" "+key);
}
}
}
};
dojo.provide("dojo.AdapterRegistry");
dojo.require("dojo.lang.func");
dojo.AdapterRegistry=function(_8f5){
this.pairs=[];
this.returnWrappers=_8f5||false;
};
dojo.lang.extend(dojo.AdapterRegistry,{register:function(name,_8f7,wrap,_8f9,_8fa){
var type=(_8fa)?"unshift":"push";
this.pairs[type]([name,_8f7,wrap,_8f9]);
},match:function(){
for(var i=0;i<this.pairs.length;i++){
var pair=this.pairs[i];
if(pair[1].apply(this,arguments)){
if((pair[3])||(this.returnWrappers)){
return pair[2];
}else{
return pair[2].apply(this,arguments);
}
}
}
throw new Error("No match found");
},unregister:function(name){
for(var i=0;i<this.pairs.length;i++){
var pair=this.pairs[i];
if(pair[0]==name){
this.pairs.splice(i,1);
return true;
}
}
return false;
}});
dojo.provide("dojo.lang.repr");
dojo.require("dojo.lang.common");
dojo.require("dojo.AdapterRegistry");
dojo.require("dojo.string.extras");
dojo.lang.reprRegistry=new dojo.AdapterRegistry();
dojo.lang.registerRepr=function(name,_902,wrap,_904){
dojo.lang.reprRegistry.register(name,_902,wrap,_904);
};
dojo.lang.repr=function(obj){
if(typeof (obj)=="undefined"){
return "undefined";
}else{
if(obj===null){
return "null";
}
}
try{
if(typeof (obj["__repr__"])=="function"){
return obj["__repr__"]();
}else{
if((typeof (obj["repr"])=="function")&&(obj.repr!=arguments.callee)){
return obj["repr"]();
}
}
return dojo.lang.reprRegistry.match(obj);
}
catch(e){
if(typeof (obj.NAME)=="string"&&(obj.toString==Function.prototype.toString||obj.toString==Object.prototype.toString)){
return obj.NAME;
}
}
if(typeof (obj)=="function"){
obj=(obj+"").replace(/^\s+/,"");
var idx=obj.indexOf("{");
if(idx!=-1){
obj=obj.substr(0,idx)+"{...}";
}
}
return obj+"";
};
dojo.lang.reprArrayLike=function(arr){
try{
var na=dojo.lang.map(arr,dojo.lang.repr);
return "["+na.join(", ")+"]";
}
catch(e){
}
};
(function(){
var m=dojo.lang;
m.registerRepr("arrayLike",m.isArrayLike,m.reprArrayLike);
m.registerRepr("string",m.isString,m.reprString);
m.registerRepr("numbers",m.isNumber,m.reprNumber);
m.registerRepr("boolean",m.isBoolean,m.reprNumber);
})();
dojo.kwCompoundRequire({common:["dojo.lang.common","dojo.lang.assert","dojo.lang.array","dojo.lang.type","dojo.lang.func","dojo.lang.extras","dojo.lang.repr","dojo.lang.declare"]});
dojo.provide("dojo.lang.*");
dojo.provide("qu.Global");
dojo.require("dojo.lang.*");
dojo.lang.declare("qu.Global",null,{instanceName:"qu.global",invoke:function(_90a,_90b){
if(typeof (_90a)=="object"){
if(typeof (_90a[_90b])=="function"){
try{
return _90a[_90b]();
}
catch(inException){
dojo.debug("Invoke Error: "+inException.message);
return false;
}
}
}
},icon:function(_90c,_90d){
if(_90d===null){
return app.config.pathIcons+_90c;
}else{
return app.config.pathIcons+"/"+_90d+"/"+_90c;
}
},createElement:function(_90e){
var _90f=document.createElement(_90e);
return _90f;
if(typeof document.createElementNS!="undefined"){
return document.createElementNS("http://www.w3.org/1999/xhtml",_90e);
}
if(typeof document.createElement!="undefined"){
return document.createElement(_90e);
}
return false;
},getCookie:function(_910){
var _911=document.cookie.split("; ");
for(var i=0;i<_911.length;i++){
var c=_911[i];
var pos=c.indexOf("=");
var n=c.substring(0,pos);
if(n==_910){
return c.substring(pos+1);
}
}
return null;
},deleteCookie:function(_916){
if(this.getCookie(_916)){
document.cookie=_916+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT";
}
},setCookie:function(_917,_918){
document.cookie=_917+"="+_918;
}});
qu.global=new qu.Global();
dojo.provide("qu.core.SuperObject");
dojo.lang.declare("qu.core.SuperObject",null,{someProperty:null});
dojo.provide("dojo.json");
dojo.require("dojo.lang.func");
dojo.require("dojo.string.extras");
dojo.require("dojo.AdapterRegistry");
dojo.json={jsonRegistry:new dojo.AdapterRegistry(),register:function(name,_91a,wrap,_91c){
dojo.json.jsonRegistry.register(name,_91a,wrap,_91c);
},evalJson:function(json){
try{
return eval("("+json+")");
}
catch(e){
dojo.debug(e);
return json;
}
},serialize:function(o){
var _91f=typeof (o);
if(_91f=="undefined"){
return "undefined";
}else{
if((_91f=="number")||(_91f=="boolean")){
return o+"";
}else{
if(o===null){
return "null";
}
}
}
if(_91f=="string"){
return dojo.string.escapeString(o);
}
var me=arguments.callee;
var _921;
if(typeof (o.__json__)=="function"){
_921=o.__json__();
if(o!==_921){
return me(_921);
}
}
if(typeof (o.json)=="function"){
_921=o.json();
if(o!==_921){
return me(_921);
}
}
if(_91f!="function"&&typeof (o.length)=="number"){
var res=[];
for(var i=0;i<o.length;i++){
var val=me(o[i]);
if(typeof (val)!="string"){
val="undefined";
}
res.push(val);
}
return "["+res.join(",")+"]";
}
try{
window.o=o;
_921=dojo.json.jsonRegistry.match(o);
return me(_921);
}
catch(e){
}
if(_91f=="function"){
return null;
}
res=[];
for(var k in o){
var _926;
if(typeof (k)=="number"){
_926="\""+k+"\"";
}else{
if(typeof (k)=="string"){
_926=dojo.string.escapeString(k);
}else{
continue;
}
}
val=me(o[k]);
if(typeof (val)!="string"){
continue;
}
res.push(_926+":"+val);
}
return "{"+res.join(",")+"}";
}};
dojo.provide("dojo.Deferred");
dojo.require("dojo.lang.func");
dojo.Deferred=function(_927){
this.chain=[];
this.id=this._nextId();
this.fired=-1;
this.paused=0;
this.results=[null,null];
this.canceller=_927;
this.silentlyCancelled=false;
};
dojo.lang.extend(dojo.Deferred,{getFunctionFromArgs:function(){
var a=arguments;
if((a[0])&&(!a[1])){
if(dojo.lang.isFunction(a[0])){
return a[0];
}else{
if(dojo.lang.isString(a[0])){
return dj_global[a[0]];
}
}
}else{
if((a[0])&&(a[1])){
return dojo.lang.hitch(a[0],a[1]);
}
}
return null;
},makeCalled:function(){
var _929=new dojo.Deferred();
_929.callback();
return _929;
},repr:function(){
var _92a;
if(this.fired==-1){
_92a="unfired";
}else{
if(this.fired==0){
_92a="success";
}else{
_92a="error";
}
}
return "Deferred("+this.id+", "+_92a+")";
},toString:dojo.lang.forward("repr"),_nextId:(function(){
var n=1;
return function(){
return n++;
};
})(),cancel:function(){
if(this.fired==-1){
if(this.canceller){
this.canceller(this);
}else{
this.silentlyCancelled=true;
}
if(this.fired==-1){
this.errback(new Error(this.repr()));
}
}else{
if((this.fired==0)&&(this.results[0] instanceof dojo.Deferred)){
this.results[0].cancel();
}
}
},_pause:function(){
this.paused++;
},_unpause:function(){
this.paused--;
if((this.paused==0)&&(this.fired>=0)){
this._fire();
}
},_continue:function(res){
this._resback(res);
this._unpause();
},_resback:function(res){
this.fired=((res instanceof Error)?1:0);
this.results[this.fired]=res;
this._fire();
},_check:function(){
if(this.fired!=-1){
if(!this.silentlyCancelled){
dojo.raise("already called!");
}
this.silentlyCancelled=false;
return;
}
},callback:function(res){
this._check();
this._resback(res);
},errback:function(res){
this._check();
if(!(res instanceof Error)){
res=new Error(res);
}
this._resback(res);
},addBoth:function(cb,cbfn){
var _932=this.getFunctionFromArgs(cb,cbfn);
if(arguments.length>2){
_932=dojo.lang.curryArguments(null,_932,arguments,2);
}
return this.addCallbacks(_932,_932);
},addCallback:function(cb,cbfn){
var _935=this.getFunctionFromArgs(cb,cbfn);
if(arguments.length>2){
_935=dojo.lang.curryArguments(null,_935,arguments,2);
}
return this.addCallbacks(_935,null);
},addErrback:function(cb,cbfn){
var _938=this.getFunctionFromArgs(cb,cbfn);
if(arguments.length>2){
_938=dojo.lang.curryArguments(null,_938,arguments,2);
}
return this.addCallbacks(null,_938);
return this.addCallbacks(null,cbfn);
},addCallbacks:function(cb,eb){
this.chain.push([cb,eb]);
if(this.fired>=0){
this._fire();
}
return this;
},_fire:function(){
var _93b=this.chain;
var _93c=this.fired;
var res=this.results[_93c];
var self=this;
var cb=null;
while(_93b.length>0&&this.paused==0){
var pair=_93b.shift();
var f=pair[_93c];
if(f==null){
continue;
}
try{
res=f(res);
_93c=((res instanceof Error)?1:0);
if(res instanceof dojo.Deferred){
cb=function(res){
self._continue(res);
};
this._pause();
}
}
catch(err){
_93c=1;
res=err;
}
}
this.fired=_93c;
this.results[_93c]=res;
if((cb)&&(this.paused)){
res.addBoth(cb);
}
}});
dojo.provide("qu.sql.ResultSet");
dojo.lang.declare("qu.sql.ResultSetMetaData",null,function(){
this.tableName=new String();
this.colNames=new Array();
this.colTypes=new Array();
this.count=0;
},{setTableName:function(_943){
this.tableName=_943;
},setNames:function(_944){
this.colNames=_944;
},setTypes:function(_945){
this.colTypes=_945;
},getTableName:function(){
return this.tableName;
},getColumnCount:function(){
return this.colNames.length;
},getColumnName:function(_946){
return this.colNames[_946-1];
},getColumnType:function(_947){
return this.colTypes[_947-1];
},findColumn:function(_948){
for(var each in this.colNames){
if(this.colNames[each].toLowerCase()==_948.toLowerCase()){
return parseInt(each)+1;
}
}
return false;
},setCount:function(_94a){
this.count=_94a;
},getCount:function(){
return this.count;
}});
dojo.lang.declare("qu.sql.ResultSet",null,function(){
this.row=-1;
this.md=new qu.sql.ResultSetMetaData();
this.rows=new Array();
this.error="";
},{setError:function(_94b){
this.error=_94b;
},getError:function(){
return this.error;
},add:function(_94c){
this.rows.push(_94c);
},getMetaData:function(){
return this.md;
},onRow:function(){
return (this.row>=0&&(this.row<this.rows.length?true:false));
},absolute:function(_94d){
if(_94d>0){
this.row=this.rows.length+1?_94d-1:this.rows.length;
}else{
this.row=this.rows.length+_94d>=-1?this.rows.length+_94d:-1;
}
return this.onRow();
},relative:function(_94e){
return this.absolute(this.row+_94e+1);
},next:function(){
return this.relative(1);
},previous:function(){
return this.relative(-1);
},first:function(){
this.row=0;
return this.onRow();
},isFirst:function(){
return this.row==0?true:false;
},last:function(){
this.row=this.rows.length-1;
return this.onRow();
},isLast:function(){
return this.row==this.rows.length-1?true:false;
},beforeFirst:function(){
this.row=-1;
},isBeforeFirst:function(){
return (this.row==-1);
},afterLast:function(){
this.row=this.rows.length;
},isAfterLast:function(){
return (this.row==this.rows.length);
},getRow:function(){
return this.row+1;
},getRowArray:function(){
var rw=this.row;
rw=rw>=0&&this.rows.length?rw:-1;
if(rw>-1){
return this.rows[rw];
}
return undefined;
},getRowObject:function(){
var rw=this.row;
var _951=new Object();
var name;
for(var each in this.md.colNames){
name=this.md.colNames[each];
if(this.md.colTypes[each]!="date"){
_951[name]=this.get(name).valueOf();
}else{
_951[name]=this.getDate(name).print("%Y-%m-%d %H:%M:%S");
}
}
return _951;
},findColumn:function(_954){
return this.md.findColumn(_954);
},close:function(){
this.row=-1;
this.md=new qu.sql.ResultSetMetaData();
this.rows=new Array();
this.error="";
},getBoolean:function(_955){
var rw=this.getRowArray();
return (rw!=undefined?new Boolean(rw[this._findIndex(_955)-1]):rw);
},getNumber:function(_957){
var rw=this.getRowArray();
return (rw!=undefined?new Number(rw[this._findIndex(_957)-1]):rw);
},getString:function(_959){
var rw=this.getRowArray();
return (rw!=undefined?new String(rw[this._findIndex(_959)-1]):rw);
},getMoney:function(_95b){
var rw=this.getRowArray();
str=dojo.string.substituteParams(app.config.get("defaultCurrency"),rw[this._findIndex(_95b)-1]);
return (rw!=undefined?new String(str):rw);
},getObject:function(_95d){
var rw=this.getRowArray();
return rw[this._findIndex(_95d)-1];
},getDate:function(_95f){
var rw=this.getRowArray();
var _961=rw[this._findIndex(_95f)-1];
if(_961 instanceof Date){
var _962=new Date(_961);
return new Date(_962.valueOf()+(qu.user.getClientServerTimeOffset()*60000));
}
if(typeof (_961)=="string"){
var _962=Date.parseDate(_961,"%Y-%m-%d %H:%M:%S");
return new Date(_962.valueOf()+(qu.user.getClientServerTimeOffset()*60000));
}
return null;
},get:function(_963){
var rw=this.getRowArray();
if(rw==undefined){
return rw;
}
var _965=this._findIndex(_963);
if(_965!==false){
var type=this.md.getColumnType(_965);
if(type=="date"){
return this.getDate(_965);
}
if(type=="string"){
return this.getString(_965);
}
if(type=="number"){
return this.getNumber(_965);
}
if(type=="boolean"){
return this.getBoolean(_965);
}
if(type=="object"){
return this.getObject(_963);
}
return rw[_965];
}
return null;
},setBoolean:function(_967,_968){
if(this.row>-1){
this.rows[this.row][this._findIndex(_967)-1]=new Boolean(_968);
}
},setNumber:function(_969,_96a){
if(this.row>-1){
this.rows[this.row][this._findIndex(_969)-1]=new Number(_96a);
}
},setString:function(_96b,_96c){
if(this.row>-1){
this.rows[this.row][this._findIndex(_96b)-1]=new String(_96c);
}
},setDate:function(_96d,_96e){
if(this.row>-1){
this.rows[this.row][this._findIndex(_96d)-1]=new Date(_96e);
}
},remove:function(){
this.rows.splice(this.row,1);
this.previous();
},_findIndex:function(_96f){
if(dojo.lang.isString(_96f)){
return this.findColumn(_96f);
}
return _96f;
},createFromObject:function(_970){
this.md.setTableName(_970.md.tableName);
this.md.setTypes(_970.md.colTypes);
this.md.setNames(_970.md.colNames);
this.md.setCount(_970.count);
this.rows=_970.rs.rows;
this.row=-1;
},getCount:function(){
return this.rows.length;
}});
dojo.provide("qu.rpc.Service");
dojo.require("dojo.io.*");
dojo.require("dojo.json");
dojo.require("dojo.lang.func");
dojo.require("dojo.Deferred");
dojo.require("qu.sql.ResultSet");
dojo.lang.declare("qu.rpc.Service",null,function(_971){
this._timeout=60;
this._showThrobber=true;
this.throbberDefaultMessage="Loading...";
this.throbberMessage=this.throbberDefaultMessage;
if(typeof (_971)!="undefined"){
this.setClassName(_971);
this.connect();
}
this.pushRequests=new Array();
},{contentType:"application/x-www-form-urlencoded",lastSubmissionId:0,strictArgChecks:true,serviceUrl:"",fileExtension:"smd",processSmd:function(_972){
if(_972.methods){
dojo.lang.forEach(_972.methods,function(m){
if(m&&m["name"]){
this[m.name]=this.generateMethod(m.name,m.parameters,m["url"]||m["serviceUrl"]||m["serviceURL"]);
}
},this);
}
app.services[this.getClassName()]=_972;
this.serviceUrl=_972.serviceUrl||_972.serviceURL;
},generateMethod:function(_974,_975,url){
return dojo.lang.hitch(this,function(){
var _977=new dojo.Deferred();
if((this.strictArgChecks)&&(_975!=null)&&(arguments.length!=_975.length)){
dojo.raise("Invalid number of parameters for remote method.");
}else{
this.bind(_974,arguments,_977,url);
}
return _977;
});
},errorCallback:function(_978,_979){
var tf=dojo.lang.hitch(this,function(type,e){
this.hideThrobber();
_978.errback(new Error(_979?e.message:app.i18n.get("RequestTimeout")+" - "+e.message));
});
return tf;
},resultCallback:function(_97d){
var tf=dojo.lang.hitch(this,function(type,obj,e){
this.hideThrobber();
if(obj["error"]!=null){
if(obj["error"]==app.i18n.get("sessionNotActive")){
qu.boot.forceLogout();
return new Error(app.i18n.get("sessionNotActive"));
}
var _982=obj.error;
var err=new Error();
err.id=obj.id;
err.message=_982;
_97d.errback(err);
}else{
var _984=this.parseResults(obj);
if(obj["push"]){
try{
this.pushData(obj["push"]);
}
catch(inError){
dojo.debug("Data push error: "+inError);
}
}
_97d.callback(_984);
}
});
return tf;
},callRemote:function(_985,_986){
var _987=new dojo.Deferred();
this.bind(_985,_986,_987);
return _987;
},bind:function(_988,_989,_98a,url){
this.showThrobber();
dojo.io.bind({url:url||this.serviceUrl,postContent:this.createRequest(_988,_989),method:"POST",contentType:this.contentType,mimetype:"text/json",load:this.resultCallback(_98a),error:this.errorCallback(_98a,false),timeout:this.errorCallback(_98a,true),timeoutSeconds:this.getTimeout(),preventCache:true});
},createRequest:function(_98c,_98d){
var req={"params":_98d,"method":_98c,"id":++this.lastSubmissionId,"push":this.pushRequests};
return "d="+encodeURIComponent(dojo.json.serialize(req));
},setClassName:function(_98f){
this._className=_98f;
},getClassName:function(){
return this._className;
},pushData:function(data){
app.dataPusher.push(data);
},parseResults:function(_991){
if(!_991){
return new Error("Empty Result");
}
if(_991["result"]!=null){
if(_991.result["count"]!=null&&_991.result["md"]!=null&&_991.result["rs"]!=null){
var _992=_991.result;
var rs=new qu.sql.ResultSet();
rs.md.setTableName(_992.md.tableName);
rs.md.setTypes(_992.md.colTypes);
rs.md.setNames(_992.md.colNames);
rs.md.setCount(_992.count);
rs.rows=_992.rs.rows;
rs.row=-1;
return rs;
}else{
return _991["result"];
}
}else{
if(_991["error"]!=null){
var err=new Error();
err.message=_991["error"];
return err;
}else{
return _991;
}
}
},connect:function(){
if(app.services&&app.services[this.getClassName()]){
this.processSmd(app.services[this.getClassName()]);
return;
}
this.showThrobber();
smdUrl=this.getClassName();
smdUrl="../server/services/"+smdUrl+"."+this.fileExtension+"?"+djConfig.cacheBust;
dojo.io.bind({url:smdUrl,mimetype:"text/json",load:dojo.lang.hitch(this,function(type,_996,e){
this.hideThrobber();
return this.processSmd(_996);
}),error:dojo.lang.hitch(this,function(type,_999,e){
this.hideThrobber();
return e;
}),timeoutSeconds:this.getTimeout(),timeout:dojo.lang.hitch(this,function(type,_99c,e){
this.hideThrobber();
return new Error(app.i18n.get("RequestTimeout"));
}),sync:true});
},showThrobber:function(){
if(this.isShowThrobber()){
if(this.throbberMessage!=this.throbberDefaultMessage){
quThrobber.show(this.throbberMessage);
this.setThrobber(this.throbberDefaultMessage);
}else{
quThrobber.show(this.throbberDefaultMessage);
}
}
},hideThrobber:function(){
if(this.isShowThrobber()){
quThrobber.hide();
}
},setThrobber:function(_99e){
this.throbberMessage=_99e;
},setShowThrobber:function(_99f){
this._showThrobber=_99f;
},isShowThrobber:function(){
return this._showThrobber;
},addPushRequest:function(_9a0,_9a1,_9a2,_9a3){
var _9a4=new Object();
_9a4.id=_9a0;
_9a4.service=_9a1;
_9a4.method=_9a2;
_9a4.params=_9a3;
this.pushRequests.push(_9a4);
},addPushRequestIf:function(_9a5,_9a6,_9a7,_9a8,_9a9){
if(_9a5){
this.addPushRequest(_9a6,_9a7,_9a8,_9a9);
}
},setTimeout:function(_9aa){
this._timeout=_9aa;
},getTimeout:function(){
return this._timeout;
}});
dojo.provide("qu.string.conversion");
if(typeof qu.string!="object"||!qu.string instanceof Object){
qu.string=new Object();
}
qu.string.patterns={html2Text:[[/\r?\n/g,""],[/[\t]+/g," "],[/<br[^>]*>/ig,String.fromCharCode(13)],[/<script[^>]*>.*?<\/script>/ig,""],[/<p[^>]*>/ig,String.fromCharCode(13)],[/<li[^>]*>/ig,String.fromCharCode(13,9)+"*"],[/<hr[^>]*>/ig,"-----"+String.fromCharCode(13)],[/<[^>]*>/g,""],[/&nbsp;?/ig," "],[/&quot;/ig,"\""],[/&gt;/ig,">"],[/&lt;/ig,"<"],[/&amp;/ig,"&"],[/&copy;/ig,"(c)"],[/&trade;/ig,"(tm)"],[/&#8220;/g,"\""],[/&#8221;/g,"\""],[/&#8211;/g,"-"],[/&#8217;/g,"'"],[/&#38;/g,"&"],[/&#169;/g,"(c)"],[/&#8482;/g,"(tm)"],[/&#151;/g,"--"],[/&#147;/g,"\""],[/&#148;/g,"\""],[/&#149;/g,"*"],[/&reg;/ig,"(R)"],[/&bull;/ig,"*"],[/&#39;/g,"'"],[/&[&;]+;/ig,""]],text2Html:[["<","&lt;"],[/\r?\n/g,"<br />"]]};
qu.string.html2Text=function(_9ab){
return qu.string._convert(_9ab,qu.string.patterns.html2Text);
};
qu.string.text2Html=function(_9ac){
return qu.string._convert(_9ac,qu.string.patterns.text2Html);
};
qu.string._convert=function(_9ad,_9ae){
for(var i=0;i<_9ae.length;i++){
_9ad=_9ad.replace(_9ae[i][0],_9ae[i][1]);
}
return _9ad;
};
qu.string.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
qu.string.encode64=function(_9b0){
if(_9b0==null){
_9b0="";
}
var _9b1="";
var chr1,chr2,chr3;
var enc1,enc2,enc3,enc4;
var i=0;
_9b0=qu.string._utf8_encode(_9b0);
do{
chr1=_9b0.charCodeAt(i++);
chr2=_9b0.charCodeAt(i++);
chr3=_9b0.charCodeAt(i++);
enc1=chr1>>2;
enc2=((chr1&3)<<4)|(chr2>>4);
enc3=((chr2&15)<<2)|(chr3>>6);
enc4=chr3&63;
if(isNaN(chr2)){
enc3=enc4=64;
}else{
if(isNaN(chr3)){
enc4=64;
}
}
_9b1=_9b1+qu.string.keyStr.charAt(enc1)+qu.string.keyStr.charAt(enc2)+qu.string.keyStr.charAt(enc3)+qu.string.keyStr.charAt(enc4);
}while(i<_9b0.length);
return _9b1;
};
qu.string.decode64=function(_9ba){
if(_9ba==null){
_9ba="";
}
var _9bb="";
var chr1,chr2,chr3;
var enc1,enc2,enc3,enc4;
var i=0;
_9ba=_9ba.replace(/[^A-Za-z0-9\+\/\=]/g,"");
do{
enc1=qu.string.keyStr.indexOf(_9ba.charAt(i++));
enc2=qu.string.keyStr.indexOf(_9ba.charAt(i++));
enc3=qu.string.keyStr.indexOf(_9ba.charAt(i++));
enc4=qu.string.keyStr.indexOf(_9ba.charAt(i++));
chr1=(enc1<<2)|(enc2>>4);
chr2=((enc2&15)<<4)|(enc3>>2);
chr3=((enc3&3)<<6)|enc4;
_9bb=_9bb+String.fromCharCode(chr1);
if(enc3!=64){
_9bb=_9bb+String.fromCharCode(chr2);
}
if(enc4!=64){
_9bb=_9bb+String.fromCharCode(chr3);
}
}while(i<_9ba.length);
_9bb=qu.string._utf8_decode(_9bb);
return _9bb;
};
qu.string._utf8_encode=function(_9c4){
_9c4=_9c4.replace(/\r\n/g,"\n");
var _9c5="";
for(var n=0;n<_9c4.length;n++){
var c=_9c4.charCodeAt(n);
if(c<128){
_9c5+=String.fromCharCode(c);
}else{
if((c>127)&&(c<2048)){
_9c5+=String.fromCharCode((c>>6)|192);
_9c5+=String.fromCharCode((c&63)|128);
}else{
_9c5+=String.fromCharCode((c>>12)|224);
_9c5+=String.fromCharCode(((c>>6)&63)|128);
_9c5+=String.fromCharCode((c&63)|128);
}
}
}
return _9c5;
};
qu.string._utf8_decode=function(_9c8){
var _9c9="";
var i=0;
var c=c1=c2=0;
while(i<_9c8.length){
c=_9c8.charCodeAt(i);
if(c<128){
_9c9+=String.fromCharCode(c);
i++;
}else{
if((c>191)&&(c<224)){
c2=_9c8.charCodeAt(i+1);
_9c9+=String.fromCharCode(((c&31)<<6)|(c2&63));
i+=2;
}else{
c2=_9c8.charCodeAt(i+1);
c3=_9c8.charCodeAt(i+2);
_9c9+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));
i+=3;
}
}
}
return _9c9;
};
qu.string.seconds2hhmm=function(_9cc){
var mm=parseInt(parseInt(_9cc)/60);
var hh=parseInt(mm/60);
mm=mm-hh*60;
return hh+":"+mm;
};
qu.string.seconds2hhmmss=function(_9cf){
_9cf=parseInt(_9cf);
var mm=parseInt(_9cf/60);
var ss=_9cf-mm*60;
var hh=parseInt(mm/60);
mm=mm-hh*60;
return hh+":"+mm+":"+ss;
};
qu.string.seconds2humantime=function(_9d3){
_9d3=parseInt(_9d3);
var mm=parseInt(_9d3/60);
var ss=_9d3-mm*60;
var hh=parseInt(mm/60);
mm=mm-hh*60;
var _9d7="";
_9d7+=hh>0?hh+app.i18n.get("hrs"):"";
_9d7+=(_9d7.length>0?" ":"")+(mm>0?mm+app.i18n.get("mins"):"");
_9d7+=(_9d7.length>0?" ":"")+(ss>0?ss+app.i18n.get("secs"):"");
return _9d7;
};
qu.string.hhmm2seconds=function(_9d8){
if(_9d8.match(/:/)){
var hhmm=_9d8.split(/:/);
return parseInt(hhmm[1])*60+parseInt(hhmm[0])*3600;
}else{
return parseInt(_9d8)*60;
}
};
qu.string.escapeHtmlTags=function(str){
return (str+"").replace(/</g,"&lt;").replace(/>/g,"&rt;");
};
qu.string.replaceParenthases=function(str){
return (str+"").replace(/\"/g,"'");
};
dojo.provide("qu.core.User");
dojo.require("qu.core.SuperObject");
dojo.require("qu.rpc.Service");
dojo.require("qu.string.conversion");
dojo.require("qu.Global");
dojo.lang.declare("qu.core.User",qu.core.SuperObject,{sid:null,timezoneOffset:0,isLoggedIn:function(){
var sid=qu.global.getCookie("sid");
if(sid&&this.isSessionActive(sid)){
this.setId(qu.global.getCookie("id"));
this.setSid(qu.global.getCookie("sid"));
this.setName(qu.global.getCookie("name"));
this.setType(qu.global.getCookie("type"));
this.setHideSuggestions(qu.global.getCookie("hide_suggestions"));
this.setSignature(qu.string.decode64(qu.global.getCookie("signature")));
this.setUserName(qu.global.getCookie("username"));
this.setClientServerTimeOffset(qu.global.getCookie("timeoffset"));
this.setHash(qu.global.getCookie("loginHash"));
return true;
}else{
if(app.params.hash){
return this.hashLogin(app.params.hash);
}else{
if(qu.global.getCookie("rememberMe")){
return this.hashLogin(qu.global.getCookie("rememberMe"));
}
}
}
return false;
},isSessionActive:function(_9dd){
var _9de=false;
var _9df=new qu.rpc.Service("Users");
dojo.io.bind({url:_9df.serviceUrl,mimetype:"text/json",contentType:"application/x-www-form-urlencoded",postContent:"d="+escape("{\"params\":[{\"sid\":\""+_9dd+"\"}],\"method\":\"authenticate\",\"id\":1}"),method:"post",load:function(type,_9e1,e){
if(_9e1.error==null||_9e1.error=="null"){
_9de=true;
}
},sync:true});
return _9de;
},hashLogin:function(_9e3){
var _9e4=false;
var _9e5=new qu.rpc.Service("Users");
dojo.io.bind({url:_9e5.serviceUrl,mimetype:"text/json",contentType:"application/x-www-form-urlencoded",postContent:"d="+escape("{\"params\":[{\"hash\":\""+_9e3+"\"}],\"method\":\"hashLogin\",\"id\":1}"),method:"post",load:dojo.lang.hitch(this,function(type,_9e7,e){
try{
if(_9e7.error==null||_9e7.error=="null"){
var rs=new qu.sql.ResultSet();
rs.createFromObject(_9e7.result);
rs.first();
this.login(rs.getString("sid").valueOf(),rs.getString("name").valueOf());
this.setUserName(rs.getString("email").valueOf());
this.setName(rs.getString("name").valueOf());
this.setType(rs.getString("user_type").valueOf());
this.setId(rs.getString("user_id").valueOf());
this.setSignature(rs.getString("signature").valueOf());
this.setHideSuggestions(rs.getString("hide_suggestions").valueOf());
this.setUserName(rs.getString("email").valueOf());
this.computeServerTimeOffset(rs.getNumber("timezone_offset"));
this.setHash(rs.getString("hash").valueOf());
_9e4=true;
}
}
catch(e){
_9e4=false;
}
}),error:dojo.lang.hitch(this,function(type,_9eb,e){
_9e4=false;
}),sync:true});
return _9e4;
},login:function(_9ed,_9ee){
this.setSid(_9ed);
qu.global.setCookie("sid",_9ed);
qu.global.setCookie("name",_9ee);
},logout:function(_9ef){
if(typeof (_9ef)=="undefined"){
isCancelRememberMe=true;
}else{
isCancelRememberMe=_9ef;
}
qu.global.deleteCookie("sid");
if(isCancelRememberMe){
qu.global.deleteCookie("rememberMe");
}
this.setSid(null);
var _9f0=new qu.rpc.Service("Users");
_9f0.setThrobber(app.i18n.get("logout"));
var def=_9f0.logout();
return def;
},computeServerTimeOffset:function(_9f2){
var _9f3=new Date();
qu.user.setClientServerTimeOffset(_9f2-_9f3.getTimezoneOffset());
},setClientServerTimeOffset:function(_9f4){
this.timezoneOffset=_9f4;
qu.global.setCookie("timeoffset",_9f4);
},getClientServerTimeOffset:function(){
return this.timezoneOffset;
},setSid:function(_9f5){
this.sid=_9f5;
},getSid:function(){
return this.sid;
},setName:function(_9f6){
this.name=_9f6;
},getName:function(){
if(this.name!=null&&this.name.length>0){
return this.name;
}else{
return this.getUserName();
}
},setUserName:function(_9f7){
qu.global.setCookie("username",_9f7);
this.username=_9f7;
},getUserName:function(){
return this.username;
},setType:function(_9f8){
qu.global.setCookie("type",_9f8);
this.type=_9f8;
},getType:function(){
return this.type;
},setId:function(inId){
qu.global.setCookie("id",inId);
this.userid=inId;
},getId:function(){
return this.userid;
},setSignature:function(_9fa){
qu.global.setCookie("signature",qu.string.encode64(_9fa));
this._signature=_9fa;
},getSignature:function(){
return this._signature;
},isUser:function(){
return this.getType()=="u";
},isAgent:function(){
return this.getType()=="g";
},isAdmin:function(){
return this.getType()=="a";
},isPowerUser:function(){
return this.getType()=="a"||this.getType()=="g";
},setHash:function(_9fb){
this.hash=_9fb;
qu.global.setCookie("loginHash",_9fb);
},getHash:function(){
return this.hash;
},getHideSuggestions:function(){
if(this.hideSuggestions){
return "y";
}
return "n";
},setHideSuggestions:function(_9fc){
if(_9fc==true||_9fc=="y"){
this.hideSuggestions=true;
}else{
this.hideSuggestions=false;
}
qu.global.setCookie("hide_suggestions",this.getHideSuggestions());
}});
qu.user=new qu.core.User();
dojo.provide("qu.core.Config");
dojo.require("qu.core.SuperObject");
dojo.require("dojo.io.cookie");
dojo.lang.declare("qu.core.Config",qu.core.SuperObject,function(){
this.cookieName="scConfig";
},{pathIcons:"lib/icons/crystalsvg",getCookie:function(_9fd){
var obj=dojo.io.cookie.getObjectCookie(qu.user.getId());
for(var each in obj){
if(each==_9fd){
if(obj[each]=="false"){
return false;
}
if(obj[each]=="true"){
return true;
}
return obj[_9fd];
}
}
return null;
},setCookie:function(_a00,_a01){
var obj={};
if(typeof _a01=="boolean"||_a01 instanceof Boolean){
_a01=_a01?"true":"false";
}
obj[_a00]=_a01;
dojo.io.cookie.setObjectCookie(qu.user.getId(),obj,365,false,false,false,false);
}});
dojo.provide("qu.core.I18n");
dojo.require("qu.core.SuperObject");
dojo.require("dojo.io.*");
dojo.lang.declare("qu.core.I18n",qu.core.SuperObject,function(_a03){
if(_a03){
this.__loadLanguageFile(_a03);
}
},{__loadLanguageFile:function(_a04){
var self=this;
dojo.io.bind({url:"../i18n/"+_a04+".lang.js?"+djConfig.cacheBust,sync:true,load:function(type,_a07){
try{
eval("var returnObj = "+_a07);
}
catch(e){
dojo.debugShallow(e);
if(_a04!="English"){
self.__loadLanguageFile("English");
}
return;
}
dojo.lang.mixin(self,returnObj);
},error:function(type,_a09){
dojo.debug("Error loading language file");
if(_a04!="English"){
self.__loadLanguageFile("English");
}
},mimetype:"text/plain",useCache:false,encoding:"utf8"});
},get:function(_a0a){
if(this[_a0a]){
return this[_a0a];
}
if(djConfig.isDebug){
return "<font class='i18nNotFound'>"+_a0a+"</font>";
}
return _a0a;
},__getPath:function(_a0b){
var path=_a0b.replace(/\./g,"/");
path=path.replace("app","app/src");
path+=".js";
return path;
},monthShort:{"Jan":"Jan",1:"Jan","Feb":"Feb",2:"Feb","Mar":"Mar",3:"Mar","Apr":"Apr",4:"Apr","May":"May",5:"May","Jun":"Jun",6:"Jun","Jul":"Jul",7:"Jul","Aug":"Aug",8:"Aug","Sep":"Sep",9:"Sep","Oct":"Oct",10:"Oct","Nov":"Nov",11:"Nov","Dec":"Dec",12:"Dec"},monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdayLetter:["S","M","T","W","T","F","S"],weekdayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]});
dojo.provide("qu.util.Date");
Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);
Date.SECOND=1000;
Date.MINUTE=60*Date.SECOND;
Date.HOUR=60*Date.MINUTE;
Date.DAY=24*Date.HOUR;
Date.WEEK=7*Date.DAY;
Date.parseDate=function(str,fmt){
var _a0f=new Date();
var y=0;
var m=-1;
var d=0;
var a=str.split(/\W+/);
var b=fmt.match(/%./g);
var i=0,j=0;
var hr=0;
var min=0;
var sec=0;
for(i=0;i<a.length;++i){
if(!a[i]){
continue;
}
switch(b[i]){
case "%d":
case "%e":
d=parseInt(a[i],10);
break;
case "%m":
m=parseInt(a[i],10)-1;
break;
case "%Y":
case "%y":
y=parseInt(a[i],10);
(y<100)&&(y+=(y>29)?1900:2000);
break;
case "%b":
case "%B":
for(j=0;j<12;++j){
if(Date._MN[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){
m=j;
break;
}
}
break;
case "%H":
case "%I":
case "%k":
case "%l":
hr=parseInt(a[i],10);
break;
case "%P":
case "%p":
if(/pm/i.test(a[i])&&hr<12){
hr+=12;
}else{
if(/am/i.test(a[i])&&hr>=12){
hr-=12;
}
}
break;
case "%M":
min=parseInt(a[i],10);
break;
case "%S":
sec=parseInt(a[i],10);
break;
}
}
if(isNaN(y)){
y=_a0f.getFullYear();
}
if(isNaN(m)){
m=_a0f.getMonth();
}
if(isNaN(d)){
d=_a0f.getDate();
}
if(isNaN(hr)){
hr=_a0f.getHours();
}
if(isNaN(min)){
min=_a0f.getMinutes();
}
if(isNaN(sec)){
min=_a0f.getMinutes();
}
if(y!=0&&m!=-1&&d!=0){
return new Date(y,m,d,hr,min,sec);
}
y=0;
m=-1;
d=0;
for(i=0;i<a.length;++i){
if(a[i].search(/[a-zA-Z]+/)!=-1){
var t=-1;
for(j=0;j<12;++j){
if(Date._MN[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){
t=j;
break;
}
}
if(t!=-1){
if(m!=-1){
d=m+1;
}
m=t;
}
}else{
if(parseInt(a[i],10)<=12&&m==-1){
m=a[i]-1;
}else{
if(parseInt(a[i],10)>31&&y==0){
y=parseInt(a[i],10);
(y<100)&&(y+=(y>29)?1900:2000);
}else{
if(d==0){
d=a[i];
}
}
}
}
}
if(y==0){
y=_a0f.getFullYear();
}
if(m!=-1&&d!=0){
return new Date(y,m,d,hr,min,0);
}
return _a0f;
};
Date.prototype.toServerDateTime=function(_a1b){
if(_a1b==null){
_a1b=this;
}
if(_a1b instanceof Date){
var _a1c=new Date(_a1b);
_a1b=new Date(_a1c.valueOf()-(qu.user.getClientServerTimeOffset()*Date.MINUTE));
}else{
if(typeof (_a1b)=="string"){
var _a1c=Date.parseDate(_a1b,"%Y-%m-%d %H:%M:%S");
_a1b=new Date(_a1c.valueOf()-(qu.user.getClientServerTimeOffset()*Date.MINUTE));
}
}
return _a1b;
};
Date.prototype.secondsToHumanTime=function(_a1d){
if(_a1d<=-4838400){
var _a1e=parseInt(_a1d/2419200)*-1;
return _a1e+app.i18n.get("monthsAgo");
}
if(_a1d>-4838400&&_a1d<=-1209600){
var _a1f=parseInt(_a1d/604800)*-1;
return _a1f+app.i18n.get("weeksAgo");
}
if(_a1d>-1209600&&_a1d<=-172800){
var days=parseInt(_a1d/86400)*-1;
return days+app.i18n.get("daysAgo");
}
if(_a1d>-172800&&_a1d<=-7200){
var _a21=parseInt(_a1d/3600)*-1;
return _a21+app.i18n.get("hoursAgo");
}
if(_a1d>-7200&&_a1d<=-60){
var _a22=parseInt(_a1d/60)*-1;
return _a22+app.i18n.get("minutesAgo");
}
if(_a1d>-60&&_a1d<=0){
return app.i18n.get("someSecondsAgo");
}
if(_a1d>0&&_a1d<=60){
return app.i18n.get("someSecondsToGo");
}
var _a22=parseInt(_a1d/60);
if(_a1d>60&&_a1d<=7200){
return _a22+app.i18n.get("minutesToGo");
}
var _a21=parseInt(_a22/60);
_a22=_a22-_a21*60;
if(_a1d>7200&&_a1d<=172800){
return _a21+app.i18n.get("hoursToGo")+" "+_a22+app.i18n.get("minutesToGo");
}
if(_a1d>172800&&_a1d<=1209600){
return parseInt(_a1d/86400)+app.i18n.get("daysToGo");
}
if(_a1d>1209600){
return parseInt(_a1d/604800)+app.i18n.get("weeksToGo");
}
return "";
};
Date.prototype.getHumanTime=function(date,_a24){
if(_a24==null){
_a24=new Date();
}
var _a25=parseInt((_a24.getTime()-date.getTime())/1000);
if(_a25<0&&_a25>=-60){
return app.i18n.get("nextMinute");
}
if(_a25==0){
return app.i18n.get("now");
}
if(_a25>0&&_a25<=60){
return app.i18n.get("lastMinute");
}
if(_a25>60&&_a25<=3600){
return parseInt(_a25/60)+" "+app.i18n.get("minutesAgo");
}
if(_a25>3600&&_a25<=7200){
return app.i18n.get("hourAgo");
}
if(_a25>7200&&_a25<=86400){
return parseInt(_a25/3600)+" "+app.i18n.get("hoursAgo");
}
if(_a25>86400&&_a25<=172800){
return app.i18n.get("yesterday");
}
if(_a25>172800){
return parseInt(_a25/86400)+" "+app.i18n.get("daysAgo");
}
return "";
};
Date.prototype.getMonthDays=function(_a26){
var year=this.getFullYear();
if(typeof _a26=="undefined"){
_a26=this.getMonth();
}
if(((0==(year%4))&&((0!=(year%100))||(0==(year%400))))&&_a26==1){
return 29;
}else{
return Date._MD[_a26];
}
};
Date.prototype.getDayOfYear=function(){
var now=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);
var then=new Date(this.getFullYear(),0,0,0,0,0);
var time=now-then;
return Math.floor(time/Date.DAY);
};
Date.prototype.getWeekNumber=function(){
var d=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);
var DoW=d.getDay();
d.setDate(d.getDate()-(DoW+6)%7+3);
var ms=d.valueOf();
d.setMonth(0);
d.setDate(4);
return Math.round((ms-d.valueOf())/(7*86400000))+1;
};
Date.prototype.equalsTo=function(date){
return ((this.getFullYear()==date.getFullYear())&&(this.getMonth()==date.getMonth())&&(this.getDate()==date.getDate())&&(this.getHours()==date.getHours())&&(this.getMinutes()==date.getMinutes()));
};
Date.prototype.setDateOnly=function(date){
var tmp=new Date(date);
this.setDate(1);
this.setFullYear(tmp.getFullYear());
this.setMonth(tmp.getMonth());
this.setDate(tmp.getDate());
};
Date.prototype.print=function(str){
var m=this.getMonth();
var d=this.getDate();
var y=this.getFullYear();
var wn=this.getWeekNumber();
var w=this.getDay();
var s={};
var hr=this.getHours();
var pm=(hr>=12);
var ir=(pm)?(hr-12):hr;
var dy=this.getDayOfYear();
if(ir==0){
ir=12;
}
var min=this.getMinutes();
var sec=this.getSeconds();
s["%a"]=Date._SDN[w];
s["%A"]=Date._DN[w];
s["%b"]=Date._SMN[m];
s["%B"]=Date._MN[m];
s["%C"]=1+Math.floor(y/100);
s["%d"]=(d<10)?("0"+d):d;
s["%e"]=d;
s["%H"]=(hr<10)?("0"+hr):hr;
s["%I"]=(ir<10)?("0"+ir):ir;
s["%j"]=(dy<100)?((dy<10)?("00"+dy):("0"+dy)):dy;
s["%k"]=hr;
s["%l"]=ir;
s["%m"]=(m<9)?("0"+(1+m)):(1+m);
s["%M"]=(min<10)?("0"+min):min;
s["%n"]="\n";
s["%p"]=pm?"PM":"AM";
s["%P"]=pm?"pm":"am";
s["%s"]=Math.floor(this.getTime()/1000);
s["%S"]=(sec<10)?("0"+sec):sec;
s["%t"]="\t";
s["%U"]=s["%W"]=s["%V"]=(wn<10)?("0"+wn):wn;
s["%u"]=w+1;
s["%w"]=w;
s["%y"]=(""+y).substr(2,2);
s["%Y"]=y;
s["%%"]="%";
var re=/%./g;
if(!Date.is_ie5&&!Date.is_khtml){
return str.replace(re,function(par){
return s[par]||par;
});
}
var a=str.match(re);
for(var i=0;i<a.length;i++){
var tmp=s[a[i]];
if(tmp){
re=new RegExp(a[i],"g");
str=str.replace(re,tmp);
}
}
return str;
};
Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;
Date.prototype.setFullYear=function(y){
var d=new Date(this);
d.__msh_oldSetFullYear(y);
if(d.getMonth()!=this.getMonth()){
this.setDate(28);
}
this.__msh_oldSetFullYear(y);
};
Date.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));
Date.is_ie5=(Date.is_ie&&/msie 5\.0/i.test(navigator.userAgent));
Date.is_opera=/opera/i.test(navigator.userAgent);
Date.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);
Date._DN=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday");
Date._SDN=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun");
Date._FD=1;
Date._MN=new Array("January","February","March","April","May","June","July","August","September","October","November","December");
Date._SMN=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
Date._TT={};
Date._TT["INFO"]="About the calendar";
Date._TT["ABOUT"]="Distributed under GNU LGPL.  See http://gnu.org/licenses/lgpl.html for details."+"\n\n"+"Date selection:\n"+"- Use the \xab, \xbb buttons to select year\n"+"- Use the "+String.fromCharCode(8249)+", "+String.fromCharCode(8250)+" buttons to select month\n"+"- Hold mouse button on any of the above buttons for faster selection.";
Date._TT["ABOUT_TIME"]="\n\n"+"Time selection:\n"+"- Click on any of the time parts to increase it\n"+"- or Shift-click to decrease it\n"+"- or click and drag for faster selection.";
Date._TT["PREV_YEAR"]="Prev. year (hold for menu)";
Date._TT["PREV_MONTH"]="Prev. month (hold for menu)";
Date._TT["GO_TODAY"]="Go Today";
Date._TT["NEXT_MONTH"]="Next month (hold for menu)";
Date._TT["NEXT_YEAR"]="Next year (hold for menu)";
Date._TT["SEL_DATE"]="Select date";
Date._TT["DRAG_TO_MOVE"]="Drag to move";
Date._TT["PART_TODAY"]=" (today)";
Date._TT["DAY_FIRST"]="Display %s first";
Date._TT["WEEKEND"]="0,6";
Date._TT["CLOSE"]="Close";
Date._TT["TODAY"]="Today";
Date._TT["TIME_PART"]="(Shift-)Click or drag to change value";
Date._TT["DEF_DATE_FORMAT"]="%Y-%m-%d";
Date._TT["TT_DATE_FORMAT"]="%a, %b %e";
Date._TT["WK"]="wk";
Date._TT["TIME"]="Time:";
dojo.provide("qu.gui.Template");
dojo.require("dojo.io.*");
dojo.require("dojo.Deferred");
dojo.require("dojo.widget.Parse");
dojo.lang.declare("qu.gui.Template",null,function(_a45){
this.setTemplate(_a45);
this._content="";
this._parseWidgets=true;
},{defaultExtension:"html",isParseWidgets:function(){
return this._parseWidgets;
},setParseWidgets:function(_a46){
this._parseWidgets;
},setTemplate:function(_a47){
this._template=_a47;
},getTemplate:function(){
return this._template;
},setContent:function(_a48){
this._content=_a48;
},getContent:function(_a49){
if(_a49==null||_a49==undefined){
_a49=this;
}
return this.parseJst(_a49);
},_getPreloaded:function(){
var _a4a=new String(this.getTemplate());
var _a4b=_a4a.split(".");
if(_a4b[0]=="app"&&_a4b[1]=="template"){
_a4b.shift();
_a4b.shift();
var _a4c="app.template."+_a4b.join(".");
try{
eval("var result="+_a4c);
}
catch(e){
return false;
}
if(result==undefined){
return false;
}
this.setContent(result);
return true;
}else{
return false;
}
},setPreloaded:function(_a4d){
this._preloaded=_a4d;
},isPreloaded:function(){
return this._preloaded;
},load:function(){
var def=new dojo.Deferred();
if(this._getPreloaded()===true){
this.setPreloaded(true);
def.callback();
return def;
}
this.setPreloaded(false);
quThrobber.show();
dojo.io.bind({url:this._getPath(this.getTemplate())+"?"+djConfig.cacheBust,mimetype:"text/plain",load:this.resultCallback(def),error:this.errorCallback(def),sync:false});
return def;
},resultCallback:function(_a4f){
return dojo.lang.hitch(this,function(_a50,_a51,_a52){
quThrobber.hide();
this.setContent(_a51);
_a4f.callback();
});
},errorCallback:function(_a53){
return function(_a54,_a55){
quThrobber.hide();
_a53.errback(new Error(_a55.message));
};
},_getPath:function(_a56){
if(dojo.lang.isString(_a56)){
var path=_a56.replace(/\./g,"/");
path=path.replace("app","app/src");
path+="."+this.defaultExtension;
return path;
}
return _a56;
},parseEL:function(_a58){
var _a59=function(_a5a){
var _a5b="app.i18n.";
var _a5c=_a5a.indexOf(_a5b);
if(_a5c==0){
_a5a=_a5a.substring(_a5b.length);
}
if(djConfig.isDebug){
return "<font class='i18nNotFound'>"+_a5a+"</font>";
}
return _a5a;
};
var _a5d=_a58||this._content;
var _a5e=false;
_a5e=_a5d.match(/\$\{([^\}]+)\}/g);
if(_a5e){
for(var i=0;i<_a5e.length;i++){
var tag=_a5e[i];
key=tag.substring(2,tag.length-1);
try{
keyValue=eval(key);
if(typeof (keyValue)=="undefined"){
keyValue=eval("this."+key);
if(typeof (keyValue)=="undefined"){
keyValue=_a59(key);
}
}
}
catch(inError){
try{
keyValue=eval("this."+key);
if(typeof (keyValue)=="undefined"){
keyValue=_a59(key);
}
}
catch(e){
keyValue=_a59(key);
dojo.debug("EL Parse Error: reference not found for "+key);
}
}
_a5d=_a5d.replace(tag,keyValue);
}
return _a5d;
}else{
return _a5d;
}
},parseScriptlets:function(_a61){
var _a62=_a61||this._content;
var _a63=false;
_a62=_a62.replace(/\r?\n/g,"");
_a63=_a62.match(/<%.*?%>/g);
if(_a63){
var tag,_a65,_a66,i,_a68;
var echo=function(_a6a){
_a68+=_a6a;
};
while(_a63.length>0){
_a68="";
try{
tag=_a63.shift();
_a65=tag.substring(2,tag.length-2);
_a66=eval(_a65);
_a62=_a62.replace(tag,(_a68=="")?"":_a68);
}
catch(inError){
dojo.debug("Scriptlet parse error: "+inError);
}
}
}
return _a62;
},parseJst:function(_a6b){
var _a6c=this._content;
var _a6d=_a6b||new Object();
var html=this.parseScriptlets.call(_a6d,_a6c);
html=this.parseEL.call(_a6d,html);
return html;
},parseWidgets:function(_a6f){
try{
var _a70=new dojo.xml.Parse();
return dojo.widget.getParser().createSubComponents(_a70.parseElement(_a6f,null,true));
}
catch(e){
dojo.debug("Exception while parsing widgets",e);
}
}});
dojo.provide("qu.gui.MsgBox");
dojo.require("dojo.dom");
dojo.lang.declare("qu.gui.MsgBox",null,function(_a71){
if(dojo.dom.isNode(_a71)){
this.setDomNode(_a71);
}else{
this.setDomNode(null);
}
},{setDomNode:function(_a72){
this._domNode=_a72;
},getDomNode:function(){
return this._domNode;
},print:function(_a73){
try{
this.getDomNode().innerHTML=_a73;
}
catch(inError){
dojo.debug(inError);
}
},clear:function(){
this.print("");
}});
dojo.provide("qu.gui.View");
dojo.require("qu.gui.Template");
dojo.require("qu.gui.MsgBox");
dojo.lang.declare("qu.gui.View",null,function(){
this.msgBox=new qu.gui.MsgBox();
this._width=0;
this._height=0;
this._left=0;
this._top=0;
this.nodesParseDeep=10;
this._templateLoaded=false;
this._displayed=false;
this._isCreated=false;
this._isLoading=false;
this._isAppended=false;
},{setMsgBox:function(_a74){
this.msgBox=_a74;
},getMsgBox:function(){
return this.msgBox;
},setAppended:function(_a75){
this._isAppended=_a75;
},isAppended:function(){
return this._isAppended;
},setCreated:function(_a76){
this._isCreated=_a76;
},isCreated:function(){
return this._isCreated;
},getDomNode:function(){
return this._domNode;
},setDomNode:function(_a77){
this._domNode=_a77;
},getContentNode:function(){
return this._contentNode;
},setWaitNode:function(_a78){
this._waitNode=_a78;
},getWaitNode:function(){
return this._waitNode;
},setContentNode:function(_a79){
this._contentNode=_a79;
},isDisplayed:function(){
return this._displayed;
},setDisplayed:function(_a7a){
this._displayed=_a7a;
},setTemplateLoaded:function(_a7b){
this._templateLoaded=_a7b;
},isTemplateLoaded:function(){
return this._templateLoaded;
},setOwner:function(_a7c){
if(dojo.dom.isNode(_a7c)){
this._owner=new qu.gui.View();
this._owner.setDomNode(_a7c);
}else{
if(_a7c instanceof qu.gui.View){
this._owner=_a7c;
}else{
if(!_a7c){
this._owner=new qu.gui.View();
this._owner.setDomNode(dojo.body());
}else{
dojo.debug("Owner is alien: "+this.className);
this._owner=_a7c;
}
}
}
},getOwner:function(){
return this._owner;
},initComponents:function(){
},initConnections:function(){
},show:function(){
},hide:function(){
this.getDomNode().style.display="none";
this.setDisplayed(false);
this.onHide();
},onHide:function(){
},dispose:function(){
this.onDispose();
this.getOwner().getDomNode().removeChild(this.getDomNode());
},onDispose:function(){
},update:function(){
this.onUpdate();
},onUpdate:function(){
},onShow:function(){
},onCreate:function(){
},create:function(){
},_getContentType:function(_a7d){
if(_a7d instanceof qu.gui.Template){
return qu.gui.CONTENT_TEMPLATE;
}
if(typeof (_a7d)=="string"){
return qu.gui.CONTENT_STRING;
}
},setContent:function(_a7e){
if(this._getContentType(_a7e)==qu.gui.CONTENT_STRING){
this.getContentNode().innerHTML=_a7e;
this.setTemplateLoaded(true);
this.onLoad();
return true;
}
if(this._getContentType(_a7e)==qu.gui.CONTENT_TEMPLATE){
this.setTemplateLoaded(false);
var def=_a7e.load();
def.addCallback(dojo.lang.hitch(this,function(){
this.getContentNode().innerHTML=_a7e.getContent();
this.setTemplateLoaded(true);
this.el=this.elements=new Object();
if(_a7e.isParseWidgets()){
var _a80=_a7e.parseWidgets(this.getContentNode());
this._initWidgets(_a80,this.el);
}
try{
this._initElements(this.getContentNode(),this.el);
if(this.el.msgBox){
this.getMsgBox().setDomNode(this.el.msgBox);
}
this.initComponents();
this.initConnections();
if(_a7e.isPreloaded()===false){
this.onLoad();
}
}
catch(e){
dojo.debug("View.setContent() Error: "+e.message);
}
}));
def.addErrback(dojo.lang.hitch(this,function(){
this.getContentNode().innerHTML="<span>"+app.i18n.get("couldNotLoadTemplate")+"</span>";
}));
}
},getContent:function(){
return this.getContentNode().innerHTML;
},getZIndex:function(){
return parseInt(this.getDomNode().style.zIndex);
},setMaxWidth:function(_a81){
var _a82=dojo.html.getViewport();
if(_a81==null){
_a81=0;
}
this.setWidth(_a82["width"]-_a81);
},setWidth:function(_a83,_a84){
this._width=_a83;
this.getContentNode().style.width=_a83+"px";
this.getWaitNode().style.width=_a83+"px";
if(_a84!==false){
this.onResize();
}
},getWidth:function(){
return this._width;
},setHeight:function(_a85){
this._height=_a85;
this.getContentNode().style.height=_a85+"px";
this.getWaitNode().style.height=_a85+"px";
this.onResize();
},getHeight:function(){
return this._height;
},setSize:function(_a86,_a87){
this.setWidth(_a86,false);
this.setHeight(_a87);
},onResize:function(){
},onMove:function(){
},setLeft:function(_a88,_a89){
this._left=_a88;
this.getDomNode().style.left=_a88+"px";
if(_a89!==false){
this.onMove();
}
},getLeft:function(){
return this._left;
},setTop:function(_a8a){
this._top=_a8a;
this.getDomNode().style.top=_a8a+"px";
this.onMove();
},getTop:function(){
return this._top;
},setPosition:function(_a8b,_a8c){
this.setLeft(_a8b,false);
this.setTop(_a8c);
},_initElements:function(_a8d,_a8e,_a8f){
var _a90=_a8d||this.domNode;
var _a91=_a8e||new Object();
var deep=_a8f||0;
if(deep>this.nodesParseDeep){
return;
}
var _a93=_a90.childNodes;
var node;
for(var each in _a93){
node=_a93[each];
if(dojo.html.hasAttribute(node,"quId")){
_a91[dojo.html.getAttribute(node,"quId")]=node;
}
if(node.nodeType==1&&node.childNodes&&node.tagName.toLowerCase()!="object"){
deep++;
this._initElements(node,_a91,deep);
deep=0;
}
}
return _a91;
},_initWidgets:function(_a96,_a97){
this.widgets=new Object();
for(var each in _a96){
if(_a96[each].quId){
_a97[_a96[each].quId]=_a96[each];
this.widgets[_a96[each].quId]=_a96[each];
}
}
},onLoad:function(){
},setLoading:function(_a99){
if(_a99===true){
this._isLoading=true;
this.getContentNode().style.display="none";
this.getWaitNode().style.display="block";
}else{
if(_a99===false){
this._isLoading=false;
this.getWaitNode().style.display="none";
this.getContentNode().style.display="block";
}
}
},hideLoading:function(){
this.setLoading(false);
this.onShow();
},showLoading:function(){
this.setLoading(true);
},isLoading:function(){
return this._isLoading;
},onFail:function(_a9a){
this.msgBox.print(_a9a);
dojo.debug(_a9a);
},onAppend:function(){
},setParent:function(_a9b){
this._parent=_a9b;
},getParent:function(){
return this._parent;
}});
qu.gui.CONTENT_STRING=1;
qu.gui.CONTENT_OBJECT=2;
qu.gui.CONTENT_TEMPLATE=3;
dojo.provide("qu.gui.Frame");
dojo.require("qu.gui.View");
dojo.lang.declare("qu.gui.Frame",qu.gui.View,function(_a9c){
this.setOwner(_a9c);
this.create();
},{create:function(){
var _a9d=document.createElement("div");
this.setDomNode(_a9d);
this.getDomNode().className="quFrame";
this.getDomNode().style.position="static";
this.getDomNode().style.zIndex=this.getOwner().getZIndex();
this.getDomNode().style.display="none";
var _a9e=document.createElement("div");
_a9e.className="content";
this.setContentNode(_a9e);
_a9d.appendChild(_a9e);
var wait=document.createElement("div");
wait.className="wait";
wait.style.display="none";
wait.style._height="1%";
wait.innerHTML="<table style=\"width:100%;height:100%;\"><tr><td style=\"text-align:center;vertical-align:middle;\">"+app.i18n.get("loading")+"<br/><img src=\"lib/style/images/progress.gif\" style=\"vertical-align:middle;\">"+"</td></tr></table>";
this.setWaitNode(wait);
_a9d.appendChild(wait);
dojo.event.connectOnce(this.getDomNode(),"onkeypress",this,"_onKeyPress");
this.setCreated(true);
},load:function(){
if(!this.isAppended()){
this.append();
}
if(this.isTemplateLoaded()){
this.onLoad();
}
},_onKeyPress:function(_aa0){
_aa0.stopPropagation();
this.onKeyPress(_aa0);
},onKeyPress:function(_aa1){
},show:function(){
dojo.event.connectOnce(this,"onLoad",this,"showFrame");
this.load();
},showFrame:function(){
this.getDomNode().style.display="block";
this.setDisplayed(true);
if(!this.isLoading()&&this.isTemplateLoaded()){
this.onShow();
}
},append:function(){
this.getOwner().getDomNode().appendChild(this.getDomNode());
this.setAppended(true);
this.onCreate();
}});
dojo.provide("dojo.html.iframe");
dojo.require("dojo.html.util");
dojo.html.iframeContentWindow=function(_aa2){
var win=dojo.html.getDocumentWindow(dojo.html.iframeContentDocument(_aa2))||dojo.html.iframeContentDocument(_aa2).__parent__||(_aa2.name&&document.frames[_aa2.name])||null;
return win;
};
dojo.html.iframeContentDocument=function(_aa4){
var doc=_aa4.contentDocument||((_aa4.contentWindow)&&(_aa4.contentWindow.document))||((_aa4.name)&&(document.frames[_aa4.name])&&(document.frames[_aa4.name].document))||null;
return doc;
};
dojo.html.BackgroundIframe=function(node){
if(dojo.render.html.ie55||dojo.render.html.ie60){
var html="<iframe src='javascript:false'"+" style='position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"+"z-index: -1; filter:Alpha(Opacity=\"0\");' "+">";
this.iframe=dojo.doc().createElement(html);
this.iframe.tabIndex=-1;
if(node){
node.appendChild(this.iframe);
this.domNode=node;
}else{
dojo.body().appendChild(this.iframe);
this.iframe.style.display="none";
}
}
};
dojo.lang.extend(dojo.html.BackgroundIframe,{iframe:null,onResized:function(){
if(this.iframe&&this.domNode&&this.domNode.parentNode){
var _aa8=dojo.html.getMarginBox(this.domNode);
if(_aa8.width==0||_aa8.height==0){
dojo.lang.setTimeout(this,this.onResized,100);
return;
}
this.iframe.style.width=_aa8.width+"px";
this.iframe.style.height=_aa8.height+"px";
}
},size:function(node){
if(!this.iframe){
return;
}
var _aaa=dojo.html.toCoordinateObject(node,true,dojo.html.boxSizing.BORDER_BOX);
with(this.iframe.style){
width=_aaa.width+"px";
height=_aaa.height+"px";
left=_aaa.left+"px";
top=_aaa.top+"px";
}
},setZIndex:function(node){
if(!this.iframe){
return;
}
if(dojo.dom.isNode(node)){
this.iframe.style.zIndex=dojo.html.getStyle(node,"z-index")-1;
}else{
if(!isNaN(node)){
this.iframe.style.zIndex=node;
}
}
},show:function(){
if(this.iframe){
this.iframe.style.display="block";
}
},hide:function(){
if(this.iframe){
this.iframe.style.display="none";
}
},remove:function(){
if(this.iframe){
dojo.html.removeNode(this.iframe,true);
delete this.iframe;
this.iframe=null;
}
}});
dojo.require("dojo.lang.common");
dojo.require("dojo.lang.func");
dojo.require("dojo.lang.declare");
dojo.provide("dojo.dnd.DragAndDrop");
dojo.declare("dojo.dnd.DragSource",null,{type:"",onDragEnd:function(evt){
},onDragStart:function(evt){
},onSelected:function(evt){
},unregister:function(){
dojo.dnd.dragManager.unregisterDragSource(this);
},reregister:function(){
dojo.dnd.dragManager.registerDragSource(this);
}});
dojo.declare("dojo.dnd.DragObject",null,{type:"",register:function(){
var dm=dojo.dnd.dragManager;
if(dm["registerDragObject"]){
dm.registerDragObject(this);
}
},onDragStart:function(evt){
},onDragMove:function(evt){
},onDragOver:function(evt){
},onDragOut:function(evt){
},onDragEnd:function(evt){
},onDragLeave:dojo.lang.forward("onDragOut"),onDragEnter:dojo.lang.forward("onDragOver"),ondragout:dojo.lang.forward("onDragOut"),ondragover:dojo.lang.forward("onDragOver")});
dojo.declare("dojo.dnd.DropTarget",null,{acceptsType:function(type){
if(!dojo.lang.inArray(this.acceptedTypes,"*")){
if(!dojo.lang.inArray(this.acceptedTypes,type)){
return false;
}
}
return true;
},accepts:function(_ab6){
if(!dojo.lang.inArray(this.acceptedTypes,"*")){
for(var i=0;i<_ab6.length;i++){
if(!dojo.lang.inArray(this.acceptedTypes,_ab6[i].type)){
return false;
}
}
}
return true;
},unregister:function(){
dojo.dnd.dragManager.unregisterDropTarget(this);
},onDragOver:function(evt){
},onDragOut:function(evt){
},onDragMove:function(evt){
},onDropStart:function(evt){
},onDrop:function(evt){
},onDropEnd:function(){
}},function(){
this.acceptedTypes=[];
});
dojo.dnd.DragEvent=function(){
this.dragSource=null;
this.dragObject=null;
this.target=null;
this.eventStatus="success";
};
dojo.declare("dojo.dnd.DragManager",null,{selectedSources:[],dragObjects:[],dragSources:[],registerDragSource:function(_abd){
},dropTargets:[],registerDropTarget:function(_abe){
},lastDragTarget:null,currentDragTarget:null,onKeyDown:function(){
},onMouseOut:function(){
},onMouseMove:function(){
},onMouseUp:function(){
}});
dojo.provide("dojo.dnd.HtmlDragManager");
dojo.require("dojo.dnd.DragAndDrop");
dojo.require("dojo.event.*");
dojo.require("dojo.lang.array");
dojo.require("dojo.html.common");
dojo.require("dojo.html.layout");
dojo.declare("dojo.dnd.HtmlDragManager",dojo.dnd.DragManager,{disabled:false,nestedTargets:false,mouseDownTimer:null,dsCounter:0,dsPrefix:"dojoDragSource",dropTargetDimensions:[],currentDropTarget:null,previousDropTarget:null,_dragTriggered:false,selectedSources:[],dragObjects:[],dragSources:[],dropTargets:[],currentX:null,currentY:null,lastX:null,lastY:null,mouseDownX:null,mouseDownY:null,threshold:7,dropAcceptable:false,cancelEvent:function(e){
e.stopPropagation();
e.preventDefault();
},registerDragSource:function(ds){
if(ds["domNode"]){
var dp=this.dsPrefix;
var _ac2=dp+"Idx_"+(this.dsCounter++);
ds.dragSourceId=_ac2;
this.dragSources[_ac2]=ds;
ds.domNode.setAttribute(dp,_ac2);
if(dojo.render.html.ie){
dojo.event.browser.addListener(ds.domNode,"ondragstart",this.cancelEvent);
}
}
},unregisterDragSource:function(ds){
if(ds["domNode"]){
var dp=this.dsPrefix;
var _ac5=ds.dragSourceId;
delete ds.dragSourceId;
delete this.dragSources[_ac5];
ds.domNode.setAttribute(dp,null);
if(dojo.render.html.ie){
dojo.event.browser.removeListener(ds.domNode,"ondragstart",this.cancelEvent);
}
}
},registerDropTarget:function(dt){
this.dropTargets.push(dt);
},unregisterDropTarget:function(dt){
var _ac8=dojo.lang.find(this.dropTargets,dt,true);
if(_ac8>=0){
this.dropTargets.splice(_ac8,1);
}
},getDragSource:function(e){
var tn=e.target;
if(tn===dojo.body()){
return;
}
var ta=dojo.html.getAttribute(tn,this.dsPrefix);
while((!ta)&&(tn)){
tn=tn.parentNode;
if((!tn)||(tn===dojo.body())){
return;
}
ta=dojo.html.getAttribute(tn,this.dsPrefix);
}
return this.dragSources[ta];
},onKeyDown:function(e){
},onMouseDown:function(e){
if(this.disabled){
return;
}
if(dojo.render.html.ie){
if(e.button!=1){
return;
}
}else{
if(e.which!=1){
return;
}
}
var _ace=e.target.nodeType==dojo.html.TEXT_NODE?e.target.parentNode:e.target;
if(dojo.html.isTag(_ace,"button","textarea","input","select","option")){
return;
}
var ds=this.getDragSource(e);
if(!ds){
return;
}
if(!dojo.lang.inArray(this.selectedSources,ds)){
this.selectedSources.push(ds);
ds.onSelected();
}
this.mouseDownX=e.pageX;
this.mouseDownY=e.pageY;
e.preventDefault();
dojo.event.connect(document,"onmousemove",this,"onMouseMove");
},onMouseUp:function(e,_ad1){
if(this.selectedSources.length==0){
return;
}
this.mouseDownX=null;
this.mouseDownY=null;
this._dragTriggered=false;
e.dragSource=this.dragSource;
if((!e.shiftKey)&&(!e.ctrlKey)){
if(this.currentDropTarget){
this.currentDropTarget.onDropStart();
}
dojo.lang.forEach(this.dragObjects,function(_ad2){
var ret=null;
if(!_ad2){
return;
}
if(this.currentDropTarget){
e.dragObject=_ad2;
var ce=this.currentDropTarget.domNode.childNodes;
if(ce.length>0){
e.dropTarget=ce[0];
while(e.dropTarget==_ad2.domNode){
e.dropTarget=e.dropTarget.nextSibling;
}
}else{
e.dropTarget=this.currentDropTarget.domNode;
}
if(this.dropAcceptable){
ret=this.currentDropTarget.onDrop(e);
}else{
this.currentDropTarget.onDragOut(e);
}
}
e.dragStatus=this.dropAcceptable&&ret?"dropSuccess":"dropFailure";
dojo.lang.delayThese([function(){
try{
_ad2.dragSource.onDragEnd(e);
}
catch(err){
var _ad5={};
for(var i in e){
if(i=="type"){
_ad5.type="mouseup";
continue;
}
_ad5[i]=e[i];
}
_ad2.dragSource.onDragEnd(_ad5);
}
},function(){
_ad2.onDragEnd(e);
}]);
},this);
this.selectedSources=[];
this.dragObjects=[];
this.dragSource=null;
if(this.currentDropTarget){
this.currentDropTarget.onDropEnd();
}
}else{
}
dojo.event.disconnect(document,"onmousemove",this,"onMouseMove");
this.currentDropTarget=null;
},onScroll:function(){
for(var i=0;i<this.dragObjects.length;i++){
if(this.dragObjects[i].updateDragOffset){
this.dragObjects[i].updateDragOffset();
}
}
if(this.dragObjects.length){
this.cacheTargetLocations();
}
},_dragStartDistance:function(x,y){
if((!this.mouseDownX)||(!this.mouseDownX)){
return;
}
var dx=Math.abs(x-this.mouseDownX);
var dx2=dx*dx;
var dy=Math.abs(y-this.mouseDownY);
var dy2=dy*dy;
return parseInt(Math.sqrt(dx2+dy2),10);
},cacheTargetLocations:function(){
dojo.profile.start("cacheTargetLocations");
this.dropTargetDimensions=[];
dojo.lang.forEach(this.dropTargets,function(_ade){
var tn=_ade.domNode;
if(!tn||!_ade.accepts([this.dragSource])){
return;
}
var abs=dojo.html.getAbsolutePosition(tn,true);
var bb=dojo.html.getBorderBox(tn);
this.dropTargetDimensions.push([[abs.x,abs.y],[abs.x+bb.width,abs.y+bb.height],_ade]);
},this);
dojo.profile.end("cacheTargetLocations");
},onMouseMove:function(e){
if((dojo.render.html.ie)&&(e.button!=1)){
this.currentDropTarget=null;
this.onMouseUp(e,true);
return;
}
if((this.selectedSources.length)&&(!this.dragObjects.length)){
var dx;
var dy;
if(!this._dragTriggered){
this._dragTriggered=(this._dragStartDistance(e.pageX,e.pageY)>this.threshold);
if(!this._dragTriggered){
return;
}
dx=e.pageX-this.mouseDownX;
dy=e.pageY-this.mouseDownY;
}
this.dragSource=this.selectedSources[0];
dojo.lang.forEach(this.selectedSources,function(_ae5){
if(!_ae5){
return;
}
var tdo=_ae5.onDragStart(e);
if(tdo){
tdo.onDragStart(e);
tdo.dragOffset.y+=dy;
tdo.dragOffset.x+=dx;
tdo.dragSource=_ae5;
this.dragObjects.push(tdo);
}
},this);
this.previousDropTarget=null;
this.cacheTargetLocations();
}
dojo.lang.forEach(this.dragObjects,function(_ae7){
if(_ae7){
_ae7.onDragMove(e);
}
});
if(this.currentDropTarget){
var c=dojo.html.toCoordinateObject(this.currentDropTarget.domNode,true);
var dtp=[[c.x,c.y],[c.x+c.width,c.y+c.height]];
}
if((!this.nestedTargets)&&(dtp)&&(this.isInsideBox(e,dtp))){
if(this.dropAcceptable){
this.currentDropTarget.onDragMove(e,this.dragObjects);
}
}else{
var _aea=this.findBestTarget(e);
if(_aea.target===null){
if(this.currentDropTarget){
this.currentDropTarget.onDragOut(e);
this.previousDropTarget=this.currentDropTarget;
this.currentDropTarget=null;
}
this.dropAcceptable=false;
return;
}
if(this.currentDropTarget!==_aea.target){
if(this.currentDropTarget){
this.previousDropTarget=this.currentDropTarget;
this.currentDropTarget.onDragOut(e);
}
this.currentDropTarget=_aea.target;
e.dragObjects=this.dragObjects;
this.dropAcceptable=this.currentDropTarget.onDragOver(e);
}else{
if(this.dropAcceptable){
this.currentDropTarget.onDragMove(e,this.dragObjects);
}
}
}
},findBestTarget:function(e){
var _aec=this;
var _aed=new Object();
_aed.target=null;
_aed.points=null;
dojo.lang.every(this.dropTargetDimensions,function(_aee){
if(!_aec.isInsideBox(e,_aee)){
return true;
}
_aed.target=_aee[2];
_aed.points=_aee;
return Boolean(_aec.nestedTargets);
});
return _aed;
},isInsideBox:function(e,_af0){
if((e.pageX>_af0[0][0])&&(e.pageX<_af0[1][0])&&(e.pageY>_af0[0][1])&&(e.pageY<_af0[1][1])){
return true;
}
return false;
},onMouseOver:function(e){
},onMouseOut:function(e){
}});
dojo.dnd.dragManager=new dojo.dnd.HtmlDragManager();
(function(){
var d=document;
var dm=dojo.dnd.dragManager;
dojo.event.connect(d,"onkeydown",dm,"onKeyDown");
dojo.event.connect(d,"onmouseover",dm,"onMouseOver");
dojo.event.connect(d,"onmouseout",dm,"onMouseOut");
dojo.event.connect(d,"onmousedown",dm,"onMouseDown");
dojo.event.connect(d,"onmouseup",dm,"onMouseUp");
dojo.event.connect(window,"onscroll",dm,"onScroll");
})();
dojo.require("dojo.html.common");
dojo.provide("dojo.html.selection");
dojo.require("dojo.dom");
dojo.require("dojo.lang.common");
dojo.html.selectionType={NONE:0,TEXT:1,CONTROL:2};
dojo.html.clearSelection=function(){
var _af5=dojo.global();
var _af6=dojo.doc();
try{
if(_af5["getSelection"]){
if(dojo.render.html.safari){
_af5.getSelection().collapse();
}else{
_af5.getSelection().removeAllRanges();
}
}else{
if(_af6.selection){
if(_af6.selection.empty){
_af6.selection.empty();
}else{
if(_af6.selection.clear){
_af6.selection.clear();
}
}
}
}
return true;
}
catch(e){
dojo.debug(e);
return false;
}
};
dojo.html.disableSelection=function(_af7){
_af7=dojo.byId(_af7)||dojo.body();
var h=dojo.render.html;
if(h.mozilla){
_af7.style.MozUserSelect="none";
}else{
if(h.safari){
_af7.style.KhtmlUserSelect="none";
}else{
if(h.ie){
_af7.unselectable="on";
}else{
return false;
}
}
}
return true;
};
dojo.html.enableSelection=function(_af9){
_af9=dojo.byId(_af9)||dojo.body();
var h=dojo.render.html;
if(h.mozilla){
_af9.style.MozUserSelect="";
}else{
if(h.safari){
_af9.style.KhtmlUserSelect="";
}else{
if(h.ie){
_af9.unselectable="off";
}else{
return false;
}
}
}
return true;
};
dojo.html.selectElement=function(_afb){
dojo.deprecated("dojo.html.selectElement","replaced by dojo.html.selection.selectElementChildren",0.5);
};
dojo.html.selectInputText=function(_afc){
var _afd=dojo.global();
var _afe=dojo.doc();
_afc=dojo.byId(_afc);
if(_afe["selection"]&&dojo.body()["createTextRange"]){
var _aff=_afc.createTextRange();
_aff.moveStart("character",0);
_aff.moveEnd("character",_afc.value.length);
_aff.select();
}else{
if(_afd["getSelection"]){
var _b00=_afd.getSelection();
_afc.setSelectionRange(0,_afc.value.length);
}
}
_afc.focus();
};
dojo.html.isSelectionCollapsed=function(){
dojo.deprecated("dojo.html.isSelectionCollapsed","replaced by dojo.html.selection.isCollapsed",0.5);
return dojo.html.selection.isCollapsed();
};
dojo.lang.mixin(dojo.html.selection,{getType:function(){
if(dojo.doc()["selection"]){
return dojo.html.selectionType[dojo.doc().selection.type.toUpperCase()];
}else{
var _b01=dojo.html.selectionType.TEXT;
var oSel;
try{
oSel=dojo.global().getSelection();
}
catch(e){
}
if(oSel&&oSel.rangeCount==1){
var _b03=oSel.getRangeAt(0);
if(_b03.startContainer==_b03.endContainer&&(_b03.endOffset-_b03.startOffset)==1&&_b03.startContainer.nodeType!=dojo.dom.TEXT_NODE){
_b01=dojo.html.selectionType.CONTROL;
}
}
return _b01;
}
},isCollapsed:function(){
var _b04=dojo.global();
var _b05=dojo.doc();
if(_b05["selection"]){
return _b05.selection.createRange().text=="";
}else{
if(_b04["getSelection"]){
var _b06=_b04.getSelection();
if(dojo.lang.isString(_b06)){
return _b06=="";
}else{
return _b06.isCollapsed||_b06.toString()=="";
}
}
}
},getSelectedElement:function(){
if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){
if(dojo.doc()["selection"]){
var _b07=dojo.doc().selection.createRange();
if(_b07&&_b07.item){
return dojo.doc().selection.createRange().item(0);
}
}else{
var _b08=dojo.global().getSelection();
return _b08.anchorNode.childNodes[_b08.anchorOffset];
}
}
},getParentElement:function(){
if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){
var p=dojo.html.selection.getSelectedElement();
if(p){
return p.parentNode;
}
}else{
if(dojo.doc()["selection"]){
return dojo.doc().selection.createRange().parentElement();
}else{
var _b0a=dojo.global().getSelection();
if(_b0a){
var node=_b0a.anchorNode;
while(node&&node.nodeType!=dojo.dom.ELEMENT_NODE){
node=node.parentNode;
}
return node;
}
}
}
},getSelectedText:function(){
if(dojo.doc()["selection"]){
if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){
return null;
}
return dojo.doc().selection.createRange().text;
}else{
var _b0c=dojo.global().getSelection();
if(_b0c){
return _b0c.toString();
}
}
},getSelectedHtml:function(){
if(dojo.doc()["selection"]){
if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){
return null;
}
return dojo.doc().selection.createRange().htmlText;
}else{
var _b0d=dojo.global().getSelection();
if(_b0d&&_b0d.rangeCount){
var frag=_b0d.getRangeAt(0).cloneContents();
var div=document.createElement("div");
div.appendChild(frag);
return div.innerHTML;
}
return null;
}
},hasAncestorElement:function(_b10){
return (dojo.html.selection.getAncestorElement.apply(this,arguments)!=null);
},getAncestorElement:function(_b11){
var node=dojo.html.selection.getSelectedElement()||dojo.html.selection.getParentElement();
while(node){
if(dojo.html.selection.isTag(node,arguments).length>0){
return node;
}
node=node.parentNode;
}
return null;
},isTag:function(node,tags){
if(node&&node.tagName){
for(var i=0;i<tags.length;i++){
if(node.tagName.toLowerCase()==String(tags[i]).toLowerCase()){
return String(tags[i]).toLowerCase();
}
}
}
return "";
},selectElement:function(_b16){
var _b17=dojo.global();
var _b18=dojo.doc();
_b16=dojo.byId(_b16);
if(_b18.selection&&dojo.body().createTextRange){
try{
var _b19=dojo.body().createControlRange();
_b19.addElement(_b16);
_b19.select();
}
catch(e){
dojo.html.selection.selectElementChildren(_b16);
}
}else{
if(_b17["getSelection"]){
var _b1a=_b17.getSelection();
if(_b1a["removeAllRanges"]){
var _b19=_b18.createRange();
_b19.selectNode(_b16);
_b1a.removeAllRanges();
_b1a.addRange(_b19);
}
}
}
},selectElementChildren:function(_b1b){
var _b1c=dojo.global();
var _b1d=dojo.doc();
_b1b=dojo.byId(_b1b);
if(_b1d.selection&&dojo.body().createTextRange){
var _b1e=dojo.body().createTextRange();
_b1e.moveToElementText(_b1b);
_b1e.select();
}else{
if(_b1c["getSelection"]){
var _b1f=_b1c.getSelection();
if(_b1f["setBaseAndExtent"]){
_b1f.setBaseAndExtent(_b1b,0,_b1b,_b1b.innerText.length-1);
}else{
if(_b1f["selectAllChildren"]){
_b1f.selectAllChildren(_b1b);
}
}
}
}
},getBookmark:function(){
var _b20;
var _b21=dojo.doc();
if(_b21["selection"]){
var _b22=_b21.selection.createRange();
_b20=_b22.getBookmark();
}else{
var _b23;
try{
_b23=dojo.global().getSelection();
}
catch(e){
}
if(_b23){
var _b22=_b23.getRangeAt(0);
_b20=_b22.cloneRange();
}else{
dojo.debug("No idea how to store the current selection for this browser!");
}
}
return _b20;
},moveToBookmark:function(_b24){
var _b25=dojo.doc();
if(_b25["selection"]){
var _b26=_b25.selection.createRange();
_b26.moveToBookmark(_b24);
_b26.select();
}else{
var _b27;
try{
_b27=dojo.global().getSelection();
}
catch(e){
}
if(_b27&&_b27["removeAllRanges"]){
_b27.removeAllRanges();
_b27.addRange(_b24);
}else{
dojo.debug("No idea how to restore selection for this browser!");
}
}
},collapse:function(_b28){
if(dojo.global()["getSelection"]){
var _b29=dojo.global().getSelection();
if(_b29.removeAllRanges){
if(_b28){
_b29.collapseToStart();
}else{
_b29.collapseToEnd();
}
}else{
dojo.global().getSelection().collapse(_b28);
}
}else{
if(dojo.doc().selection){
var _b2a=dojo.doc().selection.createRange();
_b2a.collapse(_b28);
_b2a.select();
}
}
},remove:function(){
if(dojo.doc().selection){
var _b2b=dojo.doc().selection;
if(_b2b.type.toUpperCase()!="NONE"){
_b2b.clear();
}
return _b2b;
}else{
var _b2b=dojo.global().getSelection();
for(var i=0;i<_b2b.rangeCount;i++){
_b2b.getRangeAt(i).deleteContents();
}
return _b2b;
}
}});
dojo.provide("dojo.dnd.HtmlDragAndDrop");
dojo.require("dojo.dnd.HtmlDragManager");
dojo.require("dojo.dnd.DragAndDrop");
dojo.require("dojo.html.*");
dojo.require("dojo.html.display");
dojo.require("dojo.html.util");
dojo.require("dojo.html.selection");
dojo.require("dojo.html.iframe");
dojo.require("dojo.lang.extras");
dojo.require("dojo.lfx.*");
dojo.require("dojo.event.*");
dojo.declare("dojo.dnd.HtmlDragSource",dojo.dnd.DragSource,{dragClass:"",onDragStart:function(){
var _b2d=new dojo.dnd.HtmlDragObject(this.dragObject,this.type);
if(this.dragClass){
_b2d.dragClass=this.dragClass;
}
if(this.constrainToContainer){
_b2d.constrainTo(this.constrainingContainer||this.domNode.parentNode);
}
return _b2d;
},setDragHandle:function(node){
node=dojo.byId(node);
dojo.dnd.dragManager.unregisterDragSource(this);
this.domNode=node;
dojo.dnd.dragManager.registerDragSource(this);
},setDragTarget:function(node){
this.dragObject=node;
},constrainTo:function(_b30){
this.constrainToContainer=true;
if(_b30){
this.constrainingContainer=_b30;
}
},onSelected:function(){
for(var i=0;i<this.dragObjects.length;i++){
dojo.dnd.dragManager.selectedSources.push(new dojo.dnd.HtmlDragSource(this.dragObjects[i]));
}
},addDragObjects:function(el){
for(var i=0;i<arguments.length;i++){
this.dragObjects.push(dojo.byId(arguments[i]));
}
}},function(node,type){
node=dojo.byId(node);
this.dragObjects=[];
this.constrainToContainer=false;
if(node){
this.domNode=node;
this.dragObject=node;
this.type=(type)||(this.domNode.nodeName.toLowerCase());
dojo.dnd.DragSource.prototype.reregister.call(this);
}
});
dojo.declare("dojo.dnd.HtmlDragObject",dojo.dnd.DragObject,{dragClass:"",opacity:0.5,createIframe:true,disableX:false,disableY:false,createDragNode:function(){
var node=this.domNode.cloneNode(true);
if(this.dragClass){
dojo.html.addClass(node,this.dragClass);
}
if(this.opacity<1){
dojo.html.setOpacity(node,this.opacity);
}
var ltn=node.tagName.toLowerCase();
var isTr=(ltn=="tr");
if((isTr)||(ltn=="tbody")){
var doc=this.domNode.ownerDocument;
var _b3a=doc.createElement("table");
if(isTr){
var _b3b=doc.createElement("tbody");
_b3a.appendChild(_b3b);
_b3b.appendChild(node);
}else{
_b3a.appendChild(node);
}
var _b3c=((isTr)?this.domNode:this.domNode.firstChild);
var _b3d=((isTr)?node:node.firstChild);
var _b3e=_b3c.childNodes;
var _b3f=_b3d.childNodes;
for(var i=0;i<_b3e.length;i++){
if((_b3f[i])&&(_b3f[i].style)){
_b3f[i].style.width=dojo.html.getContentBox(_b3e[i]).width+"px";
}
}
node=_b3a;
}
if((dojo.render.html.ie55||dojo.render.html.ie60)&&this.createIframe){
with(node.style){
top="0px";
left="0px";
}
var _b41=document.createElement("div");
_b41.appendChild(node);
this.bgIframe=new dojo.html.BackgroundIframe(_b41);
_b41.appendChild(this.bgIframe.iframe);
node=_b41;
}
node.style.zIndex=999;
return node;
},onDragStart:function(e){
dojo.html.clearSelection();
this.scrollOffset=dojo.html.getScroll().offset;
this.dragStartPosition=dojo.html.getAbsolutePosition(this.domNode,true);
this.dragOffset={y:this.dragStartPosition.y-e.pageY,x:this.dragStartPosition.x-e.pageX};
this.dragClone=this.createDragNode();
this.containingBlockPosition=this.domNode.offsetParent?dojo.html.getAbsolutePosition(this.domNode.offsetParent,true):{x:0,y:0};
if(this.constrainToContainer){
this.constraints=this.getConstraints();
}
with(this.dragClone.style){
position="absolute";
top=this.dragOffset.y+e.pageY+"px";
left=this.dragOffset.x+e.pageX+"px";
}
dojo.body().appendChild(this.dragClone);
dojo.event.topic.publish("dragStart",{source:this});
},getConstraints:function(){
if(this.constrainingContainer.nodeName.toLowerCase()=="body"){
var _b43=dojo.html.getViewport();
var _b44=_b43.width;
var _b45=_b43.height;
var _b46=dojo.html.getScroll().offset;
var x=_b46.x;
var y=_b46.y;
}else{
var _b49=dojo.html.getContentBox(this.constrainingContainer);
_b44=_b49.width;
_b45=_b49.height;
x=this.containingBlockPosition.x+dojo.html.getPixelValue(this.constrainingContainer,"padding-left",true)+dojo.html.getBorderExtent(this.constrainingContainer,"left");
y=this.containingBlockPosition.y+dojo.html.getPixelValue(this.constrainingContainer,"padding-top",true)+dojo.html.getBorderExtent(this.constrainingContainer,"top");
}
var mb=dojo.html.getMarginBox(this.domNode);
return {minX:x,minY:y,maxX:x+_b44-mb.width,maxY:y+_b45-mb.height};
},updateDragOffset:function(){
var _b4b=dojo.html.getScroll().offset;
if(_b4b.y!=this.scrollOffset.y){
var diff=_b4b.y-this.scrollOffset.y;
this.dragOffset.y+=diff;
this.scrollOffset.y=_b4b.y;
}
if(_b4b.x!=this.scrollOffset.x){
var diff=_b4b.x-this.scrollOffset.x;
this.dragOffset.x+=diff;
this.scrollOffset.x=_b4b.x;
}
},onDragMove:function(e){
this.updateDragOffset();
var x=this.dragOffset.x+e.pageX;
var y=this.dragOffset.y+e.pageY;
if(this.constrainToContainer){
if(x<this.constraints.minX){
x=this.constraints.minX;
}
if(y<this.constraints.minY){
y=this.constraints.minY;
}
if(x>this.constraints.maxX){
x=this.constraints.maxX;
}
if(y>this.constraints.maxY){
y=this.constraints.maxY;
}
}
this.setAbsolutePosition(x,y);
dojo.event.topic.publish("dragMove",{source:this});
},setAbsolutePosition:function(x,y){
if(!this.disableY){
this.dragClone.style.top=y+"px";
}
if(!this.disableX){
this.dragClone.style.left=x+"px";
}
},onDragEnd:function(e){
switch(e.dragStatus){
case "dropSuccess":
dojo.html.removeNode(this.dragClone);
this.dragClone=null;
break;
case "dropFailure":
var _b53=dojo.html.getAbsolutePosition(this.dragClone,true);
var _b54={left:this.dragStartPosition.x+1,top:this.dragStartPosition.y+1};
var anim=dojo.lfx.slideTo(this.dragClone,_b54,300);
var _b56=this;
dojo.event.connect(anim,"onEnd",function(e){
dojo.html.removeNode(_b56.dragClone);
_b56.dragClone=null;
});
anim.play();
break;
}
dojo.event.topic.publish("dragEnd",{source:this});
},constrainTo:function(_b58){
this.constrainToContainer=true;
if(_b58){
this.constrainingContainer=_b58;
}else{
this.constrainingContainer=this.domNode.parentNode;
}
}},function(node,type){
this.domNode=dojo.byId(node);
this.type=type;
this.constrainToContainer=false;
this.dragSource=null;
dojo.dnd.DragObject.prototype.register.call(this);
});
dojo.declare("dojo.dnd.HtmlDropTarget",dojo.dnd.DropTarget,{vertical:false,onDragOver:function(e){
if(!this.accepts(e.dragObjects)){
return false;
}
this.childBoxes=[];
for(var i=0,_b5d;i<this.domNode.childNodes.length;i++){
_b5d=this.domNode.childNodes[i];
if(_b5d.nodeType!=dojo.html.ELEMENT_NODE){
continue;
}
var pos=dojo.html.getAbsolutePosition(_b5d,true);
var _b5f=dojo.html.getBorderBox(_b5d);
this.childBoxes.push({top:pos.y,bottom:pos.y+_b5f.height,left:pos.x,right:pos.x+_b5f.width,height:_b5f.height,width:_b5f.width,node:_b5d});
}
return true;
},_getNodeUnderMouse:function(e){
for(var i=0,_b62;i<this.childBoxes.length;i++){
with(this.childBoxes[i]){
if(e.pageX>=left&&e.pageX<=right&&e.pageY>=top&&e.pageY<=bottom){
return i;
}
}
}
return -1;
},createDropIndicator:function(){
this.dropIndicator=document.createElement("div");
with(this.dropIndicator.style){
position="absolute";
zIndex=999;
if(this.vertical){
borderLeftWidth="1px";
borderLeftColor="black";
borderLeftStyle="solid";
height=dojo.html.getBorderBox(this.domNode).height+"px";
top=dojo.html.getAbsolutePosition(this.domNode,true).y+"px";
}else{
borderTopWidth="1px";
borderTopColor="black";
borderTopStyle="solid";
width=dojo.html.getBorderBox(this.domNode).width+"px";
left=dojo.html.getAbsolutePosition(this.domNode,true).x+"px";
}
}
},onDragMove:function(e,_b64){
var i=this._getNodeUnderMouse(e);
if(!this.dropIndicator){
this.createDropIndicator();
}
var _b66=this.vertical?dojo.html.gravity.WEST:dojo.html.gravity.NORTH;
var hide=false;
if(i<0){
if(this.childBoxes.length){
var _b68=(dojo.html.gravity(this.childBoxes[0].node,e)&_b66);
if(_b68){
hide=true;
}
}else{
var _b68=true;
}
}else{
var _b69=this.childBoxes[i];
var _b68=(dojo.html.gravity(_b69.node,e)&_b66);
if(_b69.node===_b64[0].dragSource.domNode){
hide=true;
}else{
var _b6a=_b68?(i>0?this.childBoxes[i-1]:_b69):(i<this.childBoxes.length-1?this.childBoxes[i+1]:_b69);
if(_b6a.node===_b64[0].dragSource.domNode){
hide=true;
}
}
}
if(hide){
this.dropIndicator.style.display="none";
return;
}else{
this.dropIndicator.style.display="";
}
this.placeIndicator(e,_b64,i,_b68);
if(!dojo.html.hasParent(this.dropIndicator)){
dojo.body().appendChild(this.dropIndicator);
}
},placeIndicator:function(e,_b6c,_b6d,_b6e){
var _b6f=this.vertical?"left":"top";
var _b70;
if(_b6d<0){
if(this.childBoxes.length){
_b70=_b6e?this.childBoxes[0]:this.childBoxes[this.childBoxes.length-1];
}else{
this.dropIndicator.style[_b6f]=dojo.html.getAbsolutePosition(this.domNode,true)[this.vertical?"x":"y"]+"px";
}
}else{
_b70=this.childBoxes[_b6d];
}
if(_b70){
this.dropIndicator.style[_b6f]=(_b6e?_b70[_b6f]:_b70[this.vertical?"right":"bottom"])+"px";
if(this.vertical){
this.dropIndicator.style.height=_b70.height+"px";
this.dropIndicator.style.top=_b70.top+"px";
}else{
this.dropIndicator.style.width=_b70.width+"px";
this.dropIndicator.style.left=_b70.left+"px";
}
}
},onDragOut:function(e){
if(this.dropIndicator){
dojo.html.removeNode(this.dropIndicator);
delete this.dropIndicator;
}
},onDrop:function(e){
this.onDragOut(e);
var i=this._getNodeUnderMouse(e);
var _b74=this.vertical?dojo.html.gravity.WEST:dojo.html.gravity.NORTH;
if(i<0){
if(this.childBoxes.length){
if(dojo.html.gravity(this.childBoxes[0].node,e)&_b74){
return this.insert(e,this.childBoxes[0].node,"before");
}else{
return this.insert(e,this.childBoxes[this.childBoxes.length-1].node,"after");
}
}
return this.insert(e,this.domNode,"append");
}
var _b75=this.childBoxes[i];
if(dojo.html.gravity(_b75.node,e)&_b74){
return this.insert(e,_b75.node,"before");
}else{
return this.insert(e,_b75.node,"after");
}
},insert:function(e,_b77,_b78){
var node=e.dragObject.domNode;
if(_b78=="before"){
return dojo.html.insertBefore(node,_b77);
}else{
if(_b78=="after"){
return dojo.html.insertAfter(node,_b77);
}else{
if(_b78=="append"){
_b77.appendChild(node);
return true;
}
}
}
return false;
}},function(node,_b7b){
if(arguments.length==0){
return;
}
this.domNode=dojo.byId(node);
dojo.dnd.DropTarget.call(this);
if(_b7b&&dojo.lang.isString(_b7b)){
_b7b=[_b7b];
}
this.acceptedTypes=_b7b||[];
dojo.dnd.dragManager.registerDropTarget(this);
});
dojo.kwCompoundRequire({common:["dojo.dnd.DragAndDrop"],browser:["dojo.dnd.HtmlDragAndDrop"],dashboard:["dojo.dnd.HtmlDragAndDrop"]});
dojo.provide("dojo.dnd.*");
dojo.provide("dojo.dnd.HtmlDragMove");
dojo.require("dojo.dnd.*");
dojo.declare("dojo.dnd.HtmlDragMoveSource",dojo.dnd.HtmlDragSource,{onDragStart:function(){
var _b7c=new dojo.dnd.HtmlDragMoveObject(this.dragObject,this.type);
if(this.constrainToContainer){
_b7c.constrainTo(this.constrainingContainer);
}
return _b7c;
},onSelected:function(){
for(var i=0;i<this.dragObjects.length;i++){
dojo.dnd.dragManager.selectedSources.push(new dojo.dnd.HtmlDragMoveSource(this.dragObjects[i]));
}
}});
dojo.declare("dojo.dnd.HtmlDragMoveObject",dojo.dnd.HtmlDragObject,{onDragStart:function(e){
dojo.html.clearSelection();
this.dragClone=this.domNode;
if(dojo.html.getComputedStyle(this.domNode,"position")!="absolute"){
this.domNode.style.position="relative";
}
var left=parseInt(dojo.html.getComputedStyle(this.domNode,"left"));
var top=parseInt(dojo.html.getComputedStyle(this.domNode,"top"));
this.dragStartPosition={x:isNaN(left)?0:left,y:isNaN(top)?0:top};
this.scrollOffset=dojo.html.getScroll().offset;
this.dragOffset={y:this.dragStartPosition.y-e.pageY,x:this.dragStartPosition.x-e.pageX};
this.containingBlockPosition={x:0,y:0};
if(this.constrainToContainer){
this.constraints=this.getConstraints();
}
dojo.event.connect(this.domNode,"onclick",this,"_squelchOnClick");
},onDragEnd:function(e){
},setAbsolutePosition:function(x,y){
if(!this.disableY){
this.domNode.style.top=y+"px";
}
if(!this.disableX){
this.domNode.style.left=x+"px";
}
},_squelchOnClick:function(e){
dojo.event.browser.stopEvent(e);
dojo.event.disconnect(this.domNode,"onclick",this,"_squelchOnClick");
}});
dojo.provide("qu.gui.Icon");
dojo.lang.declare("qu.gui.Icon",null,function(_b85,_b86){
this._size=_b86?_b86:16;
this._extension="png";
this._create();
this.setFilename(_b85);
},{_create:function(){
var img=document.createElement("img");
this.setDomNode(img);
},setDomNode:function(_b88){
this._domNode=_b88;
},getDomNode:function(){
return this._domNode;
},setFilename:function(_b89){
this._filename=_b89;
this.update();
},getFilename:function(){
return this._filename;
},getPath:function(){
return app.config.pathIcons+"/"+this.getSize()+"/"+this.getFilename()+"."+this.getExtension();
},setSize:function(_b8a){
this._size=_b8a;
},getSize:function(){
return this._size;
},getExtension:function(){
return this._extension;
},setExtension:function(_b8b){
this._extension=_b8b;
},update:function(){
var _b8c=this.getDomNode();
_b8c.setAttribute("src",this.getPath());
_b8c.style.width=this.getSize()+"px";
_b8c.style.height=this.getSize()+"px";
}});
dojo.provide("qu.gui.Dialog");
dojo.require("qu.gui.View");
dojo.require("dojo.html.*");
dojo.require("dojo.html.iframe");
dojo.require("dojo.dnd.HtmlDragMove");
dojo.require("qu.gui.Icon");
dojo.lang.declare("qu.gui.Dialog",qu.gui.View,function(_b8d){
this._title="untitled";
this._icon=null;
this.setOwner(_b8d);
this.create();
},{create:function(){
this.setCreated(true);
var _b8e=document.createElement("div");
this.setDomNode(_b8e);
_b8e.className="quDialog";
_b8e.style.display="none";
_b8e.style.position="absolute";
_b8e.style.zIndex=this.getOwner().getZIndex()+2;
this.titleContainerNode=document.createElement("div");
this.titleContainerNode.className="titleContainer";
_b8e.appendChild(this.titleContainerNode);
this.iconNode=document.createElement("img");
this.iconNode.className="icon";
this.iconNode.setAttribute("src","lib/style/images/default_icon.png");
this.titleContainerNode.appendChild(this.iconNode);
this.titleNode=document.createElement("span");
this.titleNode.className="title";
this.titleNode.innerHTML=this.getTitle();
this.titleContainerNode.appendChild(this.titleNode);
var _b8f=document.createElement("div");
_b8f.className="content";
_b8e.appendChild(_b8f);
this.setContentNode(_b8f);
var wait=document.createElement("div");
wait.className="wait";
wait.style.display="none";
wait.innerHTML="<table style=\"width:100%;height:100%;\"><tr><td style=\"text-align:center;vertical-align:middle;\">"+app.i18n.get("loading")+"<br/><img src=\"lib/style/images/progress.gif\" style=\"vertical-align:middle;\">"+"</td></tr></table>";
this.setWaitNode(wait);
_b8e.appendChild(wait);
this.setPosition(0,0);
this.setSize(0,0);
dojo.event.connectOnce(this.getDomNode(),"onkeypress",this,"_onKeyPress");
this._initDnd();
this.setCreated(true);
},append:function(){
dojo.body().appendChild(this.getDomNode());
this.setAppended(true);
this.onCreate();
},_initDnd:function(){
dojo.html.disableSelection(this.titleContainerNode);
var drag=new dojo.dnd.HtmlDragMoveSource(this.getDomNode());
drag.setDragHandle(this.titleContainerNode);
},_onKeyPress:function(_b92){
_b92.stopPropagation();
this.onKeyPress(_b92);
},onKeyPress:function(_b93){
switch(_b93.keyCode){
case _b93.KEY_ESCAPE:
this.hide();
break;
}
},getBackground:function(){
return app.background;
},getIframe:function(){
return app.iframe;
},_sizeBackground:function(){
var h=Math.max(document.documentElement.scrollHeight||document.body.scrollHeight,dojo.html.getViewport().height);
var w=dojo.html.getViewport().width;
var z=this.getOwner().getZIndex()+1;
with(this.getBackground().style){
width=w+"px";
height=h+"px";
zIndex=z;
}
this.getIframe().setZIndex(z+1);
this.getIframe().size(dojo.body());
},maximize:function(){
var _b97=dojo.html.getViewport();
this.setSize(_b97["width"]-20,_b97["height"]-20);
},center:function(){
var _b98=dojo.html.getScroll().offset;
var _b99=dojo.html.getViewport();
var w=this.getWidth();
var h=this.getHeight();
var x=_b98["x"]+(_b99["width"]-w)/2;
var y=(_b98["y"]+(_b99["height"]-h)/2)-16;
if(x<0){
x=0;
}
if(y<0){
y=0;
}
this.setPosition(x,y);
},showDialog:function(){
this.getDomNode().style.display="block";
this.setDisplayed(true);
if(!this.isLoading()&&this.isTemplateLoaded()){
this.onShow();
}
},hideDialog:function(){
this.getDomNode().style.display="none";
},showBackground:function(){
this._sizeBackground();
this.getBackground().style.display="block";
this.getIframe().show();
},hideBackground:function(){
try{
this.getOwner()._sizeBackground();
}
catch(e){
this.getBackground().style.display="none";
}
this.getIframe().hide();
},show:function(){
dojo.event.connectOnce(this,"onLoad",this,"showDialog");
if(!this.isAppended()){
this.append();
}
this.showBackground();
if(this.isTemplateLoaded()){
this.onLoad();
}
},hide:function(){
this.hideDialog();
this.hideBackground();
this.setDisplayed(false);
this.onHide();
},setTitle:function(_b9e){
this._title=_b9e;
this.titleNode.innerHTML=_b9e;
},getTitle:function(){
return this._title;
},setIcon:function(_b9f){
if(_b9f instanceof qu.gui.Icon){
this.iconNode.setAttribute("src",_b9f.getPath());
}else{
this.iconNode.setAttribute("src",_b9f);
}
this.iconNode.style.visibility="visible";
this._icon=_b9f;
},getIcon:function(){
return this._icon;
}});
app.iframe=new dojo.html.BackgroundIframe();
app.iframe.size(dojo.body());
dojo.provide("app.view.Templates");
app.template={Main:"<div style=\"min-width:750px;\">\t<!-- MSG BOX -->\t<div style=\"min-height:23px;margin-left:150px;\">\t\t<div quId=\"msgBoxContainer\" style=\"display:none;\">\t\t\t<table style=\"width:100%;border-collapse:collapse;\">\t\t\t\t<tr>\t\t\t\t\t<td style=\"width:50%\">&nbsp;</td>\t\t\t\t\t<td style=\"text-align:center;\">\t\t\t\t\t\t<div style=\"background-color:#FAD163; color:#364157;\">\t\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/yellow_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t\t<img src=\"app/web/images/corners/yellow_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div style=\"padding-left:6px;padding-right:6px;font-weight:bold;white-space:pre;\" quId=\"msgBox\"></div>\t\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/yellow_4x4_br.png') no-repeat top right;\">\t\t\t\t\t\t\t\t<img src=\"app/web/images/corners/yellow_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td style=\"width:50%\">&nbsp;</td>\t\t\t\t</tr>\t\t\t</table>\t\t</div>\t</div>\t\t<div style=\"text-align:right;padding-right:10px;\">\t\t<span>${app.i18n.loggedInAs} </span>\t\t<span quId=\"loggedAs\" style=\"font-weight:bold\"></span>\t\t<span>&nbsp;&#124;&nbsp;</span>\t\t<a href=\"javascript://\" quId=\"logout\" class=\"topMenu\">${app.i18n.logout}</a>\t</div>\t<div style=\"margin-top:5px;position:relative;\">\t\t<div class=\"mainMenu\">\t\t\t<div class=\"leftMenu\">\t\t\t\t<div quId=\"ticketsWrapper\" activeColor=\"#C3D9FF\" style=\"background-color:transparent\">\t\t\t\t\t<div quId=\"ticketsTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#tickets\" onClick=\"return false;\" quId=\"cmdTickets\" title=\"Ctrl + Shift + T\"><img src=\"${qu.global.icon('alarm.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.tickets}</a>\t\t\t\t\t\t<span quId=\"ticketsLabel\" style=\"display:none;cursor:pointer;\"><img src=\"${qu.global.icon('alarm.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.tickets}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"ticketsBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t\t<!-- FILTERS START -->\t\t\t\t<div class=\"mainFilter\" quId=\"filterContainer\" style=\"display:none;\">\t\t\t\t\t<div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter1\" class=\"mainFilter\"></a></div>\t\t\t\t\t<div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter2\" class=\"mainFilter\"></a></div>\t\t\t\t\t<div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter3\" class=\"mainFilter\"></a></div>\t\t\t\t\t<div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter4\" class=\"mainFilter\"></a></div>\t\t\t\t\t<div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter5\" class=\"mainFilter\"></a></div>                    <div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter6\" class=\"mainFilter\"></a></div>                    <div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter7\" class=\"mainFilter\"></a></div>                    <div><a href=\"#tickets\" onClick=\"return false;\" quId=\"filter8\" class=\"mainFilter\"></a></div>\t\t\t\t</div>\t\t\t\t<!-- FILTERS END -->\t\t\t\t<div quId=\"outboxWrapper\" activeColor=\"#C3D9FF\" style=\"background-color:transparent;display:none;\">\t\t\t\t\t<div quId=\"outboxTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#outbox\" onClick=\"return false;\" quId=\"cmdOutbox\" title=\"Ctrl + Shift + O\"><img src=\"${qu.global.icon('mail-forward.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.outbox}</a>\t\t\t\t\t\t<span quId=\"outboxLabel\" style=\"display:none;cursor:pointer;\"><img src=\"${qu.global.icon('mail-forward.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.outbox}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"outboxBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>                <div quId=\"downloadsWrapper\" activeColor=\"#C3D9FF\" style=\"background-color:transparent;display:none;\">                    <div quId=\"downloadsTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>                    <div style=\"padding-left:12px;\">                        <a href=\"#downloads\" onClick=\"return false;\" quId=\"cmdDownloads\" title=\"Ctrl + Shift + D\"><img src=\"${qu.global.icon('folder-locked.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.downloads}</a>                        <span quId=\"downloadsLabel\" style=\"display:none;cursor:pointer;\"><img src=\"${qu.global.icon('folder-locked.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.downloads}</span>                    </div>                    <div quId=\"downloadsBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>                </div>\t\t\t\t<div quId=\"usersWrapper\" activeColor=\"#B5EDBC\" style=\"background-color:transparent; display:none;\">\t\t\t\t\t<div quId=\"usersTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/green_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#users\" onClick=\"return false;\" quId=\"cmdUsers\" title=\"Ctrl + Shift  + U\"><img src=\"${qu.global.icon('user.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.users}</a>\t\t\t\t\t\t<span quId=\"usersLabel\" style=\"display:none;\"><img src=\"${qu.global.icon('user.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.users}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"usersBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/green_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t\t\t\t\t\t<div quId=\"reportsWrapper\" activeColor=\"#FFE6BF\" style=\"background-color:transparent; display:none;\">\t\t\t\t\t<div quId=\"reportsTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/corner_tl_reports.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#reports\" onClick=\"return false;\" quId=\"cmdReports\" title=\"Ctrl + Shift  + R\"><img src=\"${qu.global.icon('chart-bars.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.reports}</a>\t\t\t\t\t\t<span quId=\"reportsLabel\" style=\"display:none;\"><img src=\"${qu.global.icon('chart-bars.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.reports}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"reportsBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/corner_bl_reports.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t\t\t\t\t\t<div quId=\"kbaseWrapper\" activeColor=\"#CCCCCC\" style=\"background-color:transparent; display: none;\">\t\t\t\t\t<div quId=\"kbaseTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/silver_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#kbase\" onClick=\"return false;\" quId=\"cmdKbase\" title=\"Ctrl + Shift  + K\"><img src=\"${qu.global.icon('help-center.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.KnowledgeBase}</a>\t\t\t\t\t\t<span quId=\"kbaseLabel\" style=\"display:none;\"><img src=\"${qu.global.icon('help-center.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.KnowledgeBase}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"kbaseBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/silver_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t\t<div quId=\"settingsWrapper\" activeColor=\"#FAD163\" style=\"background-color:transparent; display:none;\">\t\t\t\t\t<div quId=\"settingsTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/yellow_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#settings\" onClick=\"return false;\" quId=\"cmdSettings\" title=\"Ctrl + Shift  + S\"><img src=\"${qu.global.icon('settings.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.settings}</a>\t\t\t\t\t\t<span quId=\"settingsLabel\" style=\"display:none;\"><img src=\"${qu.global.icon('settings.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.settings}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"settingsBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/yellow_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t\t\t\t\t\t<div quId=\"profileWrapper\" activeColor=\"#CCCCCC\" style=\"background-color:transparent\">\t\t\t\t\t<div quId=\"profileTl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/silver_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t\t<div style=\"padding-left:12px;\">\t\t\t\t\t\t<a href=\"#profile\" onClick=\"return false;\" quId=\"cmdProfile\" title=\"Ctrl + Shift  + P\"><img src=\"${qu.global.icon('3d.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.myProfile}</a>\t\t\t\t\t\t<span quId=\"profileLabel\" style=\"display:none;\"><img src=\"${qu.global.icon('3d.png',16)}\" style=\"width: 16px; height: 16px; border: none;\"/> ${app.i18n.myProfile}</span>\t\t\t\t\t</div>\t\t\t\t\t<div quId=\"profileBl\" style=\"visibility:hidden;\"><img src=\"app/web/images/corners/silver_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" /></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div quId=\"onlineAgentsContainer\" style=\"display:none; width: 140px; background-color: #CCCCCC; color: #364157; margin-left:6px; margin-top:16px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/silver_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/silver_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t\t<div style=\"padding-left:3px;\">\t\t\t\t\t<img src=\"app/web/images/online.gif\" style=\"margin-left:1px;\"/>\t\t\t\t\t<span style=\"font-weight:bold;\">${app.i18n.onlineAgents}</span>\t\t\t\t\t<div dojoType=\"qu:Grid\" quId=\"onlineAgents\"></div>\t\t\t\t</div>\t\t\t\t\t<div style=\"background: url('app/web/images/corners/silver_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/silver_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t\t<br/>\t\t\t\t\t</div>\t\t\t<div quId=\"mainContainer\" class=\"mainContainer\"></div>\t</div>\t<div class=\"mainContainer\" style=\"text-align:center;margin-top:8px;margin-bottom:8px;display:none;\" quId=\"footer\">\t\t&copy;2007&nbsp;\t\t<a href=\"http://www.qualityunit.com/supportcenter/\" target=\"_blank\" class=\"blue\"><img src=\"app/web/images/qu_badge.gif\" style=\"vertical-align:middle;border:none;\" /></a>\t\t<br/>\t\t<span quId=\"dbLevel\"></span>\t</div>\t<div quId=\"gearsInstallation\" style=\"display: none;font-size: xx-small;text-align: right;\">\t\t<a href=\"http://gears.google.com/?action=install\" target=\"_blank\">${app.i18n.installGoogleGears}</a>\t</div>\t</div>",profile:{notifications:{Notification:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<br/>\t${app.i18n.name} <input type=\"text\" quId=\"name\" style=\"width: 300px\" />\t<fieldset>\t\t<legend>${app.i18n.sendNotificationIf}</legend>\t\t\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsOwnedBy}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketOwner\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsAssignedToQueue}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsWithStatus}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketStatus\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsWithPriority}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketPriority\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.changes}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t</td>\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"statusCheck\" />\t\t\t\t\t<span>${app.i18n.statusChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toStatuses\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"queueCheck\" />\t\t\t\t\t<span>${app.i18n.queueChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toQueues\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"priorityCheck\" />\t\t\t\t\t<span>${app.i18n.priorityChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toPriorities\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"ownerCheck\" />\t\t\t\t\t<span>${app.i18n.ownerChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toOwners\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t</fieldset>\t\t\t\t\t\t\t\t\t\t<fieldset>\t\t<legend>${app.i18n.notifyMeByMail}</legend>\t\t\t\t<table width=\"100%\">\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.subject}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<input type=\"text\" quId=\"subject\" style=\"width: 100%\">\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.body}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"body\" height=\"170px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t<br/>\t\t\t\t\t${app.i18n.notificationVariables}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<br/>\t\t\t\t\t${app.i18n.notificationVariablesDescription}\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t\t\t\t\t\t</fieldset>\t\t\t\t\t\t\t\t\t\t<br/></div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},MyGateways:"<div>\t<div class=\"toolbar\">\t\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"add\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"_delete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",signatures:{Signature:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<fieldset style=\"height: 335px;\">\t<div dojoType=\"qu:HtmlEditor\" quId=\"signature\" width=\"100%\" height=\"300px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t</fieldset></div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},QueueSignatures:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<div class=\"toolbar\">\t\t<button quId=\"delete_\">${app.i18n.Delete}</button>\t\t<button quId=\"dialogClose\">${app.i18n.close_}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",MyProfile:"<div quId=\"ownWait\" style=\"display:none; height:250px;\">\t<table style=\"width:100%;height:100%;\">\t\t<tr>\t\t\t<td style=\"text-align:center;vertical-align:middle;\">\t\t\t\t<span style=\"padding:5px;\">${app.i18n.loading}</span><br />\t\t\t\t<img src=\"lib/style/images/progress.gif\" />\t\t\t</td>\t\t</tr>\t</table></div><div class=\"mainContent\" quId=\"ownContent\">\t<table style=\"width: 100%\">\t\t<tr>\t\t\t<td valign=\"top\">\t\t\t\t<fieldset>\t\t\t\t\t<legend>${app.i18n.personalInformation}</legend>\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td style=\"white-space: nowrap; width: 10%;\">\t\t\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"text\" quId=\"email\" style=\"width: 98%\"/>\t\t\t\t\t\t\t\t<span quId=\"emailReadonly\" style=\"display: none;\"></span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td style=\"white-space: nowrap; width: 10%;\">\t\t\t\t\t\t\t\t${app.i18n.fullName}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"text\" quId=\"name\"  style=\"width: 98%\"/>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td style=\"white-space: nowrap; width: 10%;\">\t\t\t\t\t\t\t\t${app.i18n.password}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"password\" quId=\"password\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td style=\"white-space: nowrap; width: 10%;\">\t\t\t\t\t\t\t\t${app.i18n.passwordAgain}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"password\" quId=\"passwordAgain\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>                        <tr>                            <td style=\"white-space: nowrap; width: 10%;\">                                ${app.i18n.hideKBSuggestions}                            </td>                            <td>                                <input type=\"checkbox\" quId=\"hideKBSuggestions\" />                            </td>                        </tr>                        <tr quId=\"dmNotifRow\">                            <td style=\"white-space: nowrap; width: 10%;\">                                ${app.i18n.disableDownloadManagerNotifications}                            </td>                            <td>                                <input type=\"checkbox\" quId=\"disableDmNotifications\" />                            </td>                        </tr>\t\t\t\t\t</table>\t\t\t\t</fieldset>\t\t\t</td>\t\t\t<td valign=\"top\">\t\t\t\t<fieldset quId=\"additionalInformationFieldset\" style=\"display: none;\">\t\t\t\t\t<legend>${app.i18n.additionalUserInformation}</legend>\t\t\t\t\t<div quId=\"additionalInformationContent\">\t\t\t\t\t</div>\t\t\t\t</fieldset>\t\t\t\t\t\t\t</td>\t\t</tr>\t</table>\t<fieldset style=\"height: 270px;\">\t\t<legend>${app.i18n.defaultSignature}</legend>\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"signature\" width=\"100%\" height=\"200px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t<br/><br/><div>${app.i18n.signatureVariables}</div>\t</fieldset>\t<a href=\"javascript://\" quId=\"editCustomSignatures\" style=\"display: none;\">${app.i18n.customizeSignaturePerQueue}</a>\t<br/>\t<button quId=\"cmdSave\">${app.i18n.save}</button></div>",gateways:{Gateway:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<br/>\t${app.i18n.name} <input type=\"text\" quId=\"name\" style=\"width: 300px\" />\t<fieldset>\t\t<legend>${app.i18n.forwardMeMailIf}</legend>\t\t\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.ticketsOwnedBy}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketOwner\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n._status}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"statuses\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.queue}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"queues\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.priority}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"priorities\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</fieldset>\t\t\t\t\t\t\t\t\t</div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},MyNotifications:"<div>\t<div class=\"toolbar\">\t\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"add\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"_delete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>"},Login:"<div style=\"\tbackground-color:#C3D9FF;\tcolor:#364157;\twidth:320px;\ttext-align:left;\tmargin: 10px\t\">\t<div style=\"background: url('app/web/images/corners/blue_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div style=\"\t\tbackground: transparent url('lib/icons/crystalsvg/22/user.png') 12px 8px no-repeat;\t\tpadding: 8px;\t\" >\t\t<div quId=\"lblLogin\" style=\"\t\t\theight:22px;\t\t\tpadding-left:30px;\t\t\tfont-size: 18px;\t\t\tmargin-bottom: 12px;\t\t\t\">\t\t\t${app.i18n.login}\t\t</div>\t\t<div style=\"background-color:#e0ecff; padding:8px;\">\t\t\t<table>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblEmail\">\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"username\" value=\"\" style=\"width:220px;\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblPassword\">\t\t\t\t\t\t${app.i18n.password}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"password\" quId=\"password\" value=\"\" style=\"width:220px;\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"checkbox\" quId=\"remember\" />\t\t\t\t\t</td>\t\t\t\t\t<td quId=\"lblRememberMe\">\t\t\t\t\t\t${app.i18n.rememberMe}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t\t\t\t\t<button quId=\"cmdLogin\">${app.i18n.toLogin}</button>\t\t\t<div dojoType=\"qu:Select\" quId=\"language\"></div>\t\t\t<br /><br />\t\t\t<a href=\"javascript://\" quId=\"cmdSignUp\">${app.i18n.signUp}</a><br />\t\t\t<a href=\"javascript://\" quId=\"cmdForgotPassword\">${app.i18n.forgotPassword}</a><br />\t\t</div>\t\t<div style=\"text-align:center; margin-top:12px; height:16px;\">\t\t\t<span quId=\"msgBox\"></span>\t\t</div>\t</div>\t<div style=\"background: url('app/web/images/corners/blue_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",Users:"<div style=\"background-color:#B5EDBC; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/green_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/green_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div quId=\"detailContent\" class=\"mainContent\" style=\"display:none;\"></div>\t<div quId=\"mainContent\" class=\"mainContent\">\t\t<!-- TOOLBAR -->\t\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t\t<div style=\"background-color:#d3f4d7; width:100%; margin-bottom:8px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetUsers_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetUsers_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdAdd\" caption=\"${app.i18n.add}\" icon=\"add_user\" tooltip=\"${app.i18n.add}\"></div>\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdDelete\" caption=\"${app.i18n.Delete}\" icon=\"delete_user\" tooltip=\"${app.i18n.Delete}\"></div>\t\t\t\t\t&nbsp;&#124;&nbsp;\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"userRole\"></select>\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdUpdate\" caption=\"${app.i18n.update}\" icon=\"file-save\" tooltip=\"${app.i18n.update}\"></div>\t\t\t\t</div>\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetUsers_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetUsers_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t\t\t<!-- FILTERS -->\t\t<div quId=\"filtersContainer\">\t\t\t<div style=\"background-color:#d3f4d7; width:150px; margin-left:4px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetUsers_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetUsers_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"text-align:center; font-weight:bold;\">\t\t\t\t\t${app.i18n.Filters}\t\t\t\t</div>\t\t\t</div>\t\t\t<div style=\"background-color:#d3f4d7; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetUsers_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetUsers_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"padding:4px;_height:1%;\">\t\t\t\t\t\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.name}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 50%;\">\t\t\t\t\t\t\t\t<input quId=\"filterName\" type=\"text\" style=\"width:100%;\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.userType}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 50%;\">\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterUserType\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"filterEmail\" dojoType=\"qu:AutoComplete\" style=\"width:100%;\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.emailQuality}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterEmailQuality\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.created}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterCreated\" width=\"300\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td class=\"formLabel\" nowrap=\"nowrap\">\t\t\t\t\t\t\t\t${app.i18n.groupName}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterGroupId\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t\t<div style=\"margin-top:8px;\">\t\t\t\t\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t\t\t\t\t\t<button quId=\"cmdClear\">${app.i18n.Clear}</button>\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetUsers_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetUsers_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t</div>\t<div dojoType=\"qu:Grid\" quId=\"usersGrid\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/green_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/green_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",Outbox:"<div style=\"background-color:#C3D9FF; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/blue_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\">\t\t\t<!-- TOOLBAR -->\t\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdDelete\" caption=\"${app.i18n.Delete}\" icon=\"mail-delete\" tooltip=\"${app.i18n.Delete}\"></div>\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdRetry\" caption=\"${app.i18n.retry}\" icon=\"reload\" tooltip=\"${app.i18n.retry}\"></div>\t\t\t\t</div>\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/blue_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",tickets:{Filter:"<div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t</div>\t<div style=\"text-align:center; font-weight:bold;\">\t\t${app.i18n.Filters}\t</div></div><div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t</div>\t<div style=\"padding:4px;_height:1%;\">\t\t<table style=\"width:100%;border: 1px solid #CCCCFF;\">\t\t\t<tr>\t\t\t\t<!-- LEFT COLUMN -->\t\t\t\t<td style=\"width:50%;\">\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 180px;\">\t\t\t\t\t\t\t\t${app.i18n.fullText}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"padding-right: 5px\">\t\t\t\t\t\t\t\t<input quId=\"filterBody\" type=\"text\" style=\"width:100%\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.ticketId}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"filterId\" type=\"text\" style=\"width:50%\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"padding-right: 5px\">\t\t\t\t\t\t\t\t<input quId=\"filterEmail\" dojoType=\"qu:AutoComplete\" style=\"width:100%;\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.subject}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"padding-right: 5px\">\t\t\t\t\t\t\t\t<input quId=\"filterSubject\" type=\"text\" style=\"width:100%\"/>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.LastUpdate}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterLastUpdate\" width=\"350\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr style=\"visibility: visible\" quId=\"groupFilterSection\">\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.userGroup}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterGroup\" width=\"350\" none=\"${app.i18n.any}\" multiselect=\"true\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t</td>\t\t\t\t<!-- RIGHT COLUMN -->\t\t\t\t<td>\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 180px;\">\t\t\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\" valign=\"top\">\t\t\t\t\t\t\t\t${app.i18n.agent}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t\t<input type=\"checkbox\" quId=\"filterShowRelatedTickets\" />\t\t\t\t\t\t\t\t<span>${app.i18n.showRelatedTickets}</span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.Status}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterStatus\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.priority}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterPriority\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td class=\"formLabel\">\t\t\t\t\t\t\t\t${app.i18n.mailAccount}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterMailAccount\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t\t<div quId=\"customFieldsFilter\" style=\"display: none;padding: 5px;border-bottom: 1px solid #CCCCFF;border-right: 1px solid #CCCCFF;border-left: 1px solid #CCCCFF;\"></div>\t\t\t\t<div quId=\"hint\" style=\"display:none;margin-top:12px;float:left;background-color:#FF9900;margin-left:16px;padding-left:6px;padding-right:6px;\">\t\t\t<span style=\"font-weight:bold;color:white;\">${app.i18n.hitToTakeEffect}</span>\t\t\t<img src=\"${qu.global.icon('2rightarrow.png', 16)}\" style=\"height:16px;width:16px;vertical-align:middle;\"/>\t\t</div> \t\t<div style=\"margin-top:8px;\">\t\t\t<button quId=\"cmdApply\">${app.i18n.updateFilter}</button>\t\t\t<button quId=\"cmdClear\">${app.i18n.Clear}</button>\t\t\t<a href=\"javascript://\" class=\"blue\" style=\"margin-left:1em;\" quId=\"cmdSave\">${app.i18n.SaveFilter}...</a>\t\t\t<a href=\"javascript://\" class=\"blue\" style=\"margin-left:1em;\" quId=\"cmdShowCustomFields\">${app.i18n.ShowCustomFieldsFilter}</a>\t\t</div>\t</div>\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t</div></div>",Reply:"<div style=\"background-color:white; color:#364157;width:100%;\">\t<div style=\"background: url('app/web/images/corners/editTicket_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/editTicket_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\" quId=\"ownContent\">\t\t<div quId=\"replyNotification\" style=\"display: none; float: right; text-align: right;text-decoration: blink; color: red; font-weight: bold;\"></div>\t\t<br/>\t\t<div style=\"_height:1%;\">\t\t\t<table style=\"width:100%;\">\t\t\t\t<tr quId=\"fromContainer\">\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t${app.i18n.from}:\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"from\" id=\"from\"></select>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"toContainer\">\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t${app.i18n.to}:\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input dojoType=\"qu:AutoComplete\" style=\"width:100%\" quId=\"to\" id=\"to\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"ccContainer\" style=\"display:none;\">\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t${app.i18n.cc}:\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input dojoType=\"qu:AutoComplete\" style=\"width:100%\" quId=\"cc\" id=\"cc\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"bccContainer\" style=\"display:none;\">\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t${app.i18n.bcc}:\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input dojoType=\"qu:AutoComplete\" style=\"width:100%\" quId=\"bcc\" id=\"bcc\" />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"subjectContainer\" style=\"display:none;\">\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t${app.i18n.subject}:\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" style=\"width:100%\" quId=\"subject\" id=\"subject\" />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"addFieldContainer\" style=\"display:none;\">\t\t\t\t\t<td>\t\t\t\t\t\t&nbsp;\t\t\t\t\t</td>\t\t\t\t\t<td style=\"text-align:left;\">\t\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdAddCc\" class=\"smallBlue\" id=\"addCcLink\">${app.i18n.addCc}</a>\t\t\t\t\t\t<span>&nbsp;&#124;&nbsp;</span>\t\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdAddBcc\" class=\"smallBlue\">${app.i18n.addBcc}</a>\t\t\t\t\t\t<span quId=\"editSubjectDivider\">&nbsp;&#124;&nbsp;</span>\t\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdEditSubject\" class=\"smallBlue\">${app.i18n.editSubject}</a>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"replyLabel\">\t\t\t\t\t\t<img src=\"app/web/images/attachment.gif\" style=\"width:15px;height:15px;\" />\t\t\t\t\t</td>\t\t\t\t\t<td quId=\"attachFileContainer\">\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t\t\t\t\t<div quId=\"customFieldsContent\"></div>\t\t\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"body\" height=\"200px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t<br/>\t\t</div>\t\t\t\t<div style=\"background-color:#EEEEEE;\">\t\t\t<div style=\"padding:8px;padding-bottom:4px;\">\t\t\t\t<div quId=\"updateContainer\" style=\"display: none;\">\t\t\t\t\t<table style=\"margin-bottom:6px;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n._status}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 20%\">\t\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"status_\" width=\"100%\"></select>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 20%\">\t\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"queue\" width=\"100%\"></select>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.priority}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 20%\">\t\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"priority\" width=\"100%\"></select>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.owner}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 20%\">\t\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"owner\" width=\"100%\"></select>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td style=\"width: 20%\">\t\t\t\t\t\t\t\t<div quId=\"saveAsCommentContent\" style=\"display: none;\">\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" quId=\"saveAsComment\"/> \t\t\t\t\t\t\t\t\t<span>\t\t\t\t\t\t\t\t\t\t${app.i18n.saveAsComment}\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t<div quId=\"userUpdateContainer\" style=\"display: none;\">\t\t\t\t\t<table style=\"margin-bottom:6px;\">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"userQueue\"></select>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t</div>\t\t\t\t\t\t\t\t<div quId=\"workReportContainer\" style=\"display: none;\">\t\t\t\t\t<fieldset style=\"margin-bottom: 3px;\">\t\t\t\t\t\t<legend>${app.i18n.workReport}</legend>\t\t\t\t\t\t<table style=\"width: 100%\">\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t${app.i18n.billingTime}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t<img src=\"lib/icons/crystalsvg/16/clock.png\" quId=\"billingTimeIcon\" style=\"vertical-align: middle;\" alt=\"${app.i18n.autoTimeCalculation}\" title=\"${app.i18n.autoTimeCalculation}\" />\t\t\t\t\t\t\t\t\t<input quId=\"billingTime\" type=\"text\" style=\"width: 30px;text-align: right;\">\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t${app.i18n.workTime}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t<img src=\"lib/icons/crystalsvg/16/clock.png\" quId=\"workTimeIcon\" style=\"vertical-align: middle;\" alt=\"${app.i18n.autoTimeCalculation}\" title=\"${app.i18n.autoTimeCalculation}\" />\t\t\t\t\t\t\t\t\t<input quId=\"workTime\" type=\"text\" style=\"width: 30px;text-align: right;\">\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t${app.i18n.note}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td style=\"width: 80%;\">\t\t\t\t\t\t\t\t\t<input quId=\"workNote\" type=\"text\" style=\"width: 100%\">\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</table>\t\t\t\t\t</fieldset>\t\t\t\t</div>\t\t\t\t\t\t\t\t<button quId=\"cmdSend\">${app.i18n.send}</button>\t\t\t\t<button quId=\"cmdSendAndResolve\">${app.i18n.SendAndResolve}</button>\t\t\t\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t\t\t\t<button quId=\"cmdOpenKnowledgeBase\" style=\"display: none;\">${app.i18n.OpenKnowledgeBase}</button>\t\t\t\t<a href=\"javascript://\" quId=\"cmdCancel\">${app.i18n.cancel}</a>\t\t\t\t<span quId=\"msgBox\" class=\"msgBox\"></span>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/sendEmail_8x8_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/sendEmail_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t\t\t</div>\t\t</div>\t<div quId=\"suggestionsBlock\" class=\"suggestion_block\" style=\"display: none;\">\t\t<div class=\"suggestion_title\">\t\t\t<div class=\"suggestion_title_text\">${app.i18n.reviewSuggestionsBeforeSubmit}</div>\t\t</div>\t\t<div quId=\"suggestionsContainer\" class=\"suggestion_container\"></div>\t</div>\t\t\t</div>\t\t<div style=\"background: url('app/web/images/corners/editTicket_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/editTicket_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",TicketEdit:"<div>\t<div class=\"backLink\" style=\"_height:1%;\">\t\t<table style=\"border-collapse:collapse;width:100%;\">\t\t\t<tr>\t\t\t\t<td style=\"width:170px;\">\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdBack\" class=\"backLink\">&lt;&lt;&nbsp;&nbsp;${app.i18n.backToTickets}</a>\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t<a href=\"javascript://\" quId=\"showCustomFields\" class=\"blank\" style=\"display:none;\">\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t<img src=\"${qu.global.icon('viewmag.png', 16)}\" style=\"width:16px; height:16px; vertical-align:center;border:none;\"/>\t\t\t\t\t\t<span quId=\"showCustomFieldsLabel\">${app.i18n.showCustomFields}</span>&nbsp;\t\t\t\t\t</a>\t\t\t\t\t<a href=\"#\" target=\"_blank\" quId=\"exportTicket2PDF\" class=\"blank\" style=\"display:none;\">\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t<img src=\"${qu.global.icon('adobe-reader.png', 16)}\" style=\"width:16px; height:16px; vertical-align:center;border:none;\"/>\t\t\t\t\t\t<span>${app.i18n.exportTicket2PDF}&nbsp;</span>\t\t\t\t\t</a>\t\t\t\t\t<a href=\"javascript://\" quId=\"showTicketHistory\" class=\"blank\" style=\"display:none;\">\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t<img src=\"${qu.global.icon('clock.png', 16)}\" style=\"width:16px; height:16px; vertical-align:center;border:none;\"/>\t\t\t\t\t\t<span quId=\"showTicketHistoryLabel\">${app.i18n.showTicketHistory}</span>&nbsp;\t\t\t\t\t</a>\t\t\t\t\t<a href=\"javascript://\" quId=\"expandAllMails\" class=\"blank\" style=\"display:none;\">\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t<img src=\"${qu.global.icon('down.png', 16)}\" style=\"width:16px; height:16px; vertical-align:center;border:none;\"/>\t\t\t\t\t\t<span>${app.i18n.expandAllMails}</span>&nbsp;\t\t\t\t\t</a>\t\t\t\t</td>\t\t\t\t\t\t\t\t<td style=\"text-align:right;width:20px;\">\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdPopup\" class=\"blank\" target=\"_blank\" title=\"${app.i18n.OpenInNewWindow}\">\t\t\t\t\t\t<img src=\"app/web/images/popup_blue.gif\" style=\"width:16px; height:16px;border:none;\" />\t\t\t\t\t</a>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div style=\"background-color:#e0ecff; margin-top:6px; padding:12px;\">\t\t<table style=\"width: 100%\">\t\t\t<tr>\t\t\t\t<td style=\"width: 80%\">\t\t\t\t\t<table>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<img src=\"${qu.global.icon('mime-document.png', 22)}\" quId=\"idIcon\" style=\"width:22px; height:22px; vertical-align:bottom;\"/>\t\t\t\t\t\t\t\t<span quId=\"ticketId\" style=\"font-size:16px;font-weight:bold;\"></span>\t\t\t\t\t\t\t</td><td>\t\t\t\t\t\t\t\t<img src=\"${qu.global.icon('mail.png', 22)}\" style=\"width:22px; height:22px; vertical-align:bottom;\"/>\t\t\t\t\t\t\t\t<span quId=\"ticketSubject\" style=\"font-size:16px;font-weight:bold;\"></span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<div quId=\"userLabel\">\t\t\t\t\t\t\t\t\t<img src=\"${qu.global.icon('edit_user.png', 22)}\" style=\"width:22px; height:22px; vertical-align:bottom;margin-top: 3px;\"/>\t\t\t\t\t\t\t\t\t<a quId=\"ticketCustomer\" href=\"#\" style=\"font-size:12px; cursor: pointer;\" class=\"openUserInWindow\" target=\"_blank\"></a>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t\t<div quId=\"updateBar\" style=\"display: none;\">\t\t\t<div quId=\"userUpdateBar\" style=\"display: none;\">\t\t\t\t<button quId=\"cmdResolveTicket\" style=\"display: none;\">${app.i18n.resolveTicket}</button>\t\t\t</div>\t\t\t<div quId=\"agentUpdateBar\" style=\"display: none;\">\t\t\t\t<table>\t\t\t\t\t<tr>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"queue\"></select>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t${app.i18n._status}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"status_\"></select>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t<tr>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t${app.i18n.priority}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"priority\"></select>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t${app.i18n.owner}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<select dojoType=\"qu:ComboBox\" quId=\"owner\"></select>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<button quId=\"cmdDeleteTicket\">${app.i18n.DeleteTicket}</button>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t</table>\t\t\t</div>\t\t</div>\t\t<div quId=\"customFieldsContainer\" style=\"display: none;margin-bottom: 5px;\"></div>\t\t<div quId=\"replyContainer\"></div>\t\t<span quId=\"msgBox\" class=\"msgBox\"></span>\t\t<div quId=\"emailsContainer\"></div>\t\t<a href=\"javascript://\" class=\"backLink\" style=\"display:none;\" quId=\"cmdFollowingEmails\"></a>\t</div></div>"},kbase:{KBPreview:"<div style=\"background-color:#CCCCCC; color:#364157;\" class=\"contentWrapper\">    <div style=\"background: url('app/web/images/corners/silver_8x8_tr.png') no-repeat top right;\">        <img src=\"app/web/images/corners/silver_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />    </div>    <table style=\"width: 100%; height: 100%;\">        <tr>            <td style=\"width: 30%; border-right: 1px solid #000000; vertical-align: top;\">                            <div style=\"margin: 5px; height: 100%;\">                    <div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"text-align:left; font-weight:bold; padding-left: 5px;\">                            ${app.i18n.KnowledgeBase}                        </div>                    </div>                    <div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px; height: 100%\">                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"padding:4px;\">                                                ${app.i18n.QuickFilter}                         <input type=\"text\" quId=\"quickSearch\" style=\"width: 150px\" />                        <button quId=\"cmdApply\">${app.i18n.updateFilter}</button> <br/>                                                                        <div quId=\"treeContainer\" style=\"overflow: auto; width: 100%; height: 100%; min-height: 400px; margin-top: 10px;\">                                                </div>                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                    </div>                </div>            </td>            <td style=\"width: 70%; vertical-align: top;\">                                                    <div style=\"margin: 5px; height: 100%;\">                    <div style=\"background-color:#C3D9FF; color:#364157; width:70%; min-width:200px; margin-left:4px;\">                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div quId=\"subentriesTitle\" style=\"text-align:left; white-space: nowrap; padding-left: 5px;\">                            ${app.i18n.preview}                        </div>                    </div>                    <div style=\"background-color:#C3D9FF; color:#364157; width:100%; margin-bottom:8px; height: 100%;\">                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"padding:5px; padding-right: 10px; min-height: 400px; margin: 5px;\">                        \t\t\t                <div quId=\"kbContent\" style=\"padding: 4px ;width: 100%;  height: 100%; min-height: 590px display: none; background-color: white;\">\t\t\t                    <div quId=\"kbSubject\" style=\"font-size: 14px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #DDDDDD; background-color: #EEEEEE\"></div>\t\t\t                    <div quId=\"kbBody\" style=\"border-bottom: 1px solid #DDDDDD;\"></div>\t\t\t                    <span>${app.i18n.attachedFiles}</span>\t\t\t                    <div quId=\"attachmentsContent\"></div>\t\t\t                </div>\t\t\t                <div quId=\"noContent\" style=\"width: 100%; height: 550px; padding: 5px; display: none;\">\t\t\t                    ${app.i18n.selectItem}\t\t\t                </div>                                               </div>                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_br.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                    </div>                </div>                        </td>        </tr>    </table>    <div style=\"background: url('app/web/images/corners/silver_8x8_br.png') no-repeat top right;\">        <img src=\"app/web/images/corners/silver_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />    </div></div>",CannedMessage:"<table style=\"width: 98%; height: 100%;\">  <tr>    <td style=\"width: 35%;height: 100%; vertical-align: top; padding: 4px;\">    \t<fieldset style=\"width: 100%;height: 620px;\">    \t\t<legend>${app.i18n.KnowledgeBase}</legend>    \t\t\t\t\t<div quId=\"treeContainer\" style=\"overflow: auto; width: 100%; height: 100%; min-height: 400px;\">\t\t\t    \t</fieldset>    </td>    <td style=\"width: 65%;height: 100%; vertical-align: top; padding: 4px;\">    \t<fieldset style=\"width: 100%;height: 620px;\">    \t\t<legend>${app.i18n.preview}</legend>    \t\t    \t\t<div quId=\"kbContent\" style=\"overflow: auto; width: 100%; height: 550px; padding: 5px; display: none;\">    \t\t\t<div quId=\"kbSubject\" style=\"font-size: 14px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #DDDDDD; background-color: #EEEEEE\"></div>    \t\t\t<div quId=\"kbBody\" style=\"border-bottom: 1px solid #DDDDDD;\"></div>    \t\t\t<span>${app.i18n.attachedFiles}</span>    \t\t\t<div quId=\"attachmentsContent\"></div>    \t\t</div>    \t\t<div quId=\"noContent\" style=\"overflow: auto; width: 100%; height: 550px; padding: 5px; display: none;\">    \t\t\t${app.i18n.selectItem}    \t\t</div>    \t\t\t\t\t<div class=\"buttonbar\">\t\t\t\t<button quId=\"cmdAddToReply\" style=\"display: none;\">${app.i18n.addToMail}</button>\t\t\t\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t\t\t</div>     \t    \t</fieldset>    </td>  </tr></table>",Item:"<table style=\"width: 98%;\">\t<tr>\t\t<td style=\"width: 70%; vertical-align: top; padding: 2px;\">\t\t\t<fieldset style=\"width: 99%; height: 100%;\">\t\t\t\t<legend>${app.i18n.editKnowledge}</legend>\t\t\t\t<table style=\"width: 99%\">\t\t\t\t\t<tr>\t\t\t\t\t\t<td style=\"vertical-align: top; white-space: nowrap;\">\t\t\t\t\t\t\t${app.i18n.subject}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t\t\t<input type=\"text\" quId=\"subject\" style=\"width: 100%\" />\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t<tr>\t\t\t\t\t\t<td style=\"vertical-align: top; white-space: nowrap;\">\t\t\t\t\t\t\t${app.i18n.Url}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<input type=\"text\" quId=\"url\" style=\"width: 100%\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t<td style=\"vertical-align: top; white-space: nowrap;\">\t\t\t\t\t\t\t${app.i18n.MetaDescription}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<textarea quId=\"metaDescription\" style=\"width: 100%\"></textarea>\t\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t<td style=\"vertical-align: top; white-space: nowrap;\">\t\t\t\t\t\t\t${app.i18n.order}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<input type=\"text\" quId=\"itemOrder\" style=\"width: 100%px\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t<td style=\"vertical-align: top; white-space: nowrap;\">\t\t\t\t\t\t\t${app.i18n.AccessMode}\t\t\t\t\t\t</td>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"accessMode\" />\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t\t</fieldset>\t\t</td>\t\t<td style=\"width: 30%; vertical-align: top; padding: 2px; height: 100%;\">\t\t\t<fieldset style=\"width: 99%; height: 100%;\">\t\t\t\t<legend>${app.i18n.AttachedFiles}</legend>\t\t\t\t<div quId=\"attachmentsContent\"></div>\t\t\t</fieldset>\t\t</td>\t</tr></table><fieldset style=\"height: 400px;\">\t<legend>${app.i18n.body}</legend>\t<div dojoType=\"qu:HtmlEditor\" quId=\"body\" width=\"100%\" height=\"350px\" modes=\"rich,html\" mode=\"rich\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div></fieldset><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",CannedMessageTree:"<div dojoType=\"qu:TreeLoadingController\" \tid=\"treeLoader\" \twidgetId=\"treeLoader\"\tservice=\"KBItems\" \tDNDController=\"create\"\texpandIconSrcLoading=\"../qu/widget/templates/images/treenode_loading.png\"></div><div dojoType=\"dojo:TreeSelector\" id=\"treeSelector\" eventNames=\"select:nodeSelected\"></div><div dojoType=\"dojo:Tree\" \tselector=\"treeSelector\" \tcontroller=\"treeLoader\" \tshowRootGrid=\"true\" \ttoogle=\"wipe\" \texpandLevel=\"2\"\twidgetId=\"CMTree\"\tid=\"tree\"></div>",KBase:"<div style=\"background-color:#CCCCCC; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/silver_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/silver_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<table style=\"width: 100%; height: 100%;\">\t\t<tr>\t\t\t<td style=\"width: 30%; border-right: 1px solid #000000; vertical-align: top;\">\t\t\t\t\t\t\t<div style=\"margin: 5px; height: 100%;\">\t\t\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t\t<div style=\"text-align:left; font-weight:bold; padding-left: 5px;\">\t\t\t\t\t\t\t${app.i18n.KnowledgeBaseTree}\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px; height: 100%\">\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t\t\t\t                ${app.i18n.QuickFilter} \t\t                <input type=\"text\" quId=\"quickSearch\" style=\"width: 150px\" />\t\t                <button quId=\"cmdApply\">${app.i18n.updateFilter}</button> <br/>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div quId=\"treeContainer\" style=\"overflow: auto; width: 100%; height: 100%; min-height: 400px; margin-top: 10px;\">\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</td>\t\t\t<td style=\"width: 70%; vertical-align: top;\">\t\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"margin: 5px; height: 100%;\">\t\t\t\t\t<div style=\"background-color:#C3D9FF; color:#364157; width:70%; min-width:200px; margin-left:4px;\">\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t\t<div quId=\"subentriesTitle\" style=\"text-align:left; white-space: nowrap; padding-left: 5px;\">\t\t\t\t\t\t\t${app.i18n.SubentriesOf}\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div style=\"background-color:#C3D9FF; color:#364157; width:100%; margin-bottom:8px; height: 100%;\">\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t\t<div style=\"padding:4px;min-height: 400px;\">\t\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t\t\t\t\t<table style=\"border-collapse:collapse;\">\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t<button quId=\"cmdRegenerate\">${app.i18n.regenerateKB}</button>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t<div style=\"background: url('app/web/images/corners/silver_blue_4x4_br.png') no-repeat top right;\">\t\t\t\t\t\t\t<img src=\"app/web/images/corners/silver_blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t\t\t</td>\t\t</tr>\t</table>\t<div style=\"background: url('app/web/images/corners/silver_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/silver_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",Tree:"<div dojoType=\"qu:TreeLoadingController\" \tid=\"treeLoader\" \twidgetId=\"treeLoader\"\tservice=\"KBItems\" \tDNDController=\"create\"\texpandIconSrcLoading=\"../qu/widget/templates/images/treenode_loading.png\"></div><div dojoType=\"dojo:TreeSelector\" id=\"treeSelector\" eventNames=\"select:nodeSelected\"></div><div dojoType=\"dojo:Tree\" \tselector=\"treeSelector\" \tcontroller=\"treeLoader\" \tshowRootGrid=\"true\" \ttoogle=\"wipe\" \texpandLevel=\"2\"\tDNDAcceptTypes=\"tree\"\tDNDMode=\"between;onto\"\tDNDController=\"create\"\twidgetId=\"tree\"\tid=\"tree\"></div>",KBPreviewTree:"<div dojoType=\"qu:TreeLoadingController\" \tid=\"treeLoader\" \twidgetId=\"treeLoader\"\tservice=\"KBItems\" \tDNDController=\"create\"\texpandIconSrcLoading=\"../qu/widget/templates/images/treenode_loading.png\"></div><div dojoType=\"dojo:TreeSelector\" id=\"treeSelector\" eventNames=\"select:nodeSelected\"></div><div dojoType=\"dojo:Tree\" \tselector=\"treeSelector\" \tcontroller=\"treeLoader\" \tshowRootGrid=\"true\" \ttoogle=\"wipe\" \texpandLevel=\"2\"\twidgetId=\"CMTree\"\tid=\"tree\"></div>"},Downloads:"<div style=\"background-color:#C3D9FF; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/blue_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\">                  <table style=\"width: 100%; height: 100%;\">        <tr>            <td style=\"width: 30%; border-right: 1px solid #000000; vertical-align: top;\">                            <div style=\"margin: 5px; height: 100%;\">                    <div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"text-align:left; font-weight:bold; padding-left: 5px;\">                            ${app.i18n.YourProducts}                        </div>                    </div>                    <div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px; height: 100%\">                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"padding:4px;\">                                                <div quId=\"dmTreeContainer\" style=\"overflow: auto; width: 100%; height: 100%; min-height: 400px; margin-top: 10px;\">                                                </div>                        <div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                    </div>                </div>            </td>            <td style=\"width: 70%; vertical-align: top;\">                                                    <div style=\"margin: 5px; height: 100%;\">                    <div style=\"background-color:#C3D9FF; color:#364157; width:70%; min-width:200px; margin-left:4px;\">                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                    </div>                    <div style=\"background-color:#C3D9FF; color:#364157; width:100%; margin-bottom:8px; height: 100%;\">                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_tr.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                        <div style=\"padding:5px; padding-right: 10px; min-height: 400px; margin: 5px;\">                                                    <div quId=\"dmContent\" style=\"padding: 4px ;width: 100%;  height: 100%; min-height: 590px display: none; background-color: white;\">                                <div quId=\"dmName\" style=\"font-size: 14px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #DDDDDD; background-color: #EEEEEE\"></div>                                <div quId=\"dmSubTitle\"></div>                                <table>                                    <tr>                                        <td><b>${app.i18n.License}:</b></td><td><span quId=\"dmLicenseId\"></span></td>                                    </tr>                                    <tr quId=\"productCodeRow\">                                        <td><b>${app.i18n.ProductCode}:</b></td><td><span quId=\"dmProductCode\"></span></td>                                    </tr>                                    <tr>                                        <td><b>${app.i18n.ProductAssigned}:</b></td><td><span quId=\"dmCreated\"></span></td>                                    </tr>                                    <tr>                                        <td><b>${app.i18n.Valid}:</b></td><td><span quId=\"dmValidFrom\"></span> <b>-</b> <span quId=\"dmValidUntil\"></span></td>                                    </tr>                                    <tr>                                        <td><b>${app.i18n.Downloads}:</b></td><td><span quId=\"dmDownloads\"></span> <b>/</b> <span quId=\"dmMaxDownloads\"></span></td>                                    </tr>                                </table>                                <div quId=\"dmDescription\" style=\"border-bottom: 1px solid #DDDDDD;\"></div>                                <br/><br/>                                <span style=\"font-size: small;\">${app.i18n.productFiles}</span>                                <div quId=\"attachmentsContent\"></div>                            </div>                            <div quId=\"noContent\" style=\"width: 100%; height: 550px; padding: 5px; display: none;\">                                ${app.i18n.selectProduct}                            </div>                                               </div>                        <div style=\"background: url('app/web/images/corners/silver_blue_4x4_br.png') no-repeat top right;\">                            <img src=\"app/web/images/corners/silver_blue_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />                        </div>                    </div>                </div>                        </td>        </tr>    </table>                     \t\t</div>\t<div style=\"background: url('app/web/images/corners/blue_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",Tickets2:"<div style=\"background-color:#C3D9FF; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/blue_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div quId=\"editContent\" class=\"mainContent\" style=\"display:none;\"></div>\t<div quId=\"mainContent\" class=\"mainContent\">\t\t<!-- TOOLBAR -->\t\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdAdd\" caption=\"${app.i18n.addTicket}\" icon=\"file-new\" tooltip=\"${app.i18n.addTicket}\"></div>\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdUpdates\" caption=\"${app.i18n.Updates}\" icon=\"edit\" tooltip=\"${app.i18n.Updates}\" radio=\"true\"></div>\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdFilters\" caption=\"${app.i18n.Filters}\" icon=\"file-find\" tooltip=\"${app.i18n.Filters}\" radio=\"true\"></div>\t\t\t\t\t<br/>\t\t\t\t\t<div style=\"margin-top: 3px;border-top-width: 1px; border-top-style: solid; border-top-color: #D0DCEF; padding-top: 2px;\">\t\t\t\t\t\t<span style=\"display:none;\" quId=\"filterSelectorLabel\">\t\t\t\t\t\t\t${app.i18n.SelectFilter}\t\t\t\t\t\t</span>\t\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"filterSelector\"></div>\t\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdDeleteFilter\" caption=\"${app.i18n.DeleteFilter}\" icon=\"filter-remove\" tooltip=\"${app.i18n.DeleteSavedFilter}\" radio=\"false\"></div>\t\t\t\t\t\t<a href=\"\" quId=\"filterRss\" style=\"display: none;\" title=\"${app.i18n.FilterRssFeed}\" target=\"_blank\"><img src=\"app/web/images/rss.jpg\" style=\"border: 0px; vertical-align: middle;\"/></a>\t\t\t\t\t\t<span>\t\t\t\t\t\t\t&nbsp;&#124;&nbsp;\t\t\t\t\t\t\t${app.i18n.goToTicketId}\t\t\t\t\t\t</span>\t\t\t\t\t\t<input quId=\"goToTicketId\" type=\"text\" style=\"width:100px;\" />\t\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdGoToTicketId\" caption=\"\" icon=\"file-find\" tooltip=\"${app.i18n.go}\"></div>\t\t\t\t\t\t\t<div quId=\"quickSearchElement\" style=\"display: none;\">\t\t\t\t\t\t\t<span>\t\t\t\t\t\t\t\t&nbsp;&#124;&nbsp;\t\t\t\t\t\t\t\t${app.i18n.quickSearch}\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t<input quId=\"quickSearch\" type=\"text\" style=\"width:100px;\" />\t\t\t\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdQuickSearch\" caption=\"\" icon=\"file-find\" tooltip=\"${app.i18n.quickSearch}\"></div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t\t\t<!-- UPDATES -->\t\t<div quId=\"updateContainer\" style=\"display:none;\">\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"text-align:center; font-weight:bold;\">\t\t\t\t\t${app.i18n.selection}\t\t\t\t</div>\t\t\t</div>\t\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t\t<div style=\"padding:4px;\">\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n.Delete}</button>\t\t\t\t\t&nbsp;&#124;&nbsp;\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"status_\"></select>\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"owner\"></select>\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"queue\"></select>\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"priority\"></select>\t\t\t\t\t<button quId=\"cmdUpdate\">${app.i18n.update}</button>\t\t\t\t\t</div>\t\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t\t\t\t\t<!-- FILTERS -->\t\t<div quId=\"filtersContainer\" style=\"display:block;\">\t\t</div>\t\t\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/blue_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",reports:{BillingTime:"<div>\t<div quId=\"filtersContainer\">\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.reported}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterDateRange\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span quId=\"labelAgent\">${app.i18n.queue}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.customer}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<input quId=\"filterCustomer\" dojoType=\"qu:AutoComplete\" style=\"width:80%;\" /> <span>${app.i18n.wildCardDescription}</span>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span quId=\"labelAgent\">${app.i18n.agent}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr style=\"visibility: visible\" quId=\"groupSection\">\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span quId=\"labelAgent\">${app.i18n.groupName}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterGroups\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t</div>\t<br />\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t<fieldset>\t\t<legend>${app.i18n.ReportStatistic}</legend>\t\t<table>\t\t\t<tr>\t\t\t\t<td></td>\t\t\t\t<td>${app.i18n.Summary}</td>\t\t\t\t<td>${app.i18n.Average}</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"font-size: 12px;font-weight: bold;\">${app.i18n.billedTime}</td>\t\t\t\t<td><span style=\"font-size: 16px;font-weight: bold;\" quId=\"billedTimeSummary\"></span></td>\t\t\t\t<td><span style=\"font-size: 16px;\" quId=\"billedTimeAvg\"></span></td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"font-size: 12px;font-weight: bold;\">${app.i18n.spentTime}</td>\t\t\t\t<td><span style=\"font-size: 16px;font-weight: bold;\" quId=\"spentTimeSummary\"></span></td>\t\t\t\t<td><span style=\"font-size: 16px;\" quId=\"spentTimeAvg\"></span></td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"font-size: 12px;font-weight: bold;\">${app.i18n.replyTime}</td>\t\t\t\t<td><span style=\"font-size: 16px;font-weight: bold;\" quId=\"replyTimeSummary\"></span></td>\t\t\t\t<td><span style=\"font-size: 16px;\" quId=\"replyTimeAvg\"></span></td>\t\t\t</tr>\t\t</table>\t</fieldset></div>",WorkingTime:"<div>\t<div quId=\"filtersContainer\">\t\t<table>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.dateRange}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterDateRange\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.groupByPeriod}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"groupBy\"></div>\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span quId=\"labelAgent\">${app.i18n.agent}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t\t<a href=\"#chartWorkTime\">${app.i18n.goToChart}</a>\t</div>\t<br />\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t<a name=\"chartWorkTime\" />\t<div quId=\"graph\" style=\"height: 480px;\"></div></div>",AgentsPerformance:"<div>\t<div quId=\"filtersContainer\">\t\t<table style=\"width: 100%\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.dateRange}\t\t\t\t</td>\t\t\t\t<td colspan=\"20\" style=\"width: 50%\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterDateRange\" isNoneAllowed=\"false\"></div>\t\t\t\t</td>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.groupByPeriod}\t\t\t\t</td>\t\t\t\t<td colspan=\"20\" width=\"50%\">\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"groupBy\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.queue}\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span quId=\"labelAgent\" style=\"display: none;\">${app.i18n.agent}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\" style=\"display: none;\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t\t<div quId=\"customFieldsFilter\" style=\"display: none;padding: 5px;border: 1px solid #CCCCFF;margin-bottom: 5px;\"></div>\t\t\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.clickToUpdateFilter}</button>\t\t<a href=\"javascript://\" quId=\"cmdShowCustomFields\">${app.i18n.ShowCustomFieldsFilter}</a>\t</div>\t<div quId=\"loadingIndicator\" style=\"display:none; height:150px;\">\t\t<table style=\"width:100%;height:100%;\">\t\t\t<tr>\t\t\t\t<td style=\"text-align:center;vertical-align:middle;\">\t\t\t\t\t<span style=\"padding:5px;\">${app.i18n.loading}</span><br />\t\t\t\t\t<img src=\"lib/style/images/progress.gif\" />\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<br />\t<div quId=\"reportContent\">\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div>\t\t\t<a name=\"chart\" />\t\t<div quId=\"graph\" style=\"height: 480px;\"></div>\t</div>\t</div>",Logins:"<div>\t<div quId=\"filtersContainer\">\t\t<table>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.loggedInRange}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterLogin\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span quId=\"labelAgent\">${app.i18n.agent}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>"},Profile:"<div style=\"background-color:#CCCCCC; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/silver_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/silver_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\">\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/silver_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/silver_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",filters:{SaveFilter:"<div style=\"padding-top:12px;\">\t<span>${app.i18n.SaveFilterAs}</span>\t<input type=\"text\" quId=\"filterName\" style=\"width:250px;\" />\t<div quId=\"isGlobalBox\" style=\"display: none;\">\t\t<input type=\"checkbox\" value=\"y\" quId=\"isGlobal\"> <span>${app.i18n.GlobalFilter}</span>\t</div></div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Settings:"<div style=\"background-color:#FAD163; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/yellow_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/yellow_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\">\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/yellow_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/yellow_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",settings:{downloadManager:{Products:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t    <div>        <table style=\"width: 100%\">            <tr>                <td nowrap=\"nowrap\">                    ${app.i18n.ProductName}                </td>                <td style=\"width: 50%\">                    <input quId=\"filterProductName\" type=\"text\" style=\"width:100%\" />                </td>                <td nowrap=\"nowrap\">                    ${app.i18n.created}                </td>                <td style=\"width: 50%\">                    <div dojoType=\"qu:DateRangePicker\" quId=\"filterCreated\"></div>                </td>            </tr>            <tr>                <td nowrap=\"nowrap\">                    ${app.i18n.Subtitle}                </td>                <td style=\"width: 50%\">                    <input quId=\"filterSubtitle\" type=\"text\" style=\"width:100%\" />                </td>                <td nowrap=\"nowrap\">                    ${app.i18n.Status}                </td>                <td style=\"width: 50%\">                     <div dojoType=\"qu:ComboBox\" quId=\"filterStatus\" width=\"100\" none=\"${app.i18n.any}\" multiselect=\"false\"></div>                </td>            </tr>          </table>        <button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>    </div>\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Order:"<fieldset>    <legend>${app.i18n.OrderDetails}</legend>\t<table width=\"100%\">\t\t<tr>\t\t\t<td width=\"20%\" nowrap=\"nowrap\">\t\t\t\t${app.i18n.Product}\t\t\t</td>\t\t\t<td width=\"80%\">\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"productId\" width=\"100%\" none=\"${app.i18n.SelectProduct}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.userGroup}\t\t\t</td>\t\t\t<td>                <div dojoType=\"qu:ComboBox\" quId=\"groupId\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.Customer}\t\t\t</td>\t\t\t<td>                <input quId=\"email\" dojoType=\"qu:AutoComplete\" style=\"width:100%;\" />\t\t\t</td>\t\t</tr>\t\t\t        <tr>            <td nowrap=\"nowrap\">                ${app.i18n.MaxDownloads}            </td>            <td>                <input type=\"text\" quId=\"maxDownloads\" style=\"width: 30%\" /> ${app.i18n.ZeroIsUnlimited}            </td>        </tr>        <tr>            <td nowrap=\"nowrap\">                ${app.i18n.ValidFrom}            </td>            <td>                <div dojoType=\"qu:DatePicker\" quId=\"validFrom\" isNoneAllowed=\"false\" isNoneSelected=\"false\"></div>             </td>        </tr>        <tr>            <td nowrap=\"nowrap\">                ${app.i18n.ValidUntil}            </td>            <td>                <div dojoType=\"qu:DatePicker\" quId=\"validUntil\" isNoneAllowed=\"true\" isNoneSelected=\"true\"></div> ${app.i18n.NoneMeansUnlimited}             </td>        </tr>        \t</table></fieldset><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",Orders:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>    <div>        <table style=\"width: 100%\">            <tr>                <td nowrap=\"nowrap\">                    ${app.i18n.ProductName}                </td>                <td style=\"width: 50%\">                    <input quId=\"filterProductName\" type=\"text\" style=\"width:100%\" />                </td>                <td nowrap=\"nowrap\">                    ${app.i18n.created}                </td>                <td style=\"width: 50%\">                    <div dojoType=\"qu:DateRangePicker\" quId=\"filterCreated\"></div>                </td>            </tr>            <tr>                <td nowrap=\"nowrap\">                    ${app.i18n.Subtitle}                </td>                <td style=\"width: 50%\">                    <input quId=\"filterSubtitle\" type=\"text\" style=\"width:100%\" />                </td>                <td nowrap=\"nowrap\">                    ${app.i18n.groupName}                </td>                <td style=\"width: 50%\">                     <div dojoType=\"qu:ComboBox\" quId=\"filterGroup\" width=\"100%\" none=\"${app.i18n.any}\" multiselect=\"false\"></div>                </td>            </tr>            <tr>                <td nowrap=\"nowrap\">                </td>                <td style=\"width: 50%\">                </td>                <td nowrap=\"nowrap\">                    ${app.i18n.customer}                </td>                <td style=\"width: 50%\">                     <input quId=\"filterCustomer\" dojoType=\"qu:AutoComplete\" style=\"width:100%;\" />                </td>            </tr>          </table>        <button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>    </div>  \t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Product:"<table style=\"width: 100%\">    <tr>        <td style=\"width: 50%; vertical-align: top;\">\t\t\t<fieldset style=\"height: 100%; min-height: 450px;\">\t\t\t    <legend>${app.i18n.ProductDetails}</legend>\t\t\t    <table width=\"100%\">\t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.ProductCode}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"text\" quId=\"productCode\" style=\"width: 30%\" />\t\t\t            </td>\t\t\t        </tr>\t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.ProductName}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"text\" quId=\"name\" style=\"width: 99%\" />   \t\t\t            </td>\t\t\t        </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.Subtitle}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"text\" quId=\"subtitle\" style=\"width: 99%\" />   \t\t\t            </td>\t\t\t        </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.productDescription}\t\t\t            </td>\t\t\t            <td style=\"height: 240px;\">\t\t\t                <div dojoType=\"qu:HtmlEditor\" quId=\"description\" height=\"200px\" mode=\"rich\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t            </td>\t\t\t        </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.maxDownloads}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"text\" quId=\"maxDownloads\" style=\"width: 30%\" /> ${app.i18n.ZeroIsUnlimited}  \t\t\t            </td>\t\t\t        </tr>\t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.ValidDays}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"text\" quId=\"validDays\" style=\"width: 30%\" /> ${app.i18n.ZeroIsUnlimited}  \t\t\t            </td>\t\t\t        </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.isProductEnabled}\t\t\t            </td>\t\t\t            <td>\t\t\t                <input type=\"checkbox\" quId=\"isEnabled\" />  \t\t\t            </td>\t\t\t        </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.subProducts}\t\t\t            </td>\t\t\t            <td>\t\t\t                <div dojoType=\"qu:ComboBox\" quId=\"subProducts\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"true\"></div>  \t\t\t            </td>\t\t\t        </tr>           \t\t\t    </table>\t\t\t</fieldset>        </td>        <td style=\"width: 50%; vertical-align: top;\">\t\t\t<fieldset style=\"height: 100%; min-height: 450px;\">\t\t\t    <legend>${app.i18n.NotificationMail}</legend>\t\t\t    <table width=\"100%\">                    <tr>                        <td colspan=\"2\">                            <input type=\"checkbox\" quId=\"sendNotification\" /> ${app.i18n.sendNotificationMail}                         </td>                    </tr>           \t\t\t        <tr>\t\t\t            <td>\t\t\t                ${app.i18n.subject}\t\t\t                <input type=\"text\" quId=\"notificationSubject\" style=\"width: 100%\" />\t\t\t            </td>\t\t\t        </tr>\t\t\t        <tr>\t\t\t            <td colspan=\"2\" style=\"height: 305px;\">\t\t\t                <div dojoType=\"qu:HtmlEditor\" quId=\"notificationBody\" height=\"270px\" mode=\"rich\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t            </td>\t\t\t        </tr>                               <tr>                        <td colspan=\"2\" style=\"vertical-align: top;\">                            ${app.i18n.messageVariables} <br/>                            ${app.i18n.OrderNotificationVariables}                        </td>                    </tr>           \t\t\t    </table>\t\t\t</fieldset>        </td>    </tr></table><fieldset style=\"min-height: 200px;\">    <legend>${app.i18n.ProductFiles}</legend>    <div quId=\"filesContent\"></div></fieldset><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Notifications:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Group:"<table>    <tbody quId=\"tblGroup\">\t<tr>\t\t<td>\t\t\t${app.i18n.groupName}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"groupName\" style=\"width: 200px\" />\t\t\t</td>\t</tr>\t\t</tbody>\t\t</table><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",ApplicationFiles:"<div>\t<!-- TOOLBAR -->\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t<div style=\"background-color:#FFFFFF; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;\">\t\t\t\t<div dojoType=\"qu:Button\" quId=\"_delete\" caption=\"${app.i18n._delete}\" icon=\"delete-table-cell\" tooltip=\"${app.i18n._delete}\"></div>\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdFilters\" caption=\"${app.i18n.Filters}\" icon=\"file-find\" tooltip=\"${app.i18n.Filters}\" radio=\"true\"></div>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t<div quId=\"filtersContainer\" style=\"display:none;\">\t\t<table>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.created}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterCreated\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",notifications:{Notification:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<table style=\"width: 100%;\">\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">${app.i18n.name}</td>\t\t\t<td style=\"width: 100%;\"><input type=\"text\" quId=\"name\" style=\"width: 100%\" /></td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">${app.i18n.fromMailAccount}</td>\t\t\t<td style=\"width: 100%;\"><div dojoType=\"qu:ComboBox\" quId=\"accountId\" none=\"${app.i18n.useDefaultMailAccount}\" width=\"100%\" multiselect=\"false\"></div></td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">${app.i18n.customFromMailAddress}</td>\t\t\t<td style=\"width: 100%;\">\t\t\t\t<input type=\"text\" quId=\"customFromMailAddress\" style=\"width: 100%\">\t\t\t</td>\t\t</tr>\t</table>\t<fieldset>\t\t<legend>${app.i18n.recipients}</legend>\t\t<table style=\"width: 100%\">\t\t\t<tr>\t\t\t\t<td style=\"width: 50%\">\t\t\t\t\t<input type=\"checkbox\" quId=\"sendToNotificationOwner\" /> <span quId=\"sendToNotificationOwnerLabel\"></span><br />\t\t\t\t\t<input type=\"checkbox\" quId=\"sendToCustomer\" /> <span>${app.i18n.customer}</span><br />\t\t\t\t\t<input type=\"checkbox\" quId=\"sendToAgentOwner\" /> <span>${app.i18n.ticketOwner}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 50%\">\t\t\t\t\t<span>${app.i18n.otherRecipients}</span><br />\t\t\t\t\t<textarea quId=\"sendToRecipients\" style=\"width: 100%\"></textarea>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</fieldset>\t<fieldset>\t\t<legend>${app.i18n.ticketsFilter}</legend>\t\t\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsOwnedBy}\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketOwner\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsAssignedToQueue}\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsWithStatus}\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketStatus\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.inTicketsWithPriority}\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketPriority\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.forCustomersWithGroup}\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"customerGroups\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t</td>\t\t\t\t<td style=\"width: 40%;\">\t\t\t\t</td>\t\t\t</tr>\t\t\t\t\t</table>\t</fieldset><fieldset>\t\t<legend>${app.i18n.monitoredEvents}</legend>\t\t<table style=\"width: 100%;\">\t\t\t\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.changes}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t</td>\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"statusCheck\" />\t\t\t\t\t<span>${app.i18n.statusChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toStatuses\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"queueCheck\" />\t\t\t\t\t<span>${app.i18n.queueChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toQueues\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"priorityCheck\" />\t\t\t\t\t<span>${app.i18n.priorityChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toPriorities\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<input type=\"checkbox\" quId=\"ownerCheck\" />\t\t\t\t\t<span>${app.i18n.ownerChangesTo}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"toOwners\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t</fieldset>\t\t\t\t\t\t\t\t\t\t<fieldset>\t\t<legend>${app.i18n.notifyMeByMail}</legend>\t\t\t\t<table width=\"100%\">\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.subject}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input type=\"text\" quId=\"subject\" style=\"width: 100%\">\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.body}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"body\" height=\"170px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t<br/>\t\t\t\t\t${app.i18n.notificationVariables}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<br/>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"addVariable\" none=\"${app.i18n.selectVariableToAdd}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t\t\t\t\t\t\t</fieldset>\t\t\t\t\t\t\t\t\t\t<fieldset>\t\t<legend>${app.i18n.callUrl}</legend>\t\t\t\t<table width=\"100%\">\t\t\t<tr>\t\t\t\t<td valign=\"top\" nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.callUrl}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<input type=\"text\" quId=\"callUrl\" style=\"width: 100%\">\t\t\t\t</td>\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t\t\t\t\t</fieldset>\t\t\t\t\t\t\t\t\t\t<br/></div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},ParsingRules:"<div>\t<div class=\"toolbar\">\t\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"_delete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Custom:"<div class=\"mainContent\" style=\"background-color: #FAD163;\">\t<div dojoType=\"qu:TabFolder\" quId=\"tabCustom\"></div></div>",EscalationRules:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",MailAccounts:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",escalationRules:{EscalationRule:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<span>${app.i18n.name}</span> <input type=\"text\" quId=\"name\" style=\"width: 480px\" />\t<fieldset>\t\t<legend>${app.i18n.ruleCondition}</legend>\t\t<table style=\"width: 100%\">            <tr>                <td style=\"width: 150px;white-space: nowrap;\">                    ${app.i18n.createdByCustomer}                </td>                <td>                    <input quId=\"createdByCustomer\" dojoType=\"qu:AutoComplete\" style=\"width:100%;\" />                </td>            </tr>            <tr quId=\"groupFilterSection\">                <td style=\"width: 150px;white-space: nowrap;\">                    ${app.i18n.customerGroup}                </td>                <td>                    <div dojoType=\"qu:ComboBox\" quId=\"customerGroup\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>                </td>            </tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.inTicketsOwnedBy}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ownerCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.inTicketsAssignedToQueue}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"queueCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.inTicketsWithStatus}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"statusCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.inTicketsWithPriority}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"priorityCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.lastReply}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"lastReplyCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.ticketAge}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketAgeCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.overDue}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"overDueCond\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</fieldset>\t<fieldset>\t\t<legend>${app.i18n.ruleAction}</legend>\t\t\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.changeOwner}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"actionOwner\" none=\"${app.i18n.noChange}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.changeQueue}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"actionQueue\" none=\"${app.i18n.noChange}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.changeStatus}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"actionStatus\" none=\"${app.i18n.noChange}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.changePriority}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"actionPriority\" none=\"${app.i18n.noChange}\" width=\"100%\" multiselect=\"false\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td style=\"width: 150px;white-space: nowrap;\">\t\t\t\t\t${app.i18n.deleteTicket}\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input type=\"checkbox\" quId=\"actionDeleteTicket\"/>&nbsp;\t\t\t\t\t(<input type=\"checkbox\" quId=\"actionDeleteTicketUsers\"/> ${app.i18n.deleteTicketUsers})\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</fieldset></div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Groups:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",queues:{Queue:"<div>\t<table width=\"100%\">\t\t<tr style=\"vertical-align:top;\">\t\t\t<td>\t\t\t\t<fieldset style=\"height: 20em\">\t\t\t\t\t<legend>${app.i18n.queue}</legend>\t\t\t\t\t<table>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<span quId=\"labelId\" style=\"display: none;\">${app.i18n.queueID}</span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<span quId=\"valueId\" style=\"display: none;\"></span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.queueName}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"queueName\" type=\"text\" style=\"width:100%\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.ticketIdPrefix}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"ticketIdPrefix\" type=\"text\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"email\" type=\"text\" style=\"width:100%\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.maxAnswerTime}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input quId=\"maxAnswerTime\" type=\"text\" style=\"width: 4em;\"/>\t\t\t\t\t\t\t\t<span>${app.i18n.hours}</span>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.setAsDefault}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"checkbox\" quId=\"isDefault\" />\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.public_}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"checkbox\" quId=\"public\" /> ${app.i18n.publicEveryAgentHasAccess}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t${app.i18n.openedForUsers}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<input type=\"checkbox\" quId=\"openedForUsers\" /> ${app.i18n.openedForUsersHelp}\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>\t\t\t\t\t</table>\t\t\t\t</fieldset>\t\t\t</td>\t\t\t<td style=\"width: 40%\">\t\t\t\t<fieldset style=\"height: 20em\">\t\t\t\t<legend>${app.i18n.agents}</legend>\t\t\t\t\t<div dojoType=\"qu:ListBox\" quId=\"agents\" style=\"width: 100%\"></div>\t\t\t\t</fieldset>\t\t\t</td>\t\t</tr>\t</table>\t\t<table>\t\t<tr>\t\t\t<td style=\"width: 50%\">\t\t\t\t<fieldset style=\"height: 430px;\">\t\t\t\t\t<legend>${app.i18n.queueSignature}</legend>\t\t\t\t\t<div>\t\t\t\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"queueSignature\" height=\"342px\" mode=\"rich\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t\t\t</div>\t\t\t\t</fieldset>\t\t\t</td>\t\t\t<td width=\"50%\">\t\t\t\t<fieldset style=\"height: 430px;\">\t\t\t\t\t<legend>${app.i18n.autorespond}</legend>\t\t\t\t\t<input type=\"checkbox\" quId=\"autorespond\" /><span>${app.i18n.autorespondIfReceivedNewTicket}</span><br/>\t\t\t\t\t<b>${app.i18n.subject}</b><br/>\t\t\t\t\t<input type=\"text\" quId=\"subject\" style=\"width: 100%\" />\t\t\t\t\t<b>${app.i18n.body}</b><br/>\t\t\t\t\t<div>\t\t\t\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"body\" height=\"270px\" mode=\"rich\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t\t\t\t</div><br/>\t\t\t\t\t<b>${app.i18n.messageVariables}</b><br/>\t\t\t\t\t${app.i18n.autorespondHelp}\t\t\t\t</fieldset>\t\t\t</td>\t\t</tr>\t</table>\t\t</div><div class=\"buttonbar\">\t<button quId=\"save\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Configuration:"<div>\t<div quId=\"ownWait\" style=\"display:none; height:150px;\">\t\t<table style=\"width:100%;height:100%;\">\t\t\t<tr>\t\t\t\t<td style=\"text-align:center;vertical-align:middle;\">\t\t\t\t\t<span style=\"padding:5px;\">${app.i18n.loading}</span><br />\t\t\t\t\t<img src=\"lib/style/images/progress.gif\" />\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div quId=\"ownContent\" style=\"display:none\">\t\t<fieldset>\t\t\t<legend>${app.i18n.applicationConfiguration}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.applicationURL}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"applicationURL\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.applicationURLHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.tmpPath}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"tmpPath\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.tmpPathHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.defaultLanguage}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"defaultLanguage\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.defaultLanguageHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t</fieldset>\t\t\t<br/><br/>\t\t<fieldset>\t\t\t<legend>${app.i18n.knowledgeBaseConfiguration}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.knowledgeBaseModule}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"knowledgeBaseModule\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.knowledgeBaseModuleHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.knowledgeBaseURL}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"knowledgeBaseURL\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.knowledgeBaseURLHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.knowledgeBasePath}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"knowledgeBasePath\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.knowledgeBasePathHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.knowledgeRefresh}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"knowledgeRefresh\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.knowledgeRefreshHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t</fieldset>\t\t\t\t<br /><br />\t\t<fieldset>\t\t\t<legend>${app.i18n.mailsConfiguration}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.evalEmailQuality}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"checkEmailQuality\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.emailQualityHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.sendRegistrationEmail}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"sendRegistrationEmail\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.sendRegistrationEmailHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.preventLoops}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"preventLoops\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.preventLoopsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.sendSystemMails}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"sendSystemMails\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.sendSystemMailsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.disableMailGateway}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"disableMailGateway\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.disableMailGatewayHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.disableNotifications}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"disableNotifications\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.disableNotificationsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.subjectPrefixes}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"subjectPrefixes\" style=\"width: 200px\"  configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.subjectPrefixesHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.hideTicketIdFromSubject}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"hideTicketIdFromSubject\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.hideTicketIdFromSubjectHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.ticketIdFormat}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"ticketIdFormat\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.ticketIdFormatHelp}\t\t\t\t\t</td>\t\t\t\t</tr>                <tr>                    <td class=\"configurationKey\">                        ${app.i18n.blindCarbonCopy}                    </td>                    <td class=\"configurationValue\">                        <input type=\"text\" quId=\"blindCarbonCopy\" style=\"width: 200px\" configSwitch=\"true\"/>                    </td>                    <td class=\"configurationHelp\">                        ${app.i18n.blindCarbonCopyHelp}                    </td>                </tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.defaultPriority}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"defaultPriority\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.defaultPriorityHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.autoAssignTicketToAgent}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"autoAssignTicketToAgent\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.autoAssignTicketToAgentHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.divideSameMailToMoreTickets}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"divideSameMailToMoreTickets\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.divideSameMailToMoreTicketsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.showPriorityInSubmitForm}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"showPriorityInSubmitForm\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.showPriorityInSubmitFormHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.workReporting}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"workReporting\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.workReportingHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.hideGroups}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"hideGroups\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.hideGroupsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t</fieldset>\t\t\t<br/><br/>\t\t<fieldset>\t\t\t<legend>${app.i18n.mailDeliverySettings}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.useOutbox}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"useOutbox\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.useOutboxHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.maxRetryCount}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"maxRetryCount\" style=\"width: 50px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.maxRetryCountHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.retryAfterDelay}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"retryAfterDelay\" style=\"width: 50px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.retryAfterDelayHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t</fieldset>        <br/><br/>                        <fieldset>            <legend>${app.i18n.DownloadManagerConfiguration}</legend>            <table style=\"width:100%;\" class=\"configurationTable\">                                <tr>                    <td class=\"configurationKey\">                        ${app.i18n.DownloadManager}                    </td>                    <td class=\"configurationValue\">                        <input type=\"checkbox\" quId=\"DownloadManager\" configSwitch=\"true\"/>                    </td>                    <td class=\"configurationHelp\">                        ${app.i18n.DownloadManagerHelp}                    </td>                </tr>                            </table>        </fieldset>        \t\t\t<br/><br/>\t\t<fieldset>\t\t\t<legend>${app.i18n.rightsSettings}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.agentDeleteTickets}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"agentDeleteTickets\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.agentDeleteTicketsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.agentCanSeeJustOwnQueues}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"agentCanSeeJustOwnQueues\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.agentCanSeeJustOwnQueuesHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.agentSeeJustAgentsFromHisQueues}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"agentSeeJustAgentsFromHisQueues\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.agentSeeJustAgentsFromHisQueuesHelp}\t\t\t\t\t</td>\t\t\t\t</tr>                <tr>                    <td class=\"configurationKey\">                        ${app.i18n.agentCanNotSeeAdmins}                    </td>                    <td class=\"configurationValue\">                        <input type=\"checkbox\" quId=\"agentCanNotSeeAdmins\" configSwitch=\"true\"/>                    </td>                    <td class=\"configurationHelp\">                        ${app.i18n.agentCanNotSeeAdminsHelp}                    </td>                </tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.agentUserAccess}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"agentUserAccess\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.agentUserAccessHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.onlineAgentsView}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"onlineAgentsView\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.onlineAgentsViewHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.agentCanSeeOwnReports}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"agentCanSeeOwnReports\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.agentCanSeeOwnReportsHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.userCanSeeAllTicketsInGroup}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"checkbox\" quId=\"userCanSeeAllTicketsInGroup\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.userCanSeeAllTicketsInGroupHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t</fieldset>\t\t\t<br/><br/>\t\t<fieldset>\t\t\t<legend>${app.i18n.logsConfiguration}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.minLogLevel}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"minLogLevel\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.minLogLevelHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.logFile}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"logFile\" style=\"width: 200px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.logFileHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.deleteLogsAfter}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input type=\"text\" quId=\"deleteLogsAfter\" style=\"width: 50px\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.deleteLogsAfterHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t</fieldset>\t\t<br/><br/>\t\t\t<fieldset>\t\t\t<legend>${app.i18n.wysiwygEditorConfiguration}</legend>\t\t\t<table style=\"width:100%;\" class=\"configurationTable\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.defaultFont}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"defaultFont\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.defaultFontHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td class=\"configurationKey\">\t\t\t\t\t\t${app.i18n.defaultFontSize}\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationValue\">\t\t\t\t\t\t<input dojoType=\"qu:Select\" quId=\"defaultFontSize\" configSwitch=\"true\"/>\t\t\t\t\t</td>\t\t\t\t\t<td class=\"configurationHelp\">\t\t\t\t\t\t${app.i18n.defaultFontSizeHelp}\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t</fieldset>\t\t\t\t<br/>\t\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t\t\t</div></div>",mailAccounts:{MailAccount:"<div style=\"padding:8px; padding-top:16px;\">\t<table>\t<tr>\t\t<td valign=\"top\" width=\"50%\">\t\t\t\t\t<table>\t\t\t\t<tr>\t\t\t\t\t<td>\t\t\t\t\t\t${app.i18n.accountName}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"accountName\" style=\"width: 100%\" />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td>\t\t\t\t\t\t${app.i18n.accountEmail}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"accountEmail\" style=\"width: 100%\" />\t\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td valign=\"top\">\t\t\t\t\t\t${app.i18n.fromNameFormat}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"fromNameFormat\" width=\"100%\" style=\"height: 20px;\" multiselect=\"false\"></div>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td valign=\"top\">\t\t\t\t\t\t${app.i18n.fromName}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"fromName\" style=\"width: 100%\" /><br />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t<td>\t\t\t\t\t\t${app.i18n.setAsDefault}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"checkbox\" quId=\"isDefault\" />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td>\t\t\t\t\t\t${app.i18n.deleteMails}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"checkbox\" quId=\"deleteMails\" />\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t\t\t</td>\t\t<td valign=\"top\" width=\"50%\">\t\t\t<input type=\"checkbox\" quId=\"_public\" /> ${app.i18n.public_}<br/>\t\t\t<fieldset style=\"height: 13em\">\t\t\t<legend>${app.i18n.agents}</legend>\t\t\t\t<div dojoType=\"qu:ListBox\" quId=\"agents\"></div>\t\t\t</fieldset>\t\t</td>\t</tr>\t</table>\t\t\t\t</div><fieldset>\t<legend>${app.i18n.receivingMails}</legend>\t<table style=\"width: 100%;\">\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.pop3Server}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"pop3Server\" style=\"width: 100%;\" />\t\t\t</td>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.username}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"pop3Username\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.pop3Port}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"pop3Port\" style=\"width: 100%;\" />\t\t\t</td>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.newPassword}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"password\" quId=\"pop3Password\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"checkbox\" quId=\"requirePop3Ssl\" />\t\t\t\t${app.i18n.requireSslConnection}\t\t\t</td>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td>\t\t\t\t\t\t\t\t&nbsp;\t\t\t</td>\t\t</tr>\t</table></fieldset><fieldset>\t<legend>${app.i18n.sendingMails}</legend>\t<table>\t\t<tr>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"checkbox\" quId=\"useSendmail\" />${app.i18n.useSendmail}\t\t\t\t\t\t</td>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.smtpServer}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"smtpServer\" style=\"width: 100%;\" />\t\t\t</td>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.username}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"smtpUsername\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.smtpPort}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"text\" quId=\"smtpPort\" style=\"width: 100%;\" />\t\t\t</td>\t\t\t<td nowrap=\"nowrap\">\t\t\t\t${app.i18n.newPassword}\t\t\t</td>\t\t\t<td style=\"width: 50%;\">\t\t\t\t<input type=\"password\" quId=\"smtpPassword\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"checkbox\" quId=\"requireSmtpSsl\" />\t\t\t\t${app.i18n.requireSslConnection}\t\t\t\t<br/>\t\t\t\t<input type=\"checkbox\" quId=\"requireSmtpTLS\" />\t\t\t\t${app.i18n.requireTLSConnection}\t\t\t</td>\t\t\t<td>\t\t\t\t&nbsp;\t\t\t</td>\t\t\t<td valign=\"top\">\t\t\t\t<input type=\"checkbox\" quId=\"requireSmtpAuthentification\" />\t\t\t\t${app.i18n.requireAuthentification}\t\t\t</td>\t\t</tr>\t</table></fieldset><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Queues:"<div>\t<div class=\"toolbar\">\t\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"add\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"_delete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",ApplicationSettings:"<div style=\"background-color:#FAD163; color:#364157;\" class=\"contentWrapper\">\t<div class=\"mainContent\">\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t</div></div>",gateways:{Gateway:"<div class=\"mainContent\" quId=\"ownContent\" style=\"margin: 5px;\">\t<br/>\t${app.i18n.name} <input type=\"text\" quId=\"name\" style=\"width: 300px\" />\t<fieldset>\t\t<legend>${app.i18n.forwardMeMailIf}</legend>\t\t\t\t<table style=\"width: 100%;\">\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t${app.i18n.ticketsOwnedBy}\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"ticketOwner\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n._status}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"statuses\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.queue}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"queues\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t<span>${app.i18n.priority}</span>\t\t\t\t</td>\t\t\t\t<td style=\"width: 100%;\">\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"priorities\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</fieldset>\t\t\t\t\t\t\t\t\t</div><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},Logs:"<div>\t<!-- TOOLBAR -->\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t<div style=\"background-color:#FFFFFF; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;\">\t\t\t\t<div dojoType=\"qu:Button\" quId=\"_delete\" caption=\"${app.i18n._delete}\" icon=\"delete-table-cell\" tooltip=\"${app.i18n._delete}\"></div>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t<div>\t\t<table>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.message}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<input quId=\"filterMessage\" type=\"text\" style=\"width:650px\" />\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.created}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterCreated\"></div>\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.logLevel}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterLogLevel\" none=\"${app.i18n.any}\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.logType}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input quId=\"filterLogType\" type=\"text\" style=\"width:75px\" />\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.ip}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input quId=\"filterIp\" type=\"text\" style=\"width:75px\" />\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",DownloadManagerSettings:"<div style=\"background-color:#FAD163; color:#364157;\" class=\"contentWrapper\">\t<div class=\"mainContent\">\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t</div></div>",parsingRules:{ParsingRule:"<div style=\"padding:8px; padding-top:16px;\">\t<table style=\"width: 99%;\">\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.name}\t\t\t</td>\t\t\t<td style=\"width: 100%;\">\t\t\t\t<input type=\"text\" quId=\"name\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t</table></div><fieldset>\t<legend>${app.i18n.ruleConditions}</legend>\t<table style=\"width: 99%;\">\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.fromAddress}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"fromAddrCond\"></div>\t\t\t</td>\t\t\t<td style=\"width: 100%;\">\t\t\t\t<input type=\"text\" quId=\"fromAddrValue\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>        <tr>            <td style=\"white-space: nowrap;\">                ${app.i18n.isRegisteredUser}            </td>            <td>                <div dojoType=\"qu:Select\" quId=\"isRegisteredUserCond\"></div>            </td>            <td>            </td>        </tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.userGroup}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"userGroupCond\"></div>\t\t\t</td>\t\t\t<td style=\"width: 100%;\">\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"userGroup\" width=\"100%\" none=\"${app.i18n.any}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.toAddress}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"toAddrCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"text\" quId=\"toAddrValue\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.ccAddress}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"ccAddrCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"text\" quId=\"ccAddrValue\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.subject}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"subjectCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"text\" quId=\"subjectValue\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.body}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"bodyCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"text\" quId=\"bodyValue\" style=\"width: 100%;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.queue}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"queueCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"queueId\" width=\"100%\" none=\"${app.i18n.any}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.mailAccount}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"accountCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"accountId\" width=\"100%\" none=\"${app.i18n.any}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.isNewTicket}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"isNewTicketCond\"></div>\t\t\t</td>\t\t\t<td>\t\t\t</td>\t\t</tr>\t\t\t</table></fieldset><fieldset quId=\"customFieldsSection\" style=\"display: none;\">\t<legend>${app.i18n.customFieldsMatch}</legend>\t<table style=\"width: 100%;\" quId=\"customFieldsContainer\"></table></fieldset><fieldset>\t<legend>${app.i18n.ruleActions}</legend>\t<table style=\"width: 99%;\">\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.moveToQueue}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"moveToQueueId\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.changeToStatus}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"changeToStatusId\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.changeToPriority}\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"changeToPrio\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.assignToAgent}\t\t\t</td>\t\t\t<td style=\"width: 100%;\">\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"assignToAgentId\" width=\"100%\" none=\"${app.i18n.none}\" multiselect=\"false\"></div>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.deleteMail}\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"checkbox\" quId=\"deleteMail\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td style=\"white-space: nowrap;\">\t\t\t\t${app.i18n.stopProcessingNext}\t\t\t</td>\t\t\t<td>\t\t\t\t<input type=\"checkbox\" quId=\"stopProcessing\" />\t\t\t</td>\t\t</tr>\t</table></fieldset><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},custom:{MailTemplates:"<div>\t<div class=\"toolbar\">\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Priority:"<table>\t<tr>\t\t<td>\t\t\t${app.i18n.priority}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"priority\" style=\"width: 60px\" />\t\t</td>\t</tr>\t<tr>\t\t<td>\t\t\t${app.i18n.priorityName}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"priorityName\" style=\"width: 200px\" />\t\t\t</td>\t</tr>\t\t\t</table><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",MailTemplate:"<table width=\"100%\">\t<tr>\t\t<td nowrap=\"nowrap\">\t\t\t${app.i18n.subject}\t\t</td>\t\t<td style=\"width: 100%\">\t\t\t<input type=\"text\" quId=\"subject\" style=\"width: 100%\" />\t\t</td>\t</tr>\t<tr>\t\t<td nowrap=\"nowrap\">\t\t\t${app.i18n.htmlBody}\t\t</td>\t\t<td style=\"height: 250px;width: 100%\">\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"htmlBody\" modes=\"rich,html\" width=\"100%\" height=\"200px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td nowrap=\"nowrap\">\t\t\t${app.i18n.textBody}\t\t</td>\t\t<td style=\"height: 250px;width: 100%\">\t\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"textBody\" modes=\"plain\" width=\"100%\" height=\"200px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td nowrap=\"nowrap\">\t\t\t${app.i18n.templateVariables}\t\t</td>\t\t<td style=\"width: 100%\">\t\t\t<span quId=\"templateVariables\"></span>\t\t</td>\t</tr>\t\t\t</table><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",Priorities:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Status:"<table style=\"width: 100%\">\t<tr>\t\t<td>\t\t\t${app.i18n._status}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"_status\" style=\"width: 20px\" maxlength=\"1\"/>\t\t\t<span>${app.i18n.oneLetterValue}</span>\t\t</td>\t</tr>\t<tr>\t\t<td>\t\t\t${app.i18n.statusName}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"statusName\" style=\"width: 100%;\" />\t\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.statusColor}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"color\" style=\"width: 100%;\" />\t\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.statusImage}\t\t</td>\t\t<td>\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"img\" none=\"${app.i18n.none}\" width=\"100%\" style=\"height: 20px;\" multiselect=\"false\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.computeDue}\t\t</td>\t\t<td>\t\t\t<input type=\"checkbox\" quId=\"due\" configSwitch=\"true\"/>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.dueTimeFrom}\t\t</td>\t\t<td>\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"dueTimeFrom\" none=\"${app.i18n.none}\" width=\"100%\" style=\"height: 20px;\" multiselect=\"false\"></div>\t\t</td>\t</tr>\t\t\t</table><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",Field:"<table width=\"100%\">\t<tr>\t\t<td>\t\t\t${app.i18n.fieldId}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"fieldId\" style=\"width: 100%\" />\t\t</td>\t</tr>\t<tr>\t\t<td>\t\t\t${app.i18n.fieldTitle}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"fieldTitle\" style=\"width: 100%\" />\t\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.fieldType}\t\t</td>\t\t<td>\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"fieldType\" width=\"100%\" style=\"height: 20px;\" multiselect=\"false\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td style=\"vertical-align: top;\">\t\t\t<span quId=\"lblOptions\">${app.i18n.options}</span>\t\t</td>\t\t<td>\t\t\t<textarea rows=\"4\" quId=\"options\" style=\"width: 100%;\"></textarea><br />\t\t\t<span style=\"font-size: xx-small\" quId=\"lblHelpText\">${app.i18n.separatedByCommas}</span>\t\t\t<span style=\"font-size: xx-small; display: none; white-space: normal;\" quId=\"lblPredefinedVariable\">${app.i18n.computedHTMLVariables}</span>\t\t</td>\t</tr>\t\t\t\t<tr quId=\"defaultValueRow\">\t\t<td>\t\t\t${app.i18n.defaultValue}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"defaultValue\" style=\"width: 100%\" />\t\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.relatedTo}\t\t</td>\t\t<td>\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"relatedTo\" width=\"100%\" multiselect=\"false\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.userAccess}\t\t</td>\t\t<td>\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"userAccess\" width=\"100%\" multiselect=\"false\"></div>\t\t</td>\t</tr>\t\t\t\t<tr>\t\t<td>\t\t\t${app.i18n.fieldOrder}\t\t</td>\t\t<td>\t\t\t<input type=\"text\" quId=\"orderValue\" style=\"width: 100%;\" />\t\t\t</td>\t</tr>\t\t\t</table><div class=\"buttonbar\">\t<button quId=\"cmdSave\">${app.i18n.save}</button>\t<button quId=\"cmdCancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",Statuses:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Fields:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>"},Gateways:"<div>\t<div class=\"toolbar\">\t<table style=\"border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdAdd\">${app.i18n.add}</button>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<button quId=\"cmdDelete\">${app.i18n._delete}</button>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>"},messages:{Messages:"<div style=\"\tposition:relative;\tmin-height: 200px;\t\">\t<div quId=\"treeContainer\" style=\"\t\tposition: absolute;\t\ttop: 0px;\t\tleft: 0px;\t\tborder: 1px solid #DDDDDD;\t\twidth: 200px;\t\">\t</div>\t<div style=\"\t\tposition: relative;\t\tmargin-left: 220px;\t\tborder: 1px solid #EEEEEE;\t\">\t</div></div>"},users:{AddUser:"<div style=\"padding: 6px;\">\t<table>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.email}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"email\" type=\"text\" style=\"width: 200px\"/>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.fullName}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"name\" type=\"text\" style=\"width: 200px\"/>\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.password}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"password\" type=\"password\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.passwordAgain}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"passwordAgain\" type=\"password\" />\t\t\t</td>\t\t</tr>\t\t<tr style=\"visibility:hidden;\" quId=\"userTypeContainer\">\t\t\t<td>\t\t\t\t${app.i18n.userType}\t\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"userType\"></div>\t\t\t</td>\t\t</tr>\t\t<tr style=\"visibility:hidden;\" quId=\"groupIdContainer\">\t\t\t<td>\t\t\t\t${app.i18n.groupName}\t\t\t\t</td>\t\t\t<td>\t\t\t\t<div dojoType=\"qu:Select\" quId=\"groupId\"></div>\t\t\t</td>\t\t</tr>\t</table></div><div class=\"buttonbar\">\t<button quId=\"save\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",SignUp:"<div style=\"padding: 6px;\">\t<table>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.email}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"email\" type=\"text\" style=\"width:200px;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.fullName}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"name\" type=\"text\" style=\"width:200px;\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.password}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"password\" type=\"password\" />\t\t\t</td>\t\t</tr>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.passwordAgain}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"passwordAgain\" type=\"password\" />\t\t\t</td>\t\t</tr>\t</table></div><div style=\"display: none;\"><div dojoType=\"qu:Select\" quId=\"groupId\"></div></div><div class=\"buttonbar\">\t<button quId=\"save\">${app.i18n.save}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>",userDetail:{Tickets:"<div quId=\"editContent\" style=\"min-height:150px;display:none;\"></div><div quId=\"mainContent\" class=\"mainContent\">\t<!-- TOOLBAR -->\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;\">\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdUpdates\" caption=\"${app.i18n.Updates}\" icon=\"edit\" tooltip=\"${app.i18n.Updates}\" radio=\"true\"></div>\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdFilters\" caption=\"${app.i18n.Filters}\" icon=\"file-find\" tooltip=\"${app.i18n.Filters}\" radio=\"true\"></div>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t\t<!-- UPDATES -->\t<div quId=\"updateContainer\" style=\"display:none;\">\t\t<div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"text-align:center; font-weight:bold;\">\t\t\t\t${app.i18n.selection}\t\t\t</div>\t\t</div>\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;\">\t\t\t\t<button quId=\"cmdDelete\">${app.i18n.Delete}</button>\t\t\t\t&nbsp;&#124;&nbsp;\t\t\t\t<select dojoType=\"qu:Select\" quId=\"status_\"></select>\t\t\t\t<select dojoType=\"qu:Select\" quId=\"owner\"></select>\t\t\t\t<select dojoType=\"qu:Select\" quId=\"queue\"></select>\t\t\t\t<select dojoType=\"qu:Select\" quId=\"priority\"></select>\t\t\t\t<button quId=\"cmdUpdate\">${app.i18n.update}</button>\t\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t\t\t<!-- FILTERS -->\t<div quId=\"filtersContainer\" style=\"display:none;\">\t\t<div style=\"background-color:#e0ecff; color:#364157; width:150px; margin-left:4px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"text-align:center; font-weight:bold;\">\t\t\t\t${app.i18n.Filters}\t\t\t</div>\t\t</div>\t\t<div style=\"background-color:#e0ecff; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;_height:1%;\">\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t<tr>\t\t\t\t\t\t<!-- LEFT COLUMN -->\t\t\t\t\t\t<td style=\"width:50%;\">\t\t\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.ticketId}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<input quId=\"filterId\" type=\"text\" style=\"width:100%\" />\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.subject}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<input quId=\"filterSubject\" type=\"text\" style=\"width:100%\"/>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.LastUpdate}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:DateRangePicker\" quId=\"filterLastUpdate\" width=\"350\"></div>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t&nbsp;\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t</td>\t\t\t\t\t\t<!-- RIGHT COLUMN -->\t\t\t\t\t\t<td style=\"width: 50%;\">\t\t\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterQueue\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.agent}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterAgent\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.Status}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterStatus\" none=\"${app.i18n.any}\" width=\"100%\" multiselect=\"true\"></div>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<td nowrap=\"nowrap\">\t\t\t\t\t\t\t\t\t\t${app.i18n.priority}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t<td style=\"width: 100%\">\t\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterPriority\" width=\"100%\" multiselect=\"true\" none=\"${app.i18n.any}\"></div>\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t</table>\t\t\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t\t\t\t<button quId=\"cmdClear\">${app.i18n.Clear}</button>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>",Profile:"<div style=\"_height:1%;\">\t<table style=\"width:100%;\">\t\t<tr>\t\t\t<td style=\"vertical-align:top;\">\t\t\t\t<fieldset>\t\t\t\t\t<legend>${app.i18n.personalInformation}</legend>\t\t\t\t\t\t\t\t\t\t<table style=\"width:100%;\">\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<input type=\"text\" quId=\"email\" style=\"width:100%;\" />\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.fullName}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<input type=\"text\" quId=\"name\" style=\"width:100%;\" />\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.created}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td quId=\"created\">\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.password}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<input type=\"password\" quId=\"password\" style=\"width:150px;\" />\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\"  style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.passwordAgain}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<input type=\"password\" quId=\"passwordAgain\" style=\"width:150px;\" />\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.userType}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"userType\"></div>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr quId=\"groupSection\" style=\"visibility: visible;\">\t\t\t\t\t\t\t\t<td class=\"formLabel\" style=\"width: 10%; white-space: nowrap;\">\t\t\t\t\t\t\t\t\t${app.i18n.groupName}\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"groupId\"></div>\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</table>\t\t\t\t</fieldset>\t\t\t\t<fieldset quId=\"additionalInformationFieldset\" style=\"display: none;\">\t\t\t\t\t<legend>${app.i18n.additionalUserInformation}</legend>\t\t\t\t\t<div quId=\"additionalInformationContent\">\t\t\t\t\t</div>\t\t\t\t</fieldset>\t\t\t\t\t\t\t</td>\t\t\t<td style=\"vertical-align:top;\">\t\t\t\t<div quId=\"queuesContainer\" style=\"display:none;\">\t\t\t\t\t<fieldset>\t\t\t\t\t\t<legend>${app.i18n.queues}</legend>\t\t\t\t\t\t<div dojoType=\"qu:ListBox\" quId=\"queues\" multiselect=\"true\"></div>\t\t\t\t\t</fieldset>\t\t\t\t</div>\t\t\t</td>\t\t</tr>\t</table></div><div style=\"height:200px;\">\t\t<fieldset>\t\t<legend>${app.i18n.signature}</legend>\t\t<!-- div dojoType=\"qu:RichText\" quId=\"signature\" height=\"130\" mode=\"rich\"></div-->\t\t<div dojoType=\"qu:HtmlEditor\" quId=\"signature\" height=\"130px\" defaultFont=\"${quConfig.defaultFont}\" defaultFontSize=\"${quConfig.defaultFontSize}\"></div>\t\t<br/><br/>\t</fieldset></div><br/><button quId=\"cmdSave\">${app.i18n.save}</button><span quId=\"msgBox\" class=\"msgBox\"></span>",Logs:"<div>\t<!-- TOOLBAR -->\t<div quId=\"updateContainer\" style=\"display:block;\">\t\t<div style=\"background-color:#FFFFFF; color:#364157; width:100%; margin-bottom:8px;\">\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_tr.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t\t<div style=\"padding:4px;\">\t\t\t\t<div dojoType=\"qu:Button\" quId=\"_delete\" caption=\"${app.i18n._delete}\" icon=\"delete-table-cell\" tooltip=\"${app.i18n._delete}\"></div>\t\t\t\t<div dojoType=\"qu:Button\" quId=\"cmdFilters\" caption=\"${app.i18n.Filters}\" icon=\"file-find\" tooltip=\"${app.i18n.Filters}\" radio=\"true\"></div>\t\t\t</div>\t\t\t<div style=\"background: url('app/web/images/corners/fieldsetTickets_4x4_br.png') no-repeat top right;\">\t\t\t\t<img src=\"app/web/images/corners/fieldsetTickets_4x4_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:4px; height:4px;\" />\t\t\t</div>\t\t</div>\t</div>\t<div quId=\"filtersContainer\" style=\"display:none;\">\t\t<table>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.message}</span>\t\t\t\t</td>\t\t\t\t<td colspan=\"20\">\t\t\t\t\t<input quId=\"filterMessage\" type=\"text\" style=\"width:650px\" />\t\t\t\t</td>\t\t\t</tr>\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.created}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:Select\" quId=\"filterCreated\"></div>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.logLevel}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<div dojoType=\"qu:ComboBox\" quId=\"filterLogLevel\" none=\"${app.i18n.any}\" multiselect=\"true\"></div>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.logType}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input quId=\"filterLogType\" type=\"text\" style=\"width:75px\" />\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<span>${app.i18n.ip}</span>\t\t\t\t</td>\t\t\t\t<td>\t\t\t\t\t<input quId=\"filterIp\" type=\"text\" style=\"width:75px\" />\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t\t<button quId=\"cmdUpdateFilter\">${app.i18n.updateFilter}</button>\t</div>\t<div dojoType=\"qu:Grid\" quId=\"grid\"></div></div>"},UserDetail:"<div style=\"color:#2E8C2E;\">\t<div class=\"backLink\" style=\"_height:1%;\">\t\t<table style=\"width:100%;border-collapse:collapse;\">\t\t\t<tr>\t\t\t\t<td>\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdBack\" class=\"backLinkGreen\">&lt;&lt;&nbsp;&nbsp;${app.i18n.BackToUsers}</a>\t\t\t\t</td>\t\t\t\t<td style=\"text-align:right;\">\t\t\t\t\t<a href=\"javascript://\" quId=\"cmdPopup\" class=\"blank\" target=\"_blank\" title=\"${app.i18n.OpenInNewWindow}\">\t\t\t\t\t\t<img src=\"app/web/images/popup_blue.gif\" style=\"width:16px; height:16px;border:none;\" />\t\t\t\t\t</a>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div>\t\t<div style=\"background-color:#d3f4d7;padding:12px;color:#364157;margin-top:6px;\">\t\t\t<div style=\"margin-bottom:6px;_height:1%;\">\t\t\t\t<table style=\"width:100%\">\t\t\t\t\t<tr>\t\t\t\t\t\t<td>\t\t\t\t\t\t\t<img quId=\"titleIcon\" style=\"height:22px;width:22px;vertical-align:middle;\"/>\t\t\t\t\t\t\t<span quId=\"titleName\" style=\"font-size:16px;font-weight:bold;\"></span>\t\t\t\t\t\t\t<span quId=\"titleEmail\" style=\"font-size:12px;font-weight:bold;color:#2E8C2E;\"></span>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td style=\"text-align:right;\">\t\t\t\t\t\t\t<span quId=\"titleType\" style=\"font-size:12px;font-weight:bold;\"></span>\t\t\t\t\t\t\t<img quId=\"titleTypeIcon\" style=\"height:12px;width:12px;vertical-align:baseline;\"/>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>\t\t\t\t</table>\t\t\t</div>\t\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t\t</div>\t</div></div>",ForgotPassword:"<div style=\"padding: 6px;\">\t<span>${app.i18n.requestNewPasswordDescription}</span>\t<table>\t\t<tr>\t\t\t<td>\t\t\t\t${app.i18n.email}\t\t\t</td>\t\t\t<td>\t\t\t\t<input quId=\"email\" type=\"text\" style=\"width:200px;\" />\t\t\t</td>\t\t</tr>\t</table></div><div class=\"buttonbar\">\t<button quId=\"save\">${app.i18n.requestNewPassword}</button>\t<button quId=\"cancel\">${app.i18n.cancel}</button><br/>\t<span quId=\"msgBox\" class=\"msgBox\"></span></div>"},NewTicket:"<div style=\"\tbackground-color:#C3D9FF;\tcolor:#364157;\twidth:600px;\ttext-align:left;\tmargin: 10px\t\">\t<div style=\"background: url('app/web/images/corners/blue_8x8_tr.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_tl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div style=\"\t\tbackground: transparent url('lib/icons/crystalsvg/22/help.png') 12px 8px no-repeat;\t\tpadding: 8px;\t\" >\t\t<div quId=\"lblNewTicket\" style=\"\t\t\theight:22px;\t\t\tpadding-left:30px;\t\t\tfont-size: 18px;\t\t\tmargin-bottom: 12px;\t\t\t\">\t\t\t${app.i18n.newTicket}\t\t</div>\t\t<div style=\"background-color:#e0ecff; padding:8px;\">\t\t\t<table style=\"width: 100%\">\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblTicketName\" style=\"width: 20%;\">\t\t\t\t\t\t${app.i18n.name}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"name\" value=\"\" style=\"width:100%\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblTicketEmail\">\t\t\t\t\t\t${app.i18n.email}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"email\" value=\"\" style=\"width: 100%\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t</table>\t\t\t\t<div quId=\"customFieldsContent\">\t\t\t\t</div>\t\t\t\t<table style=\"width: 100%\">\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblQueue\" style=\"width: 20%;\">\t\t\t\t\t\t${app.i18n.queue}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"queue\" style=\"width: 100%\"></select>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr quId=\"priorityLine\" style=\"display: none;\">\t\t\t\t\t<td quId=\"lblPriority\" style=\"width: 20%;\">\t\t\t\t\t\t${app.i18n.priority}\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<select dojoType=\"qu:Select\" quId=\"priority\" style=\"width: 100%\"></select>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblTicketSubject\">\t\t\t\t\t\t${app.i18n.subject}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<input type=\"text\" quId=\"subject\" value=\"\" style=\"width: 100%\"/>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblTicketBody\" valign=\"top\">\t\t\t\t\t\t${app.i18n.body}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<textarea quId=\"body\" style=\"width:100%;\" rows=\"12\"></textarea>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td quId=\"lblTicketAttachment\" valign=\"top\">\t\t\t\t\t\t${app.i18n.attachment}\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t<td>\t\t\t\t\t\t<div quId=\"attachmentContainer\"></div>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t</table>\t\t\t\t\t\t<div quId=\"suggestionsBlock\" class=\"suggestion_block\">\t\t\t\t<div class=\"suggestion_title\">\t\t\t\t\t<div class=\"suggestion_title_text\">${app.i18n.reviewSuggestionsBeforeSubmit}</div>\t\t\t\t</div>\t\t\t\t<div quId=\"suggestionsContainer\" class=\"suggestion_container\"></div>\t\t\t</div>\t\t\t\t\t\t<button quId=\"cmdSubmitNewTicket\">${app.i18n.send}</button>\t\t\t<button quId=\"cmdReset\">${app.i18n.reset_}</button>\t\t</div>\t\t<div style=\"text-align:center; margin-top:12px; height:16px;\">\t\t\t<span quId=\"msgBox\"></span>\t\t</div>\t</div>\t<div style=\"background: url('app/web/images/corners/blue_8x8_br.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/blue_8x8_bl.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>",emailTemplates:{ReplyQuote:"<font style=\"color:#555555;\">${this.signature}${this.queueSignature}</font><br/><br/><hr /><p style=\"background-color: #F6F6F6\">\t<span style=\"font-family: Arial, Tahoma, Helvetica, sans-serif; font-size: 12px; font-weight: normal;font-style:italic\">${app.i18n.from}: ${this.email.getFromUser().getEmail()}</span><br/>\t<%\t\tvar getEmails = function(inArray) {\t\t\tvar len = inArray.length;\t\t\tif(len == 0) return \"\";\t\t\tvar result = \"\";\t\t\tdojo.lang.forEach(inArray, function(inElement, inIndex) {\t\t\t\tresult += inElement.getEmail();\t\t\t\tif(inIndex != len - 1) result += \", \";\t\t\t});\t\t\treturn result;\t\t};\t\tthis.tos = getEmails(this.email.getToUsers());\t\tthis.ccs = getEmails(this.email.getCcUsers());\t%>\t<span style=\"font-family: Arial, Tahoma, Helvetica, sans-serif; font-size: 12px; font-weight: normal;font-style:italic\">${app.i18n.to}: ${this.tos}</span><br/>\t<span style=\"font-family: Arial, Tahoma, Helvetica, sans-serif; font-size: 12px; font-weight: normal;font-style:italic\">${app.i18n.cc}: ${this.ccs}</span><br/>\t<span style=\"font-family: Arial, Tahoma, Helvetica, sans-serif; font-size: 12px; font-weight: normal;font-style:italic\">${app.i18n.subject}: ${this.email.getSubject()}</span><br/>\t<div style=\"font-family: Arial, Tahoma, Helvetica, sans-serif; font-size: 12px; font-weight: normal;\">${this.email.getBodyHtml()}</div></p>",Reply:"${this.signature}${this.queueSignature}"},downloadmanager:{PreviewTree:"<div dojoType=\"qu:DmTreeLoadingController\" \tid=\"dmTreeLoader\" \twidgetId=\"dmTreeLoader\"\tservice=\"ProductOrders\" \tDNDController=\"create\"\texpandIconSrcLoading=\"../qu/widget/templates/images/treenode_loading.png\"></div><div dojoType=\"dojo:TreeSelector\" id=\"dmTreeSelector\" eventNames=\"select:dmNodeSelected\"></div><div dojoType=\"dojo:Tree\" \tselector=\"dmTreeSelector\" \tcontroller=\"dmTreeLoader\" \tshowRootGrid=\"true\" \ttoogle=\"wipe\" \texpandLevel=\"2\"\twidgetId=\"CMTreeDownloadManager\"\tid=\"tree\"></div>"},Reports:"<div style=\"background-color:#FFE6BF; color:#364157;\" class=\"contentWrapper\">\t<div style=\"background: url('app/web/images/corners/corner_tr_reports.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/corner_tl_reports.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div>\t<div class=\"mainContent\">\t\t<div dojoType=\"qu:TabFolder\" quId=\"tabFolder\"></div>\t</div>\t<div style=\"background: url('app/web/images/corners/corner_br_reports.png') no-repeat top right;\">\t\t<img src=\"app/web/images/corners/corner_bl_reports.png\" alt=\"\" class=\"corner\" style=\"display:none; width:8px; height:8px;\" />\t</div></div>"};
dojo.provide("app.data.Services");
app.services={Fields:{"SMDVersion":".1","objectName":"Fields","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Fields","methods":[{"name":"getFieldsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteField","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertField","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateField","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getField","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getTicketCustomFieldsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateCustomFields","parameters":[{"name":"params","type":"OBJECT"}]}]},OutboxMails:{"SMDVersion":".1","objectName":"OutboxMails","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=OutboxMails","methods":[{"name":"getMailsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteMail","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"retryMail","parameters":[{"name":"params","type":"OBJECT"}]}]},Notifications:{"SMDVersion":".1","objectName":"Notifications","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Notifications","methods":[{"name":"updateNotification","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertNotification","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getNotificationsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteNotification","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getNotification","parameters":[{"name":"params","type":"OBJECT"}]}]},Reports:{"SMDVersion":".1","objectName":"Reports","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Reports","methods":[{"name":"ticketsReport","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getWorkTimeReport","parameters":[{"name":"params","type":"OBJECT"}]}]},MailTemplates:{"SMDVersion":".1","objectName":"MailTemplates","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=MailTemplates","methods":[{"name":"insertTemplate","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteTemplate","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateTemplate","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getTemplatesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getTemplatesFormList","parameters":[{"name":"params","type":"OBJECT"}]}]},Groups:{"SMDVersion":".1","objectName":"Groups","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Groups","methods":[{"name":"getGroupsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteGroup","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertGroup","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateGroup","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getGroup","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getCustomFieldValues","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getAllCustomFieldValues","parameters":[{"name":"params","type":"OBJECT"}]}]},QueueSignatures:{"SMDVersion":".1","objectName":"QueueSignatures","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=QueueSignatures","methods":[{"name":"getSignaturesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertSignature","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteSignature","parameters":[{"name":"params","type":"OBJECT"}]}]},Nop:{"SMDVersion":".1","objectName":"Nop","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Nop","methods":[{"name":"nop","parameters":[{"name":"params","type":"OBJECT"}]}]},MailAccounts:{"SMDVersion":".1","objectName":"MailAccounts","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=MailAccounts","methods":[{"name":"getMailAccountsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteMailAccount","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertMailAccount","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateMailAccount","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"setAsDefaultMailAccount","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getMailAccount","parameters":[{"name":"params","type":"OBJECT"}]}]},Languages:{"SMDVersion":".1","objectName":"Languages","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Languages","methods":[{"name":"getAvailableLanguages","parameters":[{"name":"params","type":"OBJECT"}]}]},Mails:{"SMDVersion":".1","objectName":"Mails","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Mails","methods":[{"name":"getMailBody","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getMailHeaders","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"answerMail","parameters":[{"name":"params","type":"OBJECT"}]}]},KBItems:{"SMDVersion":".1","objectName":"KBItems","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=KBItems","methods":[{"name":"getItemsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getItem","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteItem","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertItem","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateItem","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"forceRefresh","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveItem","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"searchItems","parameters":[{"name":"params","type":"OBJECT"}]}]},Filters:{"SMDVersion":".1","objectName":"Filters","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Filters","methods":[{"name":"getFiltersList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteFilter","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertFilter","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateFilter","parameters":[{"name":"params","type":"OBJECT"}]}]},Tickets:{"SMDVersion":".1","objectName":"Tickets","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Tickets","methods":[{"name":"getTicketsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteTicket","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateTicket","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"replyMail","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getMailsData","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"newAnonymTicket","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveMailToNewTicket","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getCustomFieldValues","parameters":[{"name":"params","type":"OBJECT"}]}]},Products:{"SMDVersion":".1","objectName":"Products","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Products","methods":[{"name":"getProductsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteProduct","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertProduct","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateProduct","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getProduct","parameters":[{"name":"params","type":"OBJECT"}]}]},ProductOrders:{"SMDVersion":".1","objectName":"ProductOrders","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=ProductOrders","methods":[{"name":"getOrdersList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getProductOrdersList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteOrder","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertOrder","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateOrder","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getOrder","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getProductOrder","parameters":[{"name":"params","type":"OBJECT"}]}]},EscalationRules:{"SMDVersion":".1","objectName":"EscalationRules","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=EscalationRules","methods":[{"name":"getRulesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveRuleUp","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveRuleDown","parameters":[{"name":"params","type":"OBJECT"}]}]},Rules:{"SMDVersion":".1","objectName":"Rules","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Rules","methods":[{"name":"getRulesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveRuleUp","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"moveRuleDown","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateRule","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getRule","parameters":[{"name":"params","type":"OBJECT"}]}]},Priorities:{"SMDVersion":".1","objectName":"Priorities","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Priorities","methods":[{"name":"getPrioritiesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deletePriority","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertPriority","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updatePriority","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getPriority","parameters":[{"name":"params","type":"OBJECT"}]}]},Files:{"SMDVersion":".1","objectName":"Files","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Files","methods":[{"name":"getFilesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteFile","parameters":[{"name":"params","type":"OBJECT"}]}]},Settings:{"SMDVersion":".1","objectName":"Settings","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Settings","methods":[{"name":"getSettingsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateSetting","parameters":[{"name":"params","type":"OBJECT"}]}]},Statuses:{"SMDVersion":".1","objectName":"Statuses","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Statuses","methods":[{"name":"getStatusesList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteStatus","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertStatus","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateStatus","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getStatus","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getAvailableImages","parameters":[{"name":"params","type":"OBJECT"}]}]},Users:{"SMDVersion":".1","objectName":"Users","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Users","methods":[{"name":"login","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"logout","parameters":[]},{"name":"requestNewPassword","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateLastAction","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getLoggedInUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateLoggedInUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getUsersList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getUserEmailsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getAgents","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"registerNewUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"hashLogin","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getOnlineAgents","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateUser","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"authenticate","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getCustomFieldValues","parameters":[{"name":"params","type":"OBJECT"}]}]},Gateways:{"SMDVersion":".1","objectName":"Gateways","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Gateways","methods":[{"name":"updateGateway","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertGateway","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getGatewaysList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteGateway","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getGateway","parameters":[{"name":"params","type":"OBJECT"}]}]},Logs:{"SMDVersion":".1","objectName":"Logs","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Logs","methods":[{"name":"getLogsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteLog","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getLogUsersList","parameters":[{"name":"params","type":"OBJECT"}]}]},WorkReports:{"SMDVersion":".1","objectName":"WorkReports","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=WorkReports","methods":[{"name":"insertReport","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateReport","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteReport","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getBillingTimeList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getBillingTimeSum","parameters":[{"name":"params","type":"OBJECT"}]}]},Logins:{"SMDVersion":".1","objectName":"Logins","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Logins","methods":[{"name":"getLoginsList","parameters":[{"name":"params","type":"OBJECT"}]}]},Queues:{"SMDVersion":".1","objectName":"Queues","serviceType":"JSON-RPC","serviceURL":"../server/index.php?service=Queues","methods":[{"name":"getQueueList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"deleteQueue","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"setDefaultQueue","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"insertQueue","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"updateQueue","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getQueue","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getQueueAgentsList","parameters":[{"name":"params","type":"OBJECT"}]},{"name":"getPublicQueues","parameters":[{"name":"params","type":"OBJECT"}]}]}};
dojo.provide("qu.rpc.Pool");
dojo.require("dojo.Deferred");
dojo.require("dojo.io.*");
dojo.require("qu.rpc.Service");
dojo.lang.declare("qu.rpc.Pool",null,{services:[],fileExtension:"smd",getSmdUrl:function(_ba0){
var _ba1="../server/services/"+_ba0+"."+this.fileExtension+"?"+djConfig.cacheBust;
return _ba1;
},getProxyClass:function(_ba2){
var _ba3=new dojo.Deferred();
if(this.services[_ba2] instanceof qu.rpc.Service){
_ba3.callback(this.services[_ba2]);
}else{
this.createProxyClass(_ba2,_ba3);
}
return _ba3;
},createProxyClass:function(_ba4,_ba5){
quThrobber.show();
dojo.io.bind({url:this.getSmdUrl(_ba4),mimetype:"text/json",load:this.resultCallback(_ba5,_ba4),error:this.errorCallback(_ba5),sync:false});
},resultCallback:function(_ba6,_ba7){
return dojo.lang.hitch(this,function(type,obj,e){
quThrobber.hide();
try{
var _bab=new qu.rpc.Service();
_bab.processSmd(obj);
this.setProxyClass(_ba7,_bab);
_ba6.callback(_bab);
}
catch(e){
_ba6.errback(new Error(e.message));
}
});
},errorCallback:function(_bac){
return function(type,e){
quThrobber.hide();
_bac.errback(new Error(e.message));
};
},setProxyClass:function(_baf,_bb0){
this.services[_baf]=_bb0;
}});
qu.rpcPool=new qu.rpc.Pool();
dojo.provide("qu.rpc.Model");
dojo.require("qu.rpc.Service");
dojo.require("qu.sql.ResultSet");
dojo.lang.declare("qu.rpc.Model",null,function(){
this.service=null;
this.methodName="";
this.defaultParams=null;
this.params=null;
this.resultSet=new qu.sql.ResultSet();
},{ORDER:"order",ORDER_DIRECTION:"orderDirection",OFFSET:"offset",LIMIT:"limit",isInitiated:function(){
return (this.service&&this.methodName!="");
},setService:function(_bb1){
if(_bb1 instanceof qu.rpc.Service){
this.service=_bb1;
}
},getService:function(){
return this.service;
},setMethod:function(_bb2){
this.methodName=_bb2;
},getMethod:function(){
return this.methodName;
},setParams:function(_bb3){
this.params=_bb3;
},getParams:function(){
return this.params;
},setDefaultParams:function(_bb4){
this.defaultParams=_bb4;
},getDefaultParams:function(){
return this.defaultParams;
},getData:function(){
var _bb5=this.getService();
var _bb6=this.getDefaultParams();
var _bb7=this.getParams();
for(var each in _bb7){
_bb6[each]=_bb7[each];
}
var def=_bb5[this.getMethod()](_bb6);
def.addCallback(dojo.lang.hitch(this,"onGetDataSuccess"));
def.addErrback(dojo.lang.hitch(this,"onGetDataFail"));
return def;
},onGetDataSuccess:function(_bba){
this.setResultSet(_bba);
},onGetDataFail:function(_bbb){
dojo.debug("getDataFail: "+_bbb.message);
},getResultSet:function(){
return this.resultSet;
},setResultSet:function(_bbc){
this.resultSet=_bbc;
}});
dojo.provide("qu.widget.Select");
dojo.require("qu.rpc.Model");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("dojo.html.style");
dojo.widget.defineWidget("qu.widget.Select",dojo.widget.HtmlWidget,function(){
this._anyOption=false;
this._noneOption=false;
this._deleteOptions=true;
this.model=new qu.widget.select.Model();
},{namespace:"qu",widgetType:"Select",isContainer:false,quId:"",templateString:"<select class=\"quSelect\" dojoAttachPoint=\"target\"></select>",templateCssString:".quSelect {}",setAnyOption:function(_bbd){
this._anyOption=_bbd;
},getAnyOption:function(){
return this._anyOption;
},setNoneOption:function(_bbe){
this._noneOption=_bbe;
},getNoneOption:function(){
return this._noneOption;
},removeOptions:function(){
var o=this.target.options;
for(var i=0;i<o.length;i++){
o[i]=null;
}
this.target.length=0;
},removeAll:function(){
this.removeOptions();
},add:function(_bc1,_bc2){
this.addOption(_bc1,_bc2);
},addOption:function(_bc3,_bc4){
var len=this.target.options.length;
this.target.options[len]=new Option(_bc4,_bc3);
},selectByIndex:function(_bc6){
this.target.selectedIndex=_bc6;
},selectByValue:function(_bc7){
var o=this.target.options;
for(var i=0;i<o.length;i++){
if(o[i].value==_bc7){
o[i].selected=true;
break;
}
}
},remove:function(_bca){
var o=this.target.options;
for(var i=0;i<o.length;i++){
if(o[i].value==_bca){
o[i]=null;
break;
}
}
},select:function(_bcd){
this.selectByValue(_bcd);
},selectByText:function(_bce){
var o=this.target.options;
for(var i=0;i<o.length;i++){
if(o[i].innerHTML==inValue){
o[i].selected=true;
}
}
},disable:function(){
this.target.disabled=true;
},enable:function(){
this.target.disabled=false;
},setWidth:function(_bd1){
this._width=_bd1;
this.domNode.style.width=_bd1;
},getWidth:function(){
return this._width;
},getSelectedValue:function(){
var _bd2=this.getSelectedIndex();
if(_bd2<0){
return null;
}
return this.target.options[_bd2].value;
},getSelection:function(){
return this.getSelectedValue();
},getSelectedIndex:function(){
return this.target.selectedIndex;
},getSelectedText:function(){
var _bd3=this.getSelectedIndex();
if(_bd3<0){
return null;
}
return this.target.options[_bd3].innerHTML;
},setModel:function(_bd4){
this.model=_bd4;
},getModel:function(){
return this.model;
},getData:function(){
dojo.event.connectOnce(this.getModel(),"onGetDataSuccess",this,"refreshData");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",function(_bd5){
dojo.debug(_bd5);
});
this.getModel().getData();
},refreshData:function(){
this.enable();
if(this.isDeleteOptions()===true){
this.removeOptions();
}
var _bd6=this.getModel();
var rs=_bd6.getResultSet();
rs.beforeFirst();
if(this.getAnyOption()!==false){
this.addOption(qu.widget.Select.OPTION_ANY,this.getAnyOption());
}
if(this.getNoneOption()!==false){
this.addOption(qu.widget.Select.OPTION_NONE,this.getNoneOption());
}
var _bd8,text;
while(rs.next()){
_bd8=rs.get(_bd6.getValueColumn()).valueOf();
text=rs.get(_bd6.getTextColumn()).valueOf();
this.addOption(_bd8,text);
}
this.onLoad();
},setMessage:function(_bda){
var _bdb=_bda||app.i18n.get("loading");
this.removeOptions();
this.addOption("null",_bdb);
this.disable();
},onLoad:function(){
},setDeleteOptions:function(_bdc){
this._deleteOptions=_bdc;
},isDeleteOptions:function(){
return this._deleteOptions;
},update:function(_bdd){
_bdd===false?this.setDeleteOptions(false):this.setDeleteOptions(true);
this.getData();
}});
qu.widget.Select.OPTION_ANY="any";
qu.widget.Select.OPTION_NONE="";
dojo.lang.declare("qu.widget.select.Model",qu.rpc.Model,function(){
this._columnValue=null;
this._columnText=null;
},{setValueColumn:function(_bde){
this._columnValue=_bde;
},getValueColumn:function(){
return this._columnValue;
},setTextColumn:function(_bdf){
this._columnText=_bdf;
},getTextColumn:function(){
return this._columnText;
}});
dojo.provide("app.view.users.User");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.users.User",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.save,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.AddUser"));
this.setSize(350,200);
},onShow:function(){
this.el.email.focus();
},onLoad:function(){
this.center();
this.resetForm();
},resetForm:function(){
this.msgBox.clear();
this.setName("");
this.setEmail("");
this.setPassword("");
this.setGroupId("");
this.setPasswordAgain("");
},onSave:function(){
this.msgBox.print(app.i18n.get("saving"));
},onSaveSuccess:function(){
this.msgBox.print(app.i18n.get("saved"));
},onSaveFail:function(_be0){
this.msgBox.print(_be0.message);
},initUserTypes:function(){
this.el.userType.removeOptions();
if(qu.user.getType()=="a"||qu.user.getType()=="g"){
if(qu.user.getType()=="a"){
this.el.userType.addOption("a",app.i18n.get("typeAdmin"));
this.el.userType.addOption("g",app.i18n.get("typeAgent"));
}
this.setUserTypeVisible(true);
}else{
if(qu.user.getType()=="u"){
this.setUserTypeVisible(false);
}
}
this.el.userType.addOption("u",app.i18n.get("typeUser"));
this.el.userType.selectByValue("u");
},initGroups:function(){
if(!quConfig.hideGroups){
this.el.groupId.removeAll();
this.el.groupId.add("",app.i18n.get("none"));
app.main.hashMaps.fill(this.el.groupId,"groups",false);
this.setGroupId("");
}else{
this.el.groupIdContainer.style.visibility="hidden";
}
},setUserTypeVisible:function(_be1){
if(_be1===true){
this.el.userTypeContainer.style.visibility="visible";
this.el.groupIdContainer.style.visibility="visible";
}else{
this.el.userTypeContainer.style.visibility="hidden";
this.el.groupIdContainer.style.visibility="hidden";
}
},getName:function(){
return this.el.name.value;
},setName:function(_be2){
this.el.name.value=_be2;
},getEmail:function(){
return this.el.email.value;
},setEmail:function(_be3){
this.el.email.value=_be3;
},getPassword:function(){
return dojo.crypto.MD5.compute(this.el.password.value,dojo.crypto.outputTypes.Hex);
},getPlainPassword:function(){
return this.el.password.value;
},setPassword:function(inPw){
this.el.password.value=inPw;
},getPasswordAgain:function(){
return dojo.crypto.MD5.compute(this.el.passwordAgain.value,dojo.crypto.outputTypes.Hex);
},setPasswordAgain:function(inPw){
this.el.passwordAgain.value=inPw;
},getSignature:function(){
return this.el.signature.value;
},setSignature:function(_be6){
this.el.signature.value=_be6;
},getUserType:function(){
return this.el.userType.getSelectedValue();
},setUserType:function(_be7){
this.el.userType.selectByValue(_be7);
},getGroupId:function(){
return this.el.groupId.getSelectedValue();
},setGroupId:function(_be8){
this.el.groupId.selectByValue(_be8);
}});
dojo.provide("app.view.users.SignUp");
dojo.require("app.view.users.User");
dojo.lang.declare("app.view.users.SignUp",app.view.users.User,null,{initComponents:function(){
this.constructor.superclass.initComponents.apply(this);
this.setTitle(app.i18n.get("signUp"));
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.SignUp"));
this.setSize(350,150);
},checkValues:function(){
if(this.getPasswordAgain()!=this.getPassword()){
alert(app.i18n.get("passwordsDoesntMatch"));
this.setPassword("");
this.setPasswordAgain("");
this.el.password.focus();
return false;
}
if(this.getEmail().length==0){
alert(app.i18n.get("missingMandatoryFields"));
this.el.email.focus();
return false;
}
if(this.getName().length==0){
alert(app.i18n.get("missingMandatoryFields"));
this.el.name.focus();
return false;
}
return true;
},onSave:function(){
if(!this.checkValues()){
return false;
}
this.constructor.superclass.onSave.apply(this);
var _be9=new Object();
_be9.name=this.getName();
_be9.email=this.getEmail();
_be9.password=this.getPassword();
var _bea=new qu.rpc.Service("Users");
var def=_bea.registerNewUser({fields:_be9,plain_password:this.getPlainPassword(),sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onSaveSuccess:function(){
this.getParent().setUsername(this.getEmail());
this.getParent().el.password.focus();
this.getParent().msgBox.print(app.i18n.get("userSignedUp"));
},setParent:function(_bec){
this._parent=_bec;
},getParent:function(){
return this._parent;
}});
dojo.provide("app.view.users.ForgotPassword");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.users.ForgotPassword",qu.gui.Dialog,null,{initComponents:function(){
this.constructor.superclass.initComponents.apply(this);
this.setTitle(app.i18n.get("forgotPassword"));
},initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.save,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.ForgotPassword"));
this.setSize(350,110);
},onSave:function(){
var _bed=new qu.rpc.Service("Users");
var def=_bed.requestNewPassword({email:this.getEmail(),sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onSaveSuccess:function(){
this.getParent().setUsername(this.getEmail());
this.getParent().el.password.focus();
this.getParent().msgBox.print(app.i18n.get("newPasswordSent"));
},onSaveFail:function(_bef){
this.msgBox.print(_bef.message);
},setParent:function(_bf0){
this._parent=_bf0;
},getParent:function(){
return this._parent;
},onShow:function(){
this.el.email.focus();
},onLoad:function(){
this.center();
this.resetForm();
},resetForm:function(){
this.msgBox.clear();
this.setEmail("");
},getEmail:function(){
return this.el.email.value;
},setEmail:function(_bf1){
this.el.email.value=_bf1;
}});
dojo.provide("dojo.crypto");
dojo.crypto.cipherModes={ECB:0,CBC:1,PCBC:2,CFB:3,OFB:4,CTR:5};
dojo.crypto.outputTypes={Base64:0,Hex:1,String:2,Raw:3};
dojo.require("dojo.crypto");
dojo.provide("dojo.crypto.MD5");
dojo.crypto.MD5=new function(){
var _bf2=8;
var mask=(1<<_bf2)-1;
function toWord(s){
var wa=[];
for(var i=0;i<s.length*_bf2;i+=_bf2){
wa[i>>5]|=(s.charCodeAt(i/_bf2)&mask)<<(i%32);
}
return wa;
}
function toString(wa){
var s=[];
for(var i=0;i<wa.length*32;i+=_bf2){
s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));
}
return s.join("");
}
function toHex(wa){
var h="0123456789abcdef";
var s=[];
for(var i=0;i<wa.length*4;i++){
s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));
}
return s.join("");
}
function toBase64(wa){
var p="=";
var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
var s=[];
for(var i=0;i<wa.length*4;i+=3){
var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);
for(var j=0;j<4;j++){
if(i*8+j*6>wa.length*32){
s.push(p);
}else{
s.push(tab.charAt((t>>6*(3-j))&63));
}
}
}
return s.join("");
}
function add(x,y){
var l=(x&65535)+(y&65535);
var m=(x>>16)+(y>>16)+(l>>16);
return (m<<16)|(l&65535);
}
function R(n,c){
return (n<<c)|(n>>>(32-c));
}
function C(q,a,b,x,s,t){
return add(R(add(add(a,q),add(x,t)),s),b);
}
function FF(a,b,c,d,x,s,t){
return C((b&c)|((~b)&d),a,b,x,s,t);
}
function GG(a,b,c,d,x,s,t){
return C((b&d)|(c&(~d)),a,b,x,s,t);
}
function HH(a,b,c,d,x,s,t){
return C(b^c^d,a,b,x,s,t);
}
function II(a,b,c,d,x,s,t){
return C(c^(b|(~d)),a,b,x,s,t);
}
function core(x,len){
x[len>>5]|=128<<((len)%32);
x[(((len+64)>>>9)<<4)+14]=len;
var a=1732584193;
var b=-271733879;
var c=-1732584194;
var d=271733878;
for(var i=0;i<x.length;i+=16){
var olda=a;
var oldb=b;
var oldc=c;
var oldd=d;
a=FF(a,b,c,d,x[i+0],7,-680876936);
d=FF(d,a,b,c,x[i+1],12,-389564586);
c=FF(c,d,a,b,x[i+2],17,606105819);
b=FF(b,c,d,a,x[i+3],22,-1044525330);
a=FF(a,b,c,d,x[i+4],7,-176418897);
d=FF(d,a,b,c,x[i+5],12,1200080426);
c=FF(c,d,a,b,x[i+6],17,-1473231341);
b=FF(b,c,d,a,x[i+7],22,-45705983);
a=FF(a,b,c,d,x[i+8],7,1770035416);
d=FF(d,a,b,c,x[i+9],12,-1958414417);
c=FF(c,d,a,b,x[i+10],17,-42063);
b=FF(b,c,d,a,x[i+11],22,-1990404162);
a=FF(a,b,c,d,x[i+12],7,1804603682);
d=FF(d,a,b,c,x[i+13],12,-40341101);
c=FF(c,d,a,b,x[i+14],17,-1502002290);
b=FF(b,c,d,a,x[i+15],22,1236535329);
a=GG(a,b,c,d,x[i+1],5,-165796510);
d=GG(d,a,b,c,x[i+6],9,-1069501632);
c=GG(c,d,a,b,x[i+11],14,643717713);
b=GG(b,c,d,a,x[i+0],20,-373897302);
a=GG(a,b,c,d,x[i+5],5,-701558691);
d=GG(d,a,b,c,x[i+10],9,38016083);
c=GG(c,d,a,b,x[i+15],14,-660478335);
b=GG(b,c,d,a,x[i+4],20,-405537848);
a=GG(a,b,c,d,x[i+9],5,568446438);
d=GG(d,a,b,c,x[i+14],9,-1019803690);
c=GG(c,d,a,b,x[i+3],14,-187363961);
b=GG(b,c,d,a,x[i+8],20,1163531501);
a=GG(a,b,c,d,x[i+13],5,-1444681467);
d=GG(d,a,b,c,x[i+2],9,-51403784);
c=GG(c,d,a,b,x[i+7],14,1735328473);
b=GG(b,c,d,a,x[i+12],20,-1926607734);
a=HH(a,b,c,d,x[i+5],4,-378558);
d=HH(d,a,b,c,x[i+8],11,-2022574463);
c=HH(c,d,a,b,x[i+11],16,1839030562);
b=HH(b,c,d,a,x[i+14],23,-35309556);
a=HH(a,b,c,d,x[i+1],4,-1530992060);
d=HH(d,a,b,c,x[i+4],11,1272893353);
c=HH(c,d,a,b,x[i+7],16,-155497632);
b=HH(b,c,d,a,x[i+10],23,-1094730640);
a=HH(a,b,c,d,x[i+13],4,681279174);
d=HH(d,a,b,c,x[i+0],11,-358537222);
c=HH(c,d,a,b,x[i+3],16,-722521979);
b=HH(b,c,d,a,x[i+6],23,76029189);
a=HH(a,b,c,d,x[i+9],4,-640364487);
d=HH(d,a,b,c,x[i+12],11,-421815835);
c=HH(c,d,a,b,x[i+15],16,530742520);
b=HH(b,c,d,a,x[i+2],23,-995338651);
a=II(a,b,c,d,x[i+0],6,-198630844);
d=II(d,a,b,c,x[i+7],10,1126891415);
c=II(c,d,a,b,x[i+14],15,-1416354905);
b=II(b,c,d,a,x[i+5],21,-57434055);
a=II(a,b,c,d,x[i+12],6,1700485571);
d=II(d,a,b,c,x[i+3],10,-1894986606);
c=II(c,d,a,b,x[i+10],15,-1051523);
b=II(b,c,d,a,x[i+1],21,-2054922799);
a=II(a,b,c,d,x[i+8],6,1873313359);
d=II(d,a,b,c,x[i+15],10,-30611744);
c=II(c,d,a,b,x[i+6],15,-1560198380);
b=II(b,c,d,a,x[i+13],21,1309151649);
a=II(a,b,c,d,x[i+4],6,-145523070);
d=II(d,a,b,c,x[i+11],10,-1120210379);
c=II(c,d,a,b,x[i+2],15,718787259);
b=II(b,c,d,a,x[i+9],21,-343485551);
a=add(a,olda);
b=add(b,oldb);
c=add(c,oldc);
d=add(d,oldd);
}
return [a,b,c,d];
}
function hmac(data,key){
var wa=toWord(key);
if(wa.length>16){
wa=core(wa,key.length*_bf2);
}
var l=[],r=[];
for(var i=0;i<16;i++){
l[i]=wa[i]^909522486;
r[i]=wa[i]^1549556828;
}
var h=core(l.concat(toWord(data)),512+data.length*_bf2);
return core(r.concat(h),640);
}
this.compute=function(data,_c40){
var out=_c40||dojo.crypto.outputTypes.Base64;
switch(out){
case dojo.crypto.outputTypes.Hex:
return toHex(core(toWord(data),data.length*_bf2));
case dojo.crypto.outputTypes.String:
return toString(core(toWord(data),data.length*_bf2));
default:
return toBase64(core(toWord(data),data.length*_bf2));
}
};
this.getHMAC=function(data,key,_c44){
var out=_c44||dojo.crypto.outputTypes.Base64;
switch(out){
case dojo.crypto.outputTypes.Hex:
return toHex(hmac(data,key));
case dojo.crypto.outputTypes.String:
return toString(hmac(data,key));
default:
return toBase64(hmac(data,key));
}
};
}();
dojo.provide("app.view.Login");
dojo.require("qu.gui.Frame");
dojo.require("qu.rpc.Pool");
dojo.require("dojo.io.cookie");
dojo.require("qu.widget.Select");
dojo.require("app.view.users.SignUp");
dojo.require("app.view.users.ForgotPassword");
dojo.require("dojo.crypto.MD5");
dojo.lang.declare("app.view.Login",qu.gui.Frame,{initComponents:function(){
this.el.language.setWidth("10em");
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdLogin,"onclick",this,"onLogin");
dojo.event.connectOnce([this.el.username,this.el.password],"onkeypress",this,"onEnter");
dojo.event.connectOnce(this.el.language.domNode,"onchange",this,"onLanguageChange");
dojo.event.connectOnce(this.el.cmdSignUp,"onclick",this,"onSignUp");
dojo.event.connectOnce(this.el.cmdForgotPassword,"onclick",this,"onForgotPassword");
},onEnter:function(_c46){
if(_c46.keyCode==_c46.KEY_ENTER){
this.el.cmdLogin.onclick();
}
},onLanguageChange:function(){
var _c47=this.el.language.getSelectedValue();
app.i18n.__loadLanguageFile(_c47);
dojo.io.cookie.setCookie("language",_c47,365);
this.el.lblLogin.innerHTML=app.i18n.get("login");
this.el.lblEmail.innerHTML=app.i18n.get("email");
this.el.lblPassword.innerHTML=app.i18n.get("password");
this.el.lblRememberMe.innerHTML=app.i18n.get("rememberMe");
this.el.cmdLogin.innerHTML=app.i18n.get("toLogin");
this.el.cmdSignUp.innerHTML=app.i18n.get("signUp");
this.el.cmdForgotPassword.innerHTML=app.i18n.get("forgotPassword");
document.body.style.direction=app.i18n.get("languageDirection");
},preselectLanguage:function(){
var _c48=dojo.io.cookie.getCookie("language");
if(quConfig.loginLanguage.length>0){
this.el.language.select(quConfig.loginLanguage);
}else{
if(_c48){
this.el.language.select(_c48);
}else{
this.el.language.select(quConfig.interfaceLanguage);
}
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Login"));
},setInitialFocus:function(){
if(this.lastUsername){
this.el.password.focus();
}else{
this.el.username.focus();
}
},onLoad:function(){
this.el.language.removeAll();
var _c49=quConfig.systemLanguages.split("|");
for(var i=0;i<_c49.length;i++){
this.el.language.add(_c49[i],_c49[i]);
}
this.preselectLanguage();
if(_c49.length<2){
this.el.language.domNode.style.display="none";
}else{
this.el.language.domNode.style.display="inline";
}
this.lastUsername=dojo.io.cookie.getCookie("lastLoginEmail");
if(this.lastUsername){
this.setUsername(this.lastUsername);
}
},onSignUp:function(){
this.signUp=new app.view.users.SignUp();
this.signUp.setParent(this);
this.signUp.show();
},onForgotPassword:function(){
this.signUp=new app.view.users.ForgotPassword();
this.signUp.setParent(this);
this.signUp.show();
},setUsername:function(_c4b){
this.el.username.value=_c4b;
},getUsername:function(){
return this.el.username.value;
},getPassword:function(){
if(quConfig.passwordEncoding=="md5"||quConfig.passwordEncoding==""){
return dojo.crypto.MD5.compute(this.el.password.value,dojo.crypto.outputTypes.Hex);
}else{
return this.el.password.value;
}
},getRememberMe:function(){
return this.el.remember.checked;
},onLogin:function(){
this.msgBox.print(app.i18n.get("contactingWebService"));
var user=new qu.rpc.Service("Users");
var _c4d=this.getUsername();
var _c4e=this.getPassword();
var self=this;
user.setThrobber(app.i18n.get("logging"));
var _c50=user.login({"email":_c4d,"password":_c4e});
_c50.addCallback(this,"onLoginSuccess");
_c50.addErrback(this,"onLoginFail");
},onLoginSuccess:function(_c51){
this.msgBox.print("Success. Redirecting...");
_c51.first();
qu.user.login(_c51.get("sid").valueOf(),_c51.get("name").valueOf());
qu.user.setType(_c51.get("user_type").valueOf());
qu.user.setSignature(_c51.get("signature").valueOf());
qu.user.setHideSuggestions(_c51.get("hide_suggestions").valueOf());
qu.user.setId(_c51.get("user_id").valueOf());
qu.user.setUserName(_c51.get("email").valueOf());
qu.user.computeServerTimeOffset(_c51.getNumber("timezone_offset"));
qu.user.setHash(_c51.getString("hash").valueOf());
if(this.getRememberMe()){
dojo.io.cookie.setCookie("rememberMe",_c51.get("hash"),30);
}
dojo.io.cookie.setCookie("lastLoginEmail",this.getUsername(),30);
qu.boot.launch();
},onLoginFail:function(_c52){
quThrobber.hide();
this.msgBox.print(_c52.message);
}});
dojo.provide("app.widget.Widget");
dojo.lang.declare("app.widget.Widget",null,function(){
this._domNode=null;
},{getDomNode:function(){
return this._domNode;
},setDomNode:function(_c53){
this._domNode=_c53;
},create:function(){
}});
dojo.provide("dojo.io.IframeIO");
dojo.require("dojo.io.BrowserIO");
dojo.require("dojo.uri.*");
dojo.io.createIFrame=function(_c54,_c55,uri){
if(window[_c54]){
return window[_c54];
}
if(window.frames[_c54]){
return window.frames[_c54];
}
var r=dojo.render.html;
var _c58=null;
var turi=uri;
if(!turi){
if(djConfig["useXDomain"]&&!djConfig["dojoIframeHistoryUrl"]){
dojo.debug("dojo.io.createIFrame: When using cross-domain Dojo builds,"+" please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl"+" to the path on your domain to iframe_history.html");
}
turi=(djConfig["dojoIframeHistoryUrl"]||dojo.uri.moduleUri("dojo","../iframe_history.html"))+"#noInit=true";
}
var _c5a=((r.ie)&&(dojo.render.os.win))?"<iframe name=\""+_c54+"\" src=\""+turi+"\" onload=\""+_c55+"\">":"iframe";
_c58=document.createElement(_c5a);
with(_c58){
name=_c54;
setAttribute("name",_c54);
id=_c54;
}
dojo.body().appendChild(_c58);
window[_c54]=_c58;
with(_c58.style){
if(!r.safari){
position="absolute";
}
left=top="0px";
height=width="1px";
visibility="hidden";
}
if(!r.ie){
dojo.io.setIFrameSrc(_c58,turi,true);
_c58.onload=new Function(_c55);
}
return _c58;
};
dojo.io.IframeTransport=new function(){
var _c5b=this;
this.currentRequest=null;
this.requestQueue=[];
this.iframeName="dojoIoIframe";
this.fireNextRequest=function(){
try{
if((this.currentRequest)||(this.requestQueue.length==0)){
return;
}
var cr=this.currentRequest=this.requestQueue.shift();
cr._contentToClean=[];
var fn=cr["formNode"];
var _c5e=cr["content"]||{};
if(cr.sendTransport){
_c5e["dojo.transport"]="iframe";
}
if(fn){
if(_c5e){
for(var x in _c5e){
if(!fn[x]){
var tn;
if(dojo.render.html.ie){
tn=document.createElement("<input type='hidden' name='"+x+"' value='"+_c5e[x]+"'>");
fn.appendChild(tn);
}else{
tn=document.createElement("input");
fn.appendChild(tn);
tn.type="hidden";
tn.name=x;
tn.value=_c5e[x];
}
cr._contentToClean.push(x);
}else{
fn[x].value=_c5e[x];
}
}
}
if(cr["url"]){
cr._originalAction=fn.getAttribute("action");
fn.setAttribute("action",cr.url);
}
if(!fn.getAttribute("method")){
fn.setAttribute("method",(cr["method"])?cr["method"]:"post");
}
cr._originalTarget=fn.getAttribute("target");
fn.setAttribute("target",this.iframeName);
fn.target=this.iframeName;
fn.submit();
}else{
var _c61=dojo.io.argsFromMap(this.currentRequest.content);
var _c62=cr.url+(cr.url.indexOf("?")>-1?"&":"?")+_c61;
dojo.io.setIFrameSrc(this.iframe,_c62,true);
}
}
catch(e){
this.iframeOnload(e);
}
};
this.canHandle=function(_c63){
return ((dojo.lang.inArray(["text/plain","text/html","text/javascript","text/json","application/json"],_c63["mimetype"]))&&(dojo.lang.inArray(["post","get"],_c63["method"].toLowerCase()))&&(!((_c63["sync"])&&(_c63["sync"]==true))));
};
this.bind=function(_c64){
if(!this["iframe"]){
this.setUpIframe();
}
this.requestQueue.push(_c64);
this.fireNextRequest();
return;
};
this.setUpIframe=function(){
this.iframe=dojo.io.createIFrame(this.iframeName,"dojo.io.IframeTransport.iframeOnload();");
};
this.iframeOnload=function(_c65){
if(!_c5b.currentRequest){
_c5b.fireNextRequest();
return;
}
var req=_c5b.currentRequest;
if(req.formNode){
var _c67=req._contentToClean;
for(var i=0;i<_c67.length;i++){
var key=_c67[i];
if(dojo.render.html.safari){
var _c6a=req.formNode;
for(var j=0;j<_c6a.childNodes.length;j++){
var _c6c=_c6a.childNodes[j];
if(_c6c.name==key){
var _c6d=_c6c.parentNode;
_c6d.removeChild(_c6c);
break;
}
}
}else{
var _c6e=req.formNode[key];
req.formNode.removeChild(_c6e);
req.formNode[key]=null;
}
}
if(req["_originalAction"]){
req.formNode.setAttribute("action",req._originalAction);
}
if(req["_originalTarget"]){
req.formNode.setAttribute("target",req._originalTarget);
req.formNode.target=req._originalTarget;
}
}
var _c6f=function(_c70){
var doc=_c70.contentDocument||((_c70.contentWindow)&&(_c70.contentWindow.document))||((_c70.name)&&(document.frames[_c70.name])&&(document.frames[_c70.name].document))||null;
return doc;
};
var _c72;
var _c73=false;
if(_c65){
this._callError(req,"IframeTransport Request Error: "+_c65);
}else{
var ifd=_c6f(_c5b.iframe);
try{
var cmt=req.mimetype;
if((cmt=="text/javascript")||(cmt=="text/json")||(cmt=="application/json")){
var js=ifd.getElementsByTagName("textarea")[0].value;
if(cmt=="text/json"||cmt=="application/json"){
js="("+js+")";
}
_c72=dj_eval(js);
}else{
if(cmt=="text/html"){
_c72=ifd;
}else{
_c72=ifd.getElementsByTagName("textarea")[0].value;
}
}
_c73=true;
}
catch(e){
this._callError(req,"IframeTransport Error: "+e);
}
}
try{
if(_c73&&dojo.lang.isFunction(req["load"])){
req.load("load",_c72,req);
}
}
catch(e){
throw e;
}
finally{
_c5b.currentRequest=null;
_c5b.fireNextRequest();
}
};
this._callError=function(req,_c78){
var _c79=new dojo.io.Error(_c78);
if(dojo.lang.isFunction(req["error"])){
req.error("error",_c79,req);
}
};
dojo.io.transports.addTransport("IframeTransport");
};
dojo.provide("app.widget.CustomField");
dojo.require("app.widget.Widget");
dojo.require("dojo.io.IframeIO");
dojo.lang.declare("app.widget.CustomField",app.widget.Widget,function(_c7a,_c7b,_c7c,_c7d,_c7e,_c7f){
this._parentNode=_c7a;
this._fieldId=_c7b;
this._fieldType=_c7c;
this._defaultValue=_c7d;
this._options=_c7e;
this._contextVars=_c7f;
this.create();
this.connect();
},{create:function(){
var _c80=document.createElement("div");
this.setDomNode(_c80);
switch(this._fieldType){
case "t":
this.fieldNode=document.createElement("input");
this.fieldNode.setAttribute("type","text");
this.fieldNode.style.width="98%";
break;
case "c":
this.fieldNode=document.createElement("input");
this.fieldNode.setAttribute("type","checkbox");
break;
case "a":
this.fieldNode=document.createElement("textarea");
this.fieldNode.style.width="98%";
this.fieldNode.style.height="70px";
break;
case "o":
this.field=dojo.widget.createWidget("qu:ComboBox");
this.field.setMultiselect(false);
this.field.setWidth("250");
var _c81=this.getOptions();
this.field.removeAll();
for(var i=0;i<_c81.length;i++){
var str=dojo.string.trim(_c81[i]);
this.field.add(str,str);
}
this.fieldNode=this.field.domNode;
break;
case "m":
this.field=dojo.widget.createWidget("qu:ComboBox");
this.field.setWidth("250");
this.field.setMultiselect(true);
var _c81=this.getOptions();
this.field.removeAll();
for(var i=0;i<_c81.length;i++){
var str=dojo.string.trim(_c81[i]);
this.field.add(str,str);
}
this.fieldNode=this.field.domNode;
break;
case "h":
this.fieldNode=document.createElement("div");
var tmpl=new qu.gui.Template();
tmpl.setContent(this._options);
tmpl.setPreloaded(true);
this._defaultValue=tmpl.getContent(this._contextVars);
break;
default:
this.fieldNode=document.createElement("span");
this.fieldNode.innerHtml="undefined";
}
_c80.appendChild(this.fieldNode);
this.getParentNode().appendChild(this.getDomNode());
this.setValue(this._defaultValue);
},connect:function(){
},getParentNode:function(){
return this._parentNode;
},getOptions:function(){
return this._options.split(",");
},getValue:function(){
switch(this._fieldType){
case "t":
case "a":
return this.fieldNode.value;
break;
case "c":
if(this.fieldNode.checked){
return "y";
}else{
return "n";
}
break;
case "o":
case "m":
return this.field.getSelection().join(",");
break;
case "h":
if(this.fieldNode.innerHtml==undefined){
return "";
}
return this.fieldNode.innerHtml;
break;
default:
return false;
}
},setValue:function(_c85){
if(_c85=="null"){
_c85="";
}
switch(this._fieldType){
case "t":
case "a":
this.fieldNode.value=_c85;
break;
case "c":
if(_c85==true||_c85=="y"||_c85=="true"||_c85=="checked"){
this.fieldNode.checked=true;
}else{
this.fieldNode.checked=false;
}
break;
case "o":
case "m":
this.field.deselectAll();
var _c86=_c85.split(",");
for(i=0;i<_c86.length;i++){
this.field.select(dojo.string.trim(_c86[i]));
}
break;
case "h":
this.fieldNode.innerHTML=_c85;
break;
default:
return false;
}
},getFieldId:function(){
return this._fieldId;
}});
dojo.provide("app.widget.Upload");
dojo.require("app.widget.Widget");
dojo.require("dojo.io.IframeIO");
dojo.lang.declare("app.widget.Upload",app.widget.Widget,function(_c87){
this._parentNode=_c87;
this._url="../server/upload.php";
this._maxFileSize=quConfig.uploadMaxSize;
this._deleted=false;
this._inProgress=false;
this._uploaded=false;
this._result=null;
this._connectedEditor=null;
this._attachFileLabel=app.i18n.get("AttachFile");
this.fileType="";
this.create();
this.connect();
},{create:function(){
var _c88=document.createElement("div");
_c88.className="quAttachment";
this.setDomNode(_c88);
this.cmdAttachFile=document.createElement("span");
this.setAttachFileLabel(this._attachFileLabel);
this.cmdAttachFile.className="cmdAttachFile";
_c88.appendChild(this.cmdAttachFile);
var _c89=document.createElement("form");
_c89.style.display="none";
_c89.setAttribute("action",this.getUrl());
_c89.setAttribute("enctype","multipart/form-data");
_c89.setAttribute("encoding","multipart/form-data");
_c89.setAttribute("method","post");
this.setFormNode(_c89);
_c88.appendChild(_c89);
this.maxFileSizeNode=document.createElement("input");
this.maxFileSizeNode.setAttribute("type","hidden");
this.maxFileSizeNode.setAttribute("name","MAX_FILE_SIZE");
this.maxFileSizeNode.setAttribute("value",this.getMaxFileSize());
_c89.appendChild(this.maxFileSizeNode);
this.inputFileNode=document.createElement("input");
this.inputFileNode.setAttribute("type","file");
this.inputFileNode.setAttribute("name","file");
this.inputFileNode.setAttribute("size",60);
_c89.appendChild(this.inputFileNode);
this.hlpInput=document.createElement("input");
this.hlpInput.setAttribute("type","hidden");
this.hlpInput.setAttribute("name","hlp");
this.hlpInput.setAttribute("value","hlp");
_c89.appendChild(this.hlpInput);
this.cmdRemoveNode=document.createElement("span");
this.cmdRemoveNode.innerHTML=app.i18n.get("Remove");
this.cmdRemoveNode.className="cmdRemove";
_c89.appendChild(this.cmdRemoveNode);
this.getParentNode().appendChild(this.getDomNode());
this.uploadedNode=document.createElement("div");
this.uploadedNode.style.display="none";
this.checkboxNode=document.createElement("input");
this.checkboxNode.setAttribute("type","checkbox");
this.checkboxNode.style.verticalAlign="middle";
this.fileInfoNode=document.createElement("a");
this.fileInfoNode.setAttribute("title",app.i18n.get("clickToDownload"));
this.fileInfoNode.className="fileInfo";
this.imgUseAttachment=document.createElement("img");
this.imgUseAttachment.style.display="none";
this.imgUseAttachment.title=app.i18n.get("insertToText");
this.imgUseAttachment.src=qu.global.icon("insert-table-row.png",16);
spaceTag=document.createElement("span");
spaceTag.innerHTML="&nbsp;";
this.uploadedNode.appendChild(this.checkboxNode);
this.uploadedNode.appendChild(this.fileInfoNode);
this.uploadedNode.appendChild(spaceTag);
this.uploadedNode.appendChild(this.imgUseAttachment);
_c88.appendChild(this.uploadedNode);
},connect:function(){
dojo.event.connectOnce(this.cmdRemoveNode,"onclick",this,"onRemove");
dojo.event.connectOnce(this.cmdAttachFile,"onclick",this,"onAttach");
dojo.event.connectOnce(this.inputFileNode,"onchange",this,"onUpload");
dojo.event.connectOnce(this.imgUseAttachment,"onclick",this,"onAddToTextClick");
},onUpload:function(){
this.setInProgress(true);
this.setUploaded(false);
dojo.io.bind({url:this.getUrl()+"?"+new Date().valueOf().toString(),formNode:this.getFormNode(),mimetype:"text/json",load:dojo.lang.hitch(this,"onUploadSuccess"),error:dojo.lang.hitch(this,"onUploadFail")});
},onUploadSuccess:function(_c8a,_c8b,_c8c){
if(_c8b.result==null&&_c8b.error){
this.onUploadFail("error",_c8b.error);
return;
}
this.setInProgress(false);
this.setUploaded(true);
this.setResult(_c8b);
this.checkboxNode.checked=true;
this.fileInfoNode.innerHTML=_c8b.filename+" ("+_c8b.type+") ";
var _c8d=function(_c8e){
_c8e=parseInt(_c8e);
if(_c8e<1024){
return _c8e+"B";
}
if(_c8e>1024&&_c8e<1048576){
return (Math.round(_c8b.size/1024))+"K";
}
return (Math.round(_c8b.size/1048576*10)/10)+"M";
};
this.fileInfoNode.innerHTML+=_c8d(_c8b.size);
this.fileInfoNode.setAttribute("href","../server/download.php?attachment_id="+_c8b.hash);
this.getFormNode().style.display="none";
this.uploadedNode.style.display="block";
},onUploadFail:function(_c8f,_c90,_c91){
if(_c90=="1"){
alert(app.i18n.get("uploadedFileTooBig")+": "+this.formatSize(this.getMaxFileSize()));
}else{
alert(app.i18n.get("CouldNotUploadTheFile"));
}
this.setInProgress(false);
this.onRemove();
},onAttach:function(){
this.cmdAttachFile.style.display="none";
this.getFormNode().style.display="block";
},onRemove:function(){
this.getParentNode().removeChild(this.getDomNode());
this.setDeleted(true);
},getHash:function(){
return this.getResult().hash;
},getFormNode:function(){
return this._formNode;
},setFormNode:function(_c92){
this._formNode=_c92;
},getUrl:function(){
return this._url;
},setUrl:function(_c93){
this._url=_c93;
this.getFormNode().setAttribute("action",_c93);
},getMaxFileSize:function(){
return this._maxFileSize;
},setMaxFileSize:function(_c94){
this._maxFileSize=_c94;
this.maxFileSizeNode.setAttribute("value",_c94);
},setParentNode:function(_c95){
this._parentNode=_c95;
},getParentNode:function(){
return this._parentNode;
},isDeleted:function(){
return this._deleted;
},setDeleted:function(_c96){
this._deleted=_c96;
},setInProgress:function(_c97){
this._inProgress=_c97;
},isInProgress:function(){
return this._inProgress;
},isUploaded:function(){
return this._uploaded;
},setUploaded:function(_c98){
this._uploaded=_c98;
},setResult:function(_c99){
this._result=_c99;
},getResult:function(){
return this._result;
},setAttachFileLabel:function(_c9a){
this._attachFileLabel=_c9a;
this.cmdAttachFile.innerHTML=this._attachFileLabel+" ("+app.i18n.get("maxSize")+": "+this.formatSize(this.getMaxFileSize())+")";
},formatSize:function(_c9b){
_c9b=parseInt(_c9b);
if(_c9b<1024){
return _c9b+"B";
}
if(_c9b>1024&&_c9b<1048576){
return (Math.round(_c9b/1024))+"K";
}
return (Math.round(_c9b/1048576*10)/10)+"M";
},getAttachFileLabel:function(){
return this._attachFileLabel;
},isChecked:function(){
return this.checkboxNode.checked;
},setChecked:function(_c9c){
this.checkboxNode.checked=_c9c;
},setEditor:function(_c9d){
this._connectedEditor=_c9d;
if(this.getEditor()!=null){
this.imgUseAttachment.style.display="inline";
}
},getEditor:function(){
return this._connectedEditor;
},getHtmlRepresentation:function(){
if(this.getResult().type.substr(0,5)=="image"){
return "<img src='"+quConfig.applicationURL+"server/download.php?download_type=simple&attachment_id="+this.getResult().hash+"' border='0' />";
}else{
return "<a href='"+quConfig.applicationURL+"server/download.php?attachment_id="+this.getResult().hash+"'>"+this.getResult().filename+"</a>";
}
},onAddToTextClick:function(){
if(this.getEditor()!=null){
this.getEditor().replaceSelection(this.getHtmlRepresentation());
}
},setWidth:function(size){
this.inputFileNode.setAttribute("size",size);
}});
dojo.provide("app.view.NewTicket");
dojo.require("app.widget.CustomField");
dojo.require("app.widget.Upload");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.NewTicket",qu.gui.Frame,null,{onLoad:function(){
this.resetNewTicketForm();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.NewTicket"));
},initComponents:function(){
this.addAttachmentField();
this._lastSearchQuery="";
this.timeoutId=null;
if(quConfig.showPriorityInSubmitForm=="y"){
try{
this.el.priorityLine.style.display="table-row";
}
catch(e){
this.el.priorityLine.style.display="block";
}
}else{
this.el.priorityLine.style.display="none";
}
},initConnections:function(){
this._customFields=new Array();
dojo.event.connectOnce(this.el.cmdSubmitNewTicket,"onclick",this,"onSubmitNewTicket");
dojo.event.connectOnce(this.el.cmdReset,"onclick",this,"resetNewTicketForm");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadPriorities");
},addAttachmentField:function(){
this.el.attachmentContainer.innerHTML="";
this.attachment=new app.widget.Upload(this.el.attachmentContainer);
this.attachment.setWidth(20);
dojo.event.connectOnce(this.attachment,"onRemove",this,"addAttachmentField");
},onLoadPriorities:function(id,_ca0){
_ca0.beforeFirst();
if(id!="newTicketPriorities"){
return true;
}
this.el.priority.removeAll();
this.el.priority.add("","");
while(_ca0.next()){
this.el.priority.add(_ca0.get("priority"),_ca0.get("priority_name"));
}
},onLoadCustomFields:function(id,_ca2){
_ca2.beforeFirst();
if(id!="customFieldsSubmitTicketForm"){
return true;
}
this._customFields=new Array();
var _ca3={};
_ca2.beforeFirst();
while(_ca2.next()){
if(_ca2.getString("field_value").valueOf()=="null"){
_ca3["custom_"+_ca2.getString("field_id").valueOf()]="";
}else{
_ca3["custom_"+_ca2.getString("field_id").valueOf()]=_ca2.getString("field_value").valueOf();
}
}
_ca3["customer_email"]="";
_ca3["customer_name"]="";
_ca3["ticket_id"]="";
_ca3["ticket_subject"]="";
_ca3["ticket_owner"]="";
_ca3["queue_name"]="";
var _ca4=document.createElement("table");
_ca4.style.width="100%";
var _ca5=document.createElement("tbody");
_ca4.appendChild(_ca5);
_ca2.beforeFirst();
while(_ca2.next()){
var hTr=document.createElement("tr");
var _ca7=document.createElement("td");
_ca7.style.width="20%";
_ca7.innerHTML=_ca2.getString("field_title").valueOf();
hTr.appendChild(_ca7);
var _ca8=document.createElement("td");
hTr.appendChild(_ca8);
var _ca9=new app.widget.CustomField(_ca8,_ca2.getString("field_id").valueOf(),_ca2.getString("field_type").valueOf(),_ca2.getString("default_value").valueOf(),_ca2.getString("options").valueOf(),_ca3);
this._customFields.push(_ca9);
_ca5.appendChild(hTr);
}
this.el.customFieldsContent.innerHTML="";
this.el.customFieldsContent.appendChild(_ca4);
},onKeyPress:function(_caa){
if(quConfig.knowledgeBaseModule=="y"){
this.scheduleKBSearch();
}
},scheduleKBSearch:function(){
if(this.timeoutId!=null){
dojo.lang.clearTimeout(this.timeoutId);
}
this.timeoutId=dojo.lang.setTimeout(this,"querySuggestions",1000);
},getSearchQuery:function(){
return this.getTicketSubject()+" "+this.getTicketBody();
},querySuggestions:function(){
if(this.getSearchQuery().length>6&&this.getSearchQuery()!=this._lastSearchQuery){
this._lastSearchQuery=this.getSearchQuery();
var _cab={sid:qu.user.getSid(),query:this._lastSearchQuery,limit:10};
var _cac=new qu.rpc.Service("KBItems");
_cac.setThrobber(app.i18n.get("Searching")+"...");
var def=_cac.searchItems(_cab);
def.addCallback(this,"onSearchSuccess");
def.addErrback(this,"onSearchFail");
}
},onSearchSuccess:function(_cae){
if(_cae.getCount()>0){
this.showSuggestions();
_cae.beforeFirst();
var _caf="";
while(_cae.next()){
if(_caf.length>0){
_caf+="<br />";
}
var _cb0="<span class='suggestion_item_title'>"+_cae.get("subject")+"</span>";
if(_cae.get("full_parent_subject").length){
_cb0=_cae.get("full_parent_subject")+" / "+_cb0;
}
_caf+="<div class='suggestion_row'><a class='suggestion_url' href='"+quConfig.knowledgeBaseURL+_cae.get("full_path")+"' target='_blank'>"+_cb0+"</a></div>";
}
this.el.suggestionsContainer.innerHTML=_caf;
}else{
this.hideSuggestions();
}
},onSearchFail:function(_cb1){
this.hideSuggestions();
},hideSuggestions:function(){
this.el.suggestionsContainer.innerHTML="";
this.el.suggestionsBlock.style.display="none";
},showSuggestions:function(){
this.el.suggestionsContainer.innerHTML="";
this.el.suggestionsBlock.style.display="block";
},onLanguageChange:function(){
this.el.lblNewTicket.innerHTML=app.i18n.get("newTicket");
this.el.lblTicketName.innerHTML=app.i18n.get("name");
this.el.lblTicketEmail.innerHTML=app.i18n.get("email");
this.el.lblTicketSubject.innerHTML=app.i18n.get("subject");
this.el.lblTicketBody.innerHTML=app.i18n.get("body");
this.el.cmdSubmitNewTicket.innerHTML=app.i18n.get("send");
this.el.cmdReset.innerHTML=app.i18n.get("reset_");
this.el.lblQueue.innerHTML=app.i18n.get("queue");
this.el.lblPriority.innerHTML=app.i18n.get("priority");
this.el.lblTicketAttachment.innerHTML=app.i18n.get("attachment");
this.initQueues();
},initQueues:function(){
this.el.queue.removeAll();
this.el.queue.setWidth("220px");
var _cb2=new qu.rpc.Service("Queues");
_cb2.addPushRequest("customFieldsSubmitTicketForm","Fields","getTicketCustomFieldsList",{sid:qu.user.getSid(),order:"order_value, field_title"});
_cb2.addPushRequest("newTicketPriorities","Priorities","getPrioritiesList",{sid:qu.user.getSid()});
with(this.el.queue.getModel()){
setService(_cb2);
setMethod("getQueueList");
setValueColumn("queue_id");
setTextColumn("name");
setDefaultParams({sid:qu.user.getSid(),"order":"is_default DESC,name"});
}
this.el.queue.update(true);
},resetNewTicketForm:function(){
this.setTicketName(dojo.io.cookie.getCookie("submitFormName")!=null?dojo.io.cookie.getCookie("submitFormName"):"");
this.setTicketEmail(dojo.io.cookie.getCookie("submitFormEmail")!=null?dojo.io.cookie.getCookie("submitFormEmail"):"");
this.setTicketSubject("");
this.setTicketBody("");
this.attachment.onRemove();
this.initQueues();
},isAllUploaded:function(){
if(this.attachment.isInProgress()){
return false;
}
return true;
},onSubmitNewTicket:function(){
if(!this.isAllUploaded()){
var _cb3=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_cb3);
dojo.lang.setTimeout(this,"onSend",500);
return;
}
var _cb4=new Array();
if(this.attachment.isChecked()){
_cb4.push(this.attachment.getHash());
}
var _cb5={sid:qu.user.getSid(),subject:this.getTicketSubject(),body:this.getTicketBody(),name:this.getTicketName(),email:this.getTicketEmail(),queue_id:this.getTicketQueue(),isPlainText:"1",attach_ids:_cb4};
if(quConfig.showPriorityInSubmitForm=="y"){
_cb5["priority"]=this.getPriority();
}
var _cb6=new Object();
for(var i=0;i<this._customFields.length;i++){
_cb6[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
_cb5["custom"]=_cb6;
var _cb8=new qu.rpc.Service("Tickets");
_cb8.setThrobber(app.i18n.get("Sending")+"...");
var def=_cb8.newAnonymTicket(_cb5);
def.addCallback(this,"onSendSuccess");
def.addErrback(this,"onSendFail");
},onSendSuccess:function(_cba){
dojo.io.cookie.setCookie("submitFormEmail",this.getTicketEmail(),365);
dojo.io.cookie.setCookie("submitFormName",this.getTicketName(),365);
alert(app.i18n.get("ticketSuccessfullyCreated"));
this.resetNewTicketForm();
},onSendFail:function(_cbb){
this.msgBox.print(_cbb);
},setPriority:function(_cbc){
this.el.priority.selectByValue(_cbc);
},getPriority:function(){
return this.el.priority.getSelectedValue();
},setTicketName:function(_cbd){
this.el.name.value=_cbd;
},getTicketName:function(){
return this.el.name.value;
},setTicketEmail:function(_cbe){
this.el.email.value=_cbe;
},getTicketEmail:function(){
return this.el.email.value;
},setTicketSubject:function(_cbf){
this.el.subject.value=_cbf;
},getTicketSubject:function(){
return this.el.subject.value;
},setTicketBody:function(_cc0){
this.el.body.value=_cc0;
},getTicketBody:function(){
return this.el.body.value;
},getTicketQueue:function(){
return this.el.queue.getSelectedValue();
},setTicketQueue:function(_cc1){
this.el.queue.selectByValue(_cc1);
}});
dojo.provide("app.view.Welcome");
dojo.require("qu.gui.Frame");
dojo.require("app.view.Login");
dojo.require("app.view.NewTicket");
dojo.lang.declare("app.view.Welcome",qu.gui.Frame,null,{onCreate:function(){
var _cc2="../../custom/login.php";
this.setContent(new qu.gui.Template(dojo.uri.dojoUri(_cc2)));
},main:function(){
if(!dojo.io.cookie.isSupported()){
window.location="err_cookies.html";
}
this.show();
},onLoad:function(){
if(this.el.loginContainer){
this.login=new app.view.Login(this.el.loginContainer);
this.login.show();
dojo.event.connectOnce(this.login,"onLanguageChange",this,"onLanguageChange");
}
if(this.el.ticketContainer){
this.newTicket=new app.view.NewTicket(this.el.ticketContainer);
this.newTicket.show();
}
if(this.el.loginContainer&&this.el.ticketContainer){
dojo.event.connectOnce(this.login,"onLanguageChange",this.newTicket,"onLanguageChange");
}
},onShow:function(){
if(this.el.loginContainer){
dojo.event.connectOnce(this.login,"onShow",this.login,"setInitialFocus");
}
},onLanguageChange:function(){
if(dojo.byId("welcomeSubmitLabel")){
dojo.byId("welcomeSubmitLabel").innerHTML=app.i18n.get("submit_");
}
if(dojo.byId("welcomeOrLabel")){
dojo.byId("welcomeOrLabel").innerHTML=app.i18n.get("or");
}
}});
dojo.provide("qu.widget.Grid");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("qu.rpc.Model");
dojo.widget.defineWidget("qu.widget.Grid",dojo.widget.HtmlWidget,function(){
this.model=new qu.widget.grid.Model(this);
this.columns=new Array();
this.columnsCount=0;
this.sortColumn=null;
this.sortOrder=qu.widget.Grid.SORT_ASC;
this._height=10;
this.page=1;
this.dataCells={};
this.headCells={};
this.checkBoxes={};
this.multiselect=false;
this.selectedRows={};
this.onCellClickCallback=null;
this.onCheckboxClickCallback=null;
this.rowColorHandler=null;
this._showHeader=true;
this._showFooter=true;
this._updateInterval=0;
this.timeoutId=null;
this.isInitiated=false;
},{namespace:"qu",widgetType:"Grid",isContainer:true,templateString:"<div id=\"${this.widgetId}\" class=\"quGrid\">"+"\t<div dojoAttachPoint=\"containerNode\">"+"\t</div>"+"\t<div dojoAttachPoint=\"headerNavigationNode\" class=\"headerRow\" style=\"background-color:#EEEEEE;\">"+"\t\t<table border=\"0\" width=\"100%\">"+"\t\t\t<tr>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<span dojoAttachPoint=\"multiselectNode1\">"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdSelect1\">all</a>"+"\t\t\t\t\t\t<span>/</span>"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdDeselect1\">none</a>"+"\t\t\t\t\t</span>"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 20px;\">"+"\t\t\t\t\t<img src=\"lib/qu/widget/templates/images/loading_grid.gif\" style=\"display: none;\" dojoAttachPoint=\"gridLoadingIndicator1\">"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdRefresh1\">Refresh</a>"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdExportGridData1\">Export</a>"+"\t\t\t\t</td>"+"\t\t\t\t<!-- td>"+"\t\t\t\t\t<span style=\"margin-left:2em\" dojoAttachPoint=\"lblRows1\">Rows </span>"+"\t\t\t\t\t<select dojoAttachPoint=\"heightNode1\">"+"\t\t\t\t\t\t<option value=\"10\">10</option>"+"\t\t\t\t\t\t<option value=\"25\">25</option>"+"\t\t\t\t\t\t<option value=\"50\">50</option>"+"\t\t\t\t\t\t<option value=\"100\">100</option>"+"\t\t\t\t\t\t<option value=\"250\">250</option>"+"\t\t\t\t\t\t<option value=\"500\">500</option>"+"\t\t\t\t\t\t<option value=\"1000\">1000</option>"+"\t\t\t\t\t</select>"+"\t\t\t\t</td-->"+"\t\t\t\t<td style=\"text-align:right\">"+"\t\t\t\t\t<span dojoAttachPoint=\"pagerNode1\" style=\"margin-left:1em;\">"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"pagerPrevious1\">&lt;&lt;</a>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"fromToNode1\" style=\"font-weight:bold;\">0 - 0</span>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"ofNode1\"></span>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"countNode1\" style=\"font-weight:bold;\">0</span>"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"pagerNext1\">&gt;&gt;</a>"+"\t\t\t\t\t</span>"+"\t\t\t\t</td>"+"\t\t\t</tr>"+"\t\t</table>"+"\t</div>"+"\t<div dojoAttachPoint=\"gridNode\" class=\"grid\">"+"\t\t<table dojoAttachPoint=\"tableNode\" class=\"quTable\">"+"\t\t\t<thead dojoAttachPoint=\"theadNode\">"+"\t\t\t\t<tr dojoAttachPoint=\"theadTrNode\">"+"\t\t\t\t</tr>"+"\t\t\t</thead>"+"\t\t\t<tbody dojoAttachPoint=\"tbodyNode\" style=\"display:none;\">"+"\t\t\t</tbody>"+"\t\t</table>"+"\t</div>"+"\t<div dojoAttachPoint=\"footerNode\" class=\"footerRow\" style=\"background-color:#EEEEEE;\">"+"\t\t<table border=\"0\" width=\"100%\">"+"\t\t\t<tr>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<span dojoAttachPoint=\"multiselectNode\">"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdSelect\">all</a>"+"\t\t\t\t\t\t<span>/</span>"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdDeselect\">none</a>"+"\t\t\t\t\t</span>"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 20px;\">"+"\t\t\t\t\t<img src=\"lib/qu/widget/templates/images/loading_grid.gif\" style=\"display: none;\" dojoAttachPoint=\"gridLoadingIndicator\">"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdRefresh\">Refresh</a>"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"width: 100px;\">"+"\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"cmdExportGridData\">Export</a>"+"\t\t\t\t</td>"+"\t\t\t\t<td>"+"\t\t\t\t\t<span style=\"margin-left:2em\" dojoAttachPoint=\"lblRows\">Rows </span>"+"\t\t\t\t\t<select dojoAttachPoint=\"heightNode\">"+"\t\t\t\t\t\t<option value=\"10\">10</option>"+"\t\t\t\t\t\t<option value=\"25\">25</option>"+"\t\t\t\t\t\t<option value=\"50\">50</option>"+"\t\t\t\t\t\t<option value=\"100\">100</option>"+"\t\t\t\t\t\t<option value=\"250\">250</option>"+"\t\t\t\t\t\t<option value=\"500\">500</option>"+"\t\t\t\t\t\t<option value=\"1000\">1000</option>"+"\t\t\t\t\t</select>"+"\t\t\t\t</td>"+"\t\t\t\t<td style=\"text-align:right\">"+"\t\t\t\t\t<span dojoAttachPoint=\"pagerNode\" style=\"margin-left:1em;\">"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"pagerPrevious\">&lt;&lt;</a>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"fromToNode\" style=\"font-weight:bold;\">0 - 0</span>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"ofNode\"></span>"+"\t\t\t\t\t\t<span dojoAttachPoint=\"countNode\" style=\"font-weight:bold;\">0</span>"+"\t\t\t\t\t\t<a href=\"javascript://\" dojoAttachPoint=\"pagerNext\">&gt;&gt;</a>"+"\t\t\t\t\t</span>"+"\t\t\t\t</td>"+"\t\t\t</tr>"+"\t\t</table>"+"\t</div>"+"</div>",templateCssString:".quGrid {\ttext-align: left;\twidth: 100%;\tbackground-color: #DDDDDD;}"+".quTable {\ttable-layout: fixed;\tborder-collapse: collapse;\twidth: 100%;}"+".quTable .selectedRow {\tbackground-color: black !important;\tcolor: white !important;}"+".quTable th {\tcolor: black;\tbackground-color: #CCCCCC;\twhite-space: nowrap;\toverflow: hidden;\tpadding-right: 5px;\ttext-align: left;}"+".quTable td {\twhite-space: pre;\toverflow: hidden;\tpadding-right: 5px;\tvertical-align: top;\theight: 2.5em;\tborder-bottom: 1px solid #AAAAAA;}",css:{selectedRow:"selectedRow"},quId:"",setUpdateInterval:function(_cc3){
if(this.timeoutId!=null&&_cc3==0){
dojo.lang.clearTimeout(this.timeoutId);
}
this._updateInterval=_cc3*1000;
},getUpdateInterval:function(){
return this._updateInterval;
},fillInTemplate:function(){
this.cmdRefresh1.innerHTML=app.i18n.get("refresh");
this.cmdExportGridData1.innerHTML=app.i18n.get("exportGridData");
this.cmdSelect1.innerHTML=app.i18n.get("selectAll");
this.cmdDeselect1.innerHTML=app.i18n.get("selectNone");
this.ofNode1.innerHTML="&nbsp;"+app.i18n.get("of")+"&nbsp;";
this.cmdRefresh.innerHTML=app.i18n.get("refresh");
this.cmdExportGridData.innerHTML=app.i18n.get("exportGridData");
this.cmdSelect.innerHTML=app.i18n.get("selectAll");
this.cmdDeselect.innerHTML=app.i18n.get("selectNone");
this.lblRows.innerHTML=app.i18n.get("rows");
this.ofNode.innerHTML="&nbsp;"+app.i18n.get("of")+"&nbsp;";
},postCreate:function(){
},setRowColorHandler:function(_cc4){
this.rowColorHandler=_cc4;
},setSortColumn:function(_cc5){
if(this.isInitiated&&this.getSortColumn()!=_cc5){
this._unmarkSorting(this.getSortColumn());
this._markSorting(_cc5);
}
this.sortColumn=_cc5;
},getSortColumn:function(){
return this.sortColumn;
},setSortOrder:function(_cc6){
this.sortOrder=_cc6;
if(this.isInitiated){
this._markSorting(this.getSortColumn());
}
},getSortOrder:function(){
return this.sortOrder;
},setOnCellClickCallback:function(_cc7){
this.onCellClickCallback=_cc7;
},setOnCheckboxClickCallback:function(_cc8){
this.onCheckboxClickCallback=_cc8;
},isMultiselect:function(){
return this.multiselect;
},setMultiselect:function(_cc9){
this.multiselect=_cc9;
},setColumn:function(_cca,_ccb){
var col=this.columns[_cca]=new qu.widget.grid.Column(_cca);
if(typeof (_ccb)!="undefined"){
if(_ccb["caption"]){
col.setCaption(_ccb["caption"]);
}
if(_ccb["width"]){
col.setWidth(_ccb["width"]);
}
if(_ccb["sortable"]){
col.setSortable(_ccb["sortable"]);
}
if(_ccb["style"]){
col.setStyle(_ccb["style"]);
}
if(_ccb["bind"]){
col.setBind(_ccb["bind"]);
}
}
},getColumn:function(_ccd){
return this.columns[_ccd];
},getModel:function(){
return this.model;
},setHeight:function(_cce){
this._height=_cce;
this.setHeightIndicator(_cce);
if(this.isInitiated){
this.rebuild();
}
},setHeightIndicator:function(_ccf){
var o=this.heightNode.options;
for(var i=0;i<o.length;i++){
if(o[i].value==_ccf){
o[i].selected=true;
}
}
},setHeightIndicator1:function(_cd2){
var o=this.heightNode1.options;
for(var i=0;i<o.length;i++){
if(o[i].value==_cd2){
o[i].selected=true;
}
}
},getHeight:function(){
return this._height;
},setWidth:function(_cd5){
this.width=_cd5;
this.domNode.style.width=_cd5;
this.tableNode.style.width=_cd5;
},getWidth:function(){
if(this.width){
return this.width;
}
},initConnections:function(){
dojo.event.connectOnce(this.cmdRefresh1,"onclick",this,"getData");
dojo.event.connectOnce(this.cmdExportGridData1,"onclick",this,"exportData");
dojo.event.connectOnce(this.cmdSelect1,"onclick",this,"selectAll");
dojo.event.connectOnce(this.cmdDeselect1,"onclick",this,"selectNone");
dojo.event.connectOnce(this.pagerPrevious1,"onclick",this,"onPrevious");
dojo.event.connectOnce(this.pagerNext1,"onclick",this,"onNext");
dojo.event.connectOnce(this.cmdRefresh,"onclick",this,"getData");
dojo.event.connectOnce(this.cmdExportGridData,"onclick",this,"exportData");
dojo.event.connectOnce(this.cmdSelect,"onclick",this,"selectAll");
dojo.event.connectOnce(this.cmdDeselect,"onclick",this,"selectNone");
dojo.event.connectOnce(this.heightNode,"onchange",this,"onHeightChange");
dojo.event.connectOnce(this.pagerPrevious,"onclick",this,"onPrevious");
dojo.event.connectOnce(this.pagerNext,"onclick",this,"onNext");
},exportData:function(){
this.showLoadingIndicator();
dojo.event.connectOnce(this.getModel(),"onExportDataSuccess",this,"hideLoadingIndicator");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",this,"hideLoadingIndicator");
dojo.event.connectOnce(this.getModel(),"onExportDataSuccess",this,"exportReadyData");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",function(_cd6){
dojo.debug(_cd6);
});
this.getModel().exportData();
},exportReadyData:function(_cd7){
var w=window.open();
w.document.open("text/plain");
w.document.write(_cd7);
w.document.close();
},onHeightChange1:function(_cd9){
var _cda=this.heightNode1.selectedIndex;
if(_cda>=0){
var _cdb=this.heightNode1.options[_cda].value;
this.setHeightIndicator(_cdb);
this._height=_cdb;
this.setPage(1);
this.rebuild();
this.getData();
}
},onHeightChange:function(_cdc){
var _cdd=this.heightNode.selectedIndex;
if(_cdd>=0){
var _cde=this.heightNode.options[_cdd].value;
this._height=_cde;
this.setPage(1);
this.rebuild();
this.getData();
}
},buildHead:function(){
if(this.isShowHeader()){
this.showHeader();
}else{
this.hideHeader();
}
if(this.isShowFooter()){
this.showFooter();
}else{
this.hideFooter();
}
var cell,_ce0;
var _ce1=this.theadTrNode;
var _ce2=1;
if(this.isMultiselect()){
_ce0=document.createElement("th");
_ce0.style.width="20px";
cellObject=new qu.widget.grid.Cell(_ce0,this);
this.headCells["multiselect"]=cellObject;
_ce1.appendChild(cellObject.getDomNode());
this.multiselectNode.style.display="inline";
this.multiselectNode1.style.display="inline";
}else{
this.multiselectNode.style.display="none";
this.multiselectNode1.style.display="none";
}
for(var each in this.columns){
_ce0=document.createElement("th");
_ce0.setAttribute("col",_ce2);
cellObject=new qu.widget.grid.Cell(_ce0,this);
cellObject.setColumn(this.columns[each]);
this.headCells[each]=this.headCells[_ce2]=cellObject;
if(this.columns[each].getName()==this.getSortColumn()){
cellObject.value=this.columns[each].getCaption();
this._markSorting(this.columns[each].getName());
}else{
cellObject.setValue(this.columns[each].getCaption());
}
_ce1.appendChild(cellObject.getDomNode());
_ce2++;
if(cellObject.getColumn().isSortable()){
this._connectOrdering(cellObject);
}
}
},_connectOrdering:function(_ce4){
_ce4.getDomNode().style.cursor="pointer";
dojo.event.connect(_ce4.getDomNode(),"onclick",this,"onOrder");
},onOrder:function(_ce5){
var _ce6=_ce5.target;
if(_ce6.nodeName.toLowerCase()!="th"){
_ce6=dojo.html.getParentByType(_ce6,"th");
}
var col=_ce6.getAttribute("col");
var _ce8=this.getHeadCell(col);
if(_ce8!==false){
if(this.getSortColumn()==_ce8.getColumn().getName()){
if(this.getSortOrder()==qu.widget.Grid.SORT_ASC){
this.setSortOrder(qu.widget.Grid.SORT_DESC);
}else{
if(this.getSortOrder()==qu.widget.Grid.SORT_DESC){
this.setSortOrder(qu.widget.Grid.SORT_ASC);
}
}
}else{
this._unmarkSorting(this.getSortColumn());
this.setSortColumn(_ce8.getColumn().getName());
this.setSortOrder(qu.widget.Grid.SORT_ASC);
}
}
this._markSorting(this.getSortColumn());
this.getData();
},_markSorting:function(_ce9){
var cell=this.getHeadCell(_ce9);
if(cell!==false){
var _ceb=this.getSortOrder();
if(_ceb==qu.widget.Grid.SORT_ASC){
cell.setValue(cell.getValue(),qu.widget.Grid.FORMATTER_HEADER_SORT_ASC);
}else{
if(_ceb==qu.widget.Grid.SORT_DESC){
cell.setValue(cell.getValue(),qu.widget.Grid.FORMATTER_HEADER_SORT_DESC);
}
}
}
},_unmarkSorting:function(_cec){
var cell=this.getHeadCell(_cec);
if(cell!==false){
cell.setValue(cell.getValue(),qu.widget.Grid.FORMATTER_HEADER_SORT_NO);
}
},buildData:function(){
this.setTBodyVisible(false);
var cell,_cef,_cf0,_cf1;
var _cf2=this.getHeight();
var _cf3=this.tbodyNode;
for(var row=1;row<=_cf2;row++){
var _cef=document.createElement("tr");
var _cf5=new qu.widget.grid.Row(_cef);
this.dataCells[row]={};
this.dataCells[row]["row"]=_cf5;
var _cf6=1;
if(this.isMultiselect()){
_cf0=document.createElement("td");
_cf0.setAttribute("row",row);
_cf1=new qu.widget.grid.Cell(_cf0,this);
var _cf7=document.createElement("input");
this.checkBoxes[row]=_cf7;
_cf7.setAttribute("type","checkbox");
_cf7.setAttribute("row",row);
_cf0.appendChild(_cf7);
_cf5.getDomNode().appendChild(_cf1.getDomNode());
dojo.event.connect(_cf7,"onclick",this,"onCheckboxClick");
}
for(var each in this.columns){
_cf0=document.createElement("td");
_cf0.setAttribute("row",row);
_cf0.setAttribute("col",_cf6);
dojo.event.connect(_cf0,"onclick",this,"onCellClick");
_cf1=new qu.widget.grid.Cell(_cf0,this);
_cf1.setColumn(this.columns[each]);
_cf5.getDomNode().appendChild(_cf1.getDomNode());
this.dataCells[row][each]=this.dataCells[row][_cf6]=_cf1;
_cf6++;
}
_cf3.appendChild(_cef);
}
},setTBodyVisible:function(_cf9){
if(_cf9===true){
try{
this.tbodyNode.style.display="table-row-group";
}
catch(inError){
this.tbodyNode.style.display="block";
}
}else{
if(_cf9===false){
this.tbodyNode.style.display="none";
}
}
},refreshData:function(){
this.selectNone();
var rs=this.getModel().getResultSet();
rs.beforeFirst();
for(var row=1;row<=this.getHeight();row++){
if(rs.next()){
if(this.getRow(row)!==false){
this.getRow(row).setHidden(false);
}
if(typeof (this.rowColorHandler)=="function"){
try{
this.getRow(row).setColor(this.rowColorHandler(rs));
}
catch(inError){
dojo.debug(inError);
}
}
for(var col in this.columns){
var cell=this.getCell(row,col);
var _cfe="";
if(cell!==false){
if(cell.getColumn().getBind()&&typeof (cell.getColumn().getBind())=="function"){
_cfe=cell.getColumn().getBind()(col,rs);
}else{
_cfe=rs.get(col);
}
cell.setValue(_cfe);
}
}
}else{
if(this.getRow(row)!==false){
this.getRow(row).setHidden(true);
}
}
}
this.setTBodyVisible(true);
this.refreshPager(rs.md.getCount());
},refreshPager:function(_cff){
var page=this.getPage();
var _d01=parseInt(this.getHeight());
var _d02=_cff;
if(page>1){
this.pagerPrevious.style.display="inline";
this.pagerPrevious1.style.display="inline";
}else{
this.pagerPrevious.style.display="none";
this.pagerPrevious1.style.display="none";
}
this.countNode.innerHTML=_d02;
this.countNode1.innerHTML=_d02;
var from=(page-1)*_d01+1;
var to=from+_d01-1;
if(page==(parseInt(_d02/_d01)+1)||_d02==_d01){
var _d05=_d02-((page-1)*_d01);
to=from+_d05-1;
this.pagerNext.style.display="none";
this.pagerNext1.style.display="none";
}else{
this.pagerNext.style.display="inline";
this.pagerNext1.style.display="inline";
}
if(_d02==0){
from=0;
}
this.fromToNode.innerHTML=from+" - "+to;
this.fromToNode1.innerHTML=from+" - "+to;
},onNext:function(){
this.selectNone();
var _d06=this.getPage();
var _d07=_d06+1;
this.setPage(_d07);
this.getData();
},onPrevious:function(){
this.selectNone();
var _d08=this.getPage();
var _d09=_d08-1;
this.setPage(_d09);
this.getData();
},getPage:function(){
return this.page;
},setPage:function(_d0a){
this.page=_d0a;
},getData:function(){
this.showLoadingIndicator();
dojo.event.connectOnce(this.getModel(),"onGetDataSuccess",this,"hideLoadingIndicator");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",this,"hideLoadingIndicator");
dojo.event.connectOnce(this.getModel(),"onGetDataSuccess",this,"refreshData");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",function(_d0b){
dojo.debug(_d0b);
});
this.selectNone();
this.getModel().getData();
},hideLoadingIndicator:function(){
this.gridLoadingIndicator.style.display="none";
this.gridLoadingIndicator1.style.display="none";
},showLoadingIndicator:function(){
this.gridLoadingIndicator.style.display="block";
this.gridLoadingIndicator1.style.display="block";
},update:function(){
if(this.timeoutId!=null){
dojo.lang.clearTimeout(this.timeoutId);
}
if(qu.user.isLoggedIn()){
this.getData();
this.scheduleNextRefresh();
}
},scheduleNextRefresh:function(){
if(this.getUpdateInterval()>0){
this.timeoutId=dojo.lang.setTimeout(this,"autoRefresh",this.getUpdateInterval());
}
},autoRefresh:function(){
if(this.getSelectedRows()==null){
this.update();
}else{
this.scheduleNextRefresh();
}
},build:function(){
this.buildHead();
this.buildData();
this.initConnections();
},init:function(){
this.build();
this.isInitiated=true;
},rebuild:function(){
var rows=this.tbodyNode.childNodes;
var len=rows.length-1;
for(i=len;i>=0;i--){
if(rows[i]&&rows[i].tagName&&rows[i].tagName.toLowerCase()=="tr"){
this.tbodyNode.removeChild(rows[i]);
}
}
this.buildData();
},onCellClick:function(_d0e){
var _d0f=_d0e.target;
if(_d0f.tagName.toLowerCase()!="td"){
_d0f=dojo.html.getParentByType(_d0f,"td");
}
var row=_d0f.getAttribute("row");
var col=_d0f.getAttribute("col");
if(typeof (this.onCellClickCallback)=="function"){
try{
this.onCellClickCallback(row,col,this);
}
catch(inError){
dojo.debug(inError.message);
}
}
},onCheckboxClick:function(_d12){
var _d13=_d12.target;
var row=_d13.getAttribute("row");
var _d15=_d13.checked;
if(_d15===true){
this.selectRow(row);
}else{
this.deselectRow(row);
}
if(typeof (this.onCheckboxClickCallback)=="function"){
try{
this.onCheckboxClickCallback(row,_d15,this);
}
catch(inError){
dojo.debug(inError.message);
}
}
},selectRow:function(_d16){
if(this.getRow(_d16)!==false){
if(typeof (this.selectedRows[_d16])=="undefined"){
this.getRow(_d16).addCssClass(this.css.selectedRow);
}
this.checkBoxes[_d16].checked=true;
this.selectedRows[_d16]=this.getRow(_d16);
}
},deselectRow:function(_d17){
if(this.getRow(_d17)!==false){
this.getRow(_d17).removeCssClass(this.css.selectedRow);
if(typeof (this.selectedRows[_d17])!="undefined"){
delete this.selectedRows[_d17];
}
this.checkBoxes[_d17].checked=false;
}
},selectAll:function(){
var rows=parseInt(this.getHeight());
var _d19=parseInt(this.getModel().getResultSet().getMetaData().getCount());
if(rows>_d19){
rows=_d19;
}
for(i=1;i<=rows;i++){
this.selectRow(i);
}
},selectNone:function(){
if(this.isMultiselect()){
var rows=parseInt(this.getHeight());
if(this.getModel().getResultSet()==null){
return;
}
var _d1b=parseInt(this.getModel().getResultSet().getMetaData().getCount());
if(rows>_d1b){
rows=_d1b;
}
for(i=1;i<=rows;i++){
this.deselectRow(i);
}
}
},getCell:function(row,col){
var _d1e;
try{
_d1e=this.dataCells[row][col];
}
catch(e){
_d1e=false;
}
return _d1e;
},getHeadCell:function(col){
if(typeof (this.headCells[col])=="undefined"){
return false;
}
return this.headCells[col];
},getRow:function(row){
try{
var _d21=this.dataCells[row]["row"];
return _d21;
}
catch(e){
return false;
}
},setBackgroundColor:function(_d22){
this.gridNode.style.backgroundColor=_d22;
},setColor:function(_d23){
this.domNode.style.color=_d23;
},getSelectedRows:function(){
var _d24=0;
for(var each in this.selectedRows){
_d24++;
}
if(_d24>0){
return this.selectedRows;
}else{
return null;
}
},getSelectionByColumn:function(_d26){
var _d27=new Array();
var rs=this.getModel().getResultSet();
var _d29=this.getSelectedRows();
for(var each in _d29){
rs.absolute(each);
_d27.push(rs.getString(_d26).valueOf());
}
return _d27;
},setShowHeader:function(_d2b){
this._showHeader=_d2b;
},setShowFooter:function(_d2c){
this._showFooter=_d2c;
},isShowHeader:function(){
return this._showHeader;
},isShowFooter:function(){
return this._showFooter;
},showHeader:function(){
this.setShowHeader(true);
try{
this.theadTrNode.style.display="table-row";
}
catch(e){
this.theadTrNode.style.display="block";
}
},hideHeader:function(){
this.setShowHeader(false);
this.theadTrNode.style.display="none";
},showFooter:function(){
this.setShowFooter(true);
this.footerNode.style.display="block";
this.headerNavigationNode.style.display="block";
},hideFooter:function(){
this.setShowFooter(false);
this.footerNode.style.display="none";
this.headerNavigationNode.style.display="none";
}});
qu.widget.Grid.SORT_ASC="asc";
qu.widget.Grid.SORT_DESC="desc";
qu.widget.Grid.FORMATTER_STRING=function(_d2d){
};
qu.widget.Grid.FORMATTER_INTEGER=function(_d2e){
};
qu.widget.Grid.FORMATTER_DECIMAL=function(_d2f){
};
qu.widget.Grid.FORMATTER_BOOLEAN=function(_d30){
};
qu.widget.Grid.FORMATTER_HEADER_SORT_NO=function(_d31){
return _d31;
};
qu.widget.Grid.FORMATTER_HEADER_SORT_ASC=function(_d32){
return ("<span>"+_d32+"</span><img src=\"lib/qu/widget/templates/images/arrow_up.gif\" style=\"margin-left:1em\" />");
};
qu.widget.Grid.FORMATTER_HEADER_SORT_DESC=function(_d33){
return ("<span>"+_d33+"</span><img src=\"lib/qu/widget/templates/images/arrow_down.gif\" style=\"margin-left:1em\" />");
};
dojo.lang.declare("qu.widget.grid.Column",null,function(_d34){
this.name=_d34;
this.caption=_d34;
this.width=60;
this.sortable=false;
this.formatter=null;
this.style=null;
this.bind=null;
},{setBind:function(_d35){
this.bind=_d35;
},getBind:function(){
return this.bind;
},setWidth:function(_d36){
this.width=_d36;
},getWidth:function(){
return this.width;
},setCaption:function(_d37){
this.caption=_d37;
},getCaption:function(){
return this.caption;
},setName:function(_d38){
this.name=_d38;
},getName:function(){
return this.name;
},setSortable:function(_d39){
this.sortable=_d39;
},isSortable:function(){
return this.sortable;
},setStyle:function(_d3a){
this.style=_d3a;
},getStyle:function(){
return this.style;
}});
dojo.lang.declare("qu.widget.grid.Model",qu.rpc.Model,function(_d3b){
this.grid=_d3b;
this.service=null;
this.methodName="";
this.defaultParams=null;
this.params=null;
this.resultSet=null;
},{getData:function(){
var _d3c=this.getService();
var _d3d=this.getDefaultParams();
var _d3e=this.getParams();
for(var each in _d3e){
_d3d[each]=_d3e[each];
}
if(this.getGrid().getSortColumn()){
_d3d[this.ORDER]=this.getGrid().getSortColumn();
_d3d[this.ORDER_DIRECTION]=this.getGrid().getSortOrder();
}
_d3d[this.LIMIT]=this.getGrid().getHeight();
_d3d[this.OFFSET]=this.getGrid().getHeight()*(this.getGrid().getPage()-1);
_d3d["service_is_export"]=null;
var def=_d3c[this.getMethod()](_d3d);
def.addCallback(dojo.lang.hitch(this,"onGetDataSuccess"));
def.addErrback(dojo.lang.hitch(this,"onGetDataFail"));
return def;
},exportData:function(){
var _d41=this.getService();
var _d42=this.getDefaultParams();
var _d43=this.getParams();
for(var each in _d43){
_d42[each]=_d43[each];
}
if(this.getGrid().getSortColumn()){
_d42[this.ORDER]=this.getGrid().getSortColumn();
_d42[this.ORDER_DIRECTION]=this.getGrid().getSortOrder();
}
_d42[this.LIMIT]=1000000;
_d42[this.OFFSET]=0;
_d42["service_is_export"]="y";
var def=_d41[this.getMethod()](_d42);
def.addCallback(dojo.lang.hitch(this,"onExportDataSuccess"));
def.addErrback(dojo.lang.hitch(this,"onGetDataFail"));
return def;
},getGrid:function(){
return this.grid;
},setGrid:function(_d46){
this.grid=_d46;
}});
dojo.lang.declare("qu.widget.grid.Cell",null,function(_d47,_d48){
this.domNode=_d47;
this.value=null;
this.column=null;
},{getDomNode:function(){
return this.domNode;
},setDomNode:function(_d49){
this.domNode=_d49;
},setValue:function(_d4a,_d4b){
this.value=_d4a;
if(dojo.dom.isNode(_d4a)){
try{
this.getDomNode().innerHTML="";
this.getDomNode().appendChild(_d4a);
}
catch(inError){
dojo.debug(inError);
}
}else{
if(typeof (_d4b)=="function"){
this.getDomNode().innerHTML=_d4b(_d4a);
}else{
this.getDomNode().innerHTML=_d4a;
}
}
},getValue:function(){
return this.value;
},setColumn:function(_d4c){
this.column=_d4c;
if(this.column.getWidth()){
this.getDomNode().style.width=this.column.getWidth();
}
if(this.column.getStyle()){
var _d4d=this.column.getStyle();
for(var each in _d4d){
try{
this.getDomNode().style[each]=_d4d[each];
}
catch(inError){
dojo.debug("Wrong style definition: "+each);
}
}
}
},getColumn:function(){
return this.column;
}});
dojo.lang.declare("qu.widget.grid.Row",null,function(_d4f){
this.domNode=_d4f;
this.backgroundColor="#DDDDDD";
},{setDomNode:function(_d50){
this.domNode=_d50;
},getDomNode:function(){
return this.domNode;
},setHidden:function(_d51){
if(_d51===true){
this.getDomNode().style.display="none";
}else{
try{
this.getDomNode().style.display="table-row";
}
catch(inError){
this.getDomNode().style.display="block";
}
}
},setColor:function(_d52){
if(_d52){
this.getDomNode().style.backgroundColor=_d52;
}else{
this.getDomNode().style.backgroundColor=this.backgroundColor;
}
},addCssClass:function(_d53){
this.getDomNode().className+=" "+_d53;
},removeCssClass:function(_d54){
var _d55=this.getDomNode().className;
var _d56=_d55.replace(_d54,"");
this.setCssClass(_d56);
},setCssClass:function(_d57){
this.getDomNode().className=_d57;
}});
dojo.lang.declare("qu.widget.grid.Filter",null,function(_d58,_d59){
this.name=_d58;
this.domNode=_d59;
this.setter=null;
this.getter=null;
},{});
dojo.provide("qu.widget.TabFolder");
dojo.require("dojo.widget.*");
dojo.widget.defineWidget("qu.widget.TabFolder",dojo.widget.HtmlWidget,function(){
this._currentTab=false;
this.tabs=[];
},{namespace:"qu",widgetType:"TabFolder",isContainer:false,quId:"",templateString:"<div class=\"quTabFolder\">"+"<div dojoAttachPoint=\"tabButtons\" class=\"buttons\"></div>"+"<div dojoAttachPoint=\"tabContainer\">"+"<div dojoAttachPoint=\"container\" class=\"container\" style=\"_height:1%;\">"+"</div>"+"</div>",templateCssString:".quTabFolder {}"+".quTabFolder .buttons {height: 26px;_height: 20px;}"+".quTabFolder .container {background: #feeaa3 url('app/web/images/backgrounds/ffffcc-feeaa3.gif') repeat-x; overflow: auto; padding: 8px;}"+".quTabFolder .button {\tfloat: left;\tpadding-top: 6px;\t_padding-top: 3px;\tpadding-left: 12px;\tpadding-right: 12px;\tpadding-bottom: 0px;\tmargin-right: 8px;\tcursor: pointer;\theight: 20px;\t_height: 22px;\tfont-weight: bold;}"+".quTabFolder .title {\ttext-decoration: underline;}"+".quTabFolder .icon {vertical-align: middle;\tmargin-right: 4px;\tborder: none;}"+".quTabFolder .active {background-color: #ffffcc;}"+".quTabFolder .inactive {\tbackground-color: #fee292;\ttext-decoration: underline;}",setStyle:function(_d5a){
this._style=_d5a;
this.domNode.className=_d5a;
},getStyle:function(){
return this._style;
},addFrame:function(_d5b,_d5c){
var tab=new qu.widget.tabFolder.Tab(_d5b);
tab.setFrame(_d5b);
tab.setTabIndex(this.tabs.length);
tab.setTitle(_d5c?_d5c:"");
this.tabButtons.appendChild(tab.getButtonNode());
this.tabs.push(tab);
dojo.event.connectOnce(tab.getButtonNode(),"onclick",this,"onButtonClick");
},addTab:function(_d5e){
_d5e.setTabIndex(this.tabs.length);
this.tabButtons.appendChild(_d5e.getButtonNode());
this.tabs.push(_d5e);
dojo.event.connectOnce(_d5e.getButtonNode(),"onclick",this,"onButtonClick");
},showTab:function(_d5f){
if(this._currentTab!==_d5f){
if(this._currentTab!==false){
this.getTab(this._currentTab).getFrame().hide();
this.getTab(this._currentTab).setActive(false);
}
this._currentTab=_d5f;
this.getTab(_d5f).getFrame().setOwner(this.container);
this.getTab(_d5f).getFrame().show();
this.getTab(_d5f).setActive(true);
try{
if(this.getTab(_d5f).getFrame().isTemplateLoaded()===true&&!this.getTab(_d5f).getFrame().isLoading()){
this.getTab(_d5f).getFrame().update();
}
}
catch(e){
dojo.debug(e.message);
}
}
},removeAllTabs:function(){
this._currentTab=false;
this.tabs=[];
this.tabButtons.innerHTML="";
this.container.innerHTML="";
},reload:function(_d60){
if(typeof (_d60)=="undefined"||_d60==this._currentTab){
this.getTab().getFrame().show();
}else{
this.showTab(_d60);
}
},getTab:function(_d61){
if(typeof (_d61)=="undefined"&&this._currentTab!==false){
return this.tabs[this._currentTab];
}
return this.tabs[_d61];
},onButtonClick:function(_d62){
var _d63=_d62.target;
if(_d63.tagName.toLowerCase()!="div"){
_d63=dojo.html.getParentByType(_d63,"div");
}
var _d64=_d63.getAttribute("tIndex");
this.showTab(_d64);
},setHeight:function(_d65){
this.tabContainer.style.height=_d65;
},setWidth:function(_d66){
this.tabContainer.style.width=_d66;
},setSize:function(_d67,_d68){
this.setWidth(_d67);
this.setHeight(_d68);
}});
qu.widget.TabFolder.STYLE_ACTIVE="active";
qu.widget.TabFolder.STYLE_INACTIVE="inactive";
dojo.lang.declare("qu.widget.tabFolder.Tab",null,function(_d69){
this.setFrame(_d69);
this._buttonNode=null;
this._tabIndex=null;
this._icon=null;
this._iconNode=null;
this.build();
},{build:function(){
var _d6a=document.createElement("div");
_d6a.className="button inactive";
var _d6b=document.createElement("span");
_d6a.appendChild(_d6b);
this.setButtonNode(_d6a);
this.setTitleNode(_d6b);
},setFrame:function(_d6c){
this._frame=_d6c;
},getFrame:function(){
return this._frame;
},setTitle:function(_d6d){
this._title=_d6d;
this.getTitleNode().innerHTML=_d6d;
},getTitle:function(){
return this._title;
},setButtonNode:function(_d6e){
this._buttonNode=_d6e;
},getButtonNode:function(){
return this._buttonNode;
},setTitleNode:function(_d6f){
this._titleNode=_d6f;
},getTitleNode:function(){
return this._titleNode;
},setActive:function(_d70){
if(_d70===false){
dojo.html.removeClass(this.getButtonNode(),qu.widget.TabFolder.STYLE_ACTIVE);
dojo.html.addClass(this.getButtonNode(),qu.widget.TabFolder.STYLE_INACTIVE);
}else{
if(_d70===true){
dojo.html.removeClass(this.getButtonNode(),qu.widget.TabFolder.STYLE_INACTIVE);
dojo.html.addClass(this.getButtonNode(),qu.widget.TabFolder.STYLE_ACTIVE);
}
}
},setTabIndex:function(_d71){
this._tabIndex=_d71;
this.getButtonNode().setAttribute("tIndex",_d71);
},getTabIndex:function(){
return this._tabIndex;
},setIcon:function(_d72){
_d72.getDomNode().className+=" icon";
if(this.getIcon()===null){
dojo.dom.prependChild(_d72.getDomNode(),this.getButtonNode());
}else{
dojo.dom.replaceNode(this.getIcon().getDomNode(),_d72.getDomNode());
}
},getIcon:function(){
return this._icon;
}});
dojo.provide("qu.lang.array");
if(false&&!Array.prototype.forEach){
Array.prototype.forEach=function(fun){
var len=this.length;
if(typeof fun!="function"){
return false;
}
var _d75=arguments[1];
for(var i=0;i<len;i++){
if(i in this){
fun.call(_d75,this[i],i,this);
}
}
};
}
dojo.provide("dojo.collections.Collections");
dojo.collections.DictionaryEntry=function(k,v){
this.key=k;
this.value=v;
this.valueOf=function(){
return this.value;
};
this.toString=function(){
return String(this.value);
};
};
dojo.collections.Iterator=function(arr){
var a=arr;
var _d7b=0;
this.element=a[_d7b]||null;
this.atEnd=function(){
return (_d7b>=a.length);
};
this.get=function(){
if(this.atEnd()){
return null;
}
this.element=a[_d7b++];
return this.element;
};
this.map=function(fn,_d7d){
var s=_d7d||dj_global;
if(Array.map){
return Array.map(a,fn,s);
}else{
var arr=[];
for(var i=0;i<a.length;i++){
arr.push(fn.call(s,a[i]));
}
return arr;
}
};
this.reset=function(){
_d7b=0;
this.element=a[_d7b];
};
};
dojo.collections.DictionaryIterator=function(obj){
var a=[];
var _d83={};
for(var p in obj){
if(!_d83[p]){
a.push(obj[p]);
}
}
var _d85=0;
this.element=a[_d85]||null;
this.atEnd=function(){
return (_d85>=a.length);
};
this.get=function(){
if(this.atEnd()){
return null;
}
this.element=a[_d85++];
return this.element;
};
this.map=function(fn,_d87){
var s=_d87||dj_global;
if(Array.map){
return Array.map(a,fn,s);
}else{
var arr=[];
for(var i=0;i<a.length;i++){
arr.push(fn.call(s,a[i]));
}
return arr;
}
};
this.reset=function(){
_d85=0;
this.element=a[_d85];
};
};
dojo.provide("dojo.collections.Dictionary");
dojo.require("dojo.collections.Collections");
dojo.collections.Dictionary=function(_d8b){
var _d8c={};
this.count=0;
var _d8d={};
this.add=function(k,v){
var b=(k in _d8c);
_d8c[k]=new dojo.collections.DictionaryEntry(k,v);
if(!b){
this.count++;
}
};
this.clear=function(){
_d8c={};
this.count=0;
};
this.clone=function(){
return new dojo.collections.Dictionary(this);
};
this.contains=this.containsKey=function(k){
if(_d8d[k]){
return false;
}
return (_d8c[k]!=null);
};
this.containsValue=function(v){
var e=this.getIterator();
while(e.get()){
if(e.element.value==v){
return true;
}
}
return false;
};
this.entry=function(k){
return _d8c[k];
};
this.forEach=function(fn,_d96){
var a=[];
for(var p in _d8c){
if(!_d8d[p]){
a.push(_d8c[p]);
}
}
var s=_d96||dj_global;
if(Array.forEach){
Array.forEach(a,fn,s);
}else{
for(var i=0;i<a.length;i++){
fn.call(s,a[i],i,a);
}
}
};
this.getKeyList=function(){
return (this.getIterator()).map(function(_d9b){
return _d9b.key;
});
};
this.getValueList=function(){
return (this.getIterator()).map(function(_d9c){
return _d9c.value;
});
};
this.item=function(k){
if(k in _d8c){
return _d8c[k].valueOf();
}
return undefined;
};
this.getIterator=function(){
return new dojo.collections.DictionaryIterator(_d8c);
};
this.remove=function(k){
if(k in _d8c&&!_d8d[k]){
delete _d8c[k];
this.count--;
return true;
}
return false;
};
if(_d8b){
var e=_d8b.getIterator();
while(e.get()){
this.add(e.element.key,e.element.value);
}
}
};
dojo.provide("app.data.CustomField");
dojo.lang.declare("app.data.CustomField",null,function(){
this._fieldId="";
this._title="";
this._type="";
this._defaultValue="";
this._options="";
this._relatedTo="";
this._orderValue="";
this._userAccess="";
},{setUserAccess:function(_da0){
this._userAccess=_da0;
},getUserAccess:function(){
return this._userAccess;
},setOrderValue:function(_da1){
this._orderValue=_da1;
},getOrderValue:function(){
return this._OrderValue;
},setRelatedTo:function(_da2){
this._relatedTo=_da2;
},getRelatedTo:function(){
return this._relatedTo;
},setOptions:function(_da3){
this._options=_da3;
},getOptions:function(){
return this._options;
},setDefaultValue:function(_da4){
this._defaultValue=_da4;
},getDefaultValue:function(){
return this._defaultValue;
},setType:function(_da5){
this._type=_da5;
},getType:function(){
return this._type;
},setTitle:function(_da6){
this._title=_da6;
},getTitle:function(){
return this._title;
},setId:function(_da7){
this._fieldId=_da7;
},getId:function(){
return this._fieldId;
}});
dojo.provide("app.data.HashMaps");
dojo.require("dojo.collections.Dictionary");
dojo.require("qu.rpc.Service");
dojo.require("dojo.Deferred");
dojo.require("app.data.CustomField");
dojo.lang.declare("app.data.HashMaps",null,function(){
this._updateInterval=0;
this.dataLoaded=false;
this.initUserRoles();
this.initLogLevels();
this.initLastUpdates();
this.initKnowledgeBaseAccessModes();
this._firstDate=null;
this._defaultMailAccount=null;
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadData");
},{requestHashData:function(){
var cL;
var nop=new qu.rpc.Service("Nop");
nop.addPushRequest("queues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name"});
nop.addPushRequest("grantedQueues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name",granted_righs:"y"});
var _daa={sid:qu.user.getSid()};
if(qu.user.isAgent()){
_daa.user_id=qu.user.getId();
}
cL=0;
if(cL==1){
nop.addPushRequest("first_user","Users","getFirstAgent",{sid:qu.user.getSid()});
}
nop.addPushRequest("languages","Languages","getAvailableLanguages",_daa);
nop.addPushRequest("groups","Groups","getGroupsList",_daa);
nop.addPushRequest("mail_accounts","MailAccounts","getMailAccountsList",_daa);
nop.addPushRequest("priorities","Priorities","getPrioritiesList",_daa);
nop.addPushRequest("statuses","Statuses","getStatusesList",_daa);
nop.addPushRequest("userprofile","Users","getLoggedInUser",_daa);
if(!qu.user.isUser()){
nop.addPushRequest("products","Products","getProductsList",_daa);
nop.addPushRequest("signatures","QueueSignatures","getSignaturesList",_daa);
nop.addPushRequest("onlineAgents","Users","getOnlineAgents",{sid:qu.user.getSid()});
nop.addPushRequest("agents","Users","getAgents",{sid:qu.user.getSid()});
nop.addPushRequest("customFields","Fields","getFieldsListAllColumns",{sid:qu.user.getSid()});
nop.addPushRequest("filters","Filters","getFiltersList",{sid:qu.user.getSid(),user_id:qu.user.getId(),grid_id:"tickets",order:"is_global DESC, last_used DESC, filter_name"});
}else{
nop.addPushRequest("customFields","Fields","getTicketCustomFieldsList",{sid:qu.user.getSid()});
}
this._customFields=this._signatures=this._queueSignatures=this._groups=this._products=this._ticketsFilters=this._ticketsFiltersValues=this._ticketsFiltersIsGlobal=this._mailAccounts=this._agents=this._queues=this._grantedQueues=this._statuses=this._priorities=nop.nop({sid:qu.user.getSid()});
},onLoadData:function(id,_dac){
switch(id){
case "customFields":
this.initCustomFieldsSuccess(_dac);
break;
case "filters":
this.initTicketsFiltersSuccess(_dac);
break;
case "agents":
this.initAgentsSuccess(_dac);
break;
case "queues":
this.initQueuesSuccess(_dac);
break;
case "grantedQueues":
this.initGrantedQueuesSuccess(_dac);
break;
case "languages":
this.initLanguagesSuccess(_dac);
break;
case "groups":
this.initGroupsSuccess(_dac);
break;
case "products":
this.initProductsSuccess(_dac);
break;
case "signatures":
this.initSignaturesSuccess(_dac);
break;
case "mail_accounts":
this.initMailAccountsSuccess(_dac);
break;
case "priorities":
this.initPrioritiesSuccess(_dac);
break;
case "statuses":
this.initStatusesSuccess(_dac);
break;
case "first_user":
this.initFirstAgent(_dac);
break;
case "userprofile":
this.initUserProfile(_dac);
break;
default:
break;
}
},initLastUpdates:function(){
this._lastUpdates=new dojo.collections.Dictionary();
with(this._lastUpdates){
add("",app.i18n.get("whenever"));
add("today",app.i18n.get("today"));
add("yesterday",app.i18n.get("yesterday"));
add("thisWeek",app.i18n.get("thisWeek"));
add("lastWeek",app.i18n.get("lastWeek"));
add("last7Days",app.i18n.get("last7Days"));
add("thisMonth",app.i18n.get("thisMonth"));
add("lastMonth",app.i18n.get("lastMonth"));
add("last30Days",app.i18n.get("last30Days"));
add("thisYear",app.i18n.get("thisYear"));
add("lastYear",app.i18n.get("lastYear"));
}
},initKnowledgeBaseAccessModes:function(){
this._knowledgeBaseAccessModes=new dojo.collections.Dictionary();
with(this._knowledgeBaseAccessModes){
add("a",app.i18n.get("PublicKnowledge"));
add("g",app.i18n.get("InternalKnowledge"));
add("p",app.i18n.get("PrivateKnowledge"));
}
},getKnowledgeBaseAccessModes:function(){
return this._knowledgeBaseAccessModes;
},getLastUpdates:function(){
return this._lastUpdates;
},initPrioritiesSuccess:function(_dad){
this._priorities=this._rs2Dictionary(_dad,"priority","priority_name");
},initStatusesSuccess:function(_dae){
this._statuses=this._rs2Dictionary(_dae,"status","status_name");
this._statusColors=this._rs2Dictionary(_dae,"status","color");
this._statusImgs=this._rs2Dictionary(_dae,"status","img");
},initLogLevels:function(){
this._levels=new dojo.collections.Dictionary();
with(this._levels){
add("debug",app.i18n.get("debug"));
add("info",app.i18n.get("info"));
add("warning",app.i18n.get("warning"));
add("error",app.i18n.get("error"));
}
},initUserRoles:function(){
this._roles=new dojo.collections.Dictionary();
with(this._roles){
add("u",app.i18n.get("typeUser"));
add("g",app.i18n.get("typeAgent"));
add("a",app.i18n.get("typeAdmin"));
}
},getRoles:function(){
return this._roles;
},getStatuses:function(){
return this._statuses;
},getStatusColors:function(){
return this._statusColors;
},getStatusImgs:function(){
return this._statusImgs;
},getLevels:function(){
return this._levels;
},getPriorities:function(){
return this._priorities;
},fill:function(_daf,_db0,_db1,_db2){
var self=this;
var _db4=function(_db5,_db6,_db7,_db8){
return dojo.lang.hitch(self,function(){
this.fill(_db5,_db6,_db7,_db8);
});
};
var _db9=this["get"+_db0.substring(0,1).toUpperCase()+_db0.substring(1)]();
if(_db9 instanceof dojo.Deferred){
_db9.addCallback(_db4(_daf,_db0,_db1,_db2));
return;
}
if(_db1===true){
_daf.removeAll();
}
var _dba=_db9.getIterator();
var _dbb;
while(!_dba.atEnd()){
_dbb=_dba.get();
_daf.add(_dbb.key,_dbb.value);
}
if(_db2){
if(dojo.lang.isString(_db2)){
_daf.select(_db2);
}else{
if(dojo.lang.isArray(_db2)){
dojo.lang.forEach(_db2,function(elm,_dbd,arr){
_daf.select(elm);
},this);
}else{
if(dojo.lang.isFunction(_db2)){
_db2(_daf,_db9);
}
}
}
}
},execFunctionForEachElement:function(_dbf,_dc0,_dc1){
var self=this;
var _dc3=function(_dc4,_dc5,_dc6){
return dojo.lang.hitch(self,function(){
this.execFunctionForEachElement(_dc4,_dc5,_dc6);
});
};
var _dc7=this["get"+_dc1.substring(0,1).toUpperCase()+_dc1.substring(1)]();
if(_dc7 instanceof dojo.Deferred){
_dc7.addCallback(_dc3(_dbf,_dc0,_dc1));
return;
}
var _dc8=_dc7.getIterator();
var _dc9;
while(!_dc8.atEnd()){
_dc9=_dc8.get();
var _dca=new Array();
_dca.push(_dc9.value);
_dbf.apply(_dc0,_dca);
}
},_rs2Dictionary:function(_dcb,_dcc,_dcd){
var dc=new dojo.collections.Dictionary();
_dcb.beforeFirst();
while(_dcb.next()){
dc.add(_dcb.get(_dcc).valueOf(),_dcb.get(_dcd).valueOf());
}
return dc;
},initAgentsSuccess:function(_dcf){
this._agents=this._rs2Dictionary(_dcf,"user_id","name");
},getAgents:function(){
return this._agents;
},initQueuesSuccess:function(_dd0){
_dd0.beforeFirst();
this._queues=this._rs2Dictionary(_dd0,"queue_id","name");
_dd0.beforeFirst();
this._queueSignatures=this._rs2Dictionary(_dd0,"queue_id","queue_signature");
_dd0.beforeFirst();
while(_dd0.next()){
if(_dd0.getString("is_default").valueOf()=="y"){
quConfig.defaultQueue=_dd0.getString("queue_id").valueOf();
}
}
},getQueues:function(){
return this._queues;
},initGrantedQueuesSuccess:function(_dd1){
this._grantedQueues=this._rs2Dictionary(_dd1,"queue_id","name");
},getGrantedQueues:function(){
return this._grantedQueues;
},initLanguagesSuccess:function(_dd2){
this._languages=this._rs2Dictionary(_dd2,"language","language");
},initGroupsSuccess:function(_dd3){
this._groups=this._rs2Dictionary(_dd3,"groupid","group_name");
},initProductsSuccess:function(_dd4){
this._products=this._rs2Dictionary(_dd4,"productid","name");
},initSignaturesSuccess:function(_dd5){
this._signatures=this._rs2Dictionary(_dd5,"queue_id","signature");
},getLanguages:function(){
return this._languages;
},getGroups:function(){
return this._groups;
},getProducts:function(){
return this._products;
},getSignatures:function(){
return this._signatures;
},getQueueSignatures:function(){
return this._queueSignatures;
},initMailAccountsSuccess:function(_dd6){
this._mailAccounts=this._rs2Dictionary(_dd6,"account_id","account_email");
_dd6.beforeFirst();
while(_dd6.next()){
if(_dd6.get("is_default").valueOf()=="y"){
this._defaultMailAccount=_dd6.get("account_id").valueOf();
break;
}
}
},getDefaultMailAccount:function(){
return this._defaultMailAccount;
},getMailAccounts:function(){
return this._mailAccounts;
},initFirstAgent:function(_dd7){
_dd7.beforeFirst();
while(_dd7.next()){
this._firstDate=_dd7.getDate("first_time");
}
},initUserProfile:function(_dd8){
_dd8.beforeFirst();
while(_dd8.next()){
qu.user.setSignature(_dd8.getString("signature").valueOf());
qu.user.setHideSuggestions(_dd8.getString("hide_suggestions").valueOf());
qu.user.setId(_dd8.getString("user_id").valueOf());
qu.user.setName(_dd8.getString("name").valueOf());
qu.user.setType(_dd8.getString("user_type").valueOf());
qu.user.setUserName(_dd8.getString("email").valueOf());
qu.user.setHash(_dd8.getString("hash").valueOf());
}
},initCustomFieldsSuccess:function(_dd9){
var dc=new dojo.collections.Dictionary();
_dd9.beforeFirst();
while(_dd9.next()){
var _ddb=new app.data.CustomField();
_ddb.setId(_dd9.get("field_id").valueOf());
_ddb.setTitle(_dd9.get("field_title").valueOf());
_ddb.setType(_dd9.get("field_type").valueOf());
_ddb.setDefaultValue(_dd9.get("default_value").valueOf());
_ddb.setOptions(_dd9.get("options").valueOf());
_ddb.setRelatedTo(_dd9.get("related_to").valueOf());
_ddb.setOrderValue(_dd9.get("order_value").valueOf());
_ddb.setUserAccess(_dd9.get("user_access").valueOf());
dc.add(_dd9.get("field_id").valueOf(),_ddb);
}
this._customFields=dc;
},getCustomFields:function(){
return this._customFields;
},getFirstDate:function(){
return this._firstDate;
},getTicketsFilters:function(){
return this._ticketsFilters;
},getTicketsFiltersValues:function(){
return this._ticketsFiltersValues;
},getTicketsFiltersIsGlobal:function(){
return this._ticketsFiltersIsGlobal;
},initTicketsFiltersSuccess:function(_ddc){
var _ddd=new dojo.collections.Dictionary();
var _dde=new dojo.collections.Dictionary();
var _ddf=new dojo.collections.Dictionary();
var key,_de1,name,_de3;
_ddc.beforeFirst();
while(_ddc.next()){
key=_ddc.getString("filter_id").valueOf();
name=_ddc.getString("filter_name").valueOf();
_de1=_ddc.getString("filter_value").valueOf();
_de3=_ddc.getString("is_global").valueOf();
_ddd.add(key,name);
_dde.add(key,_de1);
_ddf.add(key,_de3);
}
this._ticketsFilters=_ddd;
this._ticketsFiltersValues=_dde;
this._ticketsFiltersIsGlobal=_ddf;
}});
dojo.provide("app.view.users.UserAdd");
dojo.require("app.view.users.User");
dojo.lang.declare("app.view.users.UserAdd",app.view.users.User,null,{initComponents:function(){
this.constructor.superclass.initComponents.apply(this);
this.setTitle(app.i18n.get("newUser"));
},onLoad:function(){
this.initUserTypes();
this.initGroups();
this.constructor.superclass.onLoad.apply(this);
},onSave:function(){
this.constructor.superclass.onSave.apply(this);
var _de4=new Object();
_de4.name=this.getName();
_de4.email=this.getEmail();
_de4.password=this.getPassword();
_de4.user_type=this.getUserType();
_de4.groupid=this.getGroupId();
var _de5=new qu.rpc.Service("Users");
_de5.addPushRequest("agents","Users","getAgents",{sid:qu.user.getSid()});
var def=_de5.registerNewUser({fields:_de4,plain_password:this.getPlainPassword(),sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
}});
dojo.provide("app.view.users.userDetail.Tickets");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.users.userDetail.Tickets",qu.gui.Frame,null,{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.userDetail.Tickets"));
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdUpdates,"onClick",this,"onUpdatesClick");
dojo.event.connectOnce(this.el.cmdUpdate,"onclick",this,"onUpdateCommand");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"applyFilter");
dojo.event.connectOnce(this.el.cmdFilters,"onClick",this,"onFiltersClick");
dojo.event.connectOnce(this.el.cmdClear,"onclick",this,"onClear");
dojo.event.connectOnce(this.el.grid,"onCheckboxClick",this,"onRowSelect");
},onRowSelect:function(){
if(this.el.grid.getSelectedRows()!=null){
this.el.cmdUpdates.setChecked(true);
this.el.updateContainer.style.display="block";
}
},onUpdatesClick:function(){
if(this.el.cmdUpdates.isChecked()){
this.el.updateContainer.style.display="block";
}else{
this.el.updateContainer.style.display="none";
}
},onFiltersClick:function(){
if(this.el.cmdFilters.isChecked()){
this.el.filtersContainer.style.display="block";
}else{
this.el.filtersContainer.style.display="none";
}
},applyFilter:function(){
this.el.grid.setPage(1);
this.updateGrid();
},updateGrid:function(){
var _de7=new qu.rpc.Service("Tickets");
with(this.el.grid.getModel()){
setService(_de7);
setMethod("getTicketsList");
setDefaultParams({sid:qu.user.getSid(),subject_ticket_id:this.getFilterId(),subject:this.getFilterSubject(),last_update_from:this.getFilterLastUpdate().getFrom(),last_update_to:this.getFilterLastUpdate().getTo(),queue_id:this.getFilterQueue(),filter_status:this.getFilterStatus(),priority:this.getFilterPriority(),agent:this.getFilterAgent(),customer_id:this.getParent().getId()});
}
this.el.grid.update();
},onClear:function(){
this.setFilterId("");
this.setFilterSubject("");
this.setFilterLastUpdate("");
this.el.filterQueue.deselectAll();
this.el.filterAgent.deselectAll();
this.el.filterStatus.deselectAll();
this.el.filterPriority.deselectAll();
this.updateGrid();
},initComponents:function(){
with(this.el.grid){
setColumn("t_first_subject",{caption:app.i18n.get("subject"),sortable:true,width:"60%",style:{cursor:"pointer"},bind:function(col,rs){
var id=rs.get("t_subject_ticket_id");
var _deb=rs.getString("last_read").valueOf();
var _dec=rs.get("t_first_subject").replace(/</g,"&lt;");
if(rs.get("mails_count")>1){
_dec+=" ("+rs.get("mails_count")+")";
}
var _ded="bolder";
if(_deb!="null"){
_ded="normal";
}
var _dee="<font style=\"font-weight:"+_ded+"\" title=\""+_dec+"\">"+_dec+"</font><br/>"+"<font style=\"color:#999999;\">"+id+"</font>";
return _dee;
}});
setColumn("agent_email",{caption:app.i18n.get("owner"),sortable:true,width:"20%",bind:function(col,rs){
var _df1="";
var _df2="";
if(rs.getString("t_agent_owner_id")==qu.user.getId()){
_df2=" style='font-weight: bold;'";
}
if(rs.getString(col)=="null"){
return "";
}else{
if(rs.getString("agent_name").length>0){
_df1="<span title=\""+rs.getString(col)+"\""+_df2+">"+rs.getString("agent_name")+"</span>";
}else{
_df1="<span title=\""+rs.getString(col)+"\""+_df2+">"+rs.getString(col)+"</span>";
}
}
return _df1;
},style:{cursor:"pointer"}});
setColumn("queue_name",{caption:app.i18n.get("queue"),sortable:true,width:"20%",style:{cursor:"pointer"},bind:function(col,rs){
return "<span title=\""+rs.get(col)+"\">"+rs.get(col)+"</span>";
}});
setColumn("t_last_update",{caption:app.i18n.get("update"),sortable:true,width:"75px",bind:function(col,rs){
var date=rs.getDate(col);
var _df8=new Date();
var _df9=app.i18n.get("dateFormat");
if(date.getFullYear()==_df8.getFullYear()&&date.getMonth()==_df8.getMonth()&&date.getDate()==_df8.getDate()){
_df9=app.i18n.get("timeFormat");
}else{
if(date.getFullYear()==_df8.getFullYear()){
_df9=app.i18n.get("dateFormatWithoutYear");
}
}
return "<span style=\"padding-right:6px;\" title=\""+date.print(app.i18n.get("dateTimeFormat"))+"\">"+date.print(_df9);
+"</span>";
},style:{cursor:"pointer",textAlign:"right"}});
setColumn("t_status",{caption:app.i18n.get("_status"),sortable:true,width:"75px",bind:function(col,rs){
var _dfc=rs.getString(col).valueOf();
if(app.main.hashMaps.getStatusImgs()!=null){
return "<img src=\"lib/icons/crystalsvg/16/"+app.main.hashMaps.getStatusImgs().item(_dfc)+"\" title=\""+app.main.hashMaps.getStatuses().item(_dfc)+"\"/><br/><span style=\"font-size: 10px;\">"+app.main.hashMaps.getStatuses().item(_dfc)+"</span>";
}else{
return "";
}
},style:{cursor:"pointer"}});
setColumn("t_priority",{caption:app.i18n.get("priority"),sortable:true,width:"10%",bind:function(col,rs){
var _dff=rs.get(col).valueOf();
var prio=app.main.hashMaps.getPriorities().item(_dff);
return "<span title=\""+prio+"\">"+prio+"</span>";
},style:{cursor:"pointer",textAlign:"center",verticalAlign:"middle"}});
setColumn("due",{caption:app.i18n.get("due"),sortable:true,width:"75px",bind:function(col,rs){
var _e03=rs.getNumber(col);
var _e04=rs.getString("t_status");
myDate=new Date();
if(_e03==0){
return "-";
}
var _e05=_e03<0;
return "<font style=\""+(_e05?"color:#b11000;":"color:#2e8c2e;")+"\" />"+myDate.secondsToHumanTime(_e03)+"</font>";
},style:{cursor:"pointer",textAlign:"right"}});
setMultiselect(true);
setSortColumn("due");
setRowColorHandler(function(rs){
var _e07=rs.getString("t_status").valueOf();
switch(_e07){
case "n":
return quConfig.ticketStatusNewColor;
case "r":
return quConfig.ticketStatusResolvedColor;
case "s":
return quConfig.ticketStatusSpamColor;
case "d":
return quConfig.ticketStatusDeadColor;
case "w":
return quConfig.ticketStatusWorkInProgressColor;
case "b":
return quConfig.ticketStatusBouncedColor;
case "a":
return quConfig.ticketStatusAwaitingReplyColor;
case "c":
return quConfig.ticketStatusCustomerReplyColor;
}
});
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
this.editTicket=new app.view.tickets.TicketEdit(this.el.editContent);
this.editTicket.setParent(this);
if(qu.user.getType()=="a"||qu.user.getType()=="g"){
this.el.status_.setWidth("120px");
this.el.priority.setWidth("120px");
this.el.owner.setWidth("120px");
this.el.queue.setWidth("120px");
this.el.status_.addOption("nochange",app.i18n.get("changeStatus"));
this.el.priority.addOption("nochange",app.i18n.get("changePriority"));
app.main.hashMaps.fill(this.el.status_,"statuses",false);
app.main.hashMaps.fill(this.el.priority,"priorities",false);
app.main.hashMaps.fill(this.el.queue,"queues",false);
app.main.hashMaps.fill(this.el.owner,"agents",false);
this.setUpdateVisible(true);
this.setFiltersVisible(true);
}else{
this.setUpdateVisible(false);
this.setFiltersVisible(false);
}
this.el.grid.init();
},initFilterFields:function(){
this.el.filterQueue.removeAll();
this.el.filterAgent.removeAll();
this.el.filterStatus.removeAll();
this.el.filterPriority.removeAll();
this.el.filterPriority.add("l","<img src=\"app/web/images/priority_low.gif\" style=\"margin-right:4px;\" />"+app.i18n.get("priorityLow"));
this.el.filterPriority.add("n","<img src=\"app/web/images/priority_normal.gif\" style=\"margin-right:4px;\" />"+app.i18n.get("priorityNormal"));
this.el.filterPriority.add("h","<img src=\"app/web/images/priority_high.gif\" style=\"margin-right:4px;\" />"+app.i18n.get("priorityHigh"));
this.el.filterPriority.add("i","<img src=\"app/web/images/priority_immediate.gif\" style=\"margin-right:4px;\" />"+app.i18n.get("priorityImmediate"));
app.main.hashMaps.fill(this.el.filterStatus,"statuses",false);
app.main.hashMaps.fill(this.el.filterQueue,"queues",false);
app.main.hashMaps.fill(this.el.filterAgent,"agents",false);
},onLoad:function(){
this.el.grid.rebuild();
this.updateGrid();
if(qu.user.getType()=="a"||qu.user.getType()=="g"){
this.el.owner.removeAll();
this.el.queue.removeAll();
this.el.owner.addOption("nochange",app.i18n.get("changeOwner"));
this.el.owner.addOption("","");
this.el.queue.addOption("nochange",app.i18n.get("changeQueue"));
app.main.hashMaps.fill(this.el.queue,"queues",false);
app.main.hashMaps.fill(this.el.owner,"agents",false);
this.initFilterFields();
}
},setUpdateVisible:function(_e08){
if(_e08===true){
this.el.cmdUpdates.show();
}else{
this.el.cmdUpdates.hide();
}
},setFiltersVisible:function(_e09){
if(_e09===true){
this.el.cmdFilters.show();
}else{
this.el.cmdFilters.hide();
}
},onDelete:function(_e0a){
var _e0b=this.el.grid.getSelectionByColumn("t_ticket_id").join("|");
if(_e0b==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _e0c=new qu.rpc.Service("Tickets");
_e0c.setThrobber("Deleting...");
var def=_e0c.deleteTicket({sid:qu.user.getSid(),ticket_id:this.el.grid.getSelectionByColumn("t_ticket_id").join("|"),subject_ticket_id:this.el.grid.getSelectionByColumn("t_subject_ticket_id").join("|")});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_e0e){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_e0f){
app.main.msgBox.print(_e0f);
},onEdit:function(_e10,_e11){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(_e10);
this.editTicket.setTicketId(rs.getString("t_ticket_id").valueOf());
this.editTicket.setSubjectTicketId(rs.getString("t_subject_ticket_id").valueOf());
this.editTicket.setTicketSubject(rs.getString("t_first_subject").valueOf());
this.editTicket.setTicketCustomerName(this.getParent().getName());
this.editTicket.setTicketCustomerEmail(this.getParent().getEmail());
this.editTicket.setCustomerId(this.getParent().getId());
this.editTicket.setResultSet(rs);
dojo.event.connectOnce(this.editTicket,"hide",this,"showContent");
dojo.event.connectOnce(this.editTicket,"hide",this,"updateGrid");
this.hideContent();
this.editTicket.show();
},showContent:function(){
this.el.editContent.style.display="none";
this.el.mainContent.style.display="block";
},hideContent:function(){
this.el.mainContent.style.display="none";
this.el.editContent.style.display="block";
},onUpdateCommand:function(){
var _e13=this.el.grid.getSelectionByColumn("t_ticket_id");
if(_e13.length==0){
alert(app.i18n.get("selectSomething"));
return false;
}
var _e14=new qu.rpc.Service("Tickets");
_e14.setThrobber(app.i18n.get("updating"));
var _e15=this.el.status_.getSelectedValue();
var _e16=this.el.priority.getSelectedValue();
var _e17=this.el.owner.getSelectedValue();
var _e18=this.el.queue.getSelectedValue();
var _e19=new Object();
if(_e15!="nochange"){
_e19["status"]=_e15;
}
if(_e16!="nochange"){
_e19["priority"]=_e16;
}
if(_e17!="nochange"){
_e19["agent_owner_id"]=_e17;
}
if(_e18!="nochange"){
_e19["queue_id"]=_e18;
}
var def=_e14.updateTicket({ticket_id:_e13,sid:qu.user.getSid(),fields:_e19});
dojo.event.connectOnce(this,"onUpdateSuccess",this.el.grid,"update");
def.addCallback(dojo.lang.hitch(this,"onUpdateSuccess"));
},onUpdateSuccess:function(){
this.el.status_.selectByValue("nochange");
this.el.priority.selectByValue("nochange");
this.el.owner.selectByValue("nochange");
this.el.queue.selectByValue("nochange");
},getFilterId:function(){
return this.el.filterId.value;
},setFilterId:function(_e1b){
this.el.filterId.value=_e1b;
},getFilterSubject:function(){
return this.el.filterSubject.value;
},setFilterSubject:function(_e1c){
this.el.filterSubject.value=_e1c;
},getFilterQueue:function(){
return this.el.filterQueue.getSelection();
},setFilterQueue:function(_e1d){
this.el.filterQueue.select(_e1d);
},getFilterAgent:function(){
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_e1e){
this.el.filterAgent.select(_e1e);
},getFilterLastUpdate:function(){
return this.el.filterLastUpdate;
},setFilterLastUpdate:function(_e1f){
this.el.filterLastUpdate.select(_e1f);
},getFilterStatus:function(){
return this.el.filterStatus.getSelection();
},setFilterStatus:function(_e20){
this.el.filterStatus.select(_e20);
},getFilterPriority:function(){
return this.el.filterPriority.getSelection();
},setFilterPriority:function(_e21){
this.el.filterPriority.select(_e21);
}});
dojo.provide("app.view.users.userDetail.Profile");
dojo.require("qu.gui.Frame");
dojo.require("app.widget.CustomField");
dojo.lang.declare("app.view.users.userDetail.Profile",qu.gui.Frame,null,{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.userDetail.Profile"));
},initComponents:function(){
this.initUserTypes();
this.initGroups();
this.el.queues.setSize("100%","106px");
app.main.hashMaps.fill(this.el.queues,"queues",true,dojo.lang.hitch(this,function(elm,_e23){
}));
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this.el.userType.domNode,"onchange",this,"onUserTypeChange");
dojo.event.connectOnce(this,"hideLoading",this.el.signature,"resetDesignMode");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
},createCustomFields:function(){
inResult=this.customFieldsResult;
var _e24={};
inResult.beforeFirst();
while(inResult.next()){
if(inResult.getString("field_value").valueOf()=="null"){
_e24["custom_"+inResult.getString("field_id").valueOf()]="";
}else{
_e24["custom_"+inResult.getString("field_id").valueOf()]=inResult.getString("field_value").valueOf();
}
}
_e24["customer_email"]=this.getEmail();
_e24["customer_name"]=this.getName();
_e24["ticket_id"]="";
_e24["ticket_subject"]="";
_e24["ticket_owner"]="";
_e24["queue_name"]="";
this._customFields=new Array();
var _e25=document.createElement("table");
_e25.style.width="100%";
var _e26=document.createElement("tbody");
_e25.appendChild(_e26);
inResult.beforeFirst();
while(inResult.next()){
var hTr=document.createElement("tr");
var _e28=document.createElement("td");
_e28.style.width="10%";
_e28.style.whiteSpace="nowrap";
_e28.className="formLabel";
_e28.innerHTML=inResult.getString("field_title").valueOf();
hTr.appendChild(_e28);
var _e29=document.createElement("td");
hTr.appendChild(_e29);
var _e2a=new app.widget.CustomField(_e29,inResult.getString("field_id").valueOf(),inResult.getString("field_type").valueOf(),inResult.getString("field_value").valueOf(),inResult.getString("options").valueOf(),_e24);
this._customFields.push(_e2a);
_e26.appendChild(hTr);
}
if(inResult.getCount()>0){
this.el.additionalInformationContent.innerHTML="";
this.el.additionalInformationContent.appendChild(_e25);
this.el.additionalInformationFieldset.style.display="block";
}else{
this.el.additionalInformationFieldset.style.display="none";
}
},onLoadCustomFields:function(id,_e2c){
if(id!="customFieldsUserDetail"){
return true;
}
this.customFieldsResult=_e2c;
},onUserTypeChange:function(){
if(qu.user.isAdmin()){
var _e2d=this.getUserType();
if(_e2d!="g"){
this.hideQueues();
}else{
this.showQueues();
}
}else{
alert(app.i18n.get("userTypeChangesWillNotBeSaved"));
}
},showQueues:function(){
this.el.queuesContainer.style.display="block";
},hideQueues:function(){
this.el.queuesContainer.style.display="none";
},onSave:function(){
if(this.getPasswordAgain()!=this.getPassword()){
alert(app.i18n.get("passwordsDoesntMatch"));
this.setPassword("");
this.setPasswordAgain("");
return false;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _e2e={name:this.getName(),email:this.getEmail(),signature:this.getSignature(),user_id:this.getParent().getId()};
if(qu.user.isAdmin()){
_e2e.user_type=this.getUserType();
}
if(qu.user.isPowerUser()){
_e2e.groupid=this.getGroupId();
}
if(this.getPassword()!=""){
_e2e.password=this.getPassword();
}
if(this.getUserType()=="g"){
_e2e.queue_ids=this.el.queues.getSelectedValues();
}
var _e2f={sid:qu.user.getSid(),fields:_e2e};
var _e30=new Object();
for(var i=0;i<this._customFields.length;i++){
_e30[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
_e2f["custom"]=_e30;
var _e32=new qu.rpc.Service("Users");
if(this.getUserType()!="u"){
_e32.addPushRequest("agents","Users","getAgents",{sid:qu.user.getSid()});
}
_e32.setThrobber(app.i18n.get("saving"));
var def=_e32.updateUser(_e2f);
def.addCallback(this,"onSaveSuccess");
def.addErrback(this,"onSaveFail");
},onSaveSuccess:function(){
this.setPassword("");
this.setPasswordAgain("");
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
app.main.msgBox.print(app.i18n.get("ProfileSuccessfullySaved"));
},onSaveFail:function(_e34){
app.main.msgBox.print(_e34);
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
},onLoad:function(){
this.setLoading(true);
this.loadUser();
},loadUser:function(){
var _e35=new qu.rpc.Service("Users");
_e35.addPushRequest("customFieldsUserDetail","Users","getCustomFieldValues",{sid:qu.user.getSid(),user_id:this.getParent().getId()});
var def=_e35.getUser({sid:qu.user.getSid(),user_id:this.getParent().getId()});
def.addCallback(dojo.lang.hitch(this,"onLoadUserSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadUserFail"));
},onLoadUserSuccess:function(_e37){
var rs=_e37;
rs.first();
if(rs.get("user_type")!="u"&&!qu.user.isAdmin()&&qu.user.getId()!=rs.get("user_id").valueOf()){
this.el.cmdSave.style.display="none";
}else{
this.el.cmdSave.style.display="block";
}
this.setName(rs.get("name"));
this.setEmail(rs.get("email"));
this.setSignature(rs.get("signature"));
this.setDateCreated(rs.getDate("created"));
this.setUserType(rs.get("user_type"));
this.setGroupId(rs.get("groupId")+0);
this.el.queues.deselectAll();
if(this.getUserType()=="g"){
this.showQueues();
var _e39=new qu.rpc.Service("Queues");
var def=_e39.getQueueList({sid:qu.user.getSid(),user_id:this.getParent().getId()});
def.addCallback(this,"onLoadQueuesSuccess");
def.addErrback(this,"onLoadQueuesFail");
}else{
this.hideQueues();
this.setLoading(false);
}
this.createCustomFields();
},onLoadQueuesSuccess:function(_e3b){
while(_e3b.next()){
this.el.queues.select(_e3b.getString("queue_id").valueOf());
}
this.setLoading(false);
},onLoadQueuesFail:function(_e3c){
this.setLoading(false);
},onLoadUserFail:function(_e3d){
dojo.debug(_e3d);
},initUserTypes:function(){
this.el.userType.add("u",app.i18n.get("typeUser"));
this.el.userType.add("g",app.i18n.get("typeAgent"));
this.el.userType.add("a",app.i18n.get("typeAdmin"));
},initGroups:function(){
if(!quConfig.hideGroups){
this.el.groupId.removeAll();
this.el.groupId.add("",app.i18n.get("none"));
app.main.hashMaps.fill(this.el.groupId,"groups",false);
}else{
this.el.groupSection.style.visibility="hidden";
}
},getName:function(){
return this.el.name.value;
},setName:function(_e3e){
this.el.name.value=_e3e;
},getEmail:function(){
return this.el.email.value;
},setEmail:function(_e3f){
this.el.email.value=_e3f;
},getPassword:function(){
if(this.el.password.value==""){
return "";
}
return dojo.crypto.MD5.compute(this.el.password.value,dojo.crypto.outputTypes.Hex);
},setPassword:function(inPw){
this.el.password.value=inPw;
},getPasswordAgain:function(){
if(this.el.passwordAgain.value==""){
return "";
}
return dojo.crypto.MD5.compute(this.el.passwordAgain.value,dojo.crypto.outputTypes.Hex);
},setPasswordAgain:function(inPw){
this.el.passwordAgain.value=inPw;
},getSignature:function(){
return this.el.signature.getHtml();
},setSignature:function(_e42){
if(_e42==null||_e42=="null"){
_e42="";
}
this.el.signature.setHtml(_e42);
},setDateCreated:function(_e43){
this.el.created.innerHTML=_e43.print(app.i18n.get("dateTimeFormat"));
},getUserType:function(){
return this.el.userType.getSelectedValue();
},setUserType:function(_e44){
this.el.userType.selectByValue(_e44);
},getGroupId:function(){
return this.el.groupId.getSelectedValue();
},setGroupId:function(_e45){
this.el.groupId.selectByValue(_e45);
}});
dojo.provide("app.view.users.userDetail.Logs");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.users.userDetail.Logs",qu.gui.Frame,null,{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.userDetail.Logs"));
},initComponents:function(){
with(this.el.grid){
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"115px",bind:function(col,rs){
var _e48=rs.getDate(col);
return _e48.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("log_text",{caption:app.i18n.get("message"),sortable:true,width:"100%"});
setColumn("log_type",{caption:app.i18n.get("logType"),sortable:true,width:"60px"});
setColumn("level",{caption:app.i18n.get("logLevel"),sortable:true,width:"60px"});
setColumn("ip",{caption:app.i18n.get("ip"),sortable:true,width:"50px"});
setMultiselect(true);
setSortColumn("created");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(10);
}
var _e49=new qu.rpc.Service("Logs");
with(this.el.grid.getModel()){
setService(_e49);
setMethod("getLogsList");
setDefaultParams({sid:qu.user.getSid(),user_id:this.getParent().getId()});
}
this.el.grid.init();
this.initFilterFields();
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onClick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce([this.el.filterCreated.domNode,this.el.filterLogLevel.domNode],"onchange",this,"updateGrid");
dojo.event.connectOnce(this.el.cmdFilters,"onClick",this,"onFiltersClick");
},onFiltersClick:function(){
if(this.el.cmdFilters.isChecked()){
this.el.filtersContainer.style.display="block";
}else{
this.el.filtersContainer.style.display="none";
}
},updateGrid:function(){
var logs=new qu.rpc.Service("Logs");
with(this.el.grid.getModel()){
setService(logs);
setMethod("getLogsList");
setDefaultParams({sid:qu.user.getSid(),created:this.getFilterCreated(),log_text:this.getFilterMessage(),log_level:this.getFilterLogLevel(),log_type:this.getFilterLogType(),ip:this.getFilterIp(),user_id:this.getParent().getId()});
}
this.el.grid.update();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("log_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var logs=new qu.rpc.Service("Logs");
logs.setThrobber("Deleting...");
var def=logs.deleteLog({sid:qu.user.getSid(),log_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},initFilterFields:function(){
this.el.filterCreated.removeOptions();
this.el.filterLogLevel.removeAll();
this.el.filterCreated.addOption("",app.i18n.get("any"));
this.el.filterCreated.addOption("today",app.i18n.get("today"));
this.el.filterCreated.addOption("yesterday",app.i18n.get("yesterday"));
this.el.filterCreated.addOption("thisWeek",app.i18n.get("thisWeek"));
this.el.filterCreated.addOption("lastWeek",app.i18n.get("lastWeek"));
this.el.filterCreated.addOption("last7Days",app.i18n.get("last7Days"));
this.el.filterCreated.addOption("thisMonth",app.i18n.get("thisMonth"));
this.el.filterCreated.addOption("lastMonth",app.i18n.get("lastMonth"));
this.el.filterCreated.addOption("last30Days",app.i18n.get("last30Days"));
this.el.filterCreated.addOption("thisYear",app.i18n.get("thisYear"));
this.el.filterCreated.addOption("lastYear",app.i18n.get("lastYear"));
this.setFilterCreated("");
this.el.filterLogLevel.add("info",app.i18n.get("info"));
this.el.filterLogLevel.add("warning",app.i18n.get("warning"));
this.el.filterLogLevel.add("error",app.i18n.get("error"));
this.setFilterLogLevel("");
},onDeleteSuccess:function(_e4e){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_e4f){
app.main.msgBox.print(_e4f);
},onLoad:function(){
this.el.grid.update();
},getFilterCreated:function(){
return this.el.filterCreated.getSelectedValue();
},setFilterCreated:function(_e50){
this.el.filterCreated.selectByValue(_e50);
},getFilterMessage:function(){
return this.el.filterMessage.value;
},setFilterMessage:function(_e51){
this.el.filterMessage.value=_e51;
},getFilterLogType:function(){
return this.el.filterLogType.value;
},setFilterLogType:function(_e52){
this.el.filterLogType.value=_e52;
},getFilterLogLevel:function(){
return this.el.filterLogLevel.getSelection();
},setFilterLogLevel:function(_e53){
this.el.filterLogLevel.select(_e53);
},getFilterIp:function(){
return this.el.filterIp.value;
},setFilterIp:function(_e54){
this.el.filterIp.value=_e54;
}});
dojo.provide("app.view.users.UserDetail");
dojo.require("qu.gui.Frame");
dojo.require("qu.widget.TabFolder");
dojo.require("app.view.users.userDetail.Tickets");
dojo.require("app.view.users.userDetail.Profile");
dojo.require("app.view.users.userDetail.Logs");
dojo.lang.declare("app.view.users.UserDetail",qu.gui.Frame,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdBack,"onclick",this,"hide");
},initComponents:function(){
this.el.tabFolder.setStyle("quUserDetailTF");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.users.UserDetail"));
},onLoad:function(){
var tab;
this.el.tabFolder.removeAllTabs();
var _e56=new app.view.users.userDetail.Tickets();
_e56.setParent(this);
tab=new qu.widget.tabFolder.Tab(_e56);
tab.setTitle(app.i18n.get("Tickets"));
tab.setIcon(new qu.gui.Icon("alarm"));
this.el.tabFolder.addTab(tab);
var _e57=true;
if(quConfig.agentSeeJustAgentsFromHisQueues=="y"&&this.getType()!="u"&&this.getId()!=qu.user.getId()){
_e57=false;
var _e58=app.main.hashMaps.getAgents().getIterator();
var _e59;
while(!_e58.atEnd()&&!_e57){
_e59=_e58.get();
if(_e59.key==this.getId()){
_e57=true;
}
}
}
if(_e57){
var _e5a=new app.view.users.userDetail.Profile();
_e5a.setParent(this);
tab=new qu.widget.tabFolder.Tab(_e5a);
tab.setTitle(app.i18n.get("Profile"));
tab.setIcon(new qu.gui.Icon("3d"));
this.el.tabFolder.addTab(tab);
var logs=new app.view.users.userDetail.Logs();
logs.setParent(this);
tab=new qu.widget.tabFolder.Tab(logs);
tab.setTitle(app.i18n.get("Logs"));
tab.setIcon(new qu.gui.Icon("history"));
this.el.tabFolder.addTab(tab);
}
this.el.tabFolder.showTab(0);
this.updateTitle();
this.el.cmdPopup.href=quConfig.bootFilename+"#uid="+this.getId();
this.el.tabFolder.reload();
},onShow:function(){
var _e5c={changeUrl:"uid="+this.getId()};
dojo.undo.browser.addToHistory(_e5c);
},setName:function(_e5d){
this._name=_e5d;
},getName:function(){
return this._name;
},setEmail:function(_e5e){
this._email=_e5e;
},getEmail:function(){
return this._email;
},setType:function(_e5f){
this._type=_e5f;
},getType:function(){
return this._type;
},setId:function(inId){
this._id=inId;
},getId:function(){
return this._id;
},updateTitle:function(){
var type;
if(this.getName()==""){
this.el.titleIcon.src=qu.global.icon("mail2.png",22);
this.el.titleName.innerHTML=this.getEmail();
this.el.titleEmail.innerHTML="";
}else{
this.el.titleIcon.src=qu.global.icon("edit_user.png",22);
this.el.titleName.innerHTML=this.getName();
this.el.titleEmail.innerHTML="&nbsp;&lt;"+this.getEmail()+"&gt;";
}
switch(this.getType()){
case "a":
type=app.i18n.get("typeAdmin");
break;
case "g":
type=app.i18n.get("typeAgent");
break;
case "u":
type=app.i18n.get("typeUser");
break;
}
this.el.titleTypeIcon.src="app/web/images/type_"+type.toLowerCase()+".png";
this.el.titleType.innerHTML=type;
},onHide:function(){
dojo.undo.browser.addToHistory({changeUrl:"users"});
}});
dojo.provide("app.view.Users");
dojo.require("qu.gui.Frame");
dojo.require("qu.lang.array");
dojo.require("app.view.users.UserAdd");
dojo.require("app.view.users.UserDetail");
dojo.lang.declare("app.view.Users",qu.gui.Frame,function(){
this._userToOpen=false;
},{initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onClick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdUpdate,"onClick",this,"onCmdUpdate");
dojo.event.connectOnce(this.el.cmdAdd,"onClick",this,"onAdd");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce(this.el.cmdClear,"onclick",this,"onClear");
dojo.event.connectOnce(this.userDetail,"onHide",this,"showContent");
dojo.event.connectOnce(this.userDetail,"onHide",this,"updateGrid");
},onClear:function(){
this.setFilterName("");
this.setFilterEmail("");
this.setFilterCreated("");
this.el.filterUserType.deselectAll();
this.el.filterEmailQuality.deselectAll();
this.el.filterGroupId.deselectAll();
this.updateGrid();
},updateGrid:function(){
var _e62=new qu.rpc.Service("Users");
if(!qu.user.isUser()){
_e62.addPushRequest("onlineAgents","Users","getOnlineAgents",{sid:qu.user.getSid()});
}
with(this.el.usersGrid.getModel()){
setService(_e62);
setMethod("getUsersList");
try{
setDefaultParams({sid:qu.user.getSid(),name:this.getFilterName(),email:this.getFilterEmail(),user_type:this.getFilterUserType(),created_from:this.getFilterCreated().getFrom(),created_to:this.getFilterCreated().getTo(),email_quality:this.getFilterEmailQuality(),groupid:this.getFilterGroupId(),updateLoginsAction:"update"});
}
catch(e){
setDefaultParams({sid:qu.user.getSid(),name:this.getFilterName(),email:this.getFilterEmail(),user_type:this.getFilterUserType(),email_quality:this.getFilterEmailQuality(),groupid:this.getFilterGroupId(),updateLoginsAction:"update"});
}
}
this.el.usersGrid.setPage(1);
this.el.usersGrid.update();
},initComponents:function(){
with(this.el.usersGrid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"40%",style:{cursor:"pointer"}});
setColumn("email",{caption:app.i18n.get("email"),sortable:true,width:"40%",style:{cursor:"pointer"}});
if(!quConfig.hideGroups){
setColumn("group_name",{caption:app.i18n.get("groupName"),sortable:true,width:"20%",bind:function(col,rs){
var _e65=rs.get(col).valueOf();
if(_e65==null||_e65=="null"){
_e65="";
}
return _e65;
},style:{cursor:"pointer"}});
}
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"100px",bind:function(col,rs){
var _e68=rs.getDate(col);
return _e68.print(app.i18n.get("dateFormat"));
},style:{cursor:"pointer"}});
setColumn("user_type",{caption:app.i18n.get("userType"),sortable:true,width:"60px",bind:function(col,rs){
var _e6b=rs.getString(col).valueOf();
switch(_e6b){
case "a":
return "<img src=\"app/web/images/type_admin.png\" title=\""+app.i18n.get("typeAdmin")+"\"/>&nbsp;"+app.i18n.get("typeAdmin");
case "g":
return "<img src=\"app/web/images/type_agent.png\" title=\""+app.i18n.get("typeAgent")+"\"/>&nbsp;"+app.i18n.get("typeAgent");
case "u":
return "<img src=\"app/web/images/type_user.png\" title=\""+app.i18n.get("typeUser")+"\"/>&nbsp;"+app.i18n.get("typeUser");
}
},style:{cursor:"pointer",textAlign:"left"}});
setColumn("email_quality",{caption:app.i18n.get("emailQuality"),sortable:true,width:"90px",bind:function(col,rs){
var _e6e=rs.getNumber(col).valueOf();
switch(_e6e){
case -1:
return app.i18n.get("wrongEmailFormat");
case 0:
return app.i18n.get("emailNotValidated");
case 1:
return app.i18n.get("emailFormatOK");
case 2:
return app.i18n.get("emailDomainExists");
case 3:
return app.i18n.get("emailAccountExists");
}
},style:{cursor:"pointer",textAlign:"center"}});
setColumn("popup",{caption:" ",sortable:false,width:"18px",bind:function(col,rs){
var _e71=document.createElement("a");
_e71.href=quConfig.bootFilename+"#uid="+rs.getString("user_id");
_e71.target="_blank";
_e71.className="blank";
_e71.title=app.i18n.get("OpenInNewWindow");
var img=document.createElement("img");
img.src="app/web/images/popup_gray.gif";
img.style.width="16px";
img.style.height="16px";
img.style.border="none";
img.style.marginTop="4px";
_e71.appendChild(img);
return _e71;
},style:{textAlign:"right"}});
setMultiselect(true);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setColor("black");
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onDetail"));
this.addUser=new app.view.users.UserAdd();
this.userDetail=new app.view.users.UserDetail(this.el.detailContent);
}
this.initFilterFields();
this.el.usersGrid.init();
},onUpdate:function(){
this.userDetail.hide();
this.show();
},initFilterFields:function(){
var _e73=new qu.rpc.Service("Users");
with(this.el.filterEmail.getModel()){
setService(_e73);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _e74={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_e74);
}
this.el.filterUserType.removeAll();
this.el.filterEmailQuality.removeAll();
this.el.userRole.removeAll();
this.el.userRole.add("",app.i18n.get("changeUserRole"));
app.main.hashMaps.fill(this.el.userRole,"roles",false);
this.el.filterUserType.add("a",app.i18n.get("typeAdmin"));
this.el.filterUserType.add("g",app.i18n.get("typeAgent"));
this.el.filterUserType.add("u",app.i18n.get("typeUser"));
this.el.filterEmailQuality.add("-1",app.i18n.get("wrongEmailFormat"));
this.el.filterEmailQuality.add("0",app.i18n.get("emailNotValidated"));
this.el.filterEmailQuality.add("1",app.i18n.get("emailFormatOK"));
this.el.filterEmailQuality.add("2",app.i18n.get("emailDomainExists"));
this.el.filterEmailQuality.add("3",app.i18n.get("emailAccountExists"));
app.main.hashMaps.fill(this.el.filterGroupId,"groups",true);
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Users"));
},onCmdUpdate:function(_e75){
var _e76=this.el.usersGrid.getSelectionByColumn("user_id");
if(_e76==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(this.getUserType()==""){
alert(app.i18n.get("selectUserType"));
return false;
}
var _e77=new qu.rpc.Service("Users");
_e77.addPushRequest("agents","Users","getAgents",{sid:qu.user.getSid()});
var _e78=new Object();
_e78["user_type"]=this.getUserType();
var def=_e77.updateUser({sid:qu.user.getSid(),fields:_e78,user_id:_e76});
def.addCallback(dojo.lang.hitch(this,"onUpdateSuccess"));
def.addErrback(dojo.lang.hitch(this,"onUpdateFail"));
},onUpdateSuccess:function(_e7a){
app.main.msgBox.print(app.i18n.get("Updated"));
this.setUserType("");
this.el.usersGrid.getData();
},onUpdateFail:function(_e7b){
this.setUserType("");
app.main.msgBox.print(_e7b);
},onDelete:function(_e7c){
var _e7d=this.el.usersGrid.getSelectionByColumn("user_id").join("|");
if(_e7d==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _e7e=new qu.rpc.Service("Users");
_e7e.addPushRequest("agents","Users","getAgents",{sid:qu.user.getSid()});
var def=_e7e.deleteUser({sid:qu.user.getSid(),user_id:_e7d,email:this.el.usersGrid.getSelectionByColumn("email").join("|")});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_e80){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.usersGrid.getData();
},onDeleteFail:function(_e81){
app.main.msgBox.print(_e81);
},onLoad:function(){
if(this.getUserToOpen()!==false){
this.openUser(this.getUserToOpen());
}else{
this.updateGrid();
}
},onAdd:function(){
dojo.event.connectOnce(this.addUser,"onSaveSuccess",this,"onUserCreated");
this.addUser.show();
},onUserCreated:function(){
app.main.msgBox.print(app.i18n.get("created"));
this.updateGrid();
},getFilterName:function(){
return this.el.filterName.value;
},setFilterName:function(_e82){
this.el.filterName.value=_e82;
},getFilterEmail:function(){
return this.el.filterEmail.getValue();
},setFilterEmail:function(_e83){
this.el.filterEmail.setValue(_e83);
},getFilterCreated:function(){
return this.el.filterCreated;
},setFilterCreated:function(_e84){
this.el.filterCreated.setValue(_e84);
},getUserType:function(){
return this.el.userRole.getSelectedValue();
},setUserType:function(_e85){
this.el.userRole.selectByValue(_e85);
},getFilterUserType:function(){
return this.el.filterUserType.getSelection();
},setFilterUserType:function(_e86){
this.el.filterUserType.select(_e86);
},getFilterEmailQuality:function(){
return this.el.filterEmailQuality.getSelection();
},setFilterEmailQuality:function(_e87){
this.el.filterEmailQuality.select(_e87);
},getFilterGroupId:function(){
return this.el.filterGroupId.getSelection();
},setFilterGroupId:function(_e88){
this.el.filterGroupId.select(_e88);
},onDetail:function(_e89,_e8a){
if(_e8a==6){
return;
}
var rs=this.el.usersGrid.getModel().getResultSet();
rs.absolute(_e89);
this.userDetail.setId(rs.getString("user_id").valueOf());
this.userDetail.setName(rs.getString("name").valueOf());
this.userDetail.setEmail(rs.getString("email").valueOf());
this.userDetail.setType(rs.getString("user_type").valueOf());
this.hideContent();
this.userDetail.show();
},openUser:function(inId){
var _e8d=new qu.rpc.Service("Users");
var def=_e8d.getUser({sid:qu.user.getSid(),user_id:inId});
def.addCallback(this,function(_e8f){
var rs=_e8f;
if(rs.md.getCount()==0){
throw app.i18n.get("UserDoesNotExist")+": <i>"+inId+"</i>";
}
rs.first();
this.userDetail.setId(rs.getString("user_id").valueOf());
this.userDetail.setName(rs.getString("name").valueOf());
this.userDetail.setEmail(rs.getString("email").valueOf());
this.userDetail.setType(rs.getString("user_type").valueOf());
this.userDetail.show();
this.setUserToOpen(false);
});
def.addErrback(this,function(_e91){
this.showContent();
this.updateGrid();
app.main.msgBox.print(_e91);
});
this.hideContent();
},hideContent:function(){
this.el.detailContent.style.display="block";
this.el.mainContent.style.display="none";
},showContent:function(){
this.el.detailContent.style.display="none";
this.el.mainContent.style.display="block";
},setUserToOpen:function(_e92){
this._userToOpen=_e92;
},getUserToOpen:function(){
return this._userToOpen;
}});
dojo.provide("app.view.filters.SaveFilter");
dojo.require("qu.gui.Dialog");
dojo.require("dojo.string.common");
dojo.lang.declare("app.view.filters.SaveFilter",qu.gui.Dialog,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onKeyPress:function(_e93){
switch(_e93.keyCode){
case _e93.KEY_ENTER:
this.onSave();
break;
case _e93.KEY_ESCAPE:
this.hide();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.filters.SaveFilter"));
this.setSize(350,95);
this.setTitle(app.i18n.get("SaveFilter"));
this.setIcon(new qu.gui.Icon("file-save-as"));
},onLoad:function(){
this.center();
this.resetForm();
},resetForm:function(){
this.setFilterName("");
this.setIsGlobal(false);
if(qu.user.isAdmin()){
this.el.isGlobalBox.style.display="block";
}
this.msgBox.clear();
},onShow:function(){
this.el.filterName.focus();
},onSave:function(){
if(dojo.string.trim(this.getFilterName())==""){
alert(app.i18n.get("PleaseProvideFilterName"));
this.el.filterName.focus();
return;
}
this.msgBox.print(app.i18n.get("saving"));
var _e94=new qu.rpc.Service("Filters");
_e94.setThrobber(app.i18n.get("saving"));
_e94.addPushRequestIf(qu.user.isPowerUser(),"filters","Filters","getFiltersList",{sid:qu.user.getSid(),user_id:qu.user.getId(),grid_id:"tickets",order:"is_global DESC, last_used DESC, filter_name"});
var def=_e94.insertFilter({sid:qu.user.getSid(),fields:{grid_id:this.getGrid(),filter_name:this.getFilterName(),filter_value:this.getFilter(),is_global:this.getIsGlobal()}});
def.addCallback(this,"onSaveSuccess");
def.addErrback(this,"onSaveFail");
},onSaveSuccess:function(){
this.msgBox.print(app.i18n.get("saved"));
app.main.msgBox.print(app.i18n.get("FilterSaved")+" \""+this.getFilterName()+"\"");
},onSaveFail:function(_e96){
this.msgBox.print(_e96);
},getFilterName:function(){
return this.el.filterName.value;
},setFilterName:function(_e97){
this.el.filterName.value=_e97;
},setGrid:function(_e98){
this._grid=_e98;
},getGrid:function(){
return this._grid;
},setFilter:function(_e99){
this._filter=_e99;
},getFilter:function(){
return this._filter;
},getIsGlobal:function(){
if(this.el.isGlobal.checked){
return "y";
}else{
return "n";
}
},setIsGlobal:function(_e9a){
if(_e9a==true||_e9a=="y"){
this.el.isGlobal.checked=true;
}else{
if(_e9a==false||_e9a=="n"){
this.el.isGlobal.checked=false;
}
}
}});
dojo.provide("qu.util.DateRange");
dojo.declare("qu.util.DateRange",null,{});
qu.util.DateRange.relativeRanges=[["today",function(){
var _e9b=qu.util.DateRange.getToday();
var _e9c=qu.util.DateRange.getToday();
return {from:_e9b,to:_e9c};
}],["yesterday",function(){
var _e9d=new Date();
var _e9e=new Date();
_e9d.setTime(_e9d.getTime()-qu.util.DateRange.day);
_e9e.setTime(_e9e.getTime()-qu.util.DateRange.day);
return {from:_e9d,to:_e9e};
}],["thisWeek",function(){
var _e9f=qu.util.DateRange.getToday();
var _ea0=_e9f.valueOf()-(qu.util.DateRange.day*(_e9f.getDay()-1));
var end=_e9f.valueOf()+(qu.util.DateRange.day*6)-(qu.util.DateRange.day*(_e9f.getDay()-1));
return qu.util.DateRange._createRange(_ea0,end);
}],["lastWeek",function(){
var _ea2=qu.util.DateRange.getToday();
var _ea3=_ea2.valueOf()-(qu.util.DateRange.day*(_ea2.getDay()-1))-(qu.util.DateRange.day*7);
var end=_ea2.valueOf()+(qu.util.DateRange.day*6)-(qu.util.DateRange.day*(_ea2.getDay()-1))-(qu.util.DateRange.day*7);
return qu.util.DateRange._createRange(_ea3,end);
}],["last7Days",function(){
var _ea5=qu.util.DateRange.getToday();
var _ea6=_ea5.valueOf()-(qu.util.DateRange.day*7);
var end=_ea5.valueOf();
return qu.util.DateRange._createRange(_ea6,end);
}],["last30Days",function(){
var _ea8=qu.util.DateRange.getToday();
var _ea9=_ea8.valueOf()-(qu.util.DateRange.day*30);
var end=_ea8.valueOf();
return qu.util.DateRange._createRange(_ea9,end);
}],["thisMonth",function(){
var _eab=qu.util.DateRange.getToday();
var _eac=new Date(_eab.getFullYear(),_eab.getMonth(),1);
var _ead=new Date(_eab.getFullYear(),_eab.getMonth(),_eab.getMonthDays(_eab.getMonth()));
var _eae=_eac.valueOf();
var end=_ead.valueOf();
return qu.util.DateRange._createRange(_eae,end);
}],["lastMonth",function(){
var _eb0=qu.util.DateRange.getToday();
var _eb1=new Date(_eb0.getFullYear(),_eb0.getMonth()-1,1);
var _eb2=new Date(_eb0.getFullYear(),_eb0.getMonth()-1,_eb0.getMonthDays(_eb1.getMonth()));
var _eb3=_eb1.valueOf();
var end=_eb2.valueOf();
return qu.util.DateRange._createRange(_eb3,end);
}],["thisYear",function(){
var _eb5=qu.util.DateRange.getToday();
var _eb6=new Date(_eb5.getFullYear(),0,1);
var _eb7=new Date(_eb5.getFullYear(),11,31);
var _eb8=_eb6.valueOf();
var end=_eb7.valueOf();
return qu.util.DateRange._createRange(_eb8,end);
}],["lastYear",function(){
var _eba=qu.util.DateRange.getToday();
var _ebb=new Date(_eba.getFullYear()-1,0,1);
var _ebc=new Date(_eba.getFullYear()-1,11,31);
var _ebd=_ebb.valueOf();
var end=_ebc.valueOf();
return qu.util.DateRange._createRange(_ebd,end);
}]];
qu.util.DateRange.getRelativeRange=function(_ebf){
var _ec0=null;
dojo.lang.forEach(qu.util.DateRange.relativeRanges,function(elm,_ec2,arr){
if(_ebf==elm[0]){
_ec0=elm[1];
}
});
if(dojo.lang.isFunction(_ec0)){
var _ec4=_ec0();
_ec4.from=qu.util.DateRange._postprocessFrom(_ec4.from);
_ec4.to=qu.util.DateRange._postprocessTo(_ec4.to);
return _ec4;
}
return {from:null,to:null};
};
qu.util.DateRange.getToday=function(){
var _ec5=new Date();
_ec5.setHours(0);
_ec5.setMinutes(0);
_ec5.setSeconds(0);
_ec5.setMilliseconds(0);
return _ec5;
};
qu.util.DateRange._postprocessFrom=function(_ec6){
_ec6.setHours(0);
_ec6.setMinutes(0);
_ec6.setSeconds(0);
_ec6.setMilliseconds(0);
return _ec6;
};
qu.util.DateRange._postprocessTo=function(_ec7){
_ec7.setHours(23);
_ec7.setMinutes(59);
_ec7.setSeconds(59);
_ec7.setMilliseconds(999);
return _ec7;
};
qu.util.DateRange._createRange=function(_ec8,_ec9){
var _eca=new Object();
_eca.from=new Date();
_eca.to=new Date();
_eca.from.setTime(_ec8);
_eca.to.setTime(_ec9);
return _eca;
};
qu.util.DateRange.day=86400000;
dojo.provide("app.data.Filter");
dojo.require("qu.util.DateRange");
dojo.declare("app.data.Filter",null,function(_ecb,_ecc){
if(_ecb){
this._initKw(_ecb,_ecc);
}else{
this._initEmpty();
}
},{dateFormat:"%Y-%m-%d %H:%M:%S",_initEmpty:function(){
this._id=false;
this._ticketId="";
this._similarTickets=false;
this._email="";
this._body="";
this._subject="";
this._lastUpdate_fuzzy="";
this._lastUpdate_from="";
this._lastUpdate_to="";
this._queues=new Array();
this._groups=new Array();
this._agents=new Array();
this._status=new Array();
this._priorities=new Array();
this._mailAccouts=new Array();
this._ticketsRelatedToAgents=false;
this._sortColumn=false;
this._sortOrder="desc";
this._height=50;
this._customFields=new Array();
},_initKw:function(kw,id){
with(this){
setId(id);
setTicketId(kw.subject_ticket_id);
setTicketsRelatedToAgents(kw.related_to_agents);
setBody(kw.body);
setSubject(kw.subject);
setEmail(kw.email);
setLastUpdate_fuzzy(kw.last_update);
setLastUpdate_from(kw.last_update_from);
setLastUpdate_to(kw.last_update_to);
setQueues(kw.queue_id);
setGroups(kw.groupid);
setAgents(kw.agent);
setStatus(kw.filter_status);
setPriorities(kw.priority);
setMailAccounts(kw.mail_account);
setSortColumn(kw.sort_column);
setSortOrder(kw.sort_order);
setHeight(kw.height);
setCustomFields(kw.custom_fields);
}
},setId:function(inId){
this._id=inId;
},getId:function(){
return this._id;
},setTicketId:function(_ed0){
this._ticketId=_ed0;
},getTicketId:function(){
return this._ticketId;
},setEmail:function(_ed1){
this._email=_ed1;
},getEmail:function(){
return this._email;
},setSubject:function(_ed2){
this._subject=_ed2;
},getSubject:function(){
return this._subject;
},setBody:function(_ed3){
this._body=_ed3;
},getBody:function(){
return this._body;
},setLastUpdate_from:function(_ed4){
this._lastUpdate_from=_ed4;
},getLastUpdate_from:function(){
var _ed5=this.getLastUpdate_fuzzy();
if((_ed5=="custom"||_ed5=="")||((_ed5=="custom"||_ed5=="")&&this._lastUpdate_from=="")){
return this._lastUpdate_from;
}
return qu.util.DateRange.getRelativeRange(_ed5).from.print(this.dateFormat);
},setLastUpdate_to:function(_ed6){
this._lastUpdate_to=_ed6;
},getLastUpdate_to:function(){
var _ed7=this.getLastUpdate_fuzzy();
if((_ed7=="custom"||_ed7=="")||((_ed7=="custom"||_ed7=="")&&this._lastUpdate_to=="")){
return this._lastUpdate_to;
}
return qu.util.DateRange.getRelativeRange(_ed7).to.print(this.dateFormat);
},setLastUpdate_fuzzy:function(_ed8){
if(dojo.lang.isArray(_ed8)){
_ed8=_ed8[0];
}
this._lastUpdate_fuzzy=_ed8;
},getLastUpdate_fuzzy:function(){
return this._lastUpdate_fuzzy;
},setQueues:function(_ed9){
this._queues=_ed9;
},getQueues:function(){
return this._queues;
},setGroups:function(_eda){
this._groups=_eda;
},getGroups:function(){
if(this._groups==null){
this._groups=new Array();
}
return this._groups;
},setAgents:function(_edb){
this._agents=_edb;
},getAgents:function(){
return this._agents;
},setStatus:function(_edc){
this._status=_edc;
},getStatus:function(){
return this._status;
},setPriorities:function(_edd){
this._priorities=_edd;
},getPriorities:function(){
return this._priorities;
},setMailAccounts:function(_ede){
this._mailAccounts=_ede;
},getMailAccounts:function(){
if(typeof this._mailAccounts=="undefined"){
return new Array();
}
return this._mailAccounts;
},setTicketsRelatedToAgents:function(_edf){
this._ticketsRelatedToAgents=_edf;
},isTicketsRelatedToAgents:function(){
if(this._ticketsRelatedToAgents=="y"||this._ticketsRelatedToAgents===true){
return true;
}else{
return false;
}
},setSortColumn:function(_ee0){
this._sortColumn=_ee0;
},getSortColumn:function(){
return this._sortColumn;
},setSortOrder:function(_ee1){
this._sortOrder=_ee1;
},getSortOrder:function(){
return this._sortOrder;
},setHeight:function(_ee2){
this._height=_ee2;
},getHeight:function(){
return this._height;
},setCustomFields:function(_ee3){
if(_ee3 instanceof Array){
this._customFields=_ee3;
}else{
this._customFields=new Array();
}
},getCustomFields:function(){
return this._customFields;
},_dateToString:function(_ee4){
if(dojo.lang.isUndefined(_ee4)||(dojo.lang.isString(_ee4)&&dojo.string.trim(_ee4)=="")){
return false;
}
if(_ee4 instanceof Date){
var from=_ee4.print(this.dateFormat);
return from;
}
return _ee4;
},createParamsForRpc:function(){
var _ee6=new Object();
with(this){
_ee6.subject_ticket_id=getTicketId();
_ee6.subject=getSubject();
_ee6.email=getEmail();
_ee6.body=getBody();
_ee6.related_to_agents=isTicketsRelatedToAgents()?"y":"n";
_ee6.filter_status=getStatus();
_ee6.queue_id=getQueues();
_ee6.groupid=getGroups();
_ee6.priority=getPriorities();
_ee6.mail_account=getMailAccounts();
_ee6.agent=getAgents();
_ee6.custom_fields=getCustomFields();
}
var from=this._dateToString(this.getLastUpdate_from());
if(from){
_ee6.last_update_from=from;
}
var to=this._dateToString(this.getLastUpdate_to());
if(to){
_ee6.last_update_to=to;
}
if(this.getId()){
_ee6.filter_id=this.getId();
}
return _ee6;
},createParamsForSave:function(){
var _ee9=new Object();
with(this){
_ee9.subject_ticket_id=getTicketId();
_ee9.subject=getSubject();
_ee9.email=getEmail();
_ee9.body=getBody();
_ee9.last_update=getLastUpdate_fuzzy();
_ee9.related_to_agents=isTicketsRelatedToAgents();
_ee9.filter_status=getStatus();
_ee9.queue_id=getQueues();
_ee9.groupid=getGroups();
_ee9.priority=getPriorities();
_ee9.mail_account=getMailAccounts();
_ee9.agent=getAgents();
_ee9.height=getHeight();
_ee9.sort_column=getSortColumn();
_ee9.sort_order=getSortOrder();
_ee9.custom_fields=getCustomFields();
}
var _eea=this.getLastUpdate_fuzzy();
if(_eea=="custom"){
var from=this._dateToString(this.getLastUpdate_from());
if(from){
_ee9.last_update_from=from;
}else{
_ee9.last_update_from="";
}
var to=this._dateToString(this.getLastUpdate_to());
if(to){
_ee9.last_update_to=to;
}else{
_ee9.last_update_to="";
}
}
return _ee9;
}});
dojo.provide("app.widget.CustomFilterField");
dojo.require("app.widget.Widget");
dojo.lang.declare("app.widget.CustomFilterField",app.widget.Widget,function(_eed,_eee,_eef,_ef0,_ef1){
this._parentNode=_eed;
this._fieldId=_eee;
this._fieldType=_eef;
this._defaultValue=_ef0;
this._options=_ef1;
this.create();
this.connect();
},{create:function(){
var _ef2=document.createElement("div");
this.setDomNode(_ef2);
switch(this._fieldType){
case "t":
case "a":
this.fieldNode=document.createElement("input");
this.fieldNode.setAttribute("type","text");
this.fieldNode.style.width="98%";
break;
case "c":
this.field=dojo.widget.createWidget("qu:ComboBox");
this.field.setNoneCaption(app.i18n.get("any"));
this.field.setMultiselect(false);
this.field.setWidth("250");
this.field.removeAll();
this.field.add("","["+app.i18n.get("any")+"]");
this.field.add("y",app.i18n.get("checked"));
this.field.add("n",app.i18n.get("notChecked"));
this.fieldNode=this.field.domNode;
break;
case "o":
this.field=dojo.widget.createWidget("qu:ComboBox");
this.field.setNoneCaption(app.i18n.get("any"));
this.field.setMultiselect(false);
this.field.setWidth("250");
var _ef3=this.getOptions();
this.field.removeAll();
this.field.add("","["+app.i18n.get("any")+"]");
for(var i=0;i<_ef3.length;i++){
var str=dojo.string.trim(_ef3[i]);
this.field.add(str,str);
}
this.fieldNode=this.field.domNode;
break;
case "m":
this.field=dojo.widget.createWidget("qu:ComboBox");
this.field.setNoneCaption(app.i18n.get("any"));
this.field.setWidth("250");
this.field.setMultiselect(true);
var _ef3=this.getOptions();
this.field.removeAll();
for(var i=0;i<_ef3.length;i++){
var str=dojo.string.trim(_ef3[i]);
this.field.add(str,str);
}
this.fieldNode=this.field.domNode;
break;
default:
this.fieldNode=document.createElement("span");
this.fieldNode.innerHtml="undefined";
}
this.setValue(this._defaultValue);
_ef2.appendChild(this.fieldNode);
this.getParentNode().appendChild(this.getDomNode());
},connect:function(){
switch(this._fieldType){
case "t":
case "a":
dojo.event.connectOnce(this.fieldNode,"onchange",this,"onChange");
break;
case "c":
case "o":
case "m":
dojo.event.connectOnce(this.field,"onChange",this,"onChange");
break;
default:
}
},onChange:function(){
},getParentNode:function(){
return this._parentNode;
},getOptions:function(){
return this._options.split(",");
},getValue:function(){
switch(this._fieldType){
case "t":
case "a":
return this.fieldNode.value;
break;
case "c":
case "o":
case "m":
return this.field.getSelection().join(",");
break;
default:
return false;
}
},setValue:function(_ef6){
if(_ef6=="null"){
_ef6="";
}
switch(this._fieldType){
case "t":
case "a":
this.fieldNode.value=_ef6;
break;
case "c":
case "o":
case "m":
this.field.deselectAll();
var _ef7=_ef6.split(",");
for(i=0;i<_ef7.length;i++){
this.field.select(dojo.string.trim(_ef7[i]));
}
break;
default:
return false;
}
},getFieldId:function(){
return this._fieldId;
}});
dojo.provide("app.view.tickets.Filter");
dojo.require("app.view.filters.SaveFilter");
dojo.require("app.data.Filter");
dojo.require("app.widget.CustomFilterField");
dojo.lang.declare("app.view.tickets.Filter",qu.gui.Frame,function(){
},{onLoad:function(){
this.initFilterFields();
},onShow:function(){
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.tickets.Filter"));
},initComponents:function(){
this.initAutocomplete();
this.initCustomFieldsFilter();
this.saveFilter=new app.view.filters.SaveFilter();
this.saveFilter.setGrid("tickets");
},initCustomFieldsFilter:function(){
this.el.customFieldsFilter.innerHTML="";
this.customFields=new Array();
app.main.hashMaps.execFunctionForEachElement(function(_ef8){
if(_ef8.getRelatedTo()=="g"){
return true;
}
var _ef9=document.createElement("table");
_ef9.style.width="90%";
_ef9.style.margin="0px";
var _efa=document.createElement("tbody");
_ef9.appendChild(_efa);
var hTr=document.createElement("tr");
var _efc=document.createElement("td");
_efc.style.width="180px";
_efc.style.whiteSpace="nowrap";
_efc.style.verticalAlign="top";
_efc.style.textAlign="right";
var _efd=document.createElement("span");
_efd.innerHTML=_ef8.getTitle()+"&nbsp;";
var _efe=document.createElement("img");
if(_ef8.getRelatedTo()=="u"){
_efe.src="lib/icons/crystalsvg/16/user.png";
_efe.title=app.i18n.get("relatedToUser");
}else{
if(_ef8.getRelatedTo()=="g"){
_efe.src="lib/icons/crystalsvg/16/block-device.png";
_efe.title=app.i18n.get("relatedToGroup");
}else{
_efe.src="lib/icons/crystalsvg/16/alarm.png";
_efe.title=app.i18n.get("relatedToTicket");
}
}
_efe.style.border="none";
_efc.appendChild(_efd);
_efc.appendChild(_efe);
hTr.appendChild(_efc);
var _eff=document.createElement("td");
hTr.appendChild(_eff);
var _f00=new app.widget.CustomFilterField(_eff,_ef8.getId(),_ef8.getType(),"",_ef8.getOptions());
this.customFields.push(_f00);
_efa.appendChild(hTr);
this.el.customFieldsFilter.appendChild(_ef9);
},this,"customFields");
},initAutocomplete:function(){
var _f01=new qu.rpc.Service("Users");
with(this.el.filterEmail.getModel()){
setService(_f01);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _f02={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_f02);
}
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdClear,"onclick",this,"cmdClear_onClick");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"cmdSave_onClick");
dojo.event.connectOnce(this.el.cmdShowCustomFields,"onclick",this,"cmdShowCustomFields_onClick");
dojo.event.connectOnce([this.el.filterQueue,this.el.filterGroup,this.el.filterAgent,this.el.filterStatus,this.el.filterPriority,this.el.filterMailAccount,],"onChange",this,"onChange");
dojo.event.connectOnce(this.el.filterLastUpdate,"onChange",this,"onChange");
dojo.event.connectOnce([this.el.filterBody,this.el.filterId,this.el.filterShowRelatedTickets,this.el.filterSubject,],"onchange",this,"onChange");
dojo.event.connectOnce(this.el.filterEmail,"onValueChanged",this,"onChange");
dojo.event.connectOnce(this.getParent(),"filterSelector_onChange",this,"updateFilterFields");
dojo.event.connectOnce(this.getParent(),"setRemoteFilter",this,"updateFilterFields");
dojo.event.connectOnce(this.el.cmdClear,"onclick",this,"onClear");
dojo.event.connectOnce(this.el.cmdApply,"onclick",this,"onApply");
dojo.event.connectOnce(this.saveFilter,"onSaveSuccess",this,"onSaved");
for(var i=0;i<this.customFields.length;i++){
dojo.event.connectOnce(this.customFields[i],"onChange",this,"onChange");
}
},onKeyPress:function(_f04){
switch(_f04.keyCode){
case _f04.KEY_ESCAPE:
this.onClear();
break;
case _f04.KEY_ENTER:
this.onApply();
break;
}
},initFilterFields:function(){
var _f05=this.getParent().getFilter();
with(this){
setFilterId(_f05.getTicketId());
setFilterSubject(_f05.getSubject());
setFilterBody(_f05.getBody());
setFilterEmail(_f05.getEmail());
setFilterRelatedToAgents(_f05.isTicketsRelatedToAgents());
setFilterLastUpdate(_f05.getLastUpdate_fuzzy(),_f05.getLastUpdate_from(),_f05.getLastUpdate_to());
setCustomFieldsArray(_f05.getCustomFields());
initFilterQueue();
initFilterGroup();
initFilterAgent();
initFilterStatus();
initFilterPriority();
initFilterMailAccount();
}
},initFilterQueue:function(){
app.main.hashMaps.fill(this.el.filterQueue,"queues",true,this.getFilter().getQueues());
},initFilterGroup:function(){
if(!quConfig.hideGroups){
app.main.hashMaps.fill(this.el.filterGroup,"groups",true,this.getFilter().getGroups());
}else{
this.el.groupFilterSection.style.visibility="hidden";
}
},initFilterAgent:function(){
this.el.filterAgent.removeAll();
this.el.filterAgent.add("none",app.i18n.get("notAssigned"));
app.main.hashMaps.fill(this.el.filterAgent,"agents",false,this.getFilter().getAgents());
},initFilterStatus:function(){
app.main.hashMaps.fill(this.el.filterStatus,"statuses",true,this.getFilter().getStatus());
},initFilterPriority:function(){
app.main.hashMaps.fill(this.el.filterPriority,"priorities",true,this.getFilter().getPriorities());
},initFilterMailAccount:function(){
app.main.hashMaps.fill(this.el.filterMailAccount,"mailAccounts",true,this.getFilter().getMailAccounts());
},cmdClear_onClick:function(){
this.hideHint();
},cmdSave_onClick:function(){
if(this.el.hint.style.display=="block"){
this.onApply();
}
this.getFilter().setHeight(this.getGrid().getHeight());
this.getFilter().setSortColumn(this.getGrid().getSortColumn());
this.getFilter().setSortOrder(this.getGrid().getSortOrder());
this.saveFilter.setFilter(dojo.json.serialize(this.getFilter().createParamsForSave()));
this.saveFilter.show();
},cmdShowCustomFields_onClick:function(){
if(this.el.customFieldsFilter.style.display=="none"){
this.el.customFieldsFilter.style.display="block";
this.el.cmdShowCustomFields.innerHTML=app.i18n.get("HideCustomFieldsFilter");
}else{
this.el.customFieldsFilter.style.display="none";
this.el.cmdShowCustomFields.innerHTML=app.i18n.get("ShowCustomFieldsFilter");
}
},onChange:function(){
this.showHint();
},onApply:function(){
this.hideHint();
this._getFilter();
},onClear:function(){
this.resetFilterFields();
this._getFilter();
},onSaved:function(){
},setFilter:function(_f06){
this._filter=_f06;
this._setFilter();
},getFilter:function(){
return this.getParent().getFilter();
},updateFilterFields:function(){
if(this.isDisplayed()){
this.hideHint();
this._setFilter();
}
},resetFilterFields:function(){
this.setFilterBody("");
this.setFilterId("");
this.setFilterEmail("");
this.setFilterSubject("");
this.setFilterLastUpdate("");
this.setFilterRelatedToAgents(false);
this.el.filterQueue.deselectAll();
this.el.filterGroup.deselectAll();
this.el.filterAgent.deselectAll();
this.el.filterStatus.deselectAll();
this.el.filterPriority.deselectAll();
this.el.filterMailAccount.deselectAll();
for(var i=0;i<this.customFields.length;i++){
this.customFields[i].setValue("");
}
},showHint:function(){
this.el.hint.style.display="block";
},hideHint:function(){
this.el.hint.style.display="none";
},_setFilter:function(){
var _f08=this.getFilter();
with(this){
setFilterId(_f08.getTicketId());
setFilterSubject(_f08.getSubject());
setFilterBody(_f08.getBody());
setFilterEmail(_f08.getEmail());
setFilterQueue(_f08.getQueues());
setFilterGroup(_f08.getGroups());
setFilterAgent(_f08.getAgents());
setFilterStatus(_f08.getStatus());
setFilterPriority(_f08.getPriorities());
setFilterMailAccount(_f08.getMailAccounts());
setFilterRelatedToAgents(_f08.isTicketsRelatedToAgents());
setFilterLastUpdate(_f08.getLastUpdate_fuzzy(),_f08.getLastUpdate_from(),_f08.getLastUpdate_to());
setFilterHeight(_f08.getHeight());
setFilterSortColumn(_f08.getSortColumn());
setFilterSortOrder(_f08.getSortOrder());
setCustomFieldsArray(_f08.getCustomFields());
}
},_getFilter:function(){
var _f09=this.getFilter();
with(_f09){
setTicketId(this.getFilterId());
setSubject(this.getFilterSubject());
setBody(this.getFilterBody());
setEmail(this.getFilterEmail());
setQueues(this.getFilterQueue());
setGroups(this.getFilterGroup());
setAgents(this.getFilterAgent());
setStatus(this.getFilterStatus());
setPriorities(this.getFilterPriority());
setMailAccounts(this.getFilterMailAccount());
setTicketsRelatedToAgents(this.getFilterRelatedToAgents());
setLastUpdate_fuzzy(this.getFilterLastUpdate().fuzzy);
setLastUpdate_from(this.getFilterLastUpdate().from);
setLastUpdate_to(this.getFilterLastUpdate().to);
setHeight(this.getGrid().getHeight());
setSortColumn(this.getGrid().getSortColumn());
setSortOrder(this.getGrid().getSortOrder());
setCustomFields(this.getCustomFieldsArray());
}
},getCustomFieldsArray:function(){
var _f0a=new Array();
for(var i=0;i<this.customFields.length;i++){
if(this.customFields[i].getValue()!=""){
var _f0c=new Array();
_f0c.push(this.customFields[i].getFieldId());
_f0c.push(this.customFields[i].getValue());
_f0a.push(_f0c);
}
}
return _f0a;
},setCustomFieldsArray:function(_f0d){
for(var j=0;j<this.customFields.length;j++){
this.customFields[j].setValue("");
}
for(var i=0;i<_f0d.length;i++){
for(var j=0;j<this.customFields.length;j++){
if(this.customFields[j].getFieldId()==_f0d[i][0]){
this.customFields[j].setValue(_f0d[i][1]);
break;
}
}
}
},setRemoteFilter:function(_f10){
this._remoteFilter;
},getRemoteFilter:function(){
return this._remoteFilter;
},getFilterId:function(){
return this.el.filterId.value;
},setFilterId:function(_f11){
this.el.filterId.value=_f11;
},getFilterSubject:function(){
return this.el.filterSubject.value;
},setFilterSubject:function(_f12){
this.el.filterSubject.value=_f12;
},getFilterBody:function(){
return this.el.filterBody.value;
},setFilterBody:function(_f13){
if(this.el!=undefined){
this.el.filterBody.value=_f13;
}
},getFilterEmail:function(){
return this.el.filterEmail.getValue();
},setFilterEmail:function(_f14){
this.el.filterEmail.setValue(_f14);
},getFilterQueue:function(){
return this.el.filterQueue.getSelection();
},setFilterQueue:function(_f15){
this.el.filterQueue.deselectAll();
this.el.filterQueue.select(_f15);
},getFilterGroup:function(){
return this.el.filterGroup.getSelection();
},setFilterGroup:function(_f16){
this.el.filterGroup.deselectAll();
this.el.filterGroup.select(_f16);
},getFilterAgent:function(){
if(app.main.hashMaps.getAgents() instanceof dojo.Deferred){
return this.defaultFilterAgent;
}
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_f17){
this.el.filterAgent.deselectAll();
this.el.filterAgent.select(_f17);
},getFilterLastUpdate:function(){
return this.el.filterLastUpdate;
},setFilterLastUpdate:function(_f18,from,to){
this.el.filterLastUpdate.setValue(_f18,from,to);
},getFilterStatus:function(){
return this.el.filterStatus.getSelection();
},setFilterStatus:function(_f1b){
this.el.filterStatus.deselectAll();
this.el.filterStatus.select(_f1b);
},getFilterPriority:function(){
return this.el.filterPriority.getSelection();
},setFilterPriority:function(_f1c){
this.el.filterPriority.deselectAll();
this.el.filterPriority.select(_f1c);
},getFilterMailAccount:function(){
return this.el.filterMailAccount.getSelection();
},setFilterMailAccount:function(_f1d){
this.el.filterMailAccount.deselectAll();
this.el.filterMailAccount.select(_f1d);
},getFilterRelatedToAgents:function(){
if(this.el["filterShowRelatedTickets"].checked){
return "y";
}
return "n";
},setFilterRelatedToAgents:function(_f1e){
if(_f1e==true||_f1e=="y"){
this.el["filterShowRelatedTickets"].checked=true;
}else{
if(_f1e==false||_f1e=="n"){
this.el["filterShowRelatedTickets"].checked=false;
}
}
},setFilterLastUpdate:function(_f1f,_f20,inTo){
this.el.filterLastUpdate.setValue(_f1f,_f20,inTo);
},getFilterLastUpdate:function(){
var _f22=new Object();
_f22.fuzzy=this.el.filterLastUpdate.getFuzzyRange();
_f22.from=this.el.filterLastUpdate.getRange().from;
_f22.to=this.el.filterLastUpdate.getRange().to;
if(_f22.fuzzy!="custom"){
_f22.from="";
_f22.to="";
}
return _f22;
},setFilterHeight:function(_f23){
if(_f23){
this.getGrid().setHeight(_f23);
}
},setFilterSortColumn:function(_f24){
if(_f24){
this.getGrid().setSortColumn(_f24);
}
},setFilterSortOrder:function(_f25){
if(_f25){
this.getGrid().setSortOrder(_f25);
}
},getGrid:function(){
return this._grid;
},setGrid:function(_f26){
this._grid=_f26;
}});
dojo.provide("app.view.tickets.GridInitializer");
dojo.declare("app.view.tickets.GridInitializer",null,{});
app.view.tickets.GridInitializer.initialize=function(_f27){
with(_f27){
setColumn("t_first_subject",{caption:app.i18n.get("subject"),sortable:true,width:"30%",style:{cursor:"pointer"},bind:function(col,rs){
var id=rs.get("t_subject_ticket_id");
var _f2b=rs.getString("last_read").valueOf();
var _f2c=qu.string.escapeHtmlTags(rs.get("t_first_subject"));
var _f2d="";
if(rs.get("mails_count")>1){
_f2d=" <font style=\"font-weight: bold;\">("+rs.get("mails_count")+")</font>";
}
var _f2e="bolder";
if(_f2b!="null"){
_f2e="normal";
}
var _f2f="<font style=\"font-weight:"+_f2e+"\" title=\""+qu.string.replaceParenthases(_f2c)+"\">"+_f2c+"</font><br/>"+"<font style=\"color:#999999;\">"+id+"</font>"+_f2d;
return _f2f;
}});
setColumn("customer_email",{caption:app.i18n.get("customer"),sortable:true,width:"20%",bind:function(col,rs){
var _f32=qu.string.escapeHtmlTags(rs.getString(col).valueOf());
if(_f32=="null"){
return app.i18n.get("customerDeleted");
}
var _f33="";
var _f34=rs.get("customer_email_quality");
var _f35=function(_f36){
switch(_f36){
case -1:
return app.i18n.get("wrongEmailFormat");
case 0:
return app.i18n.get("emailNotValidated");
case 1:
return app.i18n.get("emailFormatOK");
case 2:
return app.i18n.get("emailDomainExists");
case 3:
return app.i18n.get("emailAccountExists");
}
};
if(_f34<2&&_f34!=0){
_f33+="<img src=\"app/web/images/warning.png\"  style=\"width:12px;height:11px;padding-left:3px;padding-right:3px;\" title=\""+_f35(_f34)+"\"/>";
}
_f33+="<span title=\""+_f32+"\">"+_f32+"</span>";
_f33+="<br/>";
_f33+="<span title=\""+qu.string.replaceParenthases(qu.string.escapeHtmlTags(rs.getString("customer_name")))+"\">"+qu.string.escapeHtmlTags(rs.getString("customer_name"))+"</span>";
return _f33;
},style:{cursor:"pointer"}});
setColumn("agent_email",{caption:app.i18n.get("owner"),sortable:true,width:"20%",bind:function(col,rs){
var _f39="";
var _f3a="";
if(rs.getString("t_agent_owner_id")==qu.user.getId()){
_f3a=" style='font-weight: bold;'";
}
if(rs.getString(col)=="null"){
return "";
}else{
if(rs.getString("agent_name").length>0){
_f39="<span title=\""+rs.getString(col)+"\""+_f3a+">"+rs.getString("agent_name")+"</span>";
}else{
_f39="<span title=\""+rs.getString(col)+"\""+_f3a+">"+rs.getString(col)+"</span>";
}
}
return _f39;
},style:{cursor:"pointer"}});
if(!quConfig.hideGroups){
setColumn("group_name",{caption:app.i18n.get("groupName"),sortable:true,width:"15%",style:{cursor:"pointer"},bind:function(col,rs){
var _f3d=rs.get(col);
if(_f3d==null||_f3d=="null"){
_f3d="";
}
return "<span title=\""+_f3d+"\">"+_f3d+"</span>";
}});
}
setColumn("queue_name",{caption:app.i18n.get("queue"),sortable:true,width:"15%",style:{cursor:"pointer"},bind:function(col,rs){
return "<span title=\""+rs.get(col)+"\">"+rs.get(col)+"</span>";
}});
setColumn("t_last_update",{caption:app.i18n.get("update"),sortable:true,width:"75px",bind:function(col,rs){
var date=rs.getDate(col);
var _f43=new Date();
var _f44=app.i18n.get("dateFormat");
if(date.getFullYear()==_f43.getFullYear()&&date.getMonth()==_f43.getMonth()&&date.getDate()==_f43.getDate()){
_f44=app.i18n.get("timeFormat");
}else{
if(date.getFullYear()==_f43.getFullYear()){
_f44=app.i18n.get("dateFormatWithoutYear");
}
}
return "<span style=\"padding-right:6px;\" title=\""+date.print(app.i18n.get("dateTimeFormat"))+"\">"+date.print(_f44);
+"</span>";
},style:{cursor:"pointer",textAlign:"right"}});
setColumn("t_status",{caption:app.i18n.get("_status"),sortable:true,width:"75px",bind:function(col,rs){
var _f47=rs.getString(col).valueOf();
if(app.main.hashMaps.getStatusImgs()!=null){
return "<img src=\"lib/icons/crystalsvg/16/"+app.main.hashMaps.getStatusImgs().item(_f47)+"\" title=\""+app.main.hashMaps.getStatuses().item(_f47)+"\"/><br/><span style=\"font-size: 10px;\">"+app.main.hashMaps.getStatuses().item(_f47)+"</span>";
}else{
return "";
}
},style:{cursor:"pointer",textAlign:"center"}});
setColumn("t_priority",{caption:app.i18n.get("priority"),sortable:true,width:"75px",bind:function(col,rs){
var _f4a=rs.get(col).valueOf();
var prio=app.main.hashMaps.getPriorities().item(_f4a);
return "<span title=\""+prio+"\">"+prio+"</span>";
},style:{cursor:"pointer",textAlign:"center"}});
setColumn("due",{caption:app.i18n.get("due"),sortable:true,width:"75px",bind:function(col,rs){
var _f4e=rs.getNumber(col);
var _f4f=rs.getString("t_status");
myDate=new Date();
if(_f4e==0){
return "-";
}
var _f50=_f4e<0;
return "<font style=\""+(_f50?"color:#b11000;":"color:#2e8c2e;")+"\" />"+myDate.secondsToHumanTime(_f4e)+"</font>";
},style:{cursor:"pointer",textAlign:"right"}});
setColumn("popup",{caption:" ",sortable:false,width:"18px",bind:function(col,rs){
var _f53=document.createElement("a");
_f53.href=quConfig.bootFilename+"#tid="+rs.getString("t_subject_ticket_id");
_f53.target="_blank";
_f53.className="blank";
_f53.title=app.i18n.get("OpenInNewWindow");
var img=document.createElement("img");
img.src="app/web/images/popup_gray.gif";
img.style.width="16px";
img.style.height="16px";
img.style.border="none";
img.style.marginTop="4px";
_f53.appendChild(img);
return _f53;
},style:{textAlign:"right"}});
setMultiselect(true);
setSortColumn("t_last_update");
setSortOrder(qu.widget.Grid.SORT_DESC);
setRowColorHandler(function(rs){
var _f56=rs.getString("t_status").valueOf();
return app.main.hashMaps.getStatusColors().item(_f56);
});
setHeight(50);
setWidth("100%");
}
};
dojo.provide("app.data.email.Attachment");
dojo.lang.declare("app.data.email.Attachment",null,null,{setId:function(_f57){
this._id=_f57;
},getId:function(){
return this._id;
},setFilename:function(_f58){
this._filename=_f58;
},getFilename:function(){
return this._filename;
},setContentId:function(_f59){
this._contentid=_f59;
},getContentId:function(){
return this._contentid;
},setSize:function(_f5a){
this._size=_f5a;
},getSize:function(){
return this._size;
},setType:function(_f5b){
this._type=_f5b;
},getType:function(){
return this._type;
}});
dojo.provide("app.data.email.User");
dojo.lang.declare("app.data.email.User",null,null,{setId:function(_f5c){
this._id=_f5c;
},getId:function(){
return this._id;
},setName:function(_f5d){
this._name=_f5d;
},getName:function(){
return this._name;
},setEmail:function(_f5e){
this._email=_f5e;
},getEmail:function(){
return this._email;
},setType:function(_f5f){
this._type=_f5f;
},getType:function(){
return this._type;
},setQuality:function(_f60){
this._quality=_f60;
},getQuality:function(){
return this._quality;
},setGroupId:function(_f61){
this._groupid=_f61;
},getGroupId:function(){
return this._groupid;
}});
dojo.provide("app.data.Email");
dojo.require("app.data.email.Attachment");
dojo.require("app.data.email.User");
dojo.lang.declare("app.data.Email",null,function(){
this.setFromUser(null);
this.setReplyToUser(null);
this.setWroteByUser(null);
this._attachments=new Array();
this._toUsers=new Array();
this._ccUsers=new Array();
this._body=false;
},{setId:function(_f62){
this._id=_f62;
},getId:function(){
return this._id;
},setSubject:function(_f63){
this._subject=qu.string.escapeHtmlTags(_f63);
},getSubject:function(){
return this._subject;
},setAnswered:function(_f64){
this._answered=_f64;
},isAnswered:function(){
return this._answered;
},setCreated:function(_f65){
this._created=_f65;
},getCreated:function(){
return this._created;
},setDeliveryDate:function(_f66){
this._deliveryDate=_f66;
},getDeliveryDate:function(){
return this._deliveryDate;
},setDeliveryStatus:function(_f67){
this._deliveryStatus=_f67;
},getDeliveryStatus:function(){
return this._deliveryStatus;
},setAge:function(_f68){
this._age=_f68;
},getAge:function(){
return this._age;
},addAttachment:function(_f69){
this.getAttachments().push(_f69);
},getAttachments:function(){
return this._attachments;
},getAttachment:function(_f6a){
return this.getAttachments[_f6a];
},addToUser:function(_f6b){
this.getToUsers().push(_f6b);
},getToUser:function(_f6c){
return this.getToUsers()[_f6c];
},getToUsers:function(){
return this._toUsers;
},addCcUser:function(_f6d){
this.getCcUsers().push(_f6d);
},getCcUser:function(_f6e){
return this.getCcUsers()[_f6e];
},getCcUsers:function(){
return this._ccUsers;
},setWroteByUser:function(_f6f){
this._wroteByUser=_f6f;
},getWroteByUser:function(){
return this._wroteByUser;
},setFromUser:function(_f70){
this._fromUser=_f70;
},getFromUser:function(){
return this._fromUser;
},setReplyToUser:function(_f71){
this._replyToUser=_f71;
},getReplyToUser:function(){
return this._replyToUser;
},setBody:function(_f72){
this._body=_f72;
},getBody:function(){
return this._body;
},getBodyHtml:function(){
if(this._body==null){
return this._body;
}else{
if(this._body.indexOf("<br")>-1||this._body.indexOf("<BR")>-1){
return this._body;
}else{
return this._body.replace(/\r/g,"").replace(/\n/g,"<br />");
}
}
},setHtmlBody:function(_f73){
this._body_html=_f73;
},getHtmlBody:function(){
if(this._body_html!=null&&this._body_html!="null"&&dojo.string.trim(this._body_html).length>0){
return this._body_html;
}else{
return this.getBodyHtml();
}
},setAccountId:function(_f74){
this.accountId=_f74;
},getAccountId:function(){
return this.accountId;
},setAccountName:function(_f75){
this.accountName=_f75;
},getAccountName:function(){
return this.accountName;
},setAccountEmail:function(_f76){
this.accountEmail=_f76;
},getAccountEmail:function(){
return this.accountEmail;
},setIsComment:function(_f77){
this.isComment=_f77;
},getIsComment:function(){
return this.isComment;
}});
dojo.provide("app.widget.Attachment");
dojo.require("app.widget.Widget");
dojo.require("dojo.io.IframeIO");
dojo.lang.declare("app.widget.Attachment",app.widget.Widget,function(_f78,_f79){
this._parentNode=_f78;
this._attachmentModel=_f79;
this.create();
this.connect();
},{create:function(){
var _f7a=document.createElement("div");
_f7a.style.marginTop="4px";
_f7a.style.marginBottom="4px";
this.setDomNode(_f7a);
var _f7b=document.createElement("img");
_f7b.src=qu.global.icon("mime-"+this.getType()+".png",16);
_f7b.title=this.getModel().getType();
_f7b.style.border="none";
_f7b.style.height="16px";
_f7b.style.width="16px";
_f7b.style.verticalAlign="middle";
_f7b.style.marginRight="3px";
var _f7c=document.createElement("span");
_f7c.style.fontWeight="bold";
_f7c.style.color="#000000";
_f7c.innerHTML=this.getModel().getFilename();
var _f7d=document.createElement("span");
_f7d.innerHTML=" ("+this.getHumanSize()+")";
_f7a.appendChild(_f7b);
_f7a.appendChild(_f7c);
_f7a.appendChild(_f7d);
var _f7e=document.createElement("a");
_f7e.style.marginLeft="15px";
_f7e.href="../server/download.php?attachment_id="+this.getModel().getId();
_f7e.title=app.i18n.get("download");
_f7e.innerHTML=app.i18n.get("download");
_f7a.appendChild(_f7e);
if(this.hasPreview()){
this.previewNode=document.createElement("a");
this.previewNode.style.marginLeft="10px";
this.previewNode.innerHTML=app.i18n.get("preview");
_f7a.appendChild(this.previewNode);
this.previewAreaNode=document.createElement("div");
this.previewAreaNode.style.display="none";
_f7a.appendChild(this.previewAreaNode);
}
this.getParentNode().appendChild(this.getDomNode());
},connect:function(){
if(this.hasPreview()){
dojo.event.connectOnce(this.previewNode,"onclick",this,"onPreviewClick");
}
},hasPreview:function(){
return this.getType()=="image"||this.getType()=="html";
},onPreviewClick:function(){
this.onShowPreview(this.previewNode.innerHTML==app.i18n.get("preview"));
},onShowPreview:function(_f7f){
if(_f7f){
this.previewNode.innerHTML=app.i18n.get("hidePreview");
if(this.previewAreaNode.innerHTML==""){
this.iframe=document.createElement("iframe");
this.iframe.src="../server/download.php?download_type=direct&attachment_id="+this.getModel().getId();
this.iframe.style.width="95%";
this.iframe.style.height="200px";
this.previewAreaNode.appendChild(this.iframe);
dojo.event.connectOnce(this.iframe,dojo.render.html.ie?"onready":"onload",this,"setFrameSize");
}
this.previewAreaNode.style.display="block";
}else{
this.previewNode.innerHTML=app.i18n.get("preview");
this.previewAreaNode.style.display="none";
}
},setFrameSize:function(){
this.iframe.style.height=(this.iframe.contentWindow.document.body.scrollHeight+5)+"px";
},getParentNode:function(){
return this._parentNode;
},getModel:function(){
return this._attachmentModel;
},getType:function(){
switch(this.getModel().getType()){
case "image/png":
case "image/jpeg":
case "application/x-shockwave-flash":
case "image/bmp":
case "image/gif":
case "Image/jpeg":
case "image/pjpeg":
case "image/png":
case "image/tiff":
case "image/x-png":
return "image";
case "text/html":
return "html";
case "application/pdf":
return "pdf";
case "application/zip":
case "application/rar":
case "application/x-gzip":
case "application/x-zip":
case "application/x-zip-compressed":
case "application/zip":
case "archive/zip":
return "archive";
case "application/binary":
case "application/octet-stream":
case "application/download":
case "application/force-download":
case "application/x-msdos-program":
return "binary";
case "application/csv":
case "application/msword":
case "application/rtf":
case "application/text":
case "application/vnd.oasis.opendocument.text":
return "text";
case "application/ms-excel":
case "application/vnd.ms-excel":
return "spreadsheet";
case "application/x-javascript":
case "application/x-js":
return "script";
default:
return "text";
}
},getHumanSize:function(){
var size=this.getModel().getSize();
if(parseInt(size/1024)<1){
return size+" B";
}else{
size=parseInt(size/1024);
}
if(parseInt(size/1024)<1){
return size+" KB";
}else{
size=parseInt(size/1024);
}
if(parseInt(size/1024)<1){
return size+" MB";
}else{
size=parseInt(size/1024);
}
if(parseInt(size/1024)<1){
return size+" GB";
}else{
size=parseInt(size/1024);
}
return size+" TB";
}});
dojo.provide("app.widget.BodyFrame");
dojo.require("app.widget.Widget");
dojo.require("dojo.io.IframeIO");
dojo.lang.declare("app.widget.BodyFrame",app.widget.Widget,function(_f81){
this.isLoaded=false;
this._backupValue="";
this._attachments=new Array();
this.create();
this.connect();
},{create:function(){
this.iframeNode=document.createElement(dojo.render.html.ie?"<iframe src='about:blank' border='0' frameborder='0' onload=\"this.onready();\" />":"iframe");
if(!dojo.render.html.ie){
this.iframeNode.src="about:blank";
}else{
this.iframeNode.onready=function(){
};
}
this.setDomNode(this.iframeNode);
},connect:function(){
dojo.event.connectOnce(this.iframeNode,dojo.render.html.ie?"onready":"onload",this,"onLoad");
},onLoad:function(){
this.isLoaded=true;
this.setValue(this._backupValue);
this.linkImagesToAttachments(this._attachments);
},setHeight:function(){
this.iframeNode.style.height=(this.iframeNode.contentWindow.document.body.scrollHeight+20)+"px";
},setValue:function(_f82){
if(this.isLoaded){
this.iframeNode.contentWindow.document.body.innerHTML=_f82;
this.addTargetToLinks();
this.linkImagesToAttachments();
if(dojo.render.html.ie){
this.timeoutId=dojo.lang.setTimeout(this,"setHeight",100);
}else{
this.setHeight();
}
}else{
this._backupValue=_f82;
}
},addTargetToLinks:function(){
var _f83=this.iframeNode.contentWindow.document.body.getElementsByTagName("a");
for(var i=0;i<_f83.length;i++){
_f83[i].target="_blank";
}
},linkImagesToAttachments:function(_f85){
if(this.isLoaded&&_f85!=null){
this.resolveElementPath(this.iframeNode.contentWindow.document.body.getElementsByTagName("img"),_f85);
if(this.resolveElementPath(this.iframeNode.contentWindow.document.body.getElementsByTagName("embed"),_f85)){
this.setValue(this.iframeNode.contentWindow.document.body.innerHTML+" ");
}
this.setHeight();
}else{
if(_f85!=null){
this._attachments=_f85;
}
}
},resolveElementPath:function(_f86,_f87){
var re=new RegExp("cid:(.*?)");
var _f89=false;
for(var i=0;i<_f86.length;i++){
if(_f86[i].src.indexOf("cid:")!==false){
var myId=_f86[i].src.substring(4,_f86[i].src.length);
for(var j=0;j<_f87.length;j++){
if(myId==_f87[j].getFilename()||myId==_f87[j].getContentId()){
_f86[i].src=quConfig.applicationURL+"server/download.php?download_type=direct&attachment_id="+_f87[j].getId();
_f89=true;
}
}
}
}
return _f89;
},getValue:function(){
return this.iframeNode.contentWindow.document.body.innerHTML;
}});
dojo.provide("app.widget.Email");
dojo.require("dojo.io.cookie");
dojo.require("app.widget.Widget");
dojo.require("app.widget.Attachment");
dojo.require("app.widget.BodyFrame");
dojo.lang.declare("app.widget.Email",app.widget.Widget,function(_f8d,_f8e){
this.setParent(_f8e);
this.setModel(_f8d);
this.create();
this.refresh();
this.connect();
this.setExpanded(false);
this.setBodyLoaded(false);
this._showDetails=false;
},{setParent:function(_f8f){
this._parent=_f8f;
},getParent:function(){
return this._parent;
},setModel:function(_f90){
this._model=_f90;
},getModel:function(){
return this._model;
},setExpanded:function(_f91){
this._expanded=_f91;
},isExpanded:function(){
return this._expanded;
},setBodyLoaded:function(_f92){
this._bodyLoaded=_f92;
},isBodyLoaded:function(){
return this._bodyLoaded;
},setBodyMode:function(_f93){
this._bodyMode=_f93;
dojo.io.cookie.setCookie("emailBodyMode",_f93,365);
},getBodyMode:function(){
if(this._bodyMode==null){
var _f94=app.config.getCookie("emailBodyMode");
if(_f94==null||_f94.length==0||(_f94!="html"&&_f94!="text")){
this._bodyMode="html";
}else{
this._bodyMode=_f94;
}
}
return this._bodyMode;
},create:function(){
var usr="";
if(this.getModel().getIsComment()=="y"){
usr="_c";
}else{
if(this.getModel().getWroteByUser()!=null&&(this.getModel().getWroteByUser().getType()=="a"||this.getModel().getWroteByUser().getType()=="g")){
usr="_a";
}
}
var _f96=document.createElement("div");
if(usr=="_c"){
_f96.style.backgroundColor="#cccc99";
}else{
if(usr=="_a"){
_f96.style.backgroundColor="#FFF7D7";
}else{
_f96.style.backgroundColor="white";
}
}
_f96.className="quEmail";
this.setDomNode(_f96);
var tr=document.createElement("div");
tr.style.background="url('app/web/images/corners/editTicket"+usr+"_8x8_tr.png') no-repeat top right";
var tl=document.createElement("img");
tl.src="app/web/images/corners/editTicket"+usr+"_8x8_tl.png";
tl.style.width="8px";
tl.style.height="8px";
tl.style.border="none";
tl.style.display="block";
tr.appendChild(tl);
_f96.appendChild(tr);
this.headerNode=document.createElement("div");
this.headerNode.className="header";
this.headerNode.style._height="1%";
_f96.appendChild(this.headerNode);
var _f99=document.createElement("table");
_f99.style.width="100%";
var _f9a=document.createElement("tbody");
_f99.appendChild(_f9a);
var hTr=document.createElement("tr");
_f9a.appendChild(hTr);
var _f9c=document.createElement("td");
hTr.appendChild(_f9c);
var _f9d=document.createElement("td");
_f9d.style.textAlign="right";
hTr.appendChild(_f9d);
this.headerNode.appendChild(_f99);
this.fromNode=document.createElement("span");
this.fromNode.className="from";
this.subjectNode=document.createElement("span");
this.subjectNode.className="subject";
this.rightPaneNode=document.createElement("div");
this.rightPaneNode.className="rightPane";
this.receivedNode=document.createElement("span");
this.receivedNode.className="received";
this.answeredNode=document.createElement("img");
this.answeredNode.className="answered";
this.answeredNode.style.display="none";
this.answeredNode.title=app.i18n.get("notAnswered");
this.answeredNode.src=qu.global.icon("flag.gif",16);
this.notDeliveredTxtNode=document.createElement("span");
this.notDeliveredTxtNode.className="notdelivered";
this.notDeliveredNode=document.createElement("img");
this.notDeliveredNode.className="notdelivered";
this.notDeliveredNode.style.display="none";
this.notDeliveredNode.title=app.i18n.get("notDeliveredYet");
this.notDeliveredNode.src=qu.global.icon("important.png",16);
this.rightPaneNode.appendChild(this.receivedNode);
this.rightPaneNode.appendChild(this.answeredNode);
this.rightPaneNode.appendChild(this.notDeliveredNode);
this.rightPaneNode.appendChild(this.notDeliveredTxtNode);
_f9c.appendChild(this.fromNode);
_f9c.appendChild(this.subjectNode);
_f9d.appendChild(this.rightPaneNode);
this.detailsNode=document.createElement("div");
this.detailsNode.className="details";
this.detailsNode.style.display="none";
_f96.appendChild(this.detailsNode);
this.headersNode=document.createElement("div");
this.headersNode.className="headers";
this.headersNode.style.display="none";
_f96.appendChild(this.headersNode);
this.toolbarNode=document.createElement("div");
this.toolbarNode.className="toolbar";
this.toolbarNode.style.display="none";
_f96.appendChild(this.toolbarNode);
var _f9e=function(_f9f,_fa0){
var _fa1=document.createElement("div");
_fa1.style.display="inline";
_fa1.className="button";
var img=document.createElement("img");
img.src=qu.global.icon(_f9f+".png",16);
img.style.width="16px";
img.style.height="16px";
img.style.verticalAlign="middle";
img.style.marginRight="3px";
var _fa3=document.createElement("span");
_fa3.innerHTML=_fa0;
_fa3.style.fontWeight="bold";
_fa1.appendChild(img);
_fa1.appendChild(_fa3);
return _fa1;
};
this.cmdReplyNode=_f9e("mail-reply",app.i18n.get("reply"));
this.cmdReplyAllNode=_f9e("mail-reply-all",app.i18n.get("replyAll"));
this.cmdReplyQuoteNode=_f9e("mail-reply",app.i18n.get("replyQuote"));
this.cmdReplyQuoteAllNode=_f9e("mail-reply-all",app.i18n.get("replyQuoteAll"));
this.cmdForwardNode=_f9e("mail-forward",app.i18n.get("forward"));
this.cmdAddCommentNode=_f9e("comment",app.i18n.get("addComment"));
this.cmdMoveMailToNewTicket=_f9e("2rightarrow",app.i18n.get("moveToNewTicket"));
if(qu.user.isUser()){
this.cmdForwardNode.style.display="none";
this.cmdAddCommentNode.style.display="none";
this.cmdReplyAllNode.style.display="none";
this.cmdReplyQuoteAllNode.style.display="none";
this.cmdMoveMailToNewTicket.style.display="none";
}
if(qu.user.isUser()||this.getParent().getEmailsCount()<2){
this.cmdMoveMailToNewTicket.style.display="none";
}
this.showHeadersNode=document.createElement("div");
this.showHeadersNode.className="showheaders";
this.showHeadersNode.innerHTML=app.i18n.get("showHeaders");
this.toolbarNode.appendChild(this.cmdReplyNode);
this.toolbarNode.appendChild(this.cmdReplyAllNode);
this.toolbarNode.appendChild(this.cmdReplyQuoteNode);
this.toolbarNode.appendChild(this.cmdReplyQuoteAllNode);
this.toolbarNode.appendChild(this.cmdForwardNode);
this.toolbarNode.appendChild(this.cmdAddCommentNode);
this.toolbarNode.appendChild(this.cmdMoveMailToNewTicket);
this.toolbarNode.appendChild(this.showHeadersNode);
this.bodyNode=document.createElement("div");
this.bodyNode.style.display="none";
this.bodyNode.className="body";
_f96.appendChild(this.bodyNode);
this.htmlBodyNode=new app.widget.BodyFrame();
this.htmlBodyNode.getDomNode().style.display="none";
this.htmlBodyNode.getDomNode().style.width="100%";
this.htmlBodyNode.getDomNode().style.border="none";
_f96.appendChild(this.htmlBodyNode.getDomNode());
this.attDetailsNode=document.createElement("div");
this.attDetailsNode.style.display="none";
this.attDetailsNode.className="attDetails";
_f96.appendChild(this.attDetailsNode);
this.footerNode=document.createElement("div");
this.footerNode.className="footer";
_f96.appendChild(this.footerNode);
this.attachmentImage=document.createElement("img");
this.attachmentImage.src="app/web/images/attachment.gif";
this.attachmentImage.style.display="none";
this.attachmentImage.className="attachmentImage";
this.attachmentImage.title=app.i18n.get("clickToSeeDetails");
this.attachmentsNode=document.createElement("span");
this.attachmentsNode.className="attachments";
this.footerNode.appendChild(this.attachmentImage);
this.footerNode.appendChild(this.attachmentsNode);
this.notAnsweredNode=document.createElement("span");
this.notAnsweredNode.className="notAnswered";
this.footerNode.appendChild(this.notAnsweredNode);
this.bodyStyleNode=document.createElement("a");
this.bodyStyleNode.className="blue";
this.bodyStyleNode.style.textAlign="right";
this.bodyStyleNode.style.display="none";
this.bodyStyleNode.style.marginRight="5px";
this.bodyStyleNode.style.cursor="pointer";
this.bodyStyleNode.style.textDecoration="underline";
this.bodyStyleNode.style.color="#000000";
this.bodyStyleNode.innerHTML=this.getBodyMode()=="text"?app.i18n.get("showHtml"):app.i18n.get("showText");
this.footerNode.appendChild(this.bodyStyleNode);
var br=document.createElement("div");
br.style.background="url('app/web/images/corners/editTicket"+usr+"_8x8_br.png') no-repeat bottom right";
var bl=document.createElement("img");
bl.src="app/web/images/corners/editTicket"+usr+"_8x8_bl.png";
bl.style.width="8px";
bl.style.height="8px";
bl.style.border="none";
bl.style.display="block";
br.appendChild(bl);
_f96.appendChild(br);
},connect:function(){
dojo.event.connectOnce(this.subjectNode,"onclick",this,"onSubjectClick");
dojo.event.connectOnce(this.fromNode,"onclick",this,"onSubjectClick");
dojo.event.connectOnce(this.attachmentImage,"onclick",this,"onAttachmentsDetail");
if(this.getModel().getAttachments().length>1){
dojo.event.connectOnce(this.attachmentsNode,"onclick",this,"onAttachmentsDetail");
}
dojo.event.connectOnce(this.cmdForwardNode,"onclick",this,"onForward");
dojo.event.connectOnce(this.cmdAddCommentNode,"onclick",this,"onAddComment");
dojo.event.connectOnce(this.cmdMoveMailToNewTicket,"onclick",this,"onMoveToNewTicket");
dojo.event.connectOnce(this.cmdReplyNode,"onclick",this,"onReply");
dojo.event.connectOnce(this.cmdReplyAllNode,"onclick",this,"onReplyAll");
dojo.event.connectOnce(this.cmdReplyQuoteNode,"onclick",this,"onReplyQuote");
dojo.event.connectOnce(this.cmdReplyQuoteAllNode,"onclick",this,"onReplyQuoteAll");
dojo.event.connectOnce(this.showHeadersNode,"onclick",this,"onShowHeadersClick");
dojo.event.connectOnce(this.bodyStyleNode,"onclick",this,"onChangeBodyStyleClick");
},onChangeBodyStyleClick:function(){
if(this.bodyStyleNode.innerHTML==app.i18n.get("showHtml")){
this.setBodyMode("html");
}else{
this.setBodyMode("text");
}
this.showBody();
},showBody:function(){
if(this.getBodyMode()=="html"){
this.bodyStyleNode.innerHTML=app.i18n.get("showText");
this.bodyNode.style.display="none";
this.htmlBodyNode.getDomNode().style.display="block";
this.htmlBodyNode.setValue(this.getModel().getHtmlBody());
this.htmlBodyNode.linkImagesToAttachments(this.getModel().getAttachments());
}else{
this.bodyStyleNode.innerHTML=app.i18n.get("showHtml");
this.bodyNode.innerHTML=this.getModel().getBody().replace(/\r?\n/g,"<br/>");
this.htmlBodyNode.getDomNode().style.display="none";
this.bodyNode.style.display="block";
}
},onMoveToNewTicket:function(){
if(confirm(app.i18n.get("ReallyMoveToNewTicket"))){
var _fa6={sid:qu.user.getSid(),ticket_id:this.getParent().getTicketId(),mail_id:this.getModel().getId()};
var _fa7=new qu.rpc.Service("Tickets");
var def=_fa7.moveMailToNewTicket(_fa6);
def.addCallback(this,"onMoveSuccess");
def.addErrback(this,"onMoveFail");
}
},onMoveSuccess:function(_fa9){
app.main.msgBox.print(app.i18n.get("movedToNewTicket")+_fa9);
if(confirm(app.i18n.get("openNowNewTicket"))){
this.getParent().getParent().openTicket(_fa9);
}else{
this.getParent().getParent().openTicket(this.getParent().getSubjectTicketId());
}
},onMoveFail:function(_faa){
app.main.msgBox.print(_faa);
},onShowHeadersClick:function(){
if(this.headersNode.style.display=="block"){
this.setVisibilityOfHeaders(false);
}else{
this.setVisibilityOfHeaders(true);
}
},setVisibilityOfHeaders:function(_fab){
if(!_fab){
this.headersNode.style.display="none";
this.showHeadersNode.innerHTML=app.i18n.get("showHeaders");
}else{
this.showHeadersNode.innerHTML=app.i18n.get("hideHeaders");
this.headersNode.style.display="block";
if(this.headersNode.innerHTML==""){
this.loadHeaders();
}
}
},loadHeaders:function(){
this.headersNode.innerHTML="<div style=\"text-align:center; margin-top:7px;\">"+app.i18n.get("loading")+"<br/><img src=\"lib/style/images/progress.gif\" style=\"vertical-align:middle;\"></div>";
var _fac=new qu.rpc.Service("Mails");
var def=_fac.getMailHeaders({sid:qu.user.getSid(),mail_id:this.getModel().getId()});
def.addCallback(dojo.lang.hitch(this,"onHeadersLoad"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onHeadersLoad:function(_fae){
var text="<table width='100%' style='table-layout: fixed;'>";
for(var i in _fae){
text+="<tr><td style='font-weight: bold;' width='20%'>"+i+"</td><td width='80%' style='overflow: hidden;'>"+_fae[i]+"</td></tr>";
}
text=text+"</table>";
this.headersNode.innerHTML=text;
},refresh:function(){
var _fb1=this.getModel();
if(_fb1.getWroteByUser()!=null){
this.fromNode.innerHTML=this._warning(_fb1.getWroteByUser());
if(_fb1.getWroteByUser().getName()!=""){
this.fromNode.innerHTML+=_fb1.getWroteByUser().getName();
this.fromNode.title=_fb1.getWroteByUser().getEmail();
}else{
this.fromNode.innerHTML+=_fb1.getWroteByUser().getEmail();
}
}else{
this.fromNode.innerHTML="";
}
this.fromNode.innerHTML+=":";
this.subjectNode.innerHTML=_fb1.getSubject();
this.receivedNode.innerHTML=this._getCreated();
var _fb2="<table>"+"<tr>"+"<td class=\"detailLabel\">"+app.i18n.get("from")+": "+"</td>"+"<td>"+this._getFrom()+"</td>"+"</tr>"+"<tr>"+"<td class=\"detailLabel\">"+app.i18n.get("to")+": "+"</td>"+"<td>"+this._getRecipients("To")+"</td>"+"</tr>";
if(this.getModel().getCcUsers().length>0){
_fb2+="<tr>"+"<td class=\"detailLabel\">"+app.i18n.get("cc")+": "+"</td>"+"<td>"+this._getRecipients("Cc")+"</td>"+"</tr>";
}
_fb2+="<tr>"+"<td class=\"detailLabel\">"+app.i18n.get("created")+": "+"</td>"+"<td>"+_fb1.getCreated().print(app.i18n.get("dateTimeFormat"))+"</td>"+"</tr>";
if(_fb1.getDeliveryDate().print(app.i18n.get("dateTimeFormat"))!=_fb1.getCreated().print(app.i18n.get("dateTimeFormat"))){
_fb2+="<tr>"+"<td class=\"detailLabel\">"+app.i18n.get("delivered")+": "+"</td>"+"<td>"+_fb1.getDeliveryDate().print(app.i18n.get("dateTimeFormat"))+"</td>"+"</tr>";
}
_fb2+="</table>";
this.detailsNode.innerHTML=_fb2;
if(_fb1.getAttachments().length==0){
this.attachmentImage.style.display="none";
this.attachmentsNode.style.display="none";
}else{
this.attachmentsNode.innerHTML=this._getFileLabel();
if(_fb1.getAttachments().length>1){
this.attachmentsNode.title=this._getAttachmentsJoin();
this.attachmentImage.title=this._getAttachmentsJoin();
}
this.attachmentImage.style.display="inline";
this.attachmentsNode.style.display="inline";
}
this._getAttDetails(this.attDetailsNode);
this.answeredNode.style.display=this._getNotAnswered();
this.notDeliveredNode.style.display=this._getNotDelivered();
this.notDeliveredTxtNode.innerHTML=this._getDeliveryStatus();
},_getNotDelivered:function(){
var _fb3=this.getModel().getDeliveryStatus();
if(_fb3!="d"){
return "inline";
}
return "none";
},_getDeliveryStatus:function(){
switch(this.getModel().getDeliveryStatus()){
case "d":
return "";
case "p":
return app.i18n.get("deliveryPending");
case "e":
return app.i18n.get("deliveryError");
case "s":
return app.i18n.get("sending");
case "n":
return app.i18n.get("mailDeletedNotDelivered");
default:
return app.i18n.get("unknownDeliveryStatus");
}
},_getNotAnswered:function(){
var _fb4=this.getModel().isAnswered();
if(_fb4=="n"){
return "inline";
}
return "none";
},_getAttDetails:function(_fb5){
var _fb6=this.getModel().getAttachments();
for(var i=0;i<_fb6.length;i++){
var _fb8=new app.widget.Attachment(_fb5,_fb6[i]);
}
},_getFrom:function(){
try{
var from=this.getModel().getFromUser();
var _fba="";
if(from.getId()!=""){
_fba+="<a class=\"openUserInWindow\" href=\""+quConfig.bootFilename+"#uid="+from.getId()+"\" target=\"_blank\" title=\""+app.i18n.get("OpenInNewWindow")+"\">";
}
if(from.getName()!=""){
_fba+=from.getName();
if(from.getEmail()!=""){
_fba+="<span class=\"emailAddress\">&nbsp;&lt;";
}
}
_fba+=from.getEmail();
if(from.getName()!=""&&from.getEmail()!=""){
_fba+="&gt;";
_fba+="</span>";
}
if(from.getId()!=""){
_fba+="</a>";
}
return _fba+this._warning(from);
}
catch(e){
return "";
}
},_warning:function(_fbb){
if(_fbb==null){
return "";
}
var _fbc=function(_fbd){
switch(_fbd){
case -1:
return app.i18n.get("wrongEmailFormat");
case 0:
return app.i18n.get("emailNotValidated");
case 1:
return app.i18n.get("emailFormatOK");
case 2:
return app.i18n.get("emailDomainExists");
case 3:
return app.i18n.get("emailAccountExists");
}
};
var _fbe=_fbb.getQuality();
if(_fbe<2&&_fbe!=0){
return "<img src=\"app/web/images/warning.png\"  style=\"width:12px;height:11px;padding-left:3px;padding-right:3px;\" title=\""+_fbc(_fbe)+"\"/>";
}
return "";
},_getRecipients:function(_fbf){
var to=this.getModel()["get"+_fbf+"Users"]();
var _fc1="";
for(var i=0;i<to.length;i++){
if(to[i].getId()!=""){
_fc1+="<a class=\"openUserInWindow\" href=\""+quConfig.bootFilename+"#uid="+to[i].getId()+"\" target=\"_blank\" title=\""+app.i18n.get("OpenInNewWindow")+"\">";
}
if(to[i].getName()!=""){
_fc1+=to[i].getName();
_fc1+="<span class=\"emailAddress\">&nbsp;&lt;";
}
_fc1+=to[i].getEmail();
if(to[i].getName()!=""){
_fc1+="&gt;";
_fc1+="</span>";
}
if(to[i].getId()!=""){
_fc1+="</a>";
}
_fc1+=this._warning(to[i]);
if(i!=to.length-1){
_fc1+="<br/>";
}
}
return _fc1;
},_getCreated:function(){
var date=this.getModel().getCreated();
return date.print("%b %e, %Y")+" ("+date.getHumanTime(date)+")";
},_getFileLabel:function(){
var _fc4=this.getModel().getAttachments();
var _fc5="";
if(_fc4.length==1){
_fc5="<a href=\"../server/download.php?attachment_id="+_fc4[0].getId();
_fc5+="\" title=\""+app.i18n.get("clickToDownload")+"\">";
_fc5+=_fc4[0].getFilename();
_fc5+=" ("+parseInt(_fc4[0].getSize()/1024)+"K)";
_fc5+="</a>";
}else{
if(_fc4.length>1){
_fc5=_fc4.length+"&nbsp;"+app.i18n.get("files");
_fc5+=" ("+parseInt(this._getAttachmentsSize()/1024)+"K)";
}
}
return _fc5;
},_getAttachmentsSize:function(){
var _fc6=this.getModel().getAttachments();
var len=_fc6.length;
var size=0;
for(i=0;i<len;i++){
size+=_fc6[i].getSize();
}
return size;
},_getAttachmentsJoin:function(){
var _fc9=this.getModel().getAttachments();
var len=_fc9.length;
var _fcb="";
for(i=0;i<len;i++){
_fcb+=_fc9[i].getFilename();
if(i!=len-1){
_fcb+=", ";
}
}
return _fcb;
},onSubjectClick:function(){
if(this.isExpanded()){
this.setVisibilityOfHeaders(false);
this.collapse();
this.setShowAttachments(false);
return;
}
this.expandBody();
},expandBody:function(){
if(this.isBodyLoaded()){
this.expand();
return;
}
this.loadBody();
},loadBody:function(){
if(this.getModel().getBody().length>0){
this.showBody();
this.setShowAttachments(true);
this.setBodyLoaded(true);
this.expandBody();
}else{
this.bodyNode.innerHTML="<div style=\"text-align:center; margin-top:7px;\">"+app.i18n.get("loading")+"<br/><img src=\"lib/style/images/progress.gif\" style=\"vertical-align:middle;\"></div>";
this.htmlBodyNode.setValue("<div style=\"text-align:center; margin-top:7px;\">"+app.i18n.get("loading")+"<br/><img src=\"lib/style/images/progress.gif\" style=\"vertical-align:middle;\"></div>");
this.expand();
var _fcc=new qu.rpc.Service("Mails");
var def=_fcc.getMailBody({sid:qu.user.getSid(),mail_id:this.getModel().getId()});
def.addCallback(dojo.lang.hitch(this,"onBodyLoad"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}
},onBodyLoad:function(_fce){
_fce.first();
this.getModel().setBody(_fce.getString("body").replace(/\r/g,"").replace(/\n/g,"<br/>"));
this.getModel().setHtmlBody(_fce.getString("body_html"));
this.setShowAttachments(true);
this.setBodyLoaded(true);
this.showBody();
},expand:function(){
this.setShowDetails(true);
this.setShowToolbar(true);
if(this.getBodyMode()=="html"){
this.bodyNode.style.display="none";
this.htmlBodyNode.getDomNode().style.display="block";
}else{
this.bodyNode.style.display="block";
this.htmlBodyNode.getDomNode().style.display="none";
}
this.bodyStyleNode.style.display="block";
this.setShowAttachments(true);
this.setExpanded(true);
},collapse:function(){
this.setShowDetails(false);
this.setShowToolbar(false);
this.bodyNode.style.display="none";
this.htmlBodyNode.getDomNode().style.display="none";
this.bodyStyleNode.style.display="none";
this.setShowAttachments(false);
this.setExpanded(false);
},onDetails:function(){
this.setShowDetails(!this.isShowDetails());
},setShowDetails:function(_fcf){
if(_fcf==true){
this.detailsNode.style.display="block";
this._showDetails=true;
}else{
this.detailsNode.style.display="none";
this._showDetails=false;
}
},isShowDetails:function(){
return this._showDetails;
},setShowAttachments:function(_fd0){
if(_fd0==true){
this.attDetailsNode.style.display="block";
this._showAttachments=true;
}else{
this.attDetailsNode.style.display="none";
this._showAttachments=false;
}
},isShowAttachments:function(){
return this._showAttachments;
},setShowToolbar:function(_fd1){
this.toolbarNode.style.display=_fd1?"block":"none";
},onAttachmentsDetail:function(){
this.setShowAttachments(!this.isShowAttachments());
},onForward:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_FORWARD);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},onAddComment:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_COMMENT);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},onReply:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_REPLY);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},onReplyAll:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_REPLY_ALL);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},onReplyQuote:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_REPLY_QUOTE);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},onReplyQuoteAll:function(){
this.getParent().getReply().setMode(app.view.tickets.Reply.MODE_REPLY_ALL_QUOTE);
this.getParent().getReply().setEmailId(this.getModel().getId());
this.showReply();
},showReply:function(){
this.getParent().getReply().setModel(this.getModel());
this.getParent().getReply().setEmailId(this.getModel().getId());
this.getParent().setReplyVisible(true);
},hideToolbar:function(){
this.toolbarNode.style.display="none";
},showToolbar:function(){
this.toolbarNode.style.display="block";
}});
dojo.provide("app.data.HistoryEntry");
dojo.require("app.data.email.User");
dojo.lang.declare("app.data.HistoryEntry",null,function(){
this.setCreatedBy(null);
this.setNewAgent(null);
},{setCreated:function(_fd2){
this.created=_fd2;
},getCreated:function(){
return this.created;
},setCreatedBy:function(_fd3){
this.createdBy=_fd3;
},getCreatedBy:function(){
return this.createdBy;
},setNewAgent:function(_fd4){
this.newAgent=_fd4;
},getNewAgent:function(){
return this.newAgent;
},setNewStatus:function(_fd5){
this.newStatus=_fd5;
},getNewStatus:function(){
return this.newStatus;
},setNewPriority:function(_fd6){
this.newPriority=_fd6;
},getNewPriority:function(){
return this.newPriority;
},setNewQueueName:function(_fd7){
this.queueName=_fd7;
},getNewQueueName:function(){
return this.queueName;
}});
dojo.provide("app.widget.HistoryEntry");
dojo.require("app.widget.Widget");
dojo.lang.declare("app.widget.HistoryEntry",app.widget.Widget,function(_fd8,_fd9){
this.setParent(_fd9);
this.setModel(_fd8);
this.create();
this.fillFromModel();
this.connect();
},{setParent:function(_fda){
this._parent=_fda;
},getParent:function(){
return this._parent;
},setModel:function(_fdb){
this._model=_fdb;
},getModel:function(){
return this._model;
},addChangedText:function(_fdc){
if(this.changesNode.innerHTML.length>0){
this.changesNode.innerHTML+=", ";
}
this.changesNode.innerHTML+=_fdc;
},fillFromModel:function(){
this.createdNode.innerHTML=this.getModel().getCreated().print(app.i18n.get("dateTimeFormat"));
if(this.getModel().getCreatedBy()!=null){
if(this.getModel().getCreatedBy().getName().length>0){
this.createdByNode.innerHTML=this.getModel().getCreatedBy().getName();
}else{
this.createdByNode.innerHTML=this.getModel().getCreatedBy().getEmail();
}
}else{
this.createdByNode.innerHTML=app.i18n.get("createdByServer");
}
if(this.getModel().getNewStatus()!=""){
var _fdd=app.main.hashMaps.getStatuses();
this.addChangedText(app.i18n.get("newStatus")+_fdd.entry(this.getModel().getNewStatus()));
}
if(this.getModel().getNewAgent()!=null&&this.getModel().getNewAgent()!="null"){
if(this.getModel().getNewAgent().getName().length>0){
this.addChangedText(app.i18n.get("newAgent")+this.getModel().getNewAgent().getName());
}else{
this.addChangedText(app.i18n.get("newAgent")+this.getModel().getNewAgent().getEmail());
}
}
if(this.getModel().getNewQueueName()!=null&&this.getModel().getNewQueueName().length>0&&this.getModel().getNewQueueName()!="null"){
this.addChangedText(app.i18n.get("newQueue")+this.getModel().getNewQueueName());
}
if(parseInt(this.getModel().getNewPriority())>0&&this.getModel().getNewPriority()!=null&&this.getModel().getNewPriority()!="null"){
var _fde=app.main.hashMaps.getPriorities();
this.addChangedText(app.i18n.get("newPriority")+_fde.entry(this.getModel().getNewPriority()));
}
},create:function(){
var _fdf=document.createElement("div");
_fdf.className="historyentry";
this.setDomNode(_fdf);
this.createdNode=document.createElement("span");
this.createdNode.className="created";
this.createdByNode=document.createElement("span");
this.createdByNode.className="createdby";
this.changesNode=document.createElement("span");
this.changesNode.className="changes";
_fdf.appendChild(this.createdNode);
_fdf.appendChild(this.createdByNode);
_fdf.appendChild(this.changesNode);
},connect:function(){
},setCreated:function(_fe0){
this.createdNode.innerHTML=_fe0.toString();
},setCreatedBy:function(_fe1){
this.createdByNode.innerHTML=_fe1;
}});
dojo.provide("app.widget.Uploaded");
dojo.require("app.widget.Widget");
dojo.require("dojo.io.IframeIO");
dojo.lang.declare("app.widget.Uploaded",app.widget.Widget,function(_fe2,_fe3,_fe4,_fe5){
this._parentNode=_fe2;
this._deleted=false;
this._inProgress=false;
this._uploaded=true;
this._result=null;
this._attachment=_fe3;
if(_fe5!==false){
_fe5=true;
}
this._hasCheckbox=_fe5;
if(_fe4==null){
_fe4="";
}
this._queryString=_fe4;
this.create();
this.connect();
this._connectedEditor=null;
},{create:function(){
var _fe6=document.createElement("div");
_fe6.className="quAttachment";
this.setDomNode(_fe6);
this.uploadedNode=document.createElement("div");
this.uploadedNode.style.display="none";
if(this._hasCheckbox){
this.checkboxNode=document.createElement("input");
this.checkboxNode.setAttribute("type","checkbox");
this.checkboxNode.style.verticalAlign="middle";
}
this.fileInfoNode=document.createElement("a");
this.fileInfoNode.setAttribute("title",app.i18n.get("clickToDownload"));
this.fileInfoNode.className="fileInfo";
if(this._hasCheckbox){
this.uploadedNode.appendChild(this.checkboxNode);
this.checkboxNode.checked=true;
}
this.uploadedNode.appendChild(this.fileInfoNode);
this.fileInfoNode.innerHTML=this.getAttachment().getFilename();
var _fe7=dojo.lang.hitch(this,function(_fe8){
_fe8=parseInt(_fe8);
if(_fe8<1024){
return _fe8+" B";
}
if(_fe8>1024&&_fe8<1048576){
return (Math.round(this.getAttachment().getSize()/1024))+" kB";
}
return (Math.round(this.getAttachment().getSize()/1048576*10)/10)+" MB";
});
this.fileInfoNode.innerHTML+=" ("+_fe7(this.getAttachment().getSize())+") ";
this.fileInfoNode.setAttribute("href","../server/download.php?attachment_id="+this.getAttachment().getId()+this._queryString);
this.uploadedNode.style.display="block";
this.imgUseAttachment=document.createElement("img");
this.imgUseAttachment.style.display="none";
this.imgUseAttachment.title=app.i18n.get("insertToText");
this.imgUseAttachment.src=qu.global.icon("insert-table-row.png",16);
spaceTag=document.createElement("span");
spaceTag.innerHTML="&nbsp;";
this.uploadedNode.appendChild(spaceTag);
this.uploadedNode.appendChild(this.imgUseAttachment);
_fe6.appendChild(this.uploadedNode);
this.getParentNode().appendChild(this.getDomNode());
},getHash:function(){
return this.getAttachment().getId();
},connect:function(){
dojo.event.connectOnce(this.imgUseAttachment,"onclick",this,"onAddToTextClick");
},getParentNode:function(){
return this._parentNode;
},getAttachment:function(){
return this._attachment;
},isDeleted:function(){
return this._deleted;
},setDeleted:function(_fe9){
this._deleted=_fe9;
},isInProgress:function(){
return false;
},isUploaded:function(){
return true;
},isChecked:function(){
if(this._hasCheckbox){
return this.checkboxNode.checked;
}else{
return false;
}
},setChecked:function(_fea){
if(this._hasCheckbox){
this.checkboxNode.checked=_fea;
}
},setEditor:function(_feb){
this._connectedEditor=_feb;
if(this.getEditor()!=null){
this.imgUseAttachment.style.display="inline";
}
},getEditor:function(){
return this._connectedEditor;
},getHtmlRepresentation:function(){
if(this.getAttachment().getType().substr(0,5)=="image"){
return "<img src='"+quConfig.applicationURL+"server/download.php?download_type=simple&attachment_id="+this.getAttachment().getId()+"' border='0' />";
}else{
return "<a href='"+quConfig.applicationURL+"server/download.php?attachment_id="+this.getAttachment().getId()+"'>"+this.getAttachment().getFilename()+"</a>";
}
},onAddToTextClick:function(){
if(this.getEditor()!=null){
this.getEditor().replaceSelection(this.getHtmlRepresentation());
}
}});
dojo.provide("dojo.widget.TreeNode");
dojo.require("dojo.html.*");
dojo.require("dojo.event.*");
dojo.require("dojo.io.*");
dojo.widget.defineWidget("dojo.widget.TreeNode",dojo.widget.HtmlWidget,function(){
this.actionsDisabled=[];
},{widgetType:"TreeNode",loadStates:{UNCHECKED:"UNCHECKED",LOADING:"LOADING",LOADED:"LOADED"},actions:{MOVE:"MOVE",REMOVE:"REMOVE",EDIT:"EDIT",ADDCHILD:"ADDCHILD"},isContainer:true,lockLevel:0,templateString:("<div class=\"dojoTreeNode\"> "+"<span treeNode=\"${this.widgetId}\" class=\"dojoTreeNodeLabel\" dojoAttachPoint=\"labelNode\"> "+"\t\t<span dojoAttachPoint=\"titleNode\" dojoAttachEvent=\"onClick: onTitleClick\" class=\"dojoTreeNodeLabelTitle\">${this.title}</span> "+"</span> "+"<span class=\"dojoTreeNodeAfterLabel\" dojoAttachPoint=\"afterLabelNode\">${this.afterLabel}</span> "+"<div dojoAttachPoint=\"containerNode\" style=\"display:none\"></div> "+"</div>").replace(/(>|<)\s+/g,"$1"),childIconSrc:"",childIconFolderSrc:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/closed.gif"),childIconDocumentSrc:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/document.gif"),childIcon:null,isTreeNode:true,objectId:"",afterLabel:"",afterLabelNode:null,expandIcon:null,title:"",object:"",isFolder:false,labelNode:null,titleNode:null,imgs:null,expandLevel:"",tree:null,depth:0,isExpanded:false,state:null,domNodeInitialized:false,isFirstChild:function(){
return this.getParentIndex()==0?true:false;
},isLastChild:function(){
return this.getParentIndex()==this.parent.children.length-1?true:false;
},lock:function(){
return this.tree.lock.apply(this,arguments);
},unlock:function(){
return this.tree.unlock.apply(this,arguments);
},isLocked:function(){
return this.tree.isLocked.apply(this,arguments);
},cleanLock:function(){
return this.tree.cleanLock.apply(this,arguments);
},actionIsDisabled:function(_fec){
var _fed=this;
var _fee=false;
if(this.tree.strictFolders&&_fec==this.actions.ADDCHILD&&!this.isFolder){
_fee=true;
}
if(dojo.lang.inArray(_fed.actionsDisabled,_fec)){
_fee=true;
}
if(this.isLocked()){
_fee=true;
}
return _fee;
},getInfo:function(){
var info={widgetId:this.widgetId,objectId:this.objectId,index:this.getParentIndex(),isFolder:this.isFolder};
return info;
},initialize:function(args,frag){
this.state=this.loadStates.UNCHECKED;
for(var i=0;i<this.actionsDisabled.length;i++){
this.actionsDisabled[i]=this.actionsDisabled[i].toUpperCase();
}
this.expandLevel=parseInt(this.expandLevel);
},adjustDepth:function(_ff3){
for(var i=0;i<this.children.length;i++){
this.children[i].adjustDepth(_ff3);
}
this.depth+=_ff3;
if(_ff3>0){
for(var i=0;i<_ff3;i++){
var img=this.tree.makeBlankImg();
this.imgs.unshift(img);
dojo.html.insertBefore(this.imgs[0],this.domNode.firstChild);
}
}
if(_ff3<0){
for(var i=0;i<-_ff3;i++){
this.imgs.shift();
dojo.html.removeNode(this.domNode.firstChild);
}
}
},markLoading:function(){
this._markLoadingSavedIcon=this.expandIcon.src;
this.expandIcon.src=this.tree.expandIconSrcLoading;
},unMarkLoading:function(){
if(!this._markLoadingSavedIcon){
return;
}
var im=new Image();
im.src=this.tree.expandIconSrcLoading;
if(this.expandIcon.src==im.src){
this.expandIcon.src=this._markLoadingSavedIcon;
}
this._markLoadingSavedIcon=null;
},setFolder:function(){
dojo.event.connect(this.expandIcon,"onclick",this,"onTreeClick");
this.expandIcon.src=this.isExpanded?this.tree.expandIconSrcMinus:this.tree.expandIconSrcPlus;
this.isFolder=true;
},createDOMNode:function(tree,_ff8){
this.tree=tree;
this.depth=_ff8;
this.imgs=[];
for(var i=0;i<this.depth+1;i++){
var img=this.tree.makeBlankImg();
this.domNode.insertBefore(img,this.labelNode);
this.imgs.push(img);
}
this.expandIcon=this.imgs[this.imgs.length-1];
this.childIcon=this.tree.makeBlankImg();
this.imgs.push(this.childIcon);
dojo.html.insertBefore(this.childIcon,this.titleNode);
if(this.children.length||this.isFolder){
this.setFolder();
}else{
this.state=this.loadStates.LOADED;
}
dojo.event.connect(this.childIcon,"onclick",this,"onIconClick");
for(var i=0;i<this.children.length;i++){
this.children[i].parent=this;
var node=this.children[i].createDOMNode(this.tree,this.depth+1);
this.containerNode.appendChild(node);
}
if(this.children.length){
this.state=this.loadStates.LOADED;
}
this.updateIcons();
this.domNodeInitialized=true;
dojo.event.topic.publish(this.tree.eventNames.createDOMNode,{source:this});
return this.domNode;
},onTreeClick:function(e){
dojo.event.topic.publish(this.tree.eventNames.treeClick,{source:this,event:e});
},onIconClick:function(e){
dojo.event.topic.publish(this.tree.eventNames.iconClick,{source:this,event:e});
},onTitleClick:function(e){
dojo.event.topic.publish(this.tree.eventNames.titleClick,{source:this,event:e});
},markSelected:function(){
dojo.html.addClass(this.titleNode,"dojoTreeNodeLabelSelected");
},unMarkSelected:function(){
dojo.html.removeClass(this.titleNode,"dojoTreeNodeLabelSelected");
},updateExpandIcon:function(){
if(this.isFolder){
this.expandIcon.src=this.isExpanded?this.tree.expandIconSrcMinus:this.tree.expandIconSrcPlus;
}else{
this.expandIcon.src=this.tree.blankIconSrc;
}
},updateExpandGrid:function(){
if(this.tree.showGrid){
if(this.depth){
this.setGridImage(-2,this.isLastChild()?this.tree.gridIconSrcL:this.tree.gridIconSrcT);
}else{
if(this.isFirstChild()){
this.setGridImage(-2,this.isLastChild()?this.tree.gridIconSrcX:this.tree.gridIconSrcY);
}else{
this.setGridImage(-2,this.isLastChild()?this.tree.gridIconSrcL:this.tree.gridIconSrcT);
}
}
}else{
this.setGridImage(-2,this.tree.blankIconSrc);
}
},updateChildGrid:function(){
if((this.depth||this.tree.showRootGrid)&&this.tree.showGrid){
this.setGridImage(-1,(this.children.length&&this.isExpanded)?this.tree.gridIconSrcP:this.tree.gridIconSrcC);
}else{
if(this.tree.showGrid&&!this.tree.showRootGrid){
this.setGridImage(-1,(this.children.length&&this.isExpanded)?this.tree.gridIconSrcZ:this.tree.blankIconSrc);
}else{
this.setGridImage(-1,this.tree.blankIconSrc);
}
}
},updateParentGrid:function(){
var _fff=this.parent;
for(var i=0;i<this.depth;i++){
var idx=this.imgs.length-(3+i);
var img=(this.tree.showGrid&&!_fff.isLastChild())?this.tree.gridIconSrcV:this.tree.blankIconSrc;
this.setGridImage(idx,img);
_fff=_fff.parent;
}
},updateExpandGridColumn:function(){
if(!this.tree.showGrid){
return;
}
var _this=this;
var icon=this.isLastChild()?this.tree.blankIconSrc:this.tree.gridIconSrcV;
dojo.lang.forEach(_this.getDescendants(),function(node){
node.setGridImage(_this.depth,icon);
});
this.updateExpandGrid();
},updateIcons:function(){
this.imgs[0].style.display=this.tree.showRootGrid?"inline":"none";
this.buildChildIcon();
this.updateExpandGrid();
this.updateChildGrid();
this.updateParentGrid();
dojo.profile.stop("updateIcons");
},buildChildIcon:function(){
if(this.childIconSrc){
this.childIcon.src=this.childIconSrc;
}
this.childIcon.style.display=this.childIconSrc?"inline":"none";
},setGridImage:function(idx,src){
if(idx<0){
idx=this.imgs.length+idx;
}
this.imgs[idx].style.backgroundImage="url("+src+")";
},updateIconTree:function(){
this.tree.updateIconTree.call(this);
},expand:function(){
if(this.isExpanded){
return;
}
if(this.children.length){
this.showChildren();
}
this.isExpanded=true;
this.updateExpandIcon();
dojo.event.topic.publish(this.tree.eventNames.expand,{source:this});
},collapse:function(){
if(!this.isExpanded){
return;
}
this.hideChildren();
this.isExpanded=false;
this.updateExpandIcon();
dojo.event.topic.publish(this.tree.eventNames.collapse,{source:this});
},hideChildren:function(){
this.tree.toggleObj.hide(this.containerNode,this.toggleDuration,this.explodeSrc,dojo.lang.hitch(this,"onHide"));
if(dojo.exists(dojo,"dnd.dragManager.dragObjects")&&dojo.dnd.dragManager.dragObjects.length){
dojo.dnd.dragManager.cacheTargetLocations();
}
},showChildren:function(){
this.tree.toggleObj.show(this.containerNode,this.toggleDuration,this.explodeSrc,dojo.lang.hitch(this,"onShow"));
if(dojo.exists(dojo,"dnd.dragManager.dragObjects")&&dojo.dnd.dragManager.dragObjects.length){
dojo.dnd.dragManager.cacheTargetLocations();
}
},addChild:function(){
return this.tree.addChild.apply(this,arguments);
},doAddChild:function(){
return this.tree.doAddChild.apply(this,arguments);
},edit:function(props){
dojo.lang.mixin(this,props);
if(props.title){
this.titleNode.innerHTML=this.title;
}
if(props.afterLabel){
this.afterLabelNode.innerHTML=this.afterLabel;
}
if(props.childIconSrc){
this.buildChildIcon();
}
},removeNode:function(){
return this.tree.removeNode.apply(this,arguments);
},doRemoveNode:function(){
return this.tree.doRemoveNode.apply(this,arguments);
},toString:function(){
return "["+this.widgetType+" Tree:"+this.tree+" ID:"+this.widgetId+" Title:"+this.title+"]";
}});
dojo.provide("dojo.dnd.TreeDragAndDrop");
dojo.require("dojo.dnd.HtmlDragAndDrop");
dojo.require("dojo.lang.func");
dojo.require("dojo.lang.array");
dojo.require("dojo.lang.extras");
dojo.require("dojo.html.layout");
dojo.dnd.TreeDragSource=function(node,_100a,type,_100c){
this.controller=_100a;
this.treeNode=_100c;
dojo.dnd.HtmlDragSource.call(this,node,type);
};
dojo.inherits(dojo.dnd.TreeDragSource,dojo.dnd.HtmlDragSource);
dojo.lang.extend(dojo.dnd.TreeDragSource,{onDragStart:function(){
var _100d=dojo.dnd.HtmlDragSource.prototype.onDragStart.call(this);
_100d.treeNode=this.treeNode;
_100d.onDragStart=dojo.lang.hitch(_100d,function(e){
this.savedSelectedNode=this.treeNode.tree.selector.selectedNode;
if(this.savedSelectedNode){
this.savedSelectedNode.unMarkSelected();
}
var _100f=dojo.dnd.HtmlDragObject.prototype.onDragStart.apply(this,arguments);
var _1010=this.dragClone.getElementsByTagName("img");
for(var i=0;i<_1010.length;i++){
_1010.item(i).style.backgroundImage="url()";
}
return _100f;
});
_100d.onDragEnd=function(e){
if(this.savedSelectedNode){
this.savedSelectedNode.markSelected();
}
return dojo.dnd.HtmlDragObject.prototype.onDragEnd.apply(this,arguments);
};
return _100d;
},onDragEnd:function(e){
var res=dojo.dnd.HtmlDragSource.prototype.onDragEnd.call(this,e);
return res;
}});
dojo.dnd.TreeDropTarget=function(_1015,_1016,type,_1018){
this.treeNode=_1018;
this.controller=_1016;
dojo.dnd.HtmlDropTarget.apply(this,[_1015,type]);
};
dojo.inherits(dojo.dnd.TreeDropTarget,dojo.dnd.HtmlDropTarget);
dojo.lang.extend(dojo.dnd.TreeDropTarget,{autoExpandDelay:1500,autoExpandTimer:null,position:null,indicatorStyle:"2px black solid",showIndicator:function(_1019){
if(this.position==_1019){
return;
}
this.hideIndicator();
this.position=_1019;
if(_1019=="before"){
this.treeNode.labelNode.style.borderTop=this.indicatorStyle;
}else{
if(_1019=="after"){
this.treeNode.labelNode.style.borderBottom=this.indicatorStyle;
}else{
if(_1019=="onto"){
this.treeNode.markSelected();
}
}
}
},hideIndicator:function(){
this.treeNode.labelNode.style.borderBottom="";
this.treeNode.labelNode.style.borderTop="";
this.treeNode.unMarkSelected();
this.position=null;
},onDragOver:function(e){
var _101b=dojo.dnd.HtmlDropTarget.prototype.onDragOver.apply(this,arguments);
if(_101b&&this.treeNode.isFolder&&!this.treeNode.isExpanded){
this.setAutoExpandTimer();
}
return _101b;
},accepts:function(_101c){
var _101d=dojo.dnd.HtmlDropTarget.prototype.accepts.apply(this,arguments);
if(!_101d){
return false;
}
var _101e=_101c[0].treeNode;
if(dojo.lang.isUndefined(_101e)||!_101e||!_101e.isTreeNode){
dojo.raise("Source is not TreeNode or not found");
}
if(_101e===this.treeNode){
return false;
}
return true;
},setAutoExpandTimer:function(){
var _this=this;
var _1020=function(){
if(dojo.dnd.dragManager.currentDropTarget===_this){
_this.controller.expand(_this.treeNode);
}
};
this.autoExpandTimer=dojo.lang.setTimeout(_1020,_this.autoExpandDelay);
},getDNDMode:function(){
return this.treeNode.tree.DNDMode;
},getAcceptPosition:function(e,_1022){
var _1023=this.getDNDMode();
if(_1023&dojo.widget.Tree.prototype.DNDModes.ONTO&&!(!this.treeNode.actionIsDisabled(dojo.widget.TreeNode.prototype.actions.ADDCHILD)&&_1022.parent!==this.treeNode&&this.controller.canMove(_1022,this.treeNode))){
_1023&=~dojo.widget.Tree.prototype.DNDModes.ONTO;
}
var _1024=this.getPosition(e,_1023);
if(_1024=="onto"||(!this.isAdjacentNode(_1022,_1024)&&this.controller.canMove(_1022,this.treeNode.parent))){
return _1024;
}else{
return false;
}
},onDragOut:function(e){
this.clearAutoExpandTimer();
this.hideIndicator();
},clearAutoExpandTimer:function(){
if(this.autoExpandTimer){
clearTimeout(this.autoExpandTimer);
this.autoExpandTimer=null;
}
},onDragMove:function(e,_1027){
var _1028=_1027[0].treeNode;
var _1029=this.getAcceptPosition(e,_1028);
if(_1029){
this.showIndicator(_1029);
}
},isAdjacentNode:function(_102a,_102b){
if(_102a===this.treeNode){
return true;
}
if(_102a.getNextSibling()===this.treeNode&&_102b=="before"){
return true;
}
if(_102a.getPreviousSibling()===this.treeNode&&_102b=="after"){
return true;
}
return false;
},getPosition:function(e,_102d){
var node=dojo.byId(this.treeNode.labelNode);
var _102f=e.pageY||e.clientY+dojo.body().scrollTop;
var nodey=dojo.html.getAbsolutePosition(node).y;
var _1031=dojo.html.getBorderBox(node).height;
var relY=_102f-nodey;
var p=relY/_1031;
var _1034="";
if(_102d&dojo.widget.Tree.prototype.DNDModes.ONTO&&_102d&dojo.widget.Tree.prototype.DNDModes.BETWEEN){
if(p<=0.3){
_1034="before";
}else{
if(p<=0.7){
_1034="onto";
}else{
_1034="after";
}
}
}else{
if(_102d&dojo.widget.Tree.prototype.DNDModes.BETWEEN){
if(p<=0.5){
_1034="before";
}else{
_1034="after";
}
}else{
if(_102d&dojo.widget.Tree.prototype.DNDModes.ONTO){
_1034="onto";
}
}
}
return _1034;
},getTargetParentIndex:function(_1035,_1036){
var index=_1036=="before"?this.treeNode.getParentIndex():this.treeNode.getParentIndex()+1;
if(this.treeNode.parent===_1035.parent&&this.treeNode.getParentIndex()>_1035.getParentIndex()){
index--;
}
return index;
},onDrop:function(e){
var _1039=this.position;
this.onDragOut(e);
var _103a=e.dragObject.treeNode;
if(!dojo.lang.isObject(_103a)){
dojo.raise("TreeNode not found in dragObject");
}
if(_1039=="onto"){
return this.controller.move(_103a,this.treeNode,0);
}else{
var index=this.getTargetParentIndex(_103a,_1039);
return this.controller.move(_103a,this.treeNode.parent,index);
}
}});
dojo.dnd.TreeDNDController=function(_103c){
this.treeController=_103c;
this.dragSources={};
this.dropTargets={};
};
dojo.lang.extend(dojo.dnd.TreeDNDController,{listenTree:function(tree){
dojo.event.topic.subscribe(tree.eventNames.createDOMNode,this,"onCreateDOMNode");
dojo.event.topic.subscribe(tree.eventNames.moveFrom,this,"onMoveFrom");
dojo.event.topic.subscribe(tree.eventNames.moveTo,this,"onMoveTo");
dojo.event.topic.subscribe(tree.eventNames.addChild,this,"onAddChild");
dojo.event.topic.subscribe(tree.eventNames.removeNode,this,"onRemoveNode");
dojo.event.topic.subscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
},unlistenTree:function(tree){
dojo.event.topic.unsubscribe(tree.eventNames.createDOMNode,this,"onCreateDOMNode");
dojo.event.topic.unsubscribe(tree.eventNames.moveFrom,this,"onMoveFrom");
dojo.event.topic.unsubscribe(tree.eventNames.moveTo,this,"onMoveTo");
dojo.event.topic.unsubscribe(tree.eventNames.addChild,this,"onAddChild");
dojo.event.topic.unsubscribe(tree.eventNames.removeNode,this,"onRemoveNode");
dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
},onTreeDestroy:function(_103f){
this.unlistenTree(_103f.source);
},onCreateDOMNode:function(_1040){
this.registerDNDNode(_1040.source);
},onAddChild:function(_1041){
this.registerDNDNode(_1041.child);
},onMoveFrom:function(_1042){
var _this=this;
dojo.lang.forEach(_1042.child.getDescendants(),function(node){
_this.unregisterDNDNode(node);
});
},onMoveTo:function(_1045){
var _this=this;
dojo.lang.forEach(_1045.child.getDescendants(),function(node){
_this.registerDNDNode(node);
});
},registerDNDNode:function(node){
if(!node.tree.DNDMode){
return;
}
var _1049=null;
var _104a=null;
if(!node.actionIsDisabled(node.actions.MOVE)){
var _1049=new dojo.dnd.TreeDragSource(node.labelNode,this,node.tree.widgetId,node);
this.dragSources[node.widgetId]=_1049;
}
var _104a=new dojo.dnd.TreeDropTarget(node.labelNode,this.treeController,node.tree.DNDAcceptTypes,node);
this.dropTargets[node.widgetId]=_104a;
},unregisterDNDNode:function(node){
if(this.dragSources[node.widgetId]){
dojo.dnd.dragManager.unregisterDragSource(this.dragSources[node.widgetId]);
delete this.dragSources[node.widgetId];
}
if(this.dropTargets[node.widgetId]){
dojo.dnd.dragManager.unregisterDropTarget(this.dropTargets[node.widgetId]);
delete this.dropTargets[node.widgetId];
}
}});
dojo.provide("dojo.widget.TreeBasicController");
dojo.require("dojo.event.*");
dojo.require("dojo.json");
dojo.require("dojo.io.*");
dojo.widget.defineWidget("dojo.widget.TreeBasicController",dojo.widget.HtmlWidget,{widgetType:"TreeBasicController",DNDController:"",dieWithTree:false,initialize:function(args,frag){
if(this.DNDController=="create"){
dojo.require("dojo.dnd.TreeDragAndDrop");
this.DNDController=new dojo.dnd.TreeDNDController(this);
}
},listenTree:function(tree){
dojo.event.topic.subscribe(tree.eventNames.createDOMNode,this,"onCreateDOMNode");
dojo.event.topic.subscribe(tree.eventNames.treeClick,this,"onTreeClick");
dojo.event.topic.subscribe(tree.eventNames.treeCreate,this,"onTreeCreate");
dojo.event.topic.subscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
if(this.DNDController){
this.DNDController.listenTree(tree);
}
},unlistenTree:function(tree){
dojo.event.topic.unsubscribe(tree.eventNames.createDOMNode,this,"onCreateDOMNode");
dojo.event.topic.unsubscribe(tree.eventNames.treeClick,this,"onTreeClick");
dojo.event.topic.unsubscribe(tree.eventNames.treeCreate,this,"onTreeCreate");
dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
},onTreeDestroy:function(_1050){
var tree=_1050.source;
this.unlistenTree(tree);
if(this.dieWithTree){
this.destroy();
}
},onCreateDOMNode:function(_1052){
var node=_1052.source;
if(node.expandLevel>0){
this.expandToLevel(node,node.expandLevel);
}
},onTreeCreate:function(_1054){
var tree=_1054.source;
var _this=this;
if(tree.expandLevel){
dojo.lang.forEach(tree.children,function(child){
_this.expandToLevel(child,tree.expandLevel-1);
});
}
},expandToLevel:function(node,level){
if(level==0){
return;
}
var _105a=node.children;
var _this=this;
var _105c=function(node,_105e){
this.node=node;
this.expandLevel=_105e;
this.process=function(){
for(var i=0;i<this.node.children.length;i++){
var child=node.children[i];
_this.expandToLevel(child,this.expandLevel);
}
};
};
var h=new _105c(node,level-1);
this.expand(node,false,h,h.process);
},onTreeClick:function(_1062){
var node=_1062.source;
if(node.isLocked()){
return false;
}
if(node.isExpanded){
this.collapse(node);
}else{
this.expand(node);
}
},expand:function(node,sync,_1066,_1067){
node.expand();
if(_1067){
_1067.apply(_1066,[node]);
}
},collapse:function(node){
node.collapse();
},canMove:function(child,_106a){
if(child.actionIsDisabled(child.actions.MOVE)){
return false;
}
if(child.parent!==_106a&&_106a.actionIsDisabled(_106a.actions.ADDCHILD)){
return false;
}
var node=_106a;
while(node.isTreeNode){
if(node===child){
return false;
}
node=node.parent;
}
return true;
},move:function(child,_106d,index){
if(!this.canMove(child,_106d)){
return false;
}
var _106f=this.doMove(child,_106d,index);
if(!_106f){
return _106f;
}
if(_106d.isTreeNode){
this.expand(_106d);
}
return _106f;
},doMove:function(child,_1071,index){
child.tree.move(child,_1071,index);
return true;
},canRemoveNode:function(child){
if(child.actionIsDisabled(child.actions.REMOVE)){
return false;
}
return true;
},removeNode:function(node,_1075,_1076){
if(!this.canRemoveNode(node)){
return false;
}
return this.doRemoveNode(node,_1075,_1076);
},doRemoveNode:function(node,_1078,_1079){
node.tree.removeNode(node);
if(_1079){
_1079.apply(dojo.lang.isUndefined(_1078)?this:_1078,[node]);
}
},canCreateChild:function(_107a,index,data){
if(_107a.actionIsDisabled(_107a.actions.ADDCHILD)){
return false;
}
return true;
},createChild:function(_107d,index,data,_1080,_1081){
if(!this.canCreateChild(_107d,index,data)){
return false;
}
return this.doCreateChild.apply(this,arguments);
},doCreateChild:function(_1082,index,data,_1085,_1086){
var _1087=data.widgetType?data.widgetType:"TreeNode";
var _1088=dojo.widget.createWidget(_1087,data);
_1082.addChild(_1088,index);
this.expand(_1082);
if(_1086){
_1086.apply(_1085,[_1088]);
}
return _1088;
}});
dojo.provide("dojo.widget.TreeSelector");
dojo.require("dojo.widget.HtmlWidget");
dojo.widget.defineWidget("dojo.widget.TreeSelector",dojo.widget.HtmlWidget,function(){
this.eventNames={};
this.listenedTrees=[];
},{widgetType:"TreeSelector",selectedNode:null,dieWithTree:false,eventNamesDefault:{select:"select",destroy:"destroy",deselect:"deselect",dblselect:"dblselect"},initialize:function(){
for(var name in this.eventNamesDefault){
if(dojo.lang.isUndefined(this.eventNames[name])){
this.eventNames[name]=this.widgetId+"/"+this.eventNamesDefault[name];
}
}
},destroy:function(){
dojo.event.topic.publish(this.eventNames.destroy,{source:this});
return dojo.widget.HtmlWidget.prototype.destroy.apply(this,arguments);
},listenTree:function(tree){
dojo.event.topic.subscribe(tree.eventNames.titleClick,this,"select");
dojo.event.topic.subscribe(tree.eventNames.iconClick,this,"select");
dojo.event.topic.subscribe(tree.eventNames.collapse,this,"onCollapse");
dojo.event.topic.subscribe(tree.eventNames.moveFrom,this,"onMoveFrom");
dojo.event.topic.subscribe(tree.eventNames.removeNode,this,"onRemoveNode");
dojo.event.topic.subscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
this.listenedTrees.push(tree);
},unlistenTree:function(tree){
dojo.event.topic.unsubscribe(tree.eventNames.titleClick,this,"select");
dojo.event.topic.unsubscribe(tree.eventNames.iconClick,this,"select");
dojo.event.topic.unsubscribe(tree.eventNames.collapse,this,"onCollapse");
dojo.event.topic.unsubscribe(tree.eventNames.moveFrom,this,"onMoveFrom");
dojo.event.topic.unsubscribe(tree.eventNames.removeNode,this,"onRemoveNode");
dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy,this,"onTreeDestroy");
for(var i=0;i<this.listenedTrees.length;i++){
if(this.listenedTrees[i]===tree){
this.listenedTrees.splice(i,1);
break;
}
}
},onTreeDestroy:function(_108d){
this.unlistenTree(_108d.source);
if(this.dieWithTree){
this.destroy();
}
},onCollapse:function(_108e){
if(!this.selectedNode){
return;
}
var node=_108e.source;
var _1090=this.selectedNode.parent;
while(_1090!==node&&_1090.isTreeNode){
_1090=_1090.parent;
}
if(_1090.isTreeNode){
this.deselect();
}
},select:function(_1091){
var node=_1091.source;
var e=_1091.event;
if(this.selectedNode===node){
if(e.ctrlKey||e.shiftKey||e.metaKey){
this.deselect();
return;
}
dojo.event.topic.publish(this.eventNames.dblselect,{node:node});
return;
}
if(this.selectedNode){
this.deselect();
}
this.doSelect(node);
dojo.event.topic.publish(this.eventNames.select,{node:node});
},onMoveFrom:function(_1094){
if(_1094.child!==this.selectedNode){
return;
}
if(!dojo.lang.inArray(this.listenedTrees,_1094.newTree)){
this.deselect();
}
},onRemoveNode:function(_1095){
if(_1095.child!==this.selectedNode){
return;
}
this.deselect();
},doSelect:function(node){
node.markSelected();
this.selectedNode=node;
},deselect:function(){
var node=this.selectedNode;
this.selectedNode=null;
node.unMarkSelected();
dojo.event.topic.publish(this.eventNames.deselect,{node:node});
}});
dojo.provide("dojo.widget.Tree");
dojo.require("dojo.widget.*");
dojo.require("dojo.event.*");
dojo.require("dojo.io.*");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("dojo.widget.TreeNode");
dojo.require("dojo.html.common");
dojo.require("dojo.html.selection");
dojo.widget.defineWidget("dojo.widget.Tree",dojo.widget.HtmlWidget,function(){
this.eventNames={};
this.tree=this;
this.DNDAcceptTypes=[];
this.actionsDisabled=[];
},{widgetType:"Tree",eventNamesDefault:{createDOMNode:"createDOMNode",treeCreate:"treeCreate",treeDestroy:"treeDestroy",treeClick:"treeClick",iconClick:"iconClick",titleClick:"titleClick",moveFrom:"moveFrom",moveTo:"moveTo",addChild:"addChild",removeNode:"removeNode",expand:"expand",collapse:"collapse"},isContainer:true,DNDMode:"off",lockLevel:0,strictFolders:true,DNDModes:{BETWEEN:1,ONTO:2},DNDAcceptTypes:"",templateCssString:"\n.dojoTree {\n\tfont: caption;\n\tfont-size: 11px;\n\tfont-weight: normal;\n\toverflow: auto;\n}\n\n\n.dojoTreeNodeLabelTitle {\n\tpadding-left: 2px;\n\tcolor: WindowText;\n}\n\n.dojoTreeNodeLabel {\n\tcursor:hand;\n\tcursor:pointer;\n}\n\n.dojoTreeNodeLabelTitle:hover {\n\ttext-decoration: underline;\n}\n\n.dojoTreeNodeLabelSelected {\n\tbackground-color: Highlight;\n\tcolor: HighlightText;\n}\n\n.dojoTree div {\n\twhite-space: nowrap;\n}\n\n.dojoTree img, .dojoTreeNodeLabel img {\n\tvertical-align: middle;\n}\n\n",templateCssPath:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/Tree.css"),templateString:"<div class=\"dojoTree\"></div>",isExpanded:true,isTree:true,objectId:"",controller:"",selector:"",menu:"",expandLevel:"",blankIconSrc:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_blank.gif"),gridIconSrcT:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_t.gif"),gridIconSrcL:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_l.gif"),gridIconSrcV:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_v.gif"),gridIconSrcP:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_p.gif"),gridIconSrcC:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_c.gif"),gridIconSrcX:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_x.gif"),gridIconSrcY:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_y.gif"),gridIconSrcZ:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_grid_z.gif"),expandIconSrcPlus:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_expand_plus.gif"),expandIconSrcMinus:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_expand_minus.gif"),expandIconSrcLoading:dojo.uri.moduleUri("dojo.widget","templates/images/Tree/treenode_loading.gif"),iconWidth:18,iconHeight:18,showGrid:true,showRootGrid:true,actionIsDisabled:function(_1098){
var _this=this;
return dojo.lang.inArray(_this.actionsDisabled,_1098);
},actions:{ADDCHILD:"ADDCHILD"},getInfo:function(){
var info={widgetId:this.widgetId,objectId:this.objectId};
return info;
},initializeController:function(){
if(this.controller!="off"){
if(this.controller){
this.controller=dojo.widget.byId(this.controller);
}else{
dojo.require("dojo.widget.TreeBasicController");
this.controller=dojo.widget.createWidget("TreeBasicController",{DNDController:(this.DNDMode?"create":""),dieWithTree:true});
}
this.controller.listenTree(this);
}else{
this.controller=null;
}
},initializeSelector:function(){
if(this.selector!="off"){
if(this.selector){
this.selector=dojo.widget.byId(this.selector);
}else{
dojo.require("dojo.widget.TreeSelector");
this.selector=dojo.widget.createWidget("TreeSelector",{dieWithTree:true});
}
this.selector.listenTree(this);
}else{
this.selector=null;
}
},initialize:function(args,frag){
var _this=this;
for(name in this.eventNamesDefault){
if(dojo.lang.isUndefined(this.eventNames[name])){
this.eventNames[name]=this.widgetId+"/"+this.eventNamesDefault[name];
}
}
for(var i=0;i<this.actionsDisabled.length;i++){
this.actionsDisabled[i]=this.actionsDisabled[i].toUpperCase();
}
if(this.DNDMode=="off"){
this.DNDMode=0;
}else{
if(this.DNDMode=="between"){
this.DNDMode=this.DNDModes.ONTO|this.DNDModes.BETWEEN;
}else{
if(this.DNDMode=="onto"){
this.DNDMode=this.DNDModes.ONTO;
}
}
}
this.expandLevel=parseInt(this.expandLevel);
this.initializeSelector();
this.initializeController();
if(this.menu){
this.menu=dojo.widget.byId(this.menu);
this.menu.listenTree(this);
}
this.containerNode=this.domNode;
},postCreate:function(){
this.createDOMNode();
},createDOMNode:function(){
dojo.html.disableSelection(this.domNode);
for(var i=0;i<this.children.length;i++){
this.children[i].parent=this;
var node=this.children[i].createDOMNode(this,0);
this.domNode.appendChild(node);
}
if(!this.showRootGrid){
for(var i=0;i<this.children.length;i++){
this.children[i].expand();
}
}
dojo.event.topic.publish(this.eventNames.treeCreate,{source:this});
},destroy:function(){
dojo.event.topic.publish(this.tree.eventNames.treeDestroy,{source:this});
return dojo.widget.HtmlWidget.prototype.destroy.apply(this,arguments);
},addChild:function(child,index){
var _10a3={child:child,index:index,parent:this,domNodeInitialized:child.domNodeInitialized};
this.doAddChild.apply(this,arguments);
dojo.event.topic.publish(this.tree.eventNames.addChild,_10a3);
},doAddChild:function(child,index){
if(dojo.lang.isUndefined(index)){
index=this.children.length;
}
if(!child.isTreeNode){
dojo.raise("You can only add TreeNode widgets to a "+this.widgetType+" widget!");
return;
}
if(this.isTreeNode){
if(!this.isFolder){
this.setFolder();
}
}
var _this=this;
dojo.lang.forEach(child.getDescendants(),function(elem){
elem.tree=_this.tree;
});
child.parent=this;
if(this.isTreeNode){
this.state=this.loadStates.LOADED;
}
if(index<this.children.length){
dojo.html.insertBefore(child.domNode,this.children[index].domNode);
}else{
this.containerNode.appendChild(child.domNode);
if(this.isExpanded&&this.isTreeNode){
this.showChildren();
}
}
this.children.splice(index,0,child);
if(child.domNodeInitialized){
var d=this.isTreeNode?this.depth:-1;
child.adjustDepth(d-child.depth+1);
child.updateIconTree();
}else{
child.depth=this.isTreeNode?this.depth+1:0;
child.createDOMNode(child.tree,child.depth);
}
var _10a9=child.getPreviousSibling();
if(child.isLastChild()&&_10a9){
_10a9.updateExpandGridColumn();
}
},makeBlankImg:function(){
var img=document.createElement("img");
img.style.width=this.iconWidth+"px";
img.style.height=this.iconHeight+"px";
img.src=this.blankIconSrc;
img.style.verticalAlign="middle";
return img;
},updateIconTree:function(){
if(!this.isTree){
this.updateIcons();
}
for(var i=0;i<this.children.length;i++){
this.children[i].updateIconTree();
}
},toString:function(){
return "["+this.widgetType+" ID:"+this.widgetId+"]";
},move:function(child,_10ad,index){
var _10af=child.parent;
var _10b0=child.tree;
this.doMove.apply(this,arguments);
var _10ad=child.parent;
var _10b1=child.tree;
var _10b2={oldParent:_10af,oldTree:_10b0,newParent:_10ad,newTree:_10b1,child:child};
dojo.event.topic.publish(_10b0.eventNames.moveFrom,_10b2);
dojo.event.topic.publish(_10b1.eventNames.moveTo,_10b2);
},doMove:function(child,_10b4,index){
child.parent.doRemoveNode(child);
_10b4.doAddChild(child,index);
},removeNode:function(child){
if(!child.parent){
return;
}
var _10b7=child.tree;
var _10b8=child.parent;
var _10b9=this.doRemoveNode.apply(this,arguments);
dojo.event.topic.publish(this.tree.eventNames.removeNode,{child:_10b9,tree:_10b7,parent:_10b8});
return _10b9;
},doRemoveNode:function(child){
if(!child.parent){
return;
}
var _10bb=child.parent;
var _10bc=_10bb.children;
var index=child.getParentIndex();
if(index<0){
dojo.raise("Couldn't find node "+child+" for removal");
}
_10bc.splice(index,1);
dojo.html.removeNode(child.domNode);
if(_10bb.children.length==0&&!_10bb.isTree){
_10bb.containerNode.style.display="none";
}
if(index==_10bc.length&&index>0){
_10bc[index-1].updateExpandGridColumn();
}
if(_10bb instanceof dojo.widget.Tree&&index==0&&_10bc.length>0){
_10bc[0].updateExpandGrid();
}
child.parent=child.tree=null;
return child;
},markLoading:function(){
},unMarkLoading:function(){
},lock:function(){
!this.lockLevel&&this.markLoading();
this.lockLevel++;
},unlock:function(){
if(!this.lockLevel){
dojo.raise("unlock: not locked");
}
this.lockLevel--;
!this.lockLevel&&this.unMarkLoading();
},isLocked:function(){
var node=this;
while(true){
if(node.lockLevel){
return true;
}
if(node instanceof dojo.widget.Tree){
break;
}
node=node.parent;
}
return false;
},flushLock:function(){
this.lockLevel=0;
this.unMarkLoading();
}});
dojo.provide("qu.widget.TreeLoadingController");
dojo.require("dojo.widget.TreeBasicController");
dojo.require("dojo.event.*");
dojo.require("qu.rpc.Service");
dojo.widget.defineWidget("qu.widget.TreeLoadingController",dojo.widget.TreeBasicController,{widgetType:"TreeLoadingController",namespace:"qu",service:"",fillInTemplate:function(){
this.serviceClass=this.getService();
},getService:function(){
try{
var _10bf=new qu.rpc.Service(this.service);
return _10bf;
}
catch(inError){
dojo.raise(inError);
}
},expand:function(node,sync,_10c2,_10c3){
if(node.state==node.loadStates.UNCHECKED&&node.isFolder){
node.state=node.loadStates.LOADING;
this.loadRemote(node,sync,this,function(){
this.expand(node,sync,_10c2,_10c3);
});
return;
}
dojo.widget.TreeBasicController.prototype.expand.apply(this,arguments);
},doMove:function(child,_10c5,index){
var def=this.serviceClass.moveItem({sid:qu.user.getSid(),item_id:child.item.getId(),old_tree_path:child.item.getFullTreePath(),new_tree_path:_10c5.children[index-1].item.getFullTreePath()});
child.item.setTreePath(_10c5.children[index-1].item.getFullTreePath());
def.addCallback(this,function(_10c8){
this.onItemMoved(child,_10c5,index,_10c8);
});
return true;
},onItemMoved:function(child,_10ca,index,_10cc){
if(_10cc){
dojo.widget.TreeBasicController.prototype.doMove.apply(this,[child,_10ca.children[index-1],index]);
_10ca.children[index-1].state=_10ca.children[index-1].loadStates.UNCHECKED;
_10ca.children[index-1].setFolder();
this.expand(_10ca.children[index-1]);
}
},canMove:function(child,_10ce){
if(child.item.getId()==0){
return false;
}
return true;
},canCreateChild:function(_10cf,index,data){
return true;
},loadRemote:function(node,sync,_10d4,_10d5){
node.markLoading();
params={sid:qu.user.getSid(),tree_path:node.item.getFullTreePath(),item_id:node.item.getId()};
if(node.item.getQuery()!=""&&node.item.getQuery()!=null){
params["query"]=node.item.getQuery();
}
var def=this.serviceClass.getItemsList(params);
def.addCallback(this,function(_10d7){
this.onLoadRemote(node,_10d7);
});
},onLoadRemote:function(_10d8,_10d9){
var _10da,_10db;
var _10dc=false;
var len=_10d8.children.length;
for(i=0;i<len;i++){
_10d8.removeNode(_10d8.children[0]);
}
if(_10d8.item.getQuery()!=null&&_10d8.item.getQuery()!=""&&_10d9.getCount()=="0"){
_10d8.item.setSubject("<b>"+app.i18n.get("noItemFoundWithText")+"</b> \""+_10d8.item.getQuery()+"\"");
var _10da=new Object();
_10da.title=_10d8.item.getSubject();
_10d8.edit(_10da);
}
if(_10d9.getCount()>0){
while(_10d9.next()){
var item=new app.data.kbase.Item(_10d9);
item.setLoaded(false);
_10da=new Object();
var _10df=parseInt(_10d9.get("children_count"));
_10da.title=item.getAccessModeImage()+item.getSubject();
_10da.isFolder=item.isFolder();
_10db=dojo.widget.createWidget("TreeNode",_10da);
_10db.item=item;
_10d8.addChild(_10db);
_10dc=true;
}
this.expand(_10d8);
}else{
_10d8.unMarkLoading();
}
}});
dojo.provide("app.data.kbase.Item");
dojo.require("qu.sql.ResultSet");
dojo.declare("app.data.kbase.Item",null,function(){
this._id=null;
this._treePath=null;
this._itemOrder=null;
this._subject=null;
this._metaDescription=null;
this._url=null;
this._body=null;
this._userId=null;
this._created=null;
this._accessMode=null;
this._childrenCount=null;
this._loaded=false;
this._query="";
if(arguments[0] instanceof qu.sql.ResultSet){
this.load(arguments[0]);
}
},{setId:function(_10e0){
this._id=_10e0;
},getId:function(){
return this._id;
},setQuery:function(_10e1){
this._query=_10e1;
},getQuery:function(){
return this._query;
},setTreePath:function(_10e2){
this._treePath=_10e2;
},getTreePath:function(){
return this._treePath;
},getFullTreePath:function(){
if(this.getId()==0||this.getId()==null){
return this.getTreePath();
}
return this.getTreePath()+this.getId()+"|";
},setItemOrder:function(_10e3){
this._itemOrder=_10e3;
},getItemOrder:function(){
return this._itemOrder;
},setSubject:function(_10e4){
this._subject=_10e4;
},getSubject:function(){
return this._subject;
},setMetaDescription:function(_10e5){
this._metaDescription=_10e5;
},getMetaDescription:function(){
return this._metaDescription;
},setUrl:function(_10e6){
this._url=_10e6;
},getUrl:function(){
return this._url;
},setBody:function(_10e7){
this._body=_10e7;
},getBody:function(){
return this._body;
},setUserId:function(_10e8){
this._userId=_10e8;
},getUserId:function(){
return this._userId;
},setCreated:function(_10e9){
this._created=_10e9;
},getCreated:function(){
return this._created;
},setAccessMode:function(_10ea){
this._accessMode=_10ea;
},getAccessMode:function(){
return this._accessMode;
},getAccessModeImage:function(){
var img="";
var title="";
switch(this.getAccessMode()){
case "a":
img="lib/icons/crystalsvg/16/group-event.png";
title=app.i18n.get("PublicKnowledge");
break;
case "g":
img="lib/icons/crystalsvg/16/instant-away.png";
title=app.i18n.get("InternalKnowledge");
break;
case "p":
img="lib/icons/crystalsvg/16/decrypted.png";
title=app.i18n.get("PrivateKnowledge");
break;
case "u":
img="lib/icons/crystalsvg/16/user.png";
title=app.i18n.get("UserKnowledge");
break;
default:
img="lib/icons/crystalsvg/16/help.png";
title="";
break;
}
return "<img src='"+img+"' border='0' title='"+title+"' /> ";
},setChildrenCount:function(_10ed){
this._childrenCount=_10ed;
},getChildrenCount:function(){
return this._childrenCount;
},isFolder:function(){
return (this.getChildrenCount()>0);
},setLoaded:function(_10ee){
this._loaded=_10ee;
},isLoaded:function(){
return this._loaded;
},load:function(_10ef){
var _10f0=function(_10f1){
var value=_10ef.get(_10f1);
if(value!=null){
return value.valueOf();
}
return value;
};
this.setId(_10f0("item_id"));
this.setTreePath(_10f0("tree_path"));
this.setItemOrder(_10f0("item_order"));
this.setSubject(_10f0("subject"));
this.setMetaDescription(_10f0("metadescription"));
this.setUrl(_10f0("url"));
this.setBody(_10f0("body"));
this.setUserId(_10f0("user_id"));
this.setCreated(_10f0("created"));
this.setAccessMode(_10f0("access_mode"));
this.setChildrenCount(_10f0("children_count"));
},serialize:function(){
var _10f3=new Object();
var _10f4=function(inKey,_10f6){
if(_10f6!=null){
_10f3[inKey]=_10f6;
}
};
_10f4("item_id",this.getId());
_10f4("tree_path",this.getTreePath());
_10f4("item_order",this.getItemOrder());
_10f4("subject",this.getSubject());
_10f4("metadescription",this.getMetaDescription());
_10f4("url",this.getUrl());
_10f4("body",this.getBody());
_10f4("created",this.getCreated());
_10f4("access_mode",this.getAccessMode());
return _10f3;
}});
dojo.provide("app.view.kbase.CannedMessageTree");
dojo.require("dojo.widget.Tree");
dojo.require("dojo.widget.TreeSelector");
dojo.require("qu.widget.TreeLoadingController");
dojo.require("app.data.kbase.Item");
dojo.declare("app.view.kbase.CannedMessageTree",qu.gui.Frame,function(){
this._selectedNode=null;
},{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.CannedMessageTree"));
},initComponents:function(){
this.tree=dojo.widget.byId("CMTree");
this.tree.expandIconSrcLoading=dojo.uri.moduleUri("qu.widget","templates/images/treenode_loading.png");
this.treeSelector=dojo.widget.byId("treeSelector");
},initConnections:function(){
dojo.event.topic.subscribe("nodeSelected",this,"onNodeSelected");
},onLoad:function(){
this._initTree();
},_initTree:function(){
if(this._ticketSubjectId!=null){
this.initSuggestions(this._ticketSubjectId,this._ticketBody);
}
var _10f7=new app.data.kbase.Item();
_10f7.setSubject("<b>"+app.i18n.get("KnowledgeBase")+"</b>");
_10f7.setId(0);
_10f7.setTreePath("0|");
this.rootNode=this.createTreeNode(_10f7);
this.tree.addChild(this.rootNode);
this.treeSelector.doSelect(this.rootNode);
this.tree.controller.expand(this.rootNode);
},initSuggestions:function(_10f8,body){
if(this.tree==null){
this._ticketSubjectId=_10f8;
this._ticketBody=body;
return true;
}
if(this.suggestionNode!=null){
this.remove(this.suggestionNode);
this.suggestionNode=null;
}
var _10fa=new app.data.kbase.Item();
_10fa.setSubject("<b>"+app.i18n.get("KnowledgeBaseSuggestionsForTiket")+_10f8+"</b>");
_10fa.setId(-1);
_10fa.setTreePath(_10f8);
_10fa.setQuery(body);
this.suggestionNode=this.createTreeNode(_10fa);
this.tree.addChild(this.suggestionNode,0);
this.tree.controller.expand(this.suggestionNode);
},createTreeNode:function(_10fb){
var _10fc=new Object();
_10fc.title=_10fb.getSubject();
_10fc.isFolder=true;
var _10fd=dojo.widget.createWidget("TreeNode",_10fc);
_10fd.item=_10fb;
return _10fd;
},onNodeSelected:function(_10fe){
this._selectedNode=_10fe.node;
this.onChange();
},getSelectedNode:function(){
if(this._selectedNode==null){
return this.rootNode;
}
return this._selectedNode;
},onChange:function(){
},removeAllChildren:function(_10ff){
var _1100=_10ff.children;
var len=_1100.length;
for(i=0;i<len;i++){
_10ff.removeNode(_1100[0]);
}
},remove:function(_1102){
if(_1102.parent){
this.select(_1102.parent);
}
this.tree.removeNode(_1102);
},selectNodeById:function(_1103,inId){
var _1105=null,nodes=_1103.children;
dojo.lang.forEach(nodes,function(elm,index,arr){
if(elm.item.getId()==inId){
this.select(elm);
_1105=elm;
}
},this);
return _1105;
},select:function(_110a){
var _110b=this.getSelectedNode();
if(!_110a||!_110a.isTreeNode){
return;
}
if(_110b&&_110b.isTreeNode){
this.treeSelector.deselect();
this.treeSelector.doSelect(_110a);
this._selectedNode=_110a;
}
}});
dojo.provide("app.view.kbase.CannedMessage");
dojo.require("qu.gui.Dialog");
dojo.require("app.view.kbase.CannedMessageTree");
dojo.lang.declare("app.view.kbase.CannedMessage",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdAddToReply,"onclick",this,"onAddToReply");
dojo.event.connectOnce(this.treeView,"onChange",this,"onNodeSelected");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadAttachments");
},initComponents:function(){
this.treeView=new app.view.kbase.CannedMessageTree(this.el.treeContainer);
this.treeView.setParent(this);
this.treeView.show();
this.resetForm();
},onKeyPress:function(_110c){
switch(_110c.keyCode){
case _110c.KEY_ESCAPE:
this.hide();
break;
}
},onLoadAttachments:function(id,_110e){
if(id=="cannedMessageLoadAttachments"){
this.loadAttachments(_110e);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.CannedMessage"));
this.setTitle(app.i18n.get("KnowledgeBase"));
this.setSize(1000,650);
this.center();
},resetForm:function(){
this.setSubject("");
this.setBody("");
this._attachments=new Array();
this.el.attachmentsContent.innerHTML="";
this.el.cmdAddToReply.style.display="none";
this.el.kbContent.style.display="none";
this.el.noContent.style.display="block";
},onLoad:function(){
if(this.getReplyForm()!=null){
var _110f="";
if(this.getReplyForm().getModel()!=null){
_110f=this.getReplyForm().getModel().getSubject()+" "+this.getReplyForm().getModel().getBody()+" "+this.getReplyForm().getBodyText();
}
this.treeView.initSuggestions(this.getReplyForm().getParent().getSubjectTicketId(),_110f);
}
},onAddToReply:function(){
if(this.getReplyForm()!=null){
this.getReplyForm().el.body.replaceSelection(this.getBody());
dojo.lang.forEach(this._attachments,function(_1110){
if(_1110.isChecked()){
var _1111=new app.widget.Uploaded(this.el.attachFileContainer,_1110.getAttachment());
this.attachments.push(_1110);
}
},this.getReplyForm());
}
this.hide();
},onNodeSelected:function(){
this.loadItem();
},loadItem:function(){
this.resetForm();
if(this.treeView.getSelectedNode().item.getId().valueOf()!="0"&&this.treeView.getSelectedNode().item.getId().valueOf()!="-1"){
var _1112=new qu.rpc.Service("KBItems");
_1112.addPushRequest("cannedMessageLoadAttachments","Attachments","getKBAttachmentsList",{sid:qu.user.getSid(),item_id:this.treeView.getSelectedNode().item.getId().valueOf()});
var def=_1112.getItem({sid:qu.user.getSid(),item_id:this.treeView.getSelectedNode().item.getId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}
},onLoadSuccess:function(_1114){
this.hideLoading();
this.el.cmdAddToReply.style.display="inline";
var rs=_1114;
rs.first();
this.setSubject(rs.get("subject"));
this.setBody(rs.get("body"));
this.el.noContent.style.display="none";
this.el.kbContent.style.display="block";
},loadAttachments:function(_1116){
_1116.beforeFirst();
while(_1116.next()){
var _1117=new app.data.email.Attachment();
_1117.setId(_1116.getString("file_id").valueOf());
_1117.setFilename(_1116.getString("filename").valueOf());
_1117.setSize(_1116.getNumber("filesize").valueOf());
_1117.setType(_1116.getString("filetype").valueOf());
this.addAttachment(_1117);
}
},addAttachment:function(_1118){
var _1119=new app.widget.Uploaded(this.el.attachmentsContent,_1118);
this._attachments.push(_1119);
},setSubject:function(_111a){
this.el.kbSubject.innerHTML=_111a;
},setBody:function(_111b){
this.el.kbBody.innerHTML=_111b;
},getBody:function(){
return this.el.kbBody.innerHTML;
},setReplyForm:function(_111c){
this._replyForm=_111c;
},getReplyForm:function(){
return this._replyForm;
}});
dojo.provide("app.view.tickets.Reply");
dojo.require("dojo.io.cookie");
dojo.require("qu.gui.Frame");
dojo.require("app.widget.Upload");
dojo.require("app.widget.Uploaded");
dojo.require("app.view.kbase.CannedMessage");
dojo.require("qu.string.conversion");
dojo.require("dojo.json");
dojo.lang.declare("app.view.tickets.Reply",qu.gui.Frame,function(){
this._workTimerId=null;
this._lastSearchQuery="";
this._customFields=new Array();
},{addAttachment:function(){
var _111d=new app.widget.Upload(this.el.attachFileContainer);
if(this.attachments.length>0){
_111d.setAttachFileLabel(app.i18n.get("AttachAnotherFile"));
}
dojo.event.connectOnce(_111d,"onAttach",this,"onAttach");
dojo.event.connectOnce(_111d,"onRemove",this,"onRemove");
this.attachments.push(_111d);
},onAttach:function(){
this.addAttachment();
},onRemove:function(){
var _111e=new Array();
for(var i=0;i<this.attachments.length;i++){
if(!this.attachments[i].isDeleted()){
_111e.push(this.attachments[i]);
}
}
this.attachments=new Array();
this.attachments=_111e;
if(this.attachments.length==1){
this.attachments[0].setAttachFileLabel(app.i18n.get("AttachFile"));
}
},initComponents:function(){
var users=new qu.rpc.Service("Users");
with(this.el.to.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _1121={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_1121);
}
this.el.to.setValueSeparator(/[,;]/g);
var users=new qu.rpc.Service("Users");
with(this.el.cc.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _1121={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_1121);
}
this.el.cc.setValueSeparator(/[,;]/g);
var users=new qu.rpc.Service("Users");
with(this.el.bcc.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _1121={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_1121);
}
this.el.bcc.setValueSeparator(/[,;]/g);
var _1122=app.config.getCookie("replyEditorMode");
if(_1122!=null&&_1122.length>0){
try{
this.el.body.setMode(_1122);
}
catch(e){
}
}
this.cannedMessage=new app.view.kbase.CannedMessage();
this.cannedMessage.setReplyForm(this);
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdAddCc,"onclick",this,"onAddCc");
dojo.event.connectOnce(this.el.cmdAddBcc,"onclick",this,"onAddBcc");
dojo.event.connectOnce(this.el.cmdEditSubject,"onclick",this,"onEditSubject");
dojo.event.connectOnce(this.el.cmdSend,"onclick",this,"onSend");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this.el.cmdSendAndResolve,"onclick",this,"onSendAndResolve");
dojo.event.connectOnce(this.el.body,"onPlainMode",this,"onToggleEditor");
dojo.event.connectOnce(this.el.body,"onHtmlMode",this,"onToggleEditor");
dojo.event.connectOnce(this.el.body,"onRichMode",this,"onToggleEditor");
dojo.event.connectOnce(this.el.body,"onKeyPress",this,"onKeyPress");
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"onCancel");
dojo.event.connectOnce(this.el.cmdOpenKnowledgeBase,"onclick",this,"onOpenKnowledgeBase");
dojo.event.connectOnce(this.el.workTime,"onchange",this,"onManualWorkReport");
dojo.event.connectOnce(this.el.billingTime,"onchange",this,"onManualWorkReport");
dojo.event.connectOnce(this,"onHide",this,"stopWorkTimer");
},onKeyPress:function(_1123){
if(_1123!=null){
switch(_1123.keyCode){
case _1123.KEY_TAB:
switch(_1123.target.id){
case "to":
if(this.el.ccContainer.style.display=="none"&&this.el.bccContainer.style.display=="none"&&this.el.subjectContainer.style.display=="none"){
_1123.preventDefault();
this.el.body.focus();
}
break;
case "cc":
if(this.el.bccContainer.style.display=="none"&&this.el.subjectContainer.style.display=="none"){
_1123.preventDefault();
this.el.body.focus();
}
break;
case "bcc":
if(this.el.subjectContainer.style.display=="none"){
_1123.preventDefault();
this.el.body.focus();
}
break;
case "subject":
_1123.preventDefault();
this.el.body.focus();
break;
default:
break;
}
break;
default:
if(quConfig.knowledgeBaseModule=="y"){
this.scheduleKBSearch();
}
}
}else{
if(quConfig.knowledgeBaseModule=="y"){
this.scheduleKBSearch();
}
}
},onCancel:function(){
this.el.cmdSend.disabled=false;
this.el.cmdSendAndResolve.disabled=false;
this.el.cmdSave.disabled=false;
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
this.getParent().hide();
}else{
this.hide();
}
},onOpenKnowledgeBase:function(){
this.cannedMessage.show();
},setChanged:function(_1124){
this._changed=_1124;
},isChanged:function(){
return this._changed;
},isAllUploaded:function(){
for(var i=0;i<this.attachments.length-1;i++){
if(this.attachments[i].isInProgress()){
return false;
}
}
return true;
},checkBeforeSend:function(){
if(dojo.string.trim(this.getTo()).length==0&&!qu.user.isUser()&&this.getSaveAsComment()=="n"){
alert(app.i18n.get("recipientsEmpty"));
return false;
}
return true;
},onSendMail:function(_1126){
if(!this.checkBeforeSend()){
return false;
}
if(this.isAutomagicWorkTime()){
this.setWorkTime(this.getSecondsFromTicketStart());
this.setBillingTime(this.getSecondsFromTicketStart());
}
this.msgBox.clear();
this.el.cmdSend.disabled=true;
this.el.cmdSendAndResolve.disabled=true;
this.el.cmdSave.disabled=true;
if(!this.isAllUploaded()){
var _1127=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_1127);
dojo.lang.setTimeout(this,"onSend",500);
return;
}
var _1128={sid:qu.user.getSid(),ticket_id:this.getTicketId(),email_id:this.getEmailId(),subject:this.getSubject(),body:this.getBodyText(),body_html:this.getHtmlBody()};
if(this.getSendMailConfirmation()){
_1128["send_mail"]="y";
}else{
_1128["send_mail"]="n";
}
if(qu.user.isUser()){
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128["status"]="n";
}else{
if(_1126=="r"){
_1128["status"]="r";
}else{
_1128["status"]="c";
}
}
}else{
_1128["status"]=this.getTicketStatus();
}
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128.ticket_id="";
_1128.email_id="";
}
if(this.el.body.getMode()=="plain"){
_1128.isPlainText="1";
_1128.body_html="";
}
if(!qu.user.isUser()){
_1128.account_id=this.getFrom();
_1128.to=this.getTo();
_1128.cc=this.getCc();
_1128.bcc=this.getBcc();
_1128.is_comment=this.getSaveAsComment();
if(this.getParent().getTicketPriority()!=this.getTicketPriority()||this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128.priority=this.getTicketPriority();
}
if(this.getParent().getTicketOwner()!=this.getTicketOwner()||this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128.agent_owner_id=this.getTicketOwner();
}
if(this.getParent().getTicketQueue()!=this.getTicketQueue()||this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128.queue_id=this.getTicketQueue();
dojo.io.cookie.setCookie("reply_queue_id",_1128.queue_id,365);
}
if(quConfig.workReporting=="y"){
_1128.billing_time=this.getBillingTime();
_1128.work_time=this.getWorkTime();
var now=new Date();
_1128.ticket_time=this.getSecondsFromTicketStart();
_1128.note=this.getWorkNote();
}
}else{
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
_1128.queue_id=this.getTicketUserQueue();
}
}
if(this.attachments.length>0){
var _112a=new Array();
dojo.lang.forEach(this.attachments,function(_112b,_112c,_112d){
if(_112b.isChecked()){
_112a.push(_112b.getHash());
}
});
if(_112a.length>0){
_1128.attach_ids=_112a;
}
}
var _112e=new Object();
for(var i=0;i<this._customFields.length;i++){
_112e[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
_1128["custom"]=_112e;
var _1130=new qu.rpc.Service("Tickets");
_1130.setThrobber(app.i18n.get("Sending")+"...");
var def=_1130.replyMail(_1128);
def.addCallback(this,"onSendSuccess");
def.addErrback(this,"onSendFail");
},onSendAndResolve:function(){
this.setTicketStatus("r");
this.setSendMailConfirmation(true);
this.onSendMail("r");
},onSave:function(){
this.setSendMailConfirmation(false);
this.onSendMail("");
},onSend:function(){
this.setSendMailConfirmation(true);
this.onSendMail("");
},setSendMailConfirmation:function(_1132){
this._sendMail=_1132;
},getSendMailConfirmation:function(){
return this._sendMail;
},onSendSuccess:function(_1133){
this.el.cmdSend.disabled=false;
this.el.cmdSendAndResolve.disabled=false;
this.el.cmdSave.disabled=false;
app.main.msgBox.print(_1133);
this.getParent().hide();
this.hide();
},onSendFail:function(_1134){
this.el.cmdSend.disabled=false;
this.el.cmdSave.disabled=false;
this.el.cmdSendAndResolve.disabled=false;
app.main.msgBox.print(_1134);
},setParent:function(_1135){
this._parent=_1135;
},getParent:function(){
return this._parent;
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.tickets.Reply"));
},onLoad:function(){
this.resetForm();
this.initFrom();
this.initTicketFields();
if(qu.user.isUser()){
this.hideTableRow(this.el.fromContainer);
this.hideTableRow(this.el.toContainer);
this.hideTableRow(this.el.ccContainer);
this.hideTableRow(this.el.bccContainer);
this.hideTableRow(this.el.addFieldContainer);
this.showTableRow(this.el.subjectContainer);
this.el.updateContainer.style.display="none";
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
this.el.userUpdateContainer.style.display="block";
}
this.el.saveAsCommentContent.style.display="none";
this.el.cmdOpenKnowledgeBase.style.display="none";
this.el.cmdSave.style.display="none";
this.el.workReportContainer.style.display="none";
}else{
this.showTableRow(this.el.addFieldContainer);
this.el.updateContainer.style.display="block";
this.el.userUpdateContainer.style.display="none";
this.el.saveAsCommentContent.style.display="block";
this.el.cmdSave.style.display="inline";
if(quConfig.knowledgeBaseModule=="y"){
this.el.cmdOpenKnowledgeBase.style.display="inline";
}else{
this.el.cmdOpenKnowledgeBase.style.display="none";
}
this.setSaveAsComment(false);
var users=new qu.rpc.Service("Users");
if(!qu.user.isUser()){
users.addPushRequest("onlineAgents","Users","getOnlineAgents",{sid:qu.user.getSid()});
}
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
users.updateLastAction({sid:qu.user.getSid(),ticket_id:"null",action:"writing_new"});
}else{
var def=users.updateLastAction({sid:qu.user.getSid(),ticket_id:this.getTicketId(),action:"replying"});
def.addErrback(dojo.lang.hitch(this,"onAnotherUserReplying"));
}
if(quConfig.workReporting=="y"){
this.el.workReportContainer.style.display="block";
}else{
this.el.workReportContainer.style.display="none";
}
}
this.msgBox.clear();
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
this.el.editSubjectDivider.style.display="none";
this.el.cmdEditSubject.style.display="none";
}else{
this.el.cmdEditSubject.style.display="inline";
this.el.editSubjectDivider.style.display="inline";
}
},onAnotherUserReplying:function(_1138){
this.el.replyNotification.innerHTML=_1138.message;
this.el.replyNotification.style.display="block";
},resetForm:function(){
this.el.attachFileContainer.innerHTML="";
this.el.replyNotification.innerHTML="";
this.el.replyNotification.style.display="block";
this.resetAttachments();
this.setBcc("");
if(this.el.bccContainer.style.display!="none"){
this.onAddBcc();
}
if(this.el.ccContainer.style.display!="none"){
this.onAddCc();
}
if(this.el.subjectContainer.style.display!="none"){
this.onEditSubject();
}
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
this.onEditSubject();
}
this.resetWorkTime();
},resetWorkTime:function(){
this.setWorkTime(this.getSecondsFromTicketStart());
this.setBillingTime(this.getSecondsFromTicketStart());
this.setWorkNote("");
this.startTimeUpdater();
this.el.workTimeIcon.style.display="inline";
this.el.billingTimeIcon.style.display="inline";
},startTimeUpdater:function(){
if(this._workTimerId!=null){
dojo.lang.clearTimeout(this._workTimerId);
this._workTimerId=null;
}
this._workTimerId=dojo.lang.setTimeout(this,"updateWork",60000);
},updateWork:function(){
this.setWorkTime(this.getSecondsFromTicketStart());
this.setBillingTime(this.getSecondsFromTicketStart());
this.startTimeUpdater();
},onManualWorkReport:function(){
this.stopWorkTimer();
this.el.workTimeIcon.style.display="none";
this.el.billingTimeIcon.style.display="none";
},isAutomagicWorkTime:function(){
return this.el.workTimeIcon.style.display!="none";
},stopWorkTimer:function(){
if(this._workTimerId!=null){
dojo.lang.clearTimeout(this._workTimerId);
this._workTimerId=null;
}
},getSecondsFromTicketStart:function(){
var now=new Date();
return parseInt((now.getTime()-this.getParent().getTicketStartTime().getTime())/1000);
},resetAttachments:function(){
this.attachments=new Array();
if(this.getMode()==app.view.tickets.Reply.MODE_FORWARD){
dojo.lang.forEach(this.getModel().getAttachments(),function(_113a){
var _113b=new app.widget.Uploaded(this.el.attachFileContainer,_113a);
this.attachments.push(_113b);
},this);
}
this.addAttachment();
},initTicketFields:function(){
if(qu.user.isPowerUser()){
var _113c=50;
var _113d="";
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
_113c=quConfig.defaultPriority;
}else{
_113c=this.getParent().getTicketPriority();
_113d=this.getParent().getTicketOwner();
}
if(quConfig.autoAssignTicketToAgent=="y"){
_113d=qu.user.getId();
}
app.main.hashMaps.fill(this.el.status_,"statuses",true,this.getParent().getTicketStatus());
app.main.hashMaps.fill(this.el.priority,"priorities",true);
this.setTicketPriority(_113c);
app.main.hashMaps.fill(this.el.queue,"queues",true,this.getParent().getTicketQueue());
this.el.owner.removeAll();
this.el.owner.add("none","&nbsp;");
if(_113d==""){
_113d="none";
}
app.main.hashMaps.fill(this.el.owner,"agents",false,_113d);
}else{
this.el.userQueue.removeAll();
this.el.userQueue.add("",app.i18n.get("selectRightQueueForMe"));
var _113e="";
if(this.getMode()!=app.view.tickets.Reply.MODE_NEW){
_113e=this.getParent().getTicketQueue();
}
app.main.hashMaps.fill(this.el.userQueue,"queues",false,_113e);
}
},onShow:function(){
this.init();
this.el.body.focus();
},getBodyText:function(){
var text=this.el.body.getValue();
if(this.el.body.getMode()!="plain"){
text=text.replace(/<[^>]*>/g,"");
text=text.replace(/&quot;/g,"\"");
text=text.replace(/&lt;/g,"<");
text=text.replace(/&amp;/g,"&");
return text;
}
return text;
},initFrom:function(){
if(qu.user.getType()=="a"||qu.user.getType()=="g"){
app.main.hashMaps.fill(this.el.from,"mailAccounts",true);
this.selectAccountFrom();
}
},initTo:function(){
if(this.getMode()==app.view.tickets.Reply.MODE_REPLY_ALL||this.getMode()==app.view.tickets.Reply.MODE_REPLY_ALL_QUOTE){
var to=this.getModel().getToUsers();
var toStr="";
if(this.getModel().getWroteByUser()!=null){
toStr=this.getModel().getWroteByUser().getEmail()+"; ";
}
for(var i=0;i<to.length;i++){
toStr+=to[i].getEmail();
toStr+="; ";
}
this.setTo(toStr);
}else{
if(this.getMode()==app.view.tickets.Reply.MODE_NEW||this.getMode()==app.view.tickets.Reply.MODE_COMMENT){
this.setTo("");
}else{
if(this.getModel().getWroteByUser()!=null){
this.setTo(this.getModel().getWroteByUser().getEmail());
}else{
this.setTo("");
}
}
}
},initCc:function(){
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
this.setCc("");
}else{
var cc=this.getModel().getCcUsers();
if(cc.length>0&&(this.getMode()==app.view.tickets.Reply.MODE_REPLY_ALL||this.getMode()==app.view.tickets.Reply.MODE_REPLY_ALL_QUOTE)){
var ccStr="";
for(var i=0;i<cc.length;i++){
ccStr+=cc[i].getEmail()+"; ";
}
this.setCc(ccStr);
this.onAddCc();
}else{
this.setCc("");
}
}
},selectAccountFrom:function(){
if(this.getMode()!=app.view.tickets.Reply.MODE_NEW){
this.setFrom(this.getModel().getAccountId());
}else{
if(app.main.hashMaps.getDefaultMailAccount()!=null){
this.setFrom(app.main.hashMaps.getDefaultMailAccount());
}
}
},onAddCc:function(){
if(this.el.ccContainer.style.display=="none"&&!qu.user.isUser()){
this.showTableRow(this.el.ccContainer);
this.el.cc.focus();
this.el.cmdAddCc.innerHTML=app.i18n.get("removeCc");
}else{
this.hideTableRow(this.el.ccContainer);
this.el.cmdAddCc.innerHTML=app.i18n.get("addCc");
}
},onAddBcc:function(){
if(this.el.bccContainer.style.display=="none"&&!qu.user.isUser()){
this.showTableRow(this.el.bccContainer);
this.el.bcc.focus();
this.el.cmdAddBcc.innerHTML=app.i18n.get("removeBcc");
}else{
this.hideTableRow(this.el.bccContainer);
this.el.cmdAddBcc.innerHTML=app.i18n.get("addBcc");
}
},onEditSubject:function(){
if(this.el.subjectContainer.style.display=="none"){
this.showTableRow(this.el.subjectContainer);
if(this.isDisplayed()){
this.el.subject.focus();
}
this.el.cmdEditSubject.innerHTML=app.i18n.get("restoreSubject");
}else{
this.hideTableRow(this.el.subjectContainer);
this.el.cmdEditSubject.innerHTML=app.i18n.get("editSubject");
}
},showTableRow:function(_1146){
if(dojo.render.html.ie){
_1146.style.display="block";
}else{
_1146.style.display="table-row";
}
},hideTableRow:function(_1147){
_1147.style.display="none";
},setTo:function(_1148){
this.el.to.setValue(_1148);
},getTo:function(){
return this.el.to.getValue();
},setCc:function(_1149){
this.el.cc.setValue(_1149);
},getCc:function(){
return this.el.cc.getValue();
},setBcc:function(_114a){
this.el.bcc.setValue(_114a);
},getBcc:function(){
return this.el.bcc.getValue();
},setSubject:function(_114b){
this.el.subject.value=_114b;
},getSubject:function(){
return this.el.subject.value;
},setTicketId:function(_114c){
this._ticketId=_114c;
},getTicketId:function(){
return this._ticketId;
},setEmailId:function(_114d){
this._emailId=_114d;
},getEmailId:function(){
return this._emailId;
},setModel:function(_114e){
this._model=_114e;
},getModel:function(){
return this._model;
},setMode:function(_114f){
this._mode=_114f;
},getMode:function(){
return this._mode;
},getFrom:function(){
return this.el.from.getSelectedValue();
},setFrom:function(_1150){
this.el.from.select(_1150);
},setBody:function(_1151){
if(this.el.body.getMode()!="plain"){
this.el.body.setHtml(_1151);
}else{
this.el.body.setValue(_1151);
}
},getBody:function(){
if(this.el.body.getMode()!="plain"){
return this.el.body.getHtml();
}else{
return this.el.body.getValue();
}
},getHtmlBody:function(){
return this.el.body.getHtml();
},getSignature:function(){
var _1152=app.main.hashMaps.getSignatures();
if(!(_1152 instanceof dojo.Deferred)){
var _1153=_1152.getIterator();
var entry;
while(!_1153.atEnd()){
entry=_1153.get();
if(entry.key==this.getTicketQueue()&&entry.value!=null&&entry.value!="null"){
return entry.value;
}
}
}
return qu.user.getSignature()=="null"?"":qu.user.getSignature();
},getQueueSignature:function(){
var _1155=app.main.hashMaps.getQueueSignatures();
if(!(_1155 instanceof dojo.Deferred)){
var _1156=_1155.getIterator();
var entry;
while(!_1156.atEnd()){
entry=_1156.get();
if(entry.key==this.getTicketQueue()&&entry.value!=null&&entry.value!="null"){
return entry.value.toString();
}
}
}
return "";
},init:function(){
this.hideSuggestions();
this.initCustomFields();
if(this.getMode()==app.view.tickets.Reply.MODE_REPLY_ALL_QUOTE||this.getMode()==app.view.tickets.Reply.MODE_REPLY_QUOTE||this.getMode()==app.view.tickets.Reply.MODE_FORWARD){
var _1158=new qu.gui.Template("app.template.emailTemplates.ReplyQuote");
var def=_1158.load();
var tpl;
def.addCallback(this,function(){
var model=this.getModel();
var _115c={email:this.getModel(),signature:this.getSignature(),queueSignature:this.getQueueSignature()};
tpl=_1158.parseJst(_115c);
if(this.el.body.getMode()=="plain"){
tpl=qu.string.html2Text(tpl);
}
this.setBody(tpl);
});
}else{
var _1158=new qu.gui.Template("app.template.emailTemplates.Reply");
var def=_1158.load();
def.addCallback(this,function(){
var _115d={signature:this.getSignature(),queueSignature:this.getQueueSignature()};
tpl=_1158.parseJst(_115d);
if(this.el.body.getMode()=="plain"){
tpl=qu.string.html2Text(tpl);
}
this.setBody(tpl);
});
}
if(this.getMode()==app.view.tickets.Reply.MODE_FORWARD||this.getMode()==app.view.tickets.Reply.MODE_COMMENT){
this.setTo("");
this.setCc("");
this.setBcc("");
}else{
this.initTo();
this.initCc();
}
if(this.getMode()!=app.view.tickets.Reply.MODE_NEW){
this.setSubject(this.getModel().getSubject());
}else{
this.setSubject("");
}
if(this.getMode()==app.view.tickets.Reply.MODE_COMMENT){
this.setSaveAsComment(true);
}
if(this.getMode()!=app.view.tickets.Reply.MODE_COMMENT){
this.setTicketStatus("a");
}
},_getFirstIndexOfArray:function(_115e){
if(_115e.length>0){
return _115e[0];
}
return "";
},getTicketQueue:function(){
return this._getFirstIndexOfArray(this.el.queue.getSelection());
},setTicketQueue:function(_115f){
this.el.queue.select(_115f);
},getTicketUserQueue:function(){
return this.el.userQueue.getSelection();
},setTicketUserQueue:function(_1160){
this.el.userQueue.select(_1160);
},getTicketStatus:function(){
return this._getFirstIndexOfArray(this.el.status_.getSelection());
},setTicketStatus:function(_1161){
this.el.status_.select(_1161);
},getTicketPriority:function(){
return this._getFirstIndexOfArray(this.el.priority.getSelection());
},setTicketPriority:function(_1162){
this.el.priority.select(_1162);
},getTicketOwner:function(){
var owner=this._getFirstIndexOfArray(this.el.owner.getSelection());
return owner;
},setTicketOwner:function(_1164){
this.el.owner.select(_1164);
},onHide:function(){
},onToggleEditor:function(){
app.config.setCookie("replyEditorMode",this.el.body.getMode());
},setSaveAsComment:function(_1165){
if(_1165==true||_1165=="y"){
this.el.saveAsComment.checked=true;
}else{
if(_1165==false||_1165=="n"){
this.el.saveAsComment.checked=false;
}
}
},getSaveAsComment:function(){
if(qu.user.isUser()){
return "n";
}
if(this.el.saveAsComment.checked){
return "y";
}
return "n";
},getBillingTime:function(){
return qu.string.hhmm2seconds(this.el.billingTime.value);
},setBillingTime:function(_1166){
this.el.billingTime.value=qu.string.seconds2hhmm(_1166);
},getWorkTime:function(){
return qu.string.hhmm2seconds(this.el.workTime.value);
},setWorkTime:function(_1167){
this.el.workTime.value=qu.string.seconds2hhmm(_1167);
},setWorkNote:function(_1168){
this.el.workNote.value=_1168;
},getWorkNote:function(){
return this.el.workNote.value;
},scheduleKBSearch:function(){
if(qu.user.getHideSuggestions()=="y"){
return true;
}
if(this.timeoutId!=null){
dojo.lang.clearTimeout(this.timeoutId);
}
this.timeoutId=dojo.lang.setTimeout(this,"querySuggestions",3000);
},getSearchQuery:function(){
return this.getSubject()+" "+this.getBodyText();
},querySuggestions:function(){
if(this.getSearchQuery().length>6&&this.getSearchQuery()!=this._lastSearchQuery){
this._lastSearchQuery=this.getSearchQuery();
var _1169={sid:qu.user.getSid(),query:this._lastSearchQuery,limit:10};
var _116a=new qu.rpc.Service("KBItems");
_116a.setThrobber(app.i18n.get("Searching")+"...");
var def=_116a.searchItems(_1169);
def.addCallback(this,"onSearchSuccess");
def.addErrback(this,"onSearchFail");
}
},onSearchSuccess:function(_116c){
if(_116c.getCount()>0){
this.showSuggestions();
_116c.beforeFirst();
var _116d="";
while(_116c.next()){
if(_116d.length>0){
_116d+="<br />";
}
var title="<span class='suggestion_item_title'>"+_116c.get("subject")+"</span>";
if(_116c.get("full_parent_subject").length){
title=_116c.get("full_parent_subject")+" / "+title;
}
_116d+="<div class='suggestion_row'><a class='suggestion_url' href='"+quConfig.knowledgeBaseURL+_116c.get("full_path")+"' target='_blank'>"+title+"</a></div>";
}
this.el.suggestionsContainer.innerHTML=_116d;
}else{
this.hideSuggestions();
}
},onSearchFail:function(_116f){
this.hideSuggestions();
},hideSuggestions:function(){
this.el.suggestionsContainer.innerHTML="";
this.el.suggestionsBlock.style.display="none";
},showSuggestions:function(){
this.el.suggestionsContainer.innerHTML="";
this.el.suggestionsBlock.style.display="block";
},initCustomFields:function(){
this.el.customFieldsContent.innerHTML="";
this._customFields=new Array();
if(this.getMode()==app.view.tickets.Reply.MODE_NEW){
app.main.hashMaps.execFunctionForEachElement(function(_1170){
if(_1170.getRelatedTo()=="g"){
return true;
}
var _1171=document.createElement("table");
_1171.style.width="100%";
_1171.style.margin="0px";
var _1172=document.createElement("tbody");
_1171.appendChild(_1172);
var hTr=document.createElement("tr");
var _1174=document.createElement("td");
_1174.style.width="150px";
_1174.style.whiteSpace="nowrap";
_1174.style.verticalAlign="top";
_1174.style.textAlign="right";
var _1175=document.createElement("span");
_1175.innerHTML=_1170.getTitle()+"&nbsp;";
var _1176=document.createElement("img");
if(_1170.getRelatedTo()=="u"){
_1176.src="lib/icons/crystalsvg/16/user.png";
_1176.title=app.i18n.get("relatedToUser");
}else{
if(_1170.getRelatedTo()=="g"){
_1176.src="lib/icons/crystalsvg/16/block-device.png";
_1176.title=app.i18n.get("relatedToGroup");
}else{
_1176.src="lib/icons/crystalsvg/16/alarm.png";
_1176.title=app.i18n.get("relatedToTicket");
}
}
_1176.style.border="none";
_1174.appendChild(_1175);
_1174.appendChild(_1176);
hTr.appendChild(_1174);
var _1177=document.createElement("td");
hTr.appendChild(_1177);
var _1178=new app.widget.CustomFilterField(_1177,_1170.getId(),_1170.getType(),"",_1170.getOptions());
this._customFields.push(_1178);
_1172.appendChild(hTr);
this.el.customFieldsContent.appendChild(_1171);
},this,"customFields");
}
}});
app.view.tickets.Reply.MODE_REPLY=0;
app.view.tickets.Reply.MODE_REPLY_ALL=1;
app.view.tickets.Reply.MODE_REPLY_QUOTE=2;
app.view.tickets.Reply.MODE_REPLY_ALL_QUOTE=3;
app.view.tickets.Reply.MODE_FORWARD=4;
app.view.tickets.Reply.MODE_NEW=5;
app.view.tickets.Reply.MODE_COMMENT=6;
dojo.provide("app.widget.TicketCustomFields");
dojo.require("app.widget.Widget");
dojo.lang.declare("app.widget.TicketCustomFields",app.widget.Widget,function(_1179,_117a){
this._isEmpty=true;
this.domNode=null;
this.setParent(_1179);
this.setResult(_117a);
this.create();
this.connect();
},{setParent:function(_117b){
this._parent=_117b;
},getParent:function(){
return this._parent;
},setResult:function(_117c){
this._result=_117c;
},isEmpty:function(){
return this._isEmpty;
},create:function(){
if(this.domNode==null){
this.domNode=document.createElement("div");
}
this.domNode.style.backgroundColor="#fdfcf7";
this.domNode.style.backgroundImage="url('app/web/images/backgrounds/f2e4ae-fdfcf7.gif')";
this.domNode.style.backgroundRepeat="repeat-x";
this.setDomNode(this.domNode);
var tr=document.createElement("div");
tr.style.background="url('app/web/images/corners/customTicketFields_8x8_tr.png') no-repeat top right";
var tl=document.createElement("img");
tl.src="app/web/images/corners/customTicketFields_8x8_tl.png";
tl.style.width="8px";
tl.style.height="8px";
tl.style.border="none";
tl.style.display="block";
tr.appendChild(tl);
this.domNode.appendChild(tr);
var _117f=document.createElement("span");
_117f.style.fontWeight="bolder";
_117f.style.margin="5px";
_117f.innerHTML=app.i18n.get("ticketCustomFields");
this.domNode.appendChild(_117f);
this._customFields=new Array();
var _1180=document.createElement("table");
_1180.style.width="90%";
_1180.style.margin="5px";
var _1181=document.createElement("tbody");
_1180.appendChild(_1181);
var _1182={};
this._result.beforeFirst();
while(this._result.next()){
if(this._result.getString("field_value").valueOf()=="null"){
_1182["custom_"+this._result.getString("field_id").valueOf()]="";
}else{
_1182["custom_"+this._result.getString("field_id").valueOf()]=this._result.getString("field_value").valueOf();
}
}
this._result.beforeFirst();
while(this._result.next()){
var hTr=document.createElement("tr");
var _1184=document.createElement("td");
_1184.style.width="10%";
_1184.style.whiteSpace="nowrap";
_1184.style.verticalAlign="top";
var _1185=document.createElement("span");
_1185.innerHTML="&nbsp;"+this._result.getString("field_title").valueOf();
var _1186=document.createElement("img");
if(this._result.getString("related_to").valueOf()=="u"){
_1186.src="lib/icons/crystalsvg/16/user.png";
_1186.title=app.i18n.get("relatedToUser");
}else{
if(this._result.getString("related_to").valueOf()=="t"){
_1186.src="lib/icons/crystalsvg/16/alarm.png";
_1186.title=app.i18n.get("relatedToTicket");
}
}
if(this._result.getString("related_to").valueOf()=="g"){
_1186.src="lib/icons/crystalsvg/16/block-device.png";
_1186.title=app.i18n.get("relatedToGroup");
}
_1186.style.border="none";
_1184.appendChild(_1186);
_1184.appendChild(_1185);
hTr.appendChild(_1184);
var _1187=document.createElement("td");
hTr.appendChild(_1187);
if(this._isEmpty&&this._result.getString("field_value").valueOf().length>0&&this._result.getString("field_value").valueOf()!="n"&&this._result.getString("field_value").valueOf()!="null"){
this._isEmpty=false;
}
var _1188=null;
if(this._result.getString("field_type").valueOf()=="h"){
_1188=_1182;
_1188["customer_email"]=this.getParent().getTicketCustomerEmail();
_1188["customer_name"]=this.getParent().getTicketCustomerName();
_1188["ticket_id"]=this.getParent().getSubjectTicketId();
_1188["ticket_subject"]=this.getParent().getTicketSubject();
_1188["ticket_owner"]=this.getParent().el.owner.getSelectedText()[0];
_1188["queue_name"]=this.getParent().el.queue.getSelectedText()[0];
}
var _1189=new app.widget.CustomField(_1187,this._result.getString("field_id").valueOf(),this._result.getString("field_type").valueOf(),this._result.getString("field_value").valueOf(),this._result.getString("options").valueOf(),_1188);
this._customFields.push(_1189);
_1181.appendChild(hTr);
}
var _118a=function(_118b,_118c){
var _118d=document.createElement("div");
_118d.style.display="inline";
_118d.className="button";
var img=document.createElement("img");
img.src=qu.global.icon(_118b+".png",16);
img.style.width="16px";
img.style.height="16px";
img.style.verticalAlign="middle";
img.style.marginRight="3px";
var _118f=document.createElement("span");
_118f.innerHTML=_118c;
_118f.style.fontWeight="bold";
_118d.appendChild(img);
_118d.appendChild(_118f);
return _118d;
};
this.cmdSaveNode=_118a("file-save-as",app.i18n.get("saveChanges"));
this.cmdSaveNode.style.margin="5px";
dojo.event.connectOnce(this.cmdSaveNode,"onclick",this,"onSave");
var hTr=document.createElement("tr");
var _1184=document.createElement("td");
_1184.style.width="10%";
_1184.style.whiteSpace="nowrap";
_1184.style.verticalAlign="top";
_1184.appendChild(this.cmdSaveNode);
hTr.appendChild(_1184);
var _1187=document.createElement("td");
hTr.appendChild(_1187);
_1181.appendChild(hTr);
if(this._result.getCount()>0){
this.domNode.appendChild(_1180);
}
var br=document.createElement("div");
br.style.background="url('app/web/images/corners/customTicketFields_8x8_br.png') no-repeat bottom right";
var bl=document.createElement("img");
bl.src="app/web/images/corners/customTicketFields_8x8_bl.png";
bl.style.width="8px";
bl.style.height="8px";
bl.style.border="none";
bl.style.display="block";
br.appendChild(bl);
this.domNode.appendChild(br);
},connect:function(){
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
},onLoadCustomFields:function(id,_1193){
if(id=="loadSavedFields"&&_1193.getCount()>0){
this.setResult(_1193);
this.domNode.innerHTML="";
this._customFields=new Array();
this.create();
}
},onSave:function(){
var _1194={sid:qu.user.getSid(),user_id:this.getParent().getCustomerId(),ticket_id:this.getParent().getTicketId()};
var _1195=new Object();
for(var i=0;i<this._customFields.length;i++){
if(this._customFields[i].getValue()==undefined){
_1195[this._customFields[i].getFieldId()]="";
}else{
_1195[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
}
_1194["custom"]=_1195;
var _1197=new qu.rpc.Service("Fields");
_1197.setThrobber(app.i18n.get("saving"));
_1197.addPushRequest("loadSavedFields","Tickets","getCustomFieldValues",{sid:qu.user.getSid(),user_id:this.getParent().getCustomerId(),ticket_id:this.getParent().getTicketId()});
var def=_1197.updateCustomFields(_1194);
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onSaveSuccess:function(){
app.main.msgBox.print(app.i18n.get("customFieldsSaved"));
},onSaveFail:function(_1199){
app.main.msgBox.print(_1199);
}});
dojo.provide("app.view.tickets.TicketEdit");
dojo.require("dojo.io.cookie");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Template");
dojo.require("qu.sql.ResultSet");
dojo.require("app.data.Email");
dojo.require("app.widget.Email");
dojo.require("app.data.HistoryEntry");
dojo.require("app.widget.HistoryEntry");
dojo.require("app.view.tickets.Reply");
dojo.require("app.widget.TicketCustomFields");
dojo.lang.declare("app.view.tickets.TicketEdit",qu.gui.Frame,function(){
this._ticketId=null;
this._ticketSubject=null;
this._ticketCustomer=null;
this._emails=new Array();
this._resultSet=null;
this._offset=1;
this.emailsPerPage=10;
this._emailsData=new Array();
this._historyWidgets=new Array();
this._ticketStartTime=new Date();
},{initComponents:function(){
this.setReply(new app.view.tickets.Reply(this.el.replyContainer));
this.getReply().setParent(this);
if(qu.user.isAdmin()||(qu.user.isAgent()&&quConfig.agentDeleteTickets=="y")){
this.el.cmdDeleteTicket.style.display="block";
}else{
this.el.cmdDeleteTicket.style.display="none";
}
},initConnections:function(){
dojo.event.connectOnce(this.el.showTicketHistory,"onclick",this,"onShowHistory");
dojo.event.connectOnce(this.el.showCustomFields,"onclick",this,"onShowCustomFields");
dojo.event.connectOnce(this.el.expandAllMails,"onclick",this,"expandAllMails");
dojo.event.connectOnce(this.el.cmdBack,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdCloseTicket,"onclick",this,"onCloseTicket");
dojo.event.connectOnce(this.el.cmdDeleteTicket,"onclick",this,"onDeleteTicket");
dojo.event.connectOnce(this.getReply(),"onHide",this,"onReplyHide");
dojo.event.connectOnce(this.el.owner,"onChange",this,"updateTicketOwner");
dojo.event.connectOnce(this.el.queue,"onChange",this,"updateTicketQueue");
dojo.event.connectOnce(this.el.status_,"onChange",this,"updateTicketStatus");
dojo.event.connectOnce(this.el.priority,"onChange",this,"updateTicketPriority");
dojo.event.connectOnce(this.el.cmdResolveTicket,"onclick",this,"onResolveTicket");
dojo.event.connectOnce(this.el.cmdFollowingEmails,"onclick",this,"onFollowingEmails");
},initExportTicket2PDF:function(_119a){
if(_119a){
this.el.exportTicket2PDF.href="../server/print.php?ticket_id="+_119a+"&timeoffset="+qu.user.getClientServerTimeOffset();
this.el.exportTicket2PDF.style.display="inline";
}else{
this.el.exportTicket2PDF.href="#";
this.el.exportTicket2PDF.style.display="none";
}
},expandAllMails:function(){
this.emailsPerPage=this.getEmailsCount();
this.onFollowingEmails();
this.emailsPerPage=10;
dojo.lang.forEach(this.getEmails(),function(_119b){
_119b.expandBody();
});
},onShowHistory:function(){
if(this.el.showTicketHistoryLabel.innerHTML==app.i18n.get("showTicketHistory")){
this.el.showTicketHistoryLabel.innerHTML=app.i18n.get("hideTicketHistory");
dojo.lang.forEach(this._historyWidgets,function(_119c){
_119c.getDomNode().style.display="block";
});
}else{
this.el.showTicketHistoryLabel.innerHTML=app.i18n.get("showTicketHistory");
dojo.lang.forEach(this._historyWidgets,function(_119d){
_119d.getDomNode().style.display="none";
});
}
},initTicketFields:function(){
var rs=this.getResultSet();
if(rs.getString("t_status").valueOf()!="r"&&qu.user.isUser()){
this.el.cmdResolveTicket.style.display="block";
}
if(qu.user.isPowerUser()){
app.main.hashMaps.fill(this.el.status_,"statuses",true,rs.getString("t_status").valueOf());
app.main.hashMaps.fill(this.el.priority,"priorities",true,rs.getString("t_priority").valueOf());
app.main.hashMaps.fill(this.el.queue,"queues",true,rs.getString("t_queue_id").valueOf());
this.el.owner.removeAll();
this.el.owner.add("none","&nbsp;");
var owner=rs.getString("t_agent_owner_id").valueOf();
if(owner=="null"||owner==""){
owner="none";
}
app.main.hashMaps.fill(this.el.owner,"agents",false,owner);
this.el.queue.setWidth("150px");
this.el.priority.setWidth("150px");
this.el.status_.setWidth("150px");
this.el.owner.setWidth("150px");
this.setUpdateVisible(true);
}
},setResultSet:function(_11a0){
this._resultSet=_11a0;
},getResultSet:function(){
return this._resultSet;
},getReply:function(){
return this._reply;
},setReply:function(_11a1){
this._reply=_11a1;
},setParent:function(_11a2){
this._parent=_11a2;
},getParent:function(){
return this._parent;
},onCloseTicket:function(){
},onDeleteTicket:function(){
if(confirm(app.i18n.get("ReallyDelete"))&&(qu.user.isAdmin()||quConfig.agentDeleteTickets=="y")){
var _11a3=new qu.rpc.Service("Tickets");
_11a3.setThrobber(app.i18n.get("Deleting"));
var def=_11a3.deleteTicket({sid:qu.user.getSid(),ticket_id:this.getTicketId(),subject_ticket_id:this.getSubjectTicketId()});
def.addCallback(this,"onDeleteTicketSuccess");
def.addErrback(this,"onDeleteTicketFail");
}
},onDeleteTicketSuccess:function(){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.hide();
},onDeleteTicketFail:function(_11a5){
app.main.msgBox.print(_11a5);
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.tickets.TicketEdit"));
},onLoad:function(){
this.setTicketStartTime();
this.el.showCustomFields.style.display="none";
this.setShowCustomFields(false);
if(this.getResultSet()!=null){
this.el.userLabel.style.display="block";
this.setId(this.getSubjectTicketId());
this.setSubject(this.getTicketSubject());
this.setCustomer(this.getTicketCustomer());
this.resetForm();
this.getMailsData();
this.msgBox.clear();
this.hideFollowingEmailsCmd();
this.initTicketFields();
this.el.showTicketHistoryLabel.innerHTML=app.i18n.get("showTicketHistory");
this.el.cmdPopup.href=quConfig.bootFilename+"#tid="+this.getSubjectTicketId();
this.el.cmdPopup.style.display="block";
this.el.idIcon.style.display="inline";
this.initExportTicket2PDF(this.getTicketId());
}else{
this.el.cmdPopup.style.display="none";
this.hideFollowingEmailsCmd();
this.setId("");
this.setSubject(app.i18n.get("newTicket"));
this.resetForm();
this.setUpdateVisible(false);
this.el.showTicketHistory.style.display="none";
this.getReply().setMode(app.view.tickets.Reply.MODE_NEW);
this.getReply().show();
this.el.userLabel.style.display="none";
this.el.idIcon.style.display="none";
this.el.expandAllMails.style.display="none";
this.initExportTicket2PDF(false);
}
},onShow:function(){
if(this.getResultSet()!=null){
this.setTicketStartTime();
var state={changeUrl:"tid="+this.getSubjectTicketId()};
dojo.undo.browser.addToHistory(state);
}
},resetForm:function(){
this.getEmails().length=0;
this.el.emailsContainer.innerHTML="";
this.setTicketStartTime();
},setTicketId:function(_11a7){
this._ticketId=_11a7;
},getTicketId:function(){
return this._ticketId;
},setTicketSubject:function(_11a8){
this._ticketSubject=_11a8;
},getTicketSubject:function(){
return this._ticketSubject;
},getTicketCustomer:function(){
if(this.getTicketCustomerName().length>0){
return this.getTicketCustomerName()+" ("+this.getTicketCustomerEmail()+")";
}else{
return this.getTicketCustomerEmail();
}
},setTicketCustomerName:function(_11a9){
this._ticketCustomerName=_11a9;
},getTicketCustomerName:function(){
return this._ticketCustomerName;
},setTicketCustomerEmail:function(_11aa){
this._ticketCustomerEmail=_11aa;
},getTicketCustomerEmail:function(){
return this._ticketCustomerEmail;
},setCustomerId:function(id){
this._customerId=id;
},getCustomerId:function(){
return this._customerId;
},setId:function(_11ac){
this.el.ticketId.innerHTML=_11ac;
},getId:function(){
return this.el.ticketId.innerHTML;
},setSubject:function(_11ad){
this.el.ticketSubject.innerHTML=qu.string.escapeHtmlTags(_11ad);
},getSubject:function(){
return this.el.ticketSubject.innerHTML;
},setCustomer:function(_11ae){
if(_11ae){
_11ae=qu.string.escapeHtmlTags(_11ae);
this.el.ticketCustomer.innerHTML=_11ae;
this.el.ticketCustomer.href=quConfig.bootFilename+"#uid="+this.getCustomerId();
this.el.userLabel.style.display="block";
}else{
this.el.userLabel.style.display="none";
}
},getMailsData:function(){
var mails=new qu.rpc.Service("Tickets");
if(!qu.user.isUser()){
mails.addPushRequest("onlineAgents","Users","getOnlineAgents",{sid:qu.user.getSid()});
}
var def=mails.getMailsData({sid:qu.user.getSid(),ticket_id:this.getTicketId()});
def.addCallback(dojo.lang.hitch(this,"onGetMailsDataSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onGetMailsDataSuccess:function(_11b1){
this.result=_11b1;
this.rawCustomFields=new qu.sql.ResultSet();
this.rawCustomFields.createFromObject(this.result["custom"]);
this.rawEmails=new qu.sql.ResultSet();
this.rawEmails.createFromObject(this.result["mails"]);
this.rawAttachments=new qu.sql.ResultSet();
this.rawAttachments.createFromObject(this.result["attachments"]);
this.rawUsers=new qu.sql.ResultSet();
this.rawUsers.createFromObject(this.result["users"]);
this.rawHistory=new qu.sql.ResultSet();
this.rawHistory.createFromObject(this.result["history"]);
this.rawFirstBody=new qu.sql.ResultSet();
if(this.rawEmails.getMetaData().getCount()>0&&this.result["firstBody"]){
this.rawFirstBody.createFromObject(this.result["firstBody"]);
}
this.loadHistory();
this.parseEmails();
this.parseCustomFields(this.rawCustomFields);
if(this.getEmails().length>1){
this.el.expandAllMails.style.display="inline";
}else{
this.el.expandAllMails.style.display="none";
}
},parseCustomFields:function(_11b2){
this.el.customFieldsContainer.innerHTML="";
if(_11b2.getCount()>0){
var _11b3=new app.widget.TicketCustomFields(this,_11b2);
this.el.customFieldsContainer.appendChild(_11b3.getDomNode());
this.el.showCustomFields.style.display="inline";
var _11b4=dojo.io.cookie.getCookie("show_custom_fields");
if((_11b4!=null&&_11b4.length>0&&_11b4=="true")||!_11b3.isEmpty()){
this.setShowCustomFields(true);
}
}else{
this.el.showCustomFields.style.display="none";
}
},onShowCustomFields:function(){
if(this.el.showCustomFieldsLabel.innerHTML==app.i18n.get("showCustomFields")){
dojo.io.cookie.setCookie("show_custom_fields","true",365);
this.setShowCustomFields(true);
}else{
dojo.io.cookie.setCookie("show_custom_fields","false",365);
this.setShowCustomFields(false);
}
},setShowCustomFields:function(_11b5){
if(_11b5){
this.el.showCustomFieldsLabel.innerHTML=app.i18n.get("hideCustomFields");
this.el.customFieldsContainer.style.display="block";
}else{
this.el.showCustomFieldsLabel.innerHTML=app.i18n.get("showCustomFields");
this.el.customFieldsContainer.style.display="none";
}
},loadHistory:function(){
var _11b6=this.rawHistory;
this.arrHistoryEntries=new Array();
_11b6.beforeFirst();
while(_11b6.next()){
var _11b7=new app.data.HistoryEntry();
_11b7.setCreated(_11b6.getDate("created"));
if(_11b6.getString("created_by_user_id")!=""){
var user=new app.data.email.User();
user.setId(_11b6.getString("created_by_user_id").valueOf());
user.setName(_11b6.getString("created_name").valueOf());
user.setEmail(_11b6.getString("created_email").valueOf());
user.setType(_11b6.getString("created_user_type").valueOf());
user.setQuality(_11b6.getNumber("created_email_quality").valueOf());
_11b7.setCreatedBy(user);
}else{
_11b7.setCreatedBy(null);
}
if(_11b6.getString("new_agent_owner_id")!=""){
var user=new app.data.email.User();
user.setId(_11b6.getString("new_agent_owner_id").valueOf());
user.setName(_11b6.getString("agent_name").valueOf());
user.setEmail(_11b6.getString("agent_email").valueOf());
user.setType(_11b6.getString("agent_user_type").valueOf());
user.setQuality(_11b6.getNumber("agent_email_quality").valueOf());
_11b7.setNewAgent(user);
}else{
_11b7.setNewAgent(null);
}
_11b7.setNewStatus(_11b6.getString("new_status").valueOf());
_11b7.setNewQueueName(_11b6.getString("queue_name").valueOf());
_11b7.setNewPriority(_11b6.getString("new_priority").valueOf());
historyWidget=new app.widget.HistoryEntry(_11b7,this);
historyWidget.getDomNode().style.display="none";
this.arrHistoryEntries.push(historyWidget);
this._historyWidgets.push(historyWidget);
}
if(this.arrHistoryEntries.length>0){
this.el.showTicketHistory.style.display="inline";
}
return this.arrHistoryEntries;
},parseEmails:function(){
var _11b9=this.rawEmails;
var _11ba=this.rawFirstBody;
var _11bb=this.rawAttachments;
var users=this.rawUsers;
var _11bd=0;
while(_11bd<this.emailsPerPage&&_11b9.next()){
var email=new app.data.Email();
while(this.arrHistoryEntries[0]!=null&&this.arrHistoryEntries[0].getModel().getCreated()>=_11b9.getDate("created")){
var _11bf=this.arrHistoryEntries.shift();
this.el.emailsContainer.appendChild(_11bf.getDomNode());
}
email.setId(_11b9.getString("mail_id").valueOf());
email.setSubject(_11b9.getString("subject").valueOf());
email.setCreated(_11b9.getDate("created"));
email.setAnswered(_11b9.getString("is_answered"));
email.setAge(_11b9.getNumber("age"));
email.setAccountId(_11b9.getString("account_id").valueOf());
email.setAccountName(_11b9.getString("account_name").valueOf());
email.setAccountEmail(_11b9.getString("account_email").valueOf());
email.setDeliveryStatus(_11b9.getString("delivery_status").valueOf());
email.setDeliveryDate(_11b9.getDate("delivery_date"));
email.setIsComment(_11b9.getString("is_comment").valueOf());
if(_11bd==0){
while(_11ba.next()){
email.setBody(_11ba.getString("body").valueOf());
email.setHtmlBody(_11ba.getString("body_html").valueOf());
}
}
_11bb.beforeFirst();
while(_11bb.next()){
if(_11bb.getString("mail_id").valueOf()==email.getId()){
var _11c0=new app.data.email.Attachment();
_11c0.setId(_11bb.getString("file_id").valueOf());
_11c0.setFilename(_11bb.getString("filename").valueOf());
_11c0.setSize(_11bb.getNumber("filesize").valueOf());
_11c0.setType(_11bb.getString("filetype").valueOf());
_11c0.setContentId(_11bb.getString("contentid").valueOf());
email.addAttachment(_11c0);
}
}
users.beforeFirst();
while(users.next()){
if(users.getString("mail_id").valueOf()==email.getId()){
var user=new app.data.email.User();
user.setId(users.getString("user_id").valueOf());
user.setName(users.getString("name").valueOf());
user.setEmail(users.getString("email").valueOf());
user.setType(users.getString("user_type").valueOf());
user.setQuality(users.getNumber("email_quality").valueOf());
var _11c2=users.getString("mail_role").valueOf();
switch(_11c2){
case "from_user":
email.setWroteByUser(user);
break;
case "from":
email.setFromUser(user);
break;
case "reply-to":
email.setReplyToUser(user);
break;
case "to":
email.addToUser(user);
break;
case "cc":
email.addCcUser(user);
break;
}
}
}
if(email.getWroteByUser()==null){
if(email.getReplyToUser()==null){
email.setWroteByUser(email.getFromUser());
}else{
email.setWroteByUser(email.getReplyToUser());
}
}
if(email.getFromUser()==null){
var _11c3=new app.data.email.User();
_11c3.setId(false);
_11c3.setName(app.i18n.get("customerDeleted"));
_11c3.setEmail("");
_11c3.setType("u");
email.setFromUser(_11c3);
}
this.getEmailsData().push(email);
emailWidget=new app.widget.Email(email,this);
this.getEmails().push(emailWidget);
this.el.emailsContainer.appendChild(emailWidget.getDomNode());
if(this.getEmails().length==1){
emailWidget.onSubjectClick();
}
_11bd++;
}
if(this.getEmailsCount()>this.emailsPerPage){
this.showFollowingEmailsCmd();
}else{
var _11bf=null;
while(_11bf=this.arrHistoryEntries.shift()){
this.el.emailsContainer.appendChild(_11bf.getDomNode());
}
}
},getFollowingEmailsCount:function(){
var rest=this.getEmailsCount()-(this.getOffset()*this.emailsPerPage);
if(rest>this.emailsPerPage){
return this.emailsPerPage;
}else{
return rest;
}
},getEmailsCount:function(){
return this.rawEmails.getMetaData().getCount();
},setSubjectTicketId:function(_11c5){
this._subjectTicketId=_11c5;
},getSubjectTicketId:function(){
return this._subjectTicketId;
},getEmails:function(){
return this._emails;
},onHide:function(){
this.getEmails().length=0;
this.getEmailsData().length=0;
this.setOffset(1);
this.setReplyVisible(false);
dojo.undo.browser.addToHistory({changeUrl:"tickets"});
},setUpdateVisible:function(_11c6){
if(_11c6===true){
this.el.updateBar.style.display="block";
if(qu.user.isUser()){
this.el.userUpdateBar.style.display="block";
}else{
this.el.agentUpdateBar.style.display="block";
}
}else{
this.el.updateBar.style.display="none";
this.el.agentUpdateBar.style.display="none";
this.el.userUpdateBar.style.display="none";
}
},setReplyVisible:function(_11c7){
if(_11c7){
this.setUpdateVisible(false);
this.hideToolbars();
this.getReply().setTicketId(this.getTicketId());
this.getReply().show();
}else{
this.getReply().hide();
this.setUpdateVisible(true);
this.showToolbars();
}
},onReplyHide:function(){
this.setUpdateVisible(true);
this.showToolbars();
},getTicketQueue:function(){
if(this.getResultSet()==null){
var queue=dojo.io.cookie.getCookie("reply_queue_id");
if(queue!=null&&queue.length>0){
return queue;
}else{
return quConfig.defaultQueue;
}
}
return this._getFirstIndexOfArray(this.el.queue.getSelection());
},setTicketQueue:function(_11c9){
this.el.queue.select(_11c9);
},getTicketStatus:function(){
return this._getFirstIndexOfArray(this.el.status_.getSelection());
},setTicketStatus:function(_11ca){
this.el.status_.select(_11ca);
},getTicketPriority:function(){
if(this.getResultSet()==null){
return quConfig.defaultPriority;
}
return this._getFirstIndexOfArray(this.el.priority.getSelection());
},setTicketPriority:function(_11cb){
this.el.priority.select(_11cb);
},getTicketOwner:function(){
var owner=this._getFirstIndexOfArray(this.el.owner.getSelection());
if(owner=="none"){
owner="";
}
return owner;
},setTicketOwner:function(_11cd){
this.el.owner.select(_11cd);
},_getFirstIndexOfArray:function(_11ce){
if(_11ce.length>0){
return _11ce[0];
}
return "";
},updateTicketStatus:function(){
var _11cf=new Object();
_11cf["status"]=this.getTicketStatus();
this.ticketUpdate(_11cf,"onUpdateSuccess");
},updateTicketOwner:function(){
var _11d0=new Object();
_11d0.agent_owner_id=this.getTicketOwner();
this.ticketUpdate(_11d0,"onUpdateSuccess");
},updateTicketQueue:function(){
var _11d1=new Object();
_11d1.queue_id=this.getTicketQueue();
this.ticketUpdate(_11d1,"onUpdateSuccess");
},updateTicketPriority:function(){
var _11d2=new Object();
_11d2.priority=this.getTicketPriority();
this.ticketUpdate(_11d2,"onUpdateSuccess");
},onResolveTicket:function(){
var _11d3=new Object();
_11d3["status"]="r";
this.ticketUpdate(_11d3,"onResolveSuccess");
},onResolveSuccess:function(_11d4){
this.onUpdateSuccess(_11d4);
this.hide();
},ticketUpdate:function(_11d5,_11d6){
var _11d7=new qu.rpc.Service("Tickets");
var _11d7=new qu.rpc.Service("Tickets");
_11d7.setThrobber(app.i18n.get("saving"));
var def=_11d7.updateTicket({ticket_id:this.getTicketId().valueOf(),fields:_11d5,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,_11d6));
def.addErrback(dojo.lang.hitch(this,"onUpdateFail"));
},onUpdateSuccess:function(_11d9){
app.main.msgBox.print(app.i18n.get("ticketUpdated"));
},onUpdateFail:function(_11da){
app.main.msgBox.print(_11da);
},hideToolbars:function(){
dojo.lang.forEach(this.getEmails(),function(_11db){
_11db.hideToolbar();
});
},showToolbars:function(){
dojo.lang.forEach(this.getEmails(),function(_11dc){
_11dc.showToolbar();
});
},setOffset:function(_11dd){
this._offset=_11dd;
},getOffset:function(){
return this._offset;
},increaseOffset:function(){
this._offset+=1;
},showFollowingEmailsCmd:function(inStr){
this.el.cmdFollowingEmails.innerHTML=app.i18n.get("Following")+" "+this.getFollowingEmailsCount()+" ("+app.i18n.get("Total")+" "+this.getEmailsCount()+")";
this.el.cmdFollowingEmails.style.display="inline";
},hideFollowingEmailsCmd:function(){
this.el.cmdFollowingEmails.style.display="none";
},onFollowingEmails:function(){
var start=this.emailsPerPage*this.getOffset();
var end=start+this.getFollowingEmailsCount();
this.parseEmails();
this.increaseOffset();
if(this.getFollowingEmailsCount()<1){
this.hideFollowingEmailsCmd();
}else{
this.showFollowingEmailsCmd();
}
},getEmailsData:function(){
return this._emailsData;
},getTicketStartTime:function(){
return this._ticketStartTime;
},setTicketStartTime:function(){
this._ticketStartTime=new Date();
}});
dojo.provide("app.view.Tickets2");
dojo.require("app.view.tickets.Filter");
dojo.require("app.view.tickets.GridInitializer");
dojo.require("app.view.tickets.TicketEdit");
dojo.declare("app.view.Tickets2",qu.gui.Frame,function(){
this.setTicketToOpen(false);
this.setRemoteFilter(false);
this.setFilter(new app.data.Filter());
this.isFirstTime=true;
},{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Tickets2"));
},initComponents:function(){
this.initGrid();
this.initFrames();
if(qu.user.isPowerUser()){
this.initSavedFilters();
}
this.initToolBar();
if(qu.user.isUser()){
this.updateGridParams();
this.updateGrid();
}
},initGrid:function(){
app.view.tickets.GridInitializer.initialize(this.el.grid);
this.el.grid.setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
this.el.grid.init();
},initFrames:function(){
if(qu.user.isPowerUser()){
this.filter=new app.view.tickets.Filter(this.el.filtersContainer);
this.filter.setParent(this);
this.filter.setRemoteFilter(this.getRemoteFilter());
this.filter.setGrid(this.el.grid);
}
this.editTicket=new app.view.tickets.TicketEdit(this.el.editContent);
this.editTicket.setParent(this);
},initUpdateFields:function(){
if(!qu.user.isUser()){
this.el.status_.setWidth("120px");
this.el.priority.setWidth("120px");
this.el.owner.setWidth("120px");
this.el.queue.setWidth("120px");
this.el.owner.removeAll();
this.el.owner.add("nochange",app.i18n.get("changeOwner"));
this.el.owner.add("","");
app.main.hashMaps.fill(this.el.owner,"agents",false);
this.el.queue.removeAll();
this.el.queue.add("nochange",app.i18n.get("changeQueue"));
app.main.hashMaps.fill(this.el.queue,"queues",false);
this.el.status_.removeAll();
this.el.status_.add("nochange",app.i18n.get("changeStatus"));
app.main.hashMaps.fill(this.el.status_,"statuses",false);
this.el.priority.removeAll();
this.el.priority.add("nochange",app.i18n.get("changePriority"));
app.main.hashMaps.fill(this.el.priority,"priorities",false);
this._resetUpdateFields();
}
},initToolBar:function(){
if(qu.user.isUser()){
this._setUpdateVisible(false);
this._setFiltersVisible(false);
}else{
this._setUpdateVisible(true);
this._setFiltersVisible(true);
if(qu.user.isAgent()&&quConfig.agentDeleteTickets!="y"){
this.el.cmdDelete.style.display="none";
}
}
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdFilters,"onClick",this,"cmdFilters_onClick");
dojo.event.connectOnce(this.el.cmdUpdates,"onClick",this,"cmdUpdates_onClick");
dojo.event.connectOnce(this.el.grid,"onCheckboxClick",this,"onRowSelect");
dojo.event.connectOnce(this.el.grid,"selectAll",this,"onRowSelect");
dojo.event.connectOnce(this.el.cmdUpdate,"onclick",this,"onUpdateCommand");
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.filterSelector.domNode,"onchange",this,"filterSelector_onChange");
dojo.event.kwConnect({srcObj:this,srcFunc:"onLoad",adviceObj:this,adviceFunc:function(){
this.isFirstTime=false;
},once:true,maxCalls:1});
dojo.event.kwConnect({srcObj:this.el.grid,srcFunc:"update",adviceObj:this,adviceFunc:"_setRefreshInterval",adviceType:"before",once:true});
dojo.event.connectOnce(this,"onHide",this,"_clearRefreshInterval");
dojo.event.connectOnce(this,"onAdd",this,"_clearRefreshInterval");
dojo.event.connectOnce(this.editTicket,"show",this,"_clearRefreshInterval");
dojo.event.connectOnce(this,"onDelete",this,"_clearRefreshInterval");
dojo.event.connectOnce(this.filter,"onChange",this,"resetFilterSelector");
dojo.event.connectOnce(this.filter,"onApply",this,"resetFilterSelector");
dojo.event.connectOnce(this.filter,"onApply",this,"applyFilter");
dojo.event.connectOnce(this.filter,"onClear",this,"resetFilterSelector");
dojo.event.connectOnce(this.filter,"onClear",this,"applyFilter");
dojo.event.connectOnce(this.filter,"onSaved",this,"refreshFilterList");
dojo.event.connectOnce(this.el.cmdDeleteFilter,"onClick",this,"onDeleteFilter");
dojo.event.connectOnce(this.el.cmdAdd,"onClick",this,"onAdd");
dojo.event.connectOnce(this.el.cmdGoToTicketId,"onClick",this,"onGoToTicketId");
dojo.event.connectOnce(this.el.goToTicketId,"onkeypress",this,"onGoToTicketIdEnter");
dojo.event.connectOnce(this.el.cmdQuickSearch,"onClick",this,"onQuickSearch");
dojo.event.connectOnce(this.el.quickSearch,"onkeypress",this,"onQuickSearchEnter");
dojo.event.connectOnce(this.getParent().el.ticketsLabel,"onclick",this,"updateGrid");
},onLoad:function(){
this.initUpdateFields();
if(qu.user.isPowerUser()){
this.el.quickSearchElement.style.display="inline";
}else{
this.el.quickSearchElement.style.display="none";
}
this.setFilterSelectorVisible((qu.user.isPowerUser()&&this.el.filterSelector.domNode.options.length>0));
if(!this.isFirstTime){
this.updateGrid();
}
if(this.getTicketToOpen()!==false){
this.openTicket(this.getTicketToOpen());
}
},onShow:function(){
},onHide:function(){
if(this.editTicket.isDisplayed()){
this.editTicket.hide();
this.showContent();
}
},cmdFilters_onClick:function(){
var _11e1=this.el.cmdFilters.isChecked()?"show":"hide";
this.filter[_11e1]();
},cmdUpdates_onClick:function(){
var _11e2=this.el.cmdUpdates.isChecked()?"block":"none";
this.el.updateContainer.style.display=_11e2;
},onRowSelect:function(){
if(!qu.user.isUser()&&this.el.grid.getSelectedRows()!=null){
this.el.cmdUpdates.setChecked(true);
this.el.updateContainer.style.display="block";
}
},onEdit:function(inRow,inCol){
if(inCol==9||inCol==10){
return;
}
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editTicket.setTicketId(rs.getString("t_ticket_id").valueOf());
this.editTicket.setSubjectTicketId(rs.getString("t_subject_ticket_id").valueOf());
this.editTicket.setTicketSubject(rs.getString("t_first_subject").valueOf());
this.editTicket.setTicketCustomerName(rs.getString("customer_name").valueOf());
this.editTicket.setTicketCustomerEmail(rs.getString("customer_email").valueOf());
this.editTicket.setCustomerId(rs.getString("t_customer_id").valueOf());
this.editTicket.setResultSet(this.el.grid.getModel().getResultSet());
dojo.event.connectOnce(this.editTicket,"hide",this,"showContent");
dojo.event.connectOnce(this.editTicket,"hide",this,"updateGrid");
this.hideContent();
this.editTicket.show();
},filterSelector_onChange:function(){
var key=this.el.filterSelector.getSelectedValue();
if(key==""){
this.setLastFilterId(false);
this.setFilter(new app.data.Filter());
this.el.cmdDeleteFilter.hide();
}else{
this.getParent().prependFilter(key,this.el.filterSelector.getSelectedText());
this.setFilter(this._getSavedFilterDefinition(key));
this.setLastFilterId(key);
this.el.cmdDeleteFilter.show();
}
this.updateFilterRss();
this.applyFilter();
},updateFilterRss:function(){
if(this.el!=null){
if(this.getFilter().getId()){
this.el.filterRss.style.display="inline";
this.el.filterRss.href=quConfig.applicationURL+"server/rss.php?fid="+this.getFilter().getId()+"&hash="+qu.user.getHash();
}else{
this.el.filterRss.style.display="none";
this.el.filterRss.href="#";
}
}
},onUpdateCommand:function(){
var _11e7=this.el.grid.getSelectionByColumn("t_ticket_id");
if(_11e7.length==0){
alert(app.i18n.get("selectSomething"));
return false;
}
var _11e8=new qu.rpc.Service("Tickets");
_11e8.setThrobber(app.i18n.get("updating"));
var _11e9=this.el.status_.getSelectedValue();
var _11ea=this.el.priority.getSelectedValue();
var owner=this.el.owner.getSelectedValue();
var queue=this.el.queue.getSelectedValue();
var _11ed=new Object();
if(_11e9!="nochange"){
_11ed["status"]=_11e9;
}
if(_11ea!="nochange"){
_11ed["priority"]=_11ea;
}
if(owner!="nochange"){
_11ed["agent_owner_id"]=owner;
}
if(queue!="nochange"){
_11ed["queue_id"]=queue;
}
var def=_11e8.updateTicket({ticket_id:_11e7,sid:qu.user.getSid(),fields:_11ed});
dojo.event.connectOnce(this,"onUpdateSuccess",this.el.grid,"update");
def.addCallback(dojo.lang.hitch(this,"onUpdateSuccess"));
def.addErrback(this,"onUpdateFail");
},onUpdateFail:function(_11ef){
app.main.msgBox.print(_11ef);
},onUpdateSuccess:function(){
app.main.msgBox.print(app.i18n.get("Updated"));
this._resetUpdateFields();
},onDelete:function(_11f0){
var _11f1=this.el.grid.getSelectionByColumn("t_ticket_id").join("|");
if(_11f1==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _11f2=new qu.rpc.Service("Tickets");
_11f2.setThrobber(app.i18n.get("Deleting"));
var def=_11f2.deleteTicket({sid:qu.user.getSid(),ticket_id:this.el.grid.getSelectionByColumn("t_ticket_id").join("|"),subject_ticket_id:this.el.grid.getSelectionByColumn("t_subject_ticket_id").join("|")});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_11f4){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_11f5){
app.main.msgBox.print(_11f5);
},onDeleteFilter:function(){
if(!qu.user.isAdmin()&&app.main.hashMaps.getTicketsFiltersIsGlobal().item(this.el.filterSelector.getSelectedValue())=="y"){
alert(app.i18n.get("YouAreNotAllowedToDeleteGlobalFilter"));
return;
}
if(confirm(app.i18n.get("ReallyDeleteSavedFilter"))){
var key=this.el.filterSelector.getSelectedValue();
var _11f7=new qu.rpc.Service("Filters");
_11f7.setThrobber(app.i18n.get("Deleting"));
var def=_11f7.deleteFilter({sid:qu.user.getSid(),filter_id:key});
def.addCallback(this,"onDeleteFilterSuccess");
def.addErrback(this,"onDeleteFilterFail");
}
},onDeleteFilterSuccess:function(){
app.main.msgBox.print(app.i18n.get("FilterDeleted"));
var key=this.el.filterSelector.getSelectedValue();
this.el.filterSelector.remove(key);
this.getParent().deleteFilter(key);
if(this.el.filterSelector.domNode.options.length==1){
this.setFilterSelectorVisible(false);
}
this.setFilter(new app.data.Filter());
if(this.filter.isDisplayed()){
this.filter._setFilter();
}
this.applyFilter();
this.updateFilterRss();
},onDeleteFilterFail:function(_11fa){
app.main.msgBox.print(_11fa);
},onAdd:function(){
this.editTicket.setTicketId("");
this.editTicket.setSubjectTicketId("");
this.editTicket.setTicketSubject("");
this.editTicket.setTicketCustomerName("");
this.editTicket.setTicketCustomerEmail("");
this.editTicket.setCustomerId("");
this.editTicket.setResultSet(null);
dojo.event.connectOnce(this.editTicket,"hide",this,"showContent");
dojo.event.connectOnce(this.editTicket,"hide",this,"updateGrid");
this.hideContent();
this.editTicket.show();
},onGoToTicketIdEnter:function(_11fb){
if(_11fb.keyCode==_11fb.KEY_ENTER){
this.onGoToTicketId();
}
},onGoToTicketId:function(){
if(this.getGoToTicketId().length>0){
this.openTicket(this.getGoToTicketId());
}
this.setGoToTicketId("");
},onQuickSearch:function(){
this.getFilter().setBody(this.el.quickSearch.value);
this.filter.setFilterBody(this.el.quickSearch.value);
this.el.quickSearch.value="";
this.applyFilter();
},onQuickSearchEnter:function(_11fc){
if(_11fc.keyCode==_11fc.KEY_ENTER){
this.onQuickSearch();
}
},applyFilter:function(){
if(this.editTicket.isDisplayed()){
this.editTicket.hide();
this.showContent();
}
this.el.grid.setPage(1);
this.updateGridParams();
this.updateGrid();
},updateGridParams:function(){
var _11fd=new qu.rpc.Service("Tickets");
_11fd.addPushRequestIf(qu.user.isPowerUser(),"onlineAgents","Users","getOnlineAgents",{sid:qu.user.getSid()});
with(this.el.grid.getModel()){
setService(_11fd);
setMethod("getTicketsList");
setDefaultParams(this._gridParams());
}
with(this.el.grid){
if(this.getFilter().getSortColumn()){
setSortColumn(this.getFilter().getSortColumn());
}
if(this.getFilter().getSortOrder()){
setSortOrder(this.getFilter().getSortOrder());
}
if(this.getFilter().getHeight()&&this.getFilter().getHeight()!=getHeight()){
setHeight(this.getFilter().getHeight());
}
}
},updateGrid:function(){
if(this.editTicket.isDisplayed()){
this.editTicket.hide();
this.showContent();
}
this.el.grid.update();
},initSavedFilters:function(){
this.el.filterSelector.removeAll();
this.el.filterSelector.add("","");
app.main.hashMaps.fill(this.el.filterSelector,"ticketsFilters",false,dojo.lang.hitch(this,function(elm,_11ff){
if(_11ff.getIterator().get()!=null){
this.setFilterSelectorVisible(true);
if(this.getRemoteFilter()!==false){
elm.select(this.getRemoteFilter());
this.setRemoteFilter(false);
}else{
if(this.getLastFilterId()){
elm.select(this.getLastFilterId());
}else{
this.el.cmdDeleteFilter.hide();
}
}
}else{
this.setFilterSelectorVisible(false);
}
this.setFilter(this._getSavedFilterDefinition(elm.getSelectedValue()));
this.updateFilterRss();
this.updateGridParams();
this.updateGrid();
}));
},resetFilterSelector:function(){
this.el.filterSelector.select("");
this.el.cmdDeleteFilter.hide();
this.setLastFilterId(false);
this.updateFilterRss();
},refreshFilterList:function(){
this.el.filterSelector.removeAll();
this.el.filterSelector.add("","");
app.main.hashMaps.fill(this.el.filterSelector,"ticketsFilters",false,dojo.lang.hitch(this,function(elm,_1201){
this.getParent().updateFilters();
if(_1201.getIterator().get()!=null){
var _1202=_1201.getIterator().get().key;
elm.select(_1202);
this.setLastFilterId(_1202);
this.setFilterSelectorVisible(true);
this.el.cmdDeleteFilter.show();
}else{
this.setFilterSelectorVisible(false);
}
}));
this.updateFilterRss();
},showContent:function(){
this.el.editContent.style.display="none";
this.el.mainContent.style.display="block";
},hideContent:function(){
this.el.mainContent.style.display="none";
this.el.editContent.style.display="block";
},openTicket:function(inId){
var _1204=new qu.rpc.Service("Tickets");
var def=_1204.getTicketsList({sid:qu.user.getSid(),subject_ticket_id:inId});
def.addCallback(this,function(_1206){
var rs=_1206;
if(rs.md.getCount()==0){
throw app.i18n.get("TicketDoesNotExist")+": <i>"+inId+"</i>";
}
rs.first();
this.editTicket.setTicketId(rs.getString("t_ticket_id").valueOf());
this.editTicket.setSubjectTicketId(rs.getString("t_subject_ticket_id").valueOf());
this.editTicket.setTicketSubject(rs.getString("t_first_subject").valueOf());
this.editTicket.setTicketCustomerName(rs.getString("customer_name").valueOf());
this.editTicket.setTicketCustomerEmail(rs.getString("customer_email").valueOf());
this.editTicket.setCustomerId(rs.getString("t_customer_id").valueOf());
this.editTicket.setResultSet(rs);
dojo.event.connectOnce(this.editTicket,"hide",this,"showContent");
dojo.event.connectOnce(this.editTicket,"hide",this,"updateGrid");
this.editTicket.show();
});
def.addErrback(this,function(_1208){
this.showContent();
this.updateGrid();
app.main.msgBox.print(_1208);
});
this.setTicketToOpen(false);
this.hideContent();
},_updateGrid:function(){
},_gridParams:function(){
var _1209=new Object();
_1209.sid=qu.user.getSid();
if(qu.user.isPowerUser()){
dojo.lang.mixin(_1209,this.getFilter().createParamsForRpc());
}
return _1209;
},_getSavedFilterDefinition:function(inKey){
if(inKey&&inKey!=""){
return new app.data.Filter(dojo.json.evalJson(app.main.hashMaps.getTicketsFiltersValues().item(inKey)),inKey);
}
return new app.data.Filter();
},_setUpdateVisible:function(_120b){
if(_120b===true){
this.el.cmdUpdates.show();
}else{
this.el.cmdUpdates.hide();
}
},_setFiltersVisible:function(_120c){
if(_120c===true){
this.el.cmdFilters.show();
}else{
this.el.cmdFilters.hide();
}
},_resetUpdateFields:function(){
this.el.status_.selectByValue("nochange");
this.el.priority.selectByValue("nochange");
this.el.owner.selectByValue("nochange");
this.el.queue.selectByValue("nochange");
},_clearRefreshInterval:function(){
this.el.grid.setUpdateInterval(0);
},_setRefreshInterval:function(){
this.el.grid.setUpdateInterval(120);
},setRemoteFilter:function(_120d){
this._remoteFilter=_120d;
this.setFilter(this._getSavedFilterDefinition(_120d));
if(_120d!=false){
this.setLastFilterId(_120d);
if(this.el){
this.updateGridParams();
}
}
if(_120d&&this.el){
this.el.filterSelector.select(_120d);
this.el.cmdDeleteFilter.show();
}
this.updateFilterRss();
},getRemoteFilter:function(){
return this._remoteFilter;
},setFilterSelectorVisible:function(_120e){
if(_120e==true){
this.el.filterSelector.show();
this.el.filterSelectorLabel.style.display="inline";
}else{
this.el.filterSelector.hide();
this.el.filterSelectorLabel.style.display="none";
this.el.cmdDeleteFilter.hide();
}
},getLastFilterId:function(){
return app.config.getCookie("lastFilterId");
},setLastFilterId:function(_120f){
app.config.setCookie("lastFilterId",_120f);
},setFilter:function(_1210){
this._filter=_1210;
},getFilter:function(){
return this._filter;
},getGoToTicketId:function(){
return dojo.string.trim(this.el.goToTicketId.value);
},setGoToTicketId:function(_1211){
this.el.goToTicketId.value=_1211;
},setTicketToOpen:function(inId){
this._ticketToOpen=inId;
},getTicketToOpen:function(){
return this._ticketToOpen;
}});
dojo.provide("app.view.Outbox");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.Outbox",qu.gui.Frame,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onClick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdRetry,"onClick",this,"onRetry");
},onDelete:function(){
var _1213=this.el.grid.getSelectionByColumn("out_id").join("|");
if(_1213==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var mails=new qu.rpc.Service("OutboxMails");
var def=mails.deleteMail({sid:qu.user.getSid(),out_id:_1213});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_1216){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.updateGrid();
},onDeleteFail:function(_1217){
app.main.msgBox.print(_1217);
},onRetry:function(){
var _1218=this.el.grid.getSelectionByColumn("out_id").join("|");
if(_1218==""){
alert(app.i18n.get("selectSomething"));
return false;
}
var mails=new qu.rpc.Service("OutboxMails");
var def=mails.retryMail({sid:qu.user.getSid(),out_id:_1218});
def.addCallback(dojo.lang.hitch(this,"onRetrySuccess"));
def.addErrback(dojo.lang.hitch(this,"onRetryFail"));
},onRetrySuccess:function(_121b){
app.main.msgBox.print(app.i18n.get("scheduledAgain"));
this.updateGrid();
},onRetryFail:function(_121c){
app.main.msgBox.print(_121c);
},updateGrid:function(){
var _121d=new qu.rpc.Service("OutboxMails");
with(this.el.grid.getModel()){
setService(_121d);
setMethod("getMailsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.setPage(1);
this.el.grid.update();
},initComponents:function(){
with(this.el.grid){
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _1220=rs.getDate(col);
return _1220.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("scheduled",{caption:app.i18n.get("scheduled"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _1223=rs.getDate(col);
return _1223.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("subject",{caption:app.i18n.get("subject"),sortable:true,width:"50%",style:{cursor:"pointer"},bind:function(col,rs){
var _1226=rs.getString("error_msg").valueOf();
if(_1226.length>0){
return "<span title=\""+rs.getString(col)+"\">"+rs.getString(col)+"</span><br/><span style=\"color: red; white-space:normal;\" title=\""+_1226+"\">"+_1226+"</span>";
}else{
return "<span title=\""+rs.getString(col)+"\">"+rs.getString(col)+"</span>";
}
}});
setColumn("recipients",{caption:app.i18n.get("recipients"),sortable:true,width:"25%",style:{cursor:"pointer"},bind:function(col,rs){
return "<span title=\""+rs.getString(col)+"\">"+rs.getString(col)+"</span>";
}});
setColumn("email",{caption:app.i18n.get("sentBy"),sortable:true,width:"25%",style:{cursor:"pointer"},bind:function(col,rs){
var _122b="";
var _122c="";
if(rs.getString("user_id")==qu.user.getId()){
_122c=" style='font-weight: bold;'";
}
if(rs.getString(col)=="null"){
return app.i18n.get("server");
}else{
if(rs.getString("name").length>0){
_122b="<span title=\""+rs.getString(col)+"\""+_122c+">"+rs.getString("name")+"</span>";
}else{
_122b="<span title=\""+rs.getString(col)+"\""+_122c+">"+rs.getString(col)+"</span>";
}
}
return _122b;
}});
setColumn("last_retry",{caption:app.i18n.get("lastRetry"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
if(rs.getString(col).valueOf()==""||rs.getString(col).valueOf()=="null"){
return "";
}
var _122f=rs.getDate(col);
return _122f.print(app.i18n.get("dateFormat"));
}});
setColumn("retry_nr",{caption:app.i18n.get("retry_nr"),sortable:true,style:{cursor:"pointer"},width:"50px"});
setColumn("status",{caption:app.i18n.get("_status"),sortable:true,width:"50px",style:{cursor:"pointer"},bind:function(col,rs){
var stat=rs.getString("status").valueOf();
switch(stat){
case "s":
return app.i18n.get("sending");
case "p":
return app.i18n.get("pending");
default:
return app.i18n.get("unknown");
}
}});
setOnCellClickCallback(dojo.lang.hitch(this,"onGoToTicket"));
setMultiselect(true);
setSortColumn("scheduled");
setSortOrder(qu.widget.Grid.SORT_ASC);
setColor("black");
setHeight(50);
}
this.el.grid.init();
},onGoToTicket:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
app.main.tabs.tickets.setTicketToOpen(rs.get("subject_ticket_id").valueOf());
app.main.showTab("tickets");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Outbox"));
},onLoad:function(){
this.updateGrid();
}});
dojo.provide("qu.widget.DmTreeLoadingController");
dojo.require("dojo.widget.TreeBasicController");
dojo.require("dojo.event.*");
dojo.require("qu.rpc.Service");
dojo.widget.defineWidget("qu.widget.DmTreeLoadingController",dojo.widget.TreeBasicController,{widgetType:"DmTreeLoadingController",namespace:"qu",service:"",fillInTemplate:function(){
this.serviceClass=this.getService();
},getService:function(){
try{
var _1236=new qu.rpc.Service(this.service);
return _1236;
}
catch(inError){
dojo.raise(inError);
}
},expand:function(node,sync,_1239,_123a){
if(node.state==node.loadStates.UNCHECKED&&node.isFolder){
node.state=node.loadStates.LOADING;
this.loadRemote(node,sync,this,function(){
this.expand(node,sync,_1239,_123a);
});
return;
}
dojo.widget.TreeBasicController.prototype.expand.apply(this,arguments);
},canMove:function(child,_123c){
return false;
},canCreateChild:function(_123d,index,data){
return true;
},loadRemote:function(node,sync,_1242,_1243){
node.markLoading();
params={sid:qu.user.getSid(),tree_path:node.item.getFullTreePath(),orderid:node.item.getOrderId()};
var def=this.serviceClass.getProductOrdersList(params);
def.addCallback(this,function(_1245){
this.onLoadRemote(node,_1245);
});
},onLoadRemote:function(_1246,_1247){
var _1248,_1249;
var _124a=false;
var len=_1246.children.length;
for(i=0;i<len;i++){
_1246.removeNode(_1246.children[0]);
}
if(_1247.getCount()>0){
while(_1247.next()){
var item=new app.data.downloadmanager.Item(_1247);
item.setLoaded(false);
_1248=new Object();
var _124d=parseInt(_1247.get("children_count"));
_1248.title=item.getName();
_1248.isFolder=item.isFolder();
_1249=dojo.widget.createWidget("TreeNode",_1248);
_1249.item=item;
_1246.addChild(_1249);
_124a=true;
}
this.expand(_1246);
}else{
_1246.unMarkLoading();
}
}});
dojo.provide("app.data.downloadmanager.Item");
dojo.require("qu.sql.ResultSet");
dojo.declare("app.data.downloadmanager.Item",null,function(){
this._childrenCount=null;
this._loaded=false;
this._treePath=null;
this._orderid=null;
this._productid=null;
this._name=null;
this._subTitle=null;
this._productCode=null;
if(arguments[0] instanceof qu.sql.ResultSet){
this.load(arguments[0]);
}
},{setProductId:function(_124e){
this._productid=_124e;
},getProductId:function(){
return this._productid;
},setOrderId:function(_124f){
this._orderid=_124f;
},getOrderId:function(){
return this._orderid;
},setTreePath:function(_1250){
this._treePath=_1250;
},getTreePath:function(){
return this._treePath;
},getFullTreePath:function(){
if(this.getOrderId()==0||this.getOrderId()==null){
return this.getTreePath();
}
return this.getTreePath()+this.getProductId()+"|";
},setName:function(_1251){
this._name=_1251;
},getName:function(){
return this._name;
},setSubTitle:function(_1252){
this._subTitle=_1252;
},getSubTitle:function(){
return this._subTitle;
},setProductCode:function(_1253){
this._productCode=_1253;
},getProductCode:function(){
return this._productCode;
},setChildrenCount:function(_1254){
this._childrenCount=_1254;
},getChildrenCount:function(){
return this._childrenCount;
},isFolder:function(){
return (this.getChildrenCount()>0);
},setLoaded:function(_1255){
this._loaded=_1255;
},isLoaded:function(){
return this._loaded;
},load:function(_1256){
var _1257=function(_1258){
var value=_1256.get(_1258);
if(value!=null){
return value.valueOf();
}
return value;
};
this.setOrderId(_1257("orderid"));
this.setProductId(_1257("productid"));
this.setTreePath(_1257("tree_path"));
this.setName(_1257("name"));
this.setSubTitle(_1257("product_subtitle"));
this.setProductCode(_1257("product_code"));
this.setChildrenCount(_1257("children_count"));
},serialize:function(){
var _125a=new Object();
var _125b=function(inKey,_125d){
if(_125d!=null){
_125a[inKey]=_125d;
}
};
_125b("orderid",this.getOrderId());
_125b("productid",this.getProductId());
_125b("tree_path",this.getTreePath());
_125b("name",this.getName());
_125b("product_subtitle",this.getSubTitle());
_125b("product_code",this.getProductCode());
_125b("children_count",this.getChildrenCount());
return _125a;
}});
dojo.provide("app.view.downloadmanager.PreviewTree");
dojo.require("dojo.widget.Tree");
dojo.require("dojo.widget.TreeSelector");
dojo.require("qu.widget.DmTreeLoadingController");
dojo.require("app.data.downloadmanager.Item");
dojo.declare("app.view.downloadmanager.PreviewTree",qu.gui.Frame,function(){
this._selectedNode=null;
},{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.downloadmanager.PreviewTree"));
},initComponents:function(){
this.tree=dojo.widget.byId("CMTreeDownloadManager");
this.tree.expandIconSrcLoading=dojo.uri.moduleUri("qu.widget","templates/images/treenode_loading.png");
this.treeSelector=dojo.widget.byId("dmTreeSelector");
},initConnections:function(){
dojo.event.topic.subscribe("dmNodeSelected",this,"onNodeSelected");
},onLoad:function(){
if(this.tree!=null){
this._initTree();
}
},_initTree:function(){
var _125e=new app.data.downloadmanager.Item();
_125e.setName("<b>"+app.i18n.get("YourProducts")+"</b>");
_125e.setOrderId(0);
_125e.setProductId(0);
_125e.setTreePath("0|");
if(this.rootNode!=null){
this.remove(this.rootNode);
this.rootNode=null;
}
this.rootNode=this.createTreeNode(_125e);
this.tree.addChild(this.rootNode);
this.treeSelector.doSelect(this.rootNode);
this.tree.controller.expand(this.rootNode);
},createTreeNode:function(_125f){
var _1260=new Object();
_1260.title=_125f.getName();
_1260.isFolder=true;
var _1261=dojo.widget.createWidget("TreeNode",_1260);
_1261.item=_125f;
return _1261;
},onNodeSelected:function(_1262){
this._selectedNode=_1262.node;
this.onChange();
},getSelectedNode:function(){
if(this._selectedNode==null){
return this.rootNode;
}
return this._selectedNode;
},onChange:function(){
},removeAllChildren:function(_1263){
var _1264=_1263.children;
var len=_1264.length;
for(i=0;i<len;i++){
_1263.removeNode(_1264[0]);
}
},remove:function(_1266){
if(_1266.parent){
this.select(_1266.parent);
}
this.tree.removeNode(_1266);
},selectNodeById:function(_1267,inId){
var _1269=null,nodes=_1267.children;
dojo.lang.forEach(nodes,function(elm,index,arr){
if(elm.item.getOrderId()==inId){
this.select(elm);
_1269=elm;
}
},this);
return _1269;
},select:function(_126e){
var _126f=this.getSelectedNode();
if(!_126e||!_126e.isTreeNode){
return;
}
if(_126f&&_126f.isTreeNode){
this.treeSelector.deselect();
this.treeSelector.doSelect(_126e);
this._selectedNode=_126e;
}
}});
dojo.provide("app.view.Downloads");
dojo.require("qu.gui.Frame");
dojo.require("app.view.downloadmanager.PreviewTree");
dojo.lang.declare("app.view.Downloads",qu.gui.Frame,null,{initConnections:function(){
dojo.event.connectOnce(this.treeViewDm,"onChange",this,"onNodeSelected");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadAttachments");
},initComponents:function(){
this.treeViewDm=new app.view.downloadmanager.PreviewTree(this.el.dmTreeContainer);
this.treeViewDm.setParent(this);
this.treeViewDm.show();
this.resetForm();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Downloads"));
},onLoad:function(){
},onLoadAttachments:function(id,_1271){
if(id=="DmPreviewLoadAttachments"){
this.resetAttachments(_1271.getCount());
this.loadAttachments(_1271);
}
},resetForm:function(){
this.setName("");
this.setSubTitle("");
this.setDescription("");
this.setProductCode("");
this.setValidFrom(""),this.setValidUntil("");
this.setMaxDownloads("");
this.setDownloads("");
this.setOrderCreated("");
this.setLicenseId("");
this.resetAttachments(0);
this.el.dmContent.style.display="none";
this.el.noContent.style.display="block";
},resetAttachments:function(count){
this._attachments=new Array();
if(count==0){
this.el.attachmentsContent.innerHTML=app.i18n.get("NoFilesAttached");
}else{
this.el.attachmentsContent.innerHTML="";
}
},onNodeSelected:function(){
this.loadItem();
},loadItem:function(){
this.resetForm();
if(this.treeViewDm.getSelectedNode().item.getOrderId().valueOf()!="0"&&this.treeViewDm.getSelectedNode().item.getOrderId().valueOf()!="-1"){
var _1273=new qu.rpc.Service("ProductOrders");
_1273.addPushRequest("DmPreviewLoadAttachments","Attachments","getDmAttachmentsList",{sid:qu.user.getSid(),productid:this.treeViewDm.getSelectedNode().item.getProductId().valueOf()});
var def=_1273.getProductOrder({sid:qu.user.getSid(),orderid:this.treeViewDm.getSelectedNode().item.getOrderId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}
},onLoadSuccess:function(_1275){
this.hideLoading();
var rs=_1275;
rs.first();
this.setName(rs.get("name"));
this.setSubTitle(rs.get("product_subtitle"));
this.setDescription(rs.get("description"));
this.setProductCode(rs.get("product_code"));
this.setValidFrom(rs.getDate("valid_from").print(app.i18n.get("dateFormat")));
if(rs.get("valid_until")==null||rs.get("valid_until")=="null"||rs.get("valid_until")==""){
this.setValidUntil(app.i18n.get("unlimited"));
}else{
this.setValidUntil(rs.getDate("valid_until").print(app.i18n.get("dateFormat")));
}
if(rs.get("max_downloads")==""||rs.get("max_downloads")==0||rs.get("max_downloads")==null){
this.setMaxDownloads(app.i18n.get("unlimited"));
}else{
this.setMaxDownloads(rs.get("max_downloads"));
}
this.setDownloads(rs.get("downloads"));
this.setOrderCreated(rs.getDate("created").print(app.i18n.get("dateTimeFormat")));
this.setLicenseId(rs.get("licenseid"));
this.el.noContent.style.display="none";
this.el.dmContent.style.display="block";
},loadAttachments:function(_1277){
_1277.beforeFirst();
while(_1277.next()){
var _1278=new app.data.email.Attachment();
_1278.setId(_1277.getString("file_id").valueOf());
_1278.setFilename(_1277.getString("filename").valueOf());
_1278.setSize(_1277.getNumber("filesize").valueOf());
_1278.setType(_1277.getString("filetype").valueOf());
this.addAttachment(_1278);
}
},addAttachment:function(_1279){
var _127a=new app.widget.Uploaded(this.el.attachmentsContent,_1279,"&orderid="+this.treeViewDm.getSelectedNode().item.getOrderId().valueOf(),false);
this._attachments.push(_127a);
},setName:function(_127b){
this.el.dmName.innerHTML=_127b;
},setSubTitle:function(_127c){
this.el.dmSubTitle.innerHTML=_127c;
},setDescription:function(_127d){
this.el.dmDescription.innerHTML=_127d;
},setProductCode:function(_127e){
if(dojo.string.trim(_127e)==""||_127e==null||_127e=="null"){
this.el.productCodeRow.style.visibility="hidden";
}else{
this.el.productCodeRow.style.visibility="visible";
}
this.el.dmProductCode.innerHTML=_127e;
},setValidFrom:function(_127f){
this.el.dmValidFrom.innerHTML=_127f;
},setValidUntil:function(_1280){
this.el.dmValidUntil.innerHTML=_1280;
},setMaxDownloads:function(_1281){
this.el.dmMaxDownloads.innerHTML=_1281;
},setDownloads:function(_1282){
this.el.dmDownloads.innerHTML=_1282;
},setOrderCreated:function(_1283){
this.el.dmCreated.innerHTML=_1283;
},setLicenseId:function(_1284){
this.el.dmLicenseId.innerHTML=_1284;
}});
dojo.provide("qu.widget.ListBox");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("dojo.html.style");
dojo.widget.defineWidget("qu.widget.ListBox",dojo.widget.HtmlWidget,function(){
this.options=new Array();
this._multiselect=true;
this.selection=new Object();
this.currentIndex=0;
this.model=new qu.widget.listbox.Model();
},{namespace:"qu",widgetType:"ListBox",isContainer:false,quId:"",templateString:"<div id=\"${this.widgetId}\" class=\"quListBox\">"+"<div style=\"margin-bottom: 5px; display:none;\">"+"<a href=\"javascript://\" dojoAttachPoint=\"cmdRefresh\">Refresh</a>"+"</div>"+"<div class=\"content\" dojoAttachPoint=\"contentNode\">"+"</div>"+"<div style=\"margin-top: 5px;\">"+"<span>Select </span>"+"<a href=\"javascript://\" dojoAttachPoint=\"cmdSelectAll\">all</a> / "+"<a href=\"javascript://\" dojoAttachPoint=\"cmdSelectNone\">none</a>"+"</div"+"</div>",templateCssPath:dojo.uri.dojoUri("../qu/widget/templates/css/ListBox.css?"+djConfig.cacheBust),fillInTemplate:function(){
this.initConnections();
},add:function(inKey,_1286){
this.addItem(inKey,_1286);
},addItem:function(_1287,_1288){
this.currentIndex++;
var div=document.createElement("div");
div.className="option";
div.setAttribute("_value",_1287);
var chck=document.createElement("input");
chck.setAttribute("type","checkbox");
if(!this.isMultiselect()){
chck.style.display="none";
}
var txt=document.createElement("span");
txt.innerHTML=_1288;
div.appendChild(chck);
div.appendChild(txt);
var _128c=new qu.widget.listbox.Option(_1287,_1288);
_128c.setDomNode(div);
_128c.setIndex(this.currentIndex);
this.options.push(_128c);
dojo.event.connectOnce(div,"onclick",this,"onRowClick");
dojo.event.connectOnce(chck,"onclick",this,"onChildClick");
dojo.event.connectOnce(txt,"onclick",this,"onChildClick");
this.contentNode.appendChild(div);
},initConnections:function(){
dojo.event.connectOnce(this.cmdRefresh,"onclick",this,"getData");
dojo.event.connectOnce(this.cmdSelectAll,"onclick",this,"selectAll");
dojo.event.connectOnce(this.cmdSelectNone,"onclick",this,"selectNone");
},removeItem:function(_128d){
var len=this.options.length;
for(var i;i>=len;i++){
if(this.options[i].getIndex()==_128d){
this.contentNode.removeChild(this.options[i].getDomNode());
this.options[i].splice(i,1);
}
}
},removeAll:function(){
this.contentNode.innerHTML="";
this.options=new Array();
this.currentIndex=0;
this.selection=new Object();
},selectAll:function(){
var len=this.options.length;
this.selection=new Object();
var _1291;
for(var i=0;i<len;i++){
_1291=this.options[i];
_1291.setSelected(true);
this.selection[_1291.getValue()]=_1291;
}
},deselectAll:function(){
this.selectNone();
},selectNone:function(){
var len=this.options.length;
this.selection=new Object();
var _1294;
for(var i=0;i<len;i++){
_1294=this.options[i];
_1294.setSelected(false);
}
},select:function(inKey){
this.selectByValue(inKey);
},selectByValue:function(_1297){
var len=this.options.length;
var _1299;
for(var i=0;i<len;i++){
_1299=this.options[i];
if(_1299.getValue()==_1297){
_1299.setSelected(true);
this.selection[_1299.getValue()]=_1299;
}
}
},onRowClick:function(_129b){
var _129c=_129b.target;
this._onClick(_129c);
},onChildClick:function(_129d){
var _129e=dojo.html.getParentByType(_129d.target,"div");
this._onClick(_129e);
},_onClick:function(_129f){
var _12a0=_129f;
var value=_12a0.getAttribute("_value");
var _12a2=this.getOptionByValue(value);
if(_12a2!==false){
if(_12a2.isSelected()){
delete this.selection[value];
_12a2.setSelected(false);
}else{
this.selection[value]=_12a2;
_12a2.setSelected(true);
}
}
this.onChange();
},getSelection:function(){
return this.selection;
},getSelectedValues:function(){
var _12a3=new Array();
for(var each in this.selection){
_12a3.push(this.selection[each].getValue());
}
return _12a3;
},onChange:function(){
},getOptionByValue:function(_12a5){
var l=this.options.length-1;
for(var i=0;i<=l;i++){
if(this.options[i].getValue()==_12a5){
return this.options[i];
}
}
return false;
},setSize:function(_12a8,_12a9){
this.contentNode.style.width=_12a8;
this.contentNode.style.height=_12a9;
},isMultiselect:function(){
return this._multiselect;
},setMultiselect:function(_12aa){
this._multiselect=_12aa;
},getData:function(){
dojo.event.connectOnce(this.getModel(),"onGetDataSuccess",this,"refreshData");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",function(_12ab){
dojo.debug(_12ab);
});
this.selectNone();
this.getModel().getData();
},getModel:function(){
return this.model;
},refreshData:function(){
this.removeAll();
var rs=this.getModel().getResultSet();
var model=this.getModel();
rs.beforeFirst();
while(rs.next()){
var value=rs.getString(model.getValueColumn()).valueOf();
var text=rs.getString(model.getTextColumn()).valueOf();
this.addItem(value,text);
}
this.onLoad();
},onLoad:function(){
},update:function(){
this.getData();
}});
dojo.lang.declare("qu.widget.listbox.Option",null,function(_12b0,_12b1){
this._value=_12b0;
this._text=_12b1;
this._domNode=null;
this._isSelected=false;
this._index=null;
},{getValue:function(){
return this._value;
},getText:function(){
return this._text;
},setIndex:function(_12b2){
this._index=_12b2;
},getIndex:function(){
return this._index;
},getDomNode:function(){
return this._domNode;
},setDomNode:function(_12b3){
this._domNode=_12b3;
},isSelected:function(){
return this._isSelected;
},setSelected:function(_12b4){
this._isSelected=_12b4;
if(_12b4===true){
dojo.html.removeClass(this.getDomNode(),"nonselected");
dojo.html.addClass(this.getDomNode(),"selected");
this.getDomNode().getElementsByTagName("input")[0].checked=true;
return;
}
dojo.html.removeClass(this.getDomNode(),"selected");
dojo.html.addClass(this.getDomNode(),"nonselected");
this.getDomNode().getElementsByTagName("input")[0].checked=false;
}});
dojo.lang.declare("qu.widget.listbox.Model",qu.rpc.Model,function(){
this._columnValue=null;
this._columnText=null;
},{setValueColumn:function(_12b5){
this._columnValue=_12b5;
},getValueColumn:function(){
return this._columnValue;
},setTextColumn:function(_12b6){
this._columnText=_12b6;
},getTextColumn:function(){
return this._columnText;
}});
dojo.provide("qu.widget.HtmlArea");
dojo.require("dojo.widget.*");
dojo.require("qu.string.conversion");
dojo.widget.defineWidget("qu.widget.HtmlArea",dojo.widget.HtmlWidget,function(){
this.isLoaded=false;
},{namespace:"qu",widgetType:"HtmlArea",isContainer:true,templateString:"<div class=\"quHtmlArea\">"+"<div class=\"toolbar\">"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/bold.gif\" cmd=\"bold\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/italic.gif\" cmd=\"italic\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/underline.gif\" cmd=\"underline\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/strikethrough.gif\" cmd=\"strikethrough\" class=\"button\" />"+"<img src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/delimiter.gif\" style=\"width: 1px; padding-right: 1px; padding-right: 1px;\" class=\"button\"/>"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/justifyleft.gif\" cmd=\"JustifyLeft\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/justifyright.gif\" cmd=\"JustifyRight\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/justifycenter.gif\" cmd=\"JustifyCenter\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/justifyfull.gif\" cmd=\"JustifyFull\" class=\"button\" />"+"<img src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/delimiter.gif\" style=\"width: 1px; padding-right: 1px; padding-right: 1px;\" class=\"button\"/>"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/link.gif\" cmd=\"CreateLink\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/unlink.gif\" cmd=\"UnLink\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/bullist.gif\" cmd=\"InsertUnorderedList\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/numlist.gif\" cmd=\"InsertOrderedList\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/indent.gif\" cmd=\"Indent\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/outdent.gif\" cmd=\"Outdent\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/hr.gif\" cmd=\"InsertHorizontalRule\" class=\"button\" />"+"<img dojoAttachEvent=\"onclick:onToolbarClick\" src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/removeformat.gif\" cmd=\"RemoveFormat\" class=\"button\" />"+"<img src=\"${dojoRoot}../qu/widget/templates/images/htmlarea/delimiter.gif\" style=\"width: 1px; padding-right: 3px; padding-right: 1px;\" class=\"button\"/>"+"<select dojoAttachEvent=\"onchange:onFontChange\" cmd=\"FontName\" style=\"margin-bottom: 5px;\">"+"<option value=\"\" selected=\"selected\">Font Name</option>"+"<option value=\"arial\">Arial</option>"+"<option value=\"Arial Narrow\">Arial Narrow</option>"+"<option value=\"courier\">Courier</option>"+"<option value=\"cursive\">Cursive</option>"+"<option value=\"fantasy\">Fantasy</option>"+"<option value=\"georgia\">Georgia</option>"+"<option value=\"impact\">Impact</option>"+"<option value=\"monospace\">Monospace</option>"+"<option value=\"serif\">Serif</option>"+"<option value=\"sans-serif\">Sans Serif</option>"+"<option value=\"tahoma\">Tahoma</option>"+"<option value=\"times\">Times</option>"+"<option value=\"verdana\">Verdana</option>"+"</select>"+"<select dojoAttachEvent=\"onchange:onFontChange\" cmd=\"FontSize\" style=\"margin-bottom: 5px;\">"+"<option value=\"\" selected=\"selected\">Font Size</option>"+"<option value=\"1\">1 (8pt)</option>"+"<option value=\"2\">2 (10pt)</option>"+"<option value=\"3\">3 (12pt)</option>"+"<option value=\"4\">4 (14pt)</option>"+"<option value=\"5\">5 (18pt)</option>"+"<option value=\"6\">6 (24pt)</option>"+"<option value=\"7\">7 (36pt)</option>"+"</select>"+"<select dojoAttachEvent=\"onchange:onFontChange\" cmd=\"ForeColor\" style=\"margin-bottom: 5px;\">"+"<option value=\"\" selected=\"selected\">Color</option>"+"<option value=\"#000000\" style=\"background-color: black; color: white;\">black</option>"+"<option value=\"silver\" style=\"background-color: silver\">silver</option>"+"<option value=\"gray\" style=\"background-color: gray\">gray</option>"+"<option value=\"#FFFFFF\" style=\"background-color: white\">white</option>"+"<option value=\"maroon\" style=\"background-color: maroon\">maroon</option>"+"<option value=\"#FF0000\" style=\"background-color: red\">red</option>"+"<option value=\"purple\" style=\"background-color: purple\">purple</option>"+"<option value=\"fuchsia\" style=\"background-color: fuchsia\">fuchsia</option>"+"<option value=\"#00FF00\" style=\"background-color: green\">green</option>"+"<option value=\"lime\" style=\"background-color: lime\">lime</option>"+"<option value=\"olive\" style=\"background-color: olive\">olive</option>"+"<option value=\"yellow\" style=\"background-color: yellow\">yellow</option>"+"<option value=\"navy\" style=\"background-color: navy\">navy</option>"+"<option value=\"#0000FF\" style=\"background-color: blue\">blue</option>"+"<option value=\"teal\" style=\"background-color: teal\">teal</option>"+"<option value=\"aqua\" style=\"background-color: aqua\">aqua</option>"+"</select>"+"<select dojoAttachEvent=\"onchange:onFontChange\" cmd=\"BackColor\" style=\"margin-bottom: 5px;\">"+"<option value=\"\" selected=\"selected\">Background Color</option>"+"<option value=\"#000000\" style=\"background-color: black; color: white;\">black</option>"+"<option value=\"silver\" style=\"background-color: silver\">silver</option>"+"<option value=\"gray\" style=\"background-color: gray\">gray</option>"+"<option value=\"#FFFFFF\" style=\"background-color: white\">white</option>"+"<option value=\"maroon\" style=\"background-color: maroon\">maroon</option>"+"<option value=\"red\" style=\"background-color: red\">red</option>"+"<option value=\"purple\" style=\"background-color: purple\">purple</option>"+"<option value=\"fuchsia\" style=\"background-color: fuchsia\">fuchsia</option>"+"<option value=\"green\" style=\"background-color: green\">green</option>"+"<option value=\"lime\" style=\"background-color: lime\">lime</option>"+"<option value=\"olive\" style=\"background-color: olive\">olive</option>"+"<option value=\"yellow\" style=\"background-color: yellow\">yellow</option>"+"<option value=\"navy\" style=\"background-color: navy\">navy</option>"+"<option value=\"blue\" style=\"background-color: blue\">blue</option>"+"<option value=\"teal\" style=\"background-color: teal\">teal</option>"+"<option value=\"aqua\" style=\"background-color: aqua\">aqua</option>"+"</select>"+"<select dojoAttachEvent=\"onchange:onStyleChange\" cmd=\"StyleSelection\" style=\"margin-bottom: 5px;\">"+"<option value=\"\" selected=\"selected\">Apply Style</option>"+"<option value=\"code\">Code</option>"+"<option value=\"path\">Path</option>"+"<option value=\"title1\">Title 1</option>"+"<option value=\"title2\">Title 2</option>"+"<option value=\"title3\">Title 3</option>"+"<option value=\"warning\">Warning</option>"+"<option value=\"notice\">Notice</option>"+"</select>"+"</div>"+"<iframe frameborder=\"0\" dojoAttachPoint=\"iframeNode\" src=\"about:blank\" onload=\"try{this.contentWindow.document.designMode='on';}catch(e){};if (typeof this.loadCount == 'undefined') {this.loadCount = 0;} this.loadCount++; if (this.loadCount > 1) {this.onready();}\"\t></iframe>"+"<div style=\"display:none;\" dojoAttachPoint=\"containerNode\"></div>"+"</div>",templateCssString:".quHtmlArea {}"+".quHtmlArea iframe {width: 100%;height: 200px;border: none;background-color: white;margin: 0px;}"+".quHtmlArea .toolbar {height: 23px;overflow: hidden;border: none;margin: 0px;padding-left: 6px;padding-top: 2px;}"+".quHtmlArea .button, .quHtmlArea .button:hover {width: 20px;height: 20px;cursor: pointer;border: none;margin: 0px;padding: 0px;}"+".quHtmlArea .button:hover {background-color: #EEEEEE;padding: 0px;}",quId:"",width:"100%",height:"200px",defaultFont:"Arial",defaultFontSize:"2",fillInTemplate:function(){
this.iframeNode.onready=function(){
};
this.initOnLoadConnections();
this.size();
},initOnLoadConnections:function(){
dojo.event.connectOnce(this.iframeNode,dojo.render.html.ie?"onready":"onload",this,"onLoad");
},initConnections:function(){
},keyPress:function(e){
var _12b8=e.charCode>0?String.fromCharCode(e.charCode):null;
var code=e.keyCode;
var _12ba=true;
if(e.ctrlKey||e.metaKey){
switch(_12b8){
case "b":
this.execCommand("bold");
break;
case "i":
this.execCommand("italic");
break;
case "u":
this.execCommand("underline");
break;
case "Z":
this.execCommand("undo");
break;
case "Y":
this.execCommand("redo");
break;
default:
_12ba=false;
break;
}
}else{
_12ba=false;
}
if(_12ba){
e.preventDefault();
}else{
this.onKeyPress();
}
},onKeyPress:function(_12bb){
},size:function(){
var width=new String(this.width);
if(width.indexOf("%")==-1){
width=parseInt(width)+"px";
}
this.iframeNode.style.width=width;
this.iframeNode.style.height=(parseInt(this.height)-20)+"px";
},setSize:function(_12bd,_12be){
this.width=_12bd;
this.height=_12be;
this.size();
},onLoad:function(){
this.isLoaded=true;
this.initConnections();
if(dojo.render.html.mozilla){
this.execCommand("styleWithCSS",false);
}
this.focus();
if(this.defaultFontSize!=""&&this.defaultFontSize!=null){
this.execCommand("FontSize",this.defaultFontSize);
}
if(this.defaultFont!=null&&this.defaultFont!=""){
this.execCommand("FontName",this.defaultFont);
}
this.setValue(this.containerNode.innerHTML);
if(__Environment__.browser=="Explorer"){
dojo.event.connectOnce(this.iframeNode.contentWindow.document.body,"onkeypress",this,"keyPress");
}else{
dojo.event.browser.addListener(this.iframeNode.contentWindow.document,"keypress",dojo.lang.hitch(this,"keyPress"));
}
},getValue:function(){
try{
return this.iframeNode.contentWindow.document.body.innerHTML;
}
catch(e){
return "";
}
},setValue:function(_12bf){
if(this.isLoaded){
this.iframeNode.contentWindow.document.body.innerHTML=_12bf;
this.resetDesignMode();
}else{
this.initOnLoadConnections();
this.containerNode.innerHTML=_12bf;
}
},onToolbarClick:function(_12c0){
var _12c1=_12c0.target.getAttribute("cmd");
var value=null;
switch(_12c1){
case "CreateLink":
value=prompt("Enter a URL:","http://");
if(value){
value=value+"";
if(value.length>0){
this.execCommand("UnLink",null);
}else{
return false;
}
}else{
return false;
}
break;
default:
break;
}
if(__Environment__.browser!="Opera"){
this.focus();
}
this.execCommand(_12c1,value);
},onFontChange:function(_12c3){
if(_12c3.target.value!=""){
var _12c4=_12c3.target.getAttribute("cmd");
if(__Environment__.browser!="Opera"){
this.focus();
}
this.execCommand(_12c4,_12c3.target.value);
_12c3.target.value="";
this.focus();
}
},onStyleChange:function(_12c5){
if(_12c5.target.value!=""){
var _12c6="";
var _12c7="";
switch(_12c5.target.value){
case "code":
_12c6="<pre style='font:normal 12px courier,serif; color:black; display:block; text-align:left; padding:10px; background-color:#fff7e4; border:1px solid #e6d6ae; overflow:auto; margin-bottom:20px;white-space:pre;'>";
_12c7="</pre>";
break;
case "warning":
_12c6="<div style='font:normal 12px courier,serif; color:red; display:block; text-align:left; padding:10px; background-color:#ffe4e4; border:1px solid #FF0000; overflow:auto; margin-bottom:20px;'>";
_12c7="</div>";
break;
case "notice":
_12c6="<div style='font:normal 12px courier,serif; color:black; display:block; text-align:left; padding:10px; background-color:#DDDDDD; border:1px solid #555555; overflow:auto; margin-bottom:20px;'>";
_12c7="</div>";
break;
case "path":
_12c6="<div style='font:bold 12px arial,verdana,sans-serif; color:black; display:block; text-align:center; padding:10px; background-color:#f3ffe9; border:1px solid #cdebb5; overflow:auto; margin-bottom:20px;'>";
_12c7="</div>";
break;
case "title1":
_12c6="<h1>";
_12c7="</h1>";
break;
case "title2":
_12c6="<h2>";
_12c7="</h2>";
break;
case "title3":
_12c6="<h3>";
_12c7="</h3>";
break;
default:
}
this.surroundSelection(_12c6,_12c7);
_12c5.target.value="";
this.focus();
}
},surroundSelection:function(_12c8,_12c9){
if(_12c8==null){
_12c8="";
}
if(_12c9==null){
_12c9="";
}
if(__Environment__.browser!="Opera"){
this.focus();
}
if(__Environment__.browser=="Explorer"){
var _12ca=this.iframeNode.contentWindow.document;
var _12cb=_12ca.selection.createRange();
var sHtml=_12cb.htmlText;
var _12cd=window.onerror;
window.onerror=function(){
alert("Unable to insert HTML for current selection.");
return true;
};
if(sHtml.length){
if(_12c9&&_12c8){
_12cb.pasteHTML(_12c8+sHtml+_12c9);
}else{
if(_12c8){
_12cb.pasteHTML(_12c8+sHtml);
}else{
if(_12c9){
_12cb.pasteHTML(sHtml+_12c9);
}
}
}
}else{
_12cb.pasteHTML(_12c8+_12c9);
}
window.onerror=_12cd;
_12cb.collapse(false);
_12cb.select();
}else{
var _12ce=this.iframeNode.contentWindow.getSelection();
var _12cf="";
for(var i=0;i<_12ce.getRangeAt(0).cloneContents().childNodes.length;i++){
if(_12ce.getRangeAt(0).cloneContents().childNodes[i].nodeType==3){
_12cf+=_12ce.getRangeAt(0).cloneContents().childNodes[i].textContent;
}else{
_12cf+=this.outerHTML(_12ce.getRangeAt(0).cloneContents().childNodes[i]);
}
}
this.execCommand("inserthtml",_12c8+_12cf+_12c9);
}
},outerHTML:function(node){
var attrs=node.attributes;
var str="<"+node.tagName;
var _12d4={"IMG":true,"BR":true,"INPUT":true,"META":true,"LINK":true,"PARAM":true,"HR":true};
for(var i=0;i<attrs.length;i++){
str+=" "+attrs[i].name+"=\""+attrs[i].value+"\"";
}
if(_12d4[node.tagName]){
return str+">";
}
return str+">"+node.innerHTML+"</"+node.tagName+">";
},replaceSelection:function(_12d6){
if(_12d6==null){
_12d6="";
}
this.focus();
if(__Environment__.browser=="Explorer"){
var _12d7=this.iframeNode.contentWindow.document;
var _12d8=_12d7.selection.createRange();
var sHtml=_12d8.htmlText;
var _12da=window.onerror;
window.onerror=function(){
alert("Unable to insert HTML for current selection.");
return true;
};
_12d8.pasteHTML(_12d6);
window.onerror=_12da;
_12d8.collapse(false);
_12d8.select();
}else{
this.execCommand("inserthtml",_12d6);
}
},execCommand:function(_12db,_12dc){
if(typeof _12dc=="undefined"){
_12dc=null;
}
if(!this.isDesignMode()){
this.resetDesignMode();
}
try{
this.iframeNode.contentWindow.document.execCommand(_12db,false,_12dc);
}
catch(inError){
dojo.debug(inError);
}
},focus:function(){
if(this.isLoaded){
this.resetDesignMode();
if(dojo.render.html.opera){
this.iframeNode.focus();
}else{
this.iframeNode.contentWindow.focus();
}
}else{
dojo.event.connectOnce(this,"onLoad",this,"focus");
}
},resetDesignMode:function(){
if(dojo.render.html.mozilla&&!this.isDesignMode()){
this.setDesignMode(true);
}
},isDesignMode:function(){
var _12dd=this.iframeNode.contentWindow.document.designMode;
if(_12dd.toLowerCase()=="on"){
return true;
}
return false;
},setDesignMode:function(_12de){
var mode="off";
if(_12de===true){
mode="on";
}
try{
this.iframeNode.contentWindow.document.designMode=mode;
if(_12de){
this.disableCss();
}
}
catch(inError){
}
},disableCss:function(){
if(dojo.render.html.mozilla){
try{
this.execCommand("styleWithCSS",false);
}
catch(inError){
}
}
}});
dojo.provide("qu.widget.HtmlEditor");
dojo.require("dojo.widget.*");
dojo.require("qu.string.conversion");
dojo.require("qu.widget.HtmlArea");
dojo.widget.defineWidget("qu.widget.HtmlEditor",dojo.widget.HtmlWidget,function(){
this.MODE_PLAIN="plain";
this.MODE_RICH="rich";
this.MODE_HTML="html";
this.defaultMode=this.MODE_RICH;
this._mode=null;
},{namespace:"qu",widgetType:"HtmlEditor",isContainer:true,widgetsInTemplate:true,templateString:"<div class=\"quHtmlEditor\">"+"<div dojoAttachPoint=\"headerNode\" class=\"header\">"+"<div dojoAttachPoint=\"tabsNode\" class=\"tabs\">"+"<div dojoAttachPoint=\"tabRichNode\" class=\"tab\" style=\"display:none;\">Rich Text</div>"+"<div dojoAttachPoint=\"tabPlainNode\" class=\"tab\" style=\"display:none;\">Plain Text</div>"+"<div dojoAttachPoint=\"tabHtmlNode\" class=\"tab\" style=\"display:none;\">Html</div>"+"</div>"+"</div>"+"<div dojoAttachPoint=\"contentNode\" class=\"content\">"+"<div dojoAttachPoint=\"htmlareaNode\">"+"<div dojoType=\"qu:HtmlArea\" dojoAttachPoint=\"htmlarea\"></div>"+"</div>"+"<div dojoAttachPoint=\"textareaNode\">"+"<textarea dojoAttachPoint=\"textarea\"></textarea>"+"</div>"+"</div>"+"<div dojoAttachPoint=\"footerNode\">"+"<div dojoAttachPoint=\"containerNode\" style=\"display:none;\">"+"</div>",templateCssString:".quHtmlEditor {position: relative;}"+".quHtmlEditor .header {position: relative;}"+".quHtmlEditor .tabs {position: absolute;height: 20px;right: 0px;}"+".quHtmlEditor .tab {float: left;background-color: #EEEEEE;padding: 4px;padding-left: 8px;padding-right: 8px;\tmargin-left: 3px;\tcursor: pointer;}"+".quHtmlEditor .tabActive {background-color: #DDDDDD;}"+".quHtmlEditor .content {position: relative;top: 20px;background-color: #DDDDDD;text-align: left;padding: 0px;border: 1px solid #DDDDDD;overflow: hidden;}"+".quHtmlEditor .content textarea {width: 100%;border: none;}",quId:"",mode:"rich",modes:"plain,rich,html",width:"100%",height:"300px",defaultFont:"Arial",defaultFontSize:"2",fillInTemplate:function(){
if(this.modes!=""){
var modes=this.modes.split(",");
this.isRichEnabled=false;
this.isPlainEnabled=false;
this.isHtmlEnabled=false;
dojo.lang.forEach(modes,function(elm,index,arr){
elm=dojo.string.trim(elm);
if(elm==this.MODE_RICH){
this.isRichEnabled=true;
}
if(elm==this.MODE_PLAIN){
this.isPlainEnabled=true;
}
if(elm==this.MODE_HTML){
this.isHtmlEnabled=true;
}
},this);
if(this.isRichEnabled){
this.tabRichNode.style.display="block";
}
if(this.isPlainEnabled){
this.tabPlainNode.style.display="block";
}
if(this.isHtmlEnabled){
this.tabHtmlNode.style.display="block";
}
}
},postCreate:function(){
this.htmlarea.defaultFont=this.defaultFont;
this.htmlarea.defaultFontSize=this.defaultFontSize;
this.initConnections();
this.size();
if(this.mode!=""){
this.setMode(this.mode);
}else{
this.setMode(this.defaultMode);
}
if(dojo.string.trim(this.containerNode.innerHTML)!=""){
this.setValue(this.containerNode.innerHTML);
}
},initConnections:function(){
dojo.event.connectOnce(this.tabRichNode,"onclick",this,"onRichMode");
dojo.event.connectOnce(this.tabPlainNode,"onclick",this,"onPlainMode");
dojo.event.connectOnce(this.tabHtmlNode,"onclick",this,"onHtmlMode");
dojo.event.connectOnce(this.htmlarea,"onKeyPress",this,"onKeyPress");
dojo.event.connectOnce(this.textarea,"onKeyPress",this,"onKeyPress");
},setValue:function(_12e4){
switch(this.getMode()){
case this.MODE_RICH:
this.htmlarea.setValue(_12e4);
break;
case this.MODE_PLAIN:
case this.MODE_HTML:
this.textarea.value=_12e4;
break;
}
},onKeyPress:function(_12e5){
},getValue:function(){
var value="";
switch(this.getMode()){
case "rich":
value=this.htmlarea.getValue();
break;
case "plain":
case "html":
value=this.textarea.value;
break;
}
return value;
},onRichMode:function(){
this.setMode(this.MODE_RICH);
this.focus();
},onPlainMode:function(){
if(confirm(app.i18n.get("ConfirmPlainText"))){
this.setMode(this.MODE_PLAIN);
this.focus();
}
},onHtmlMode:function(){
this.setMode(this.MODE_HTML);
this.focus();
},setMode:function(_12e7){
if(!_12e7){
return;
}
if(this.getMode()!=_12e7){
switch(_12e7){
case this.MODE_RICH:
this.setModeRich();
break;
case this.MODE_PLAIN:
this.setModePlain();
break;
case this.MODE_HTML:
this.setModeHtml();
break;
}
}
},getMode:function(){
return this._mode==null?null:this._mode.toLowerCase();
},setModeRich:function(){
var value=this.getValue();
this.textareaNode.style.display="none";
this.htmlareaNode.style.display="block";
this.resetDesignMode();
dojo.html.removeClass(this.tabPlainNode,"tabActive");
dojo.html.removeClass(this.tabHtmlNode,"tabActive");
dojo.html.addClass(this.tabRichNode,"tabActive");
if(this.getMode()==this.MODE_PLAIN){
value=qu.string.text2Html(value);
}
this._mode=this.MODE_RICH;
this.setValue(value);
},setModePlain:function(){
var value=this.getValue();
this.htmlareaNode.style.display="none";
this.textareaNode.style.display="block";
dojo.html.removeClass(this.tabHtmlNode,"tabActive");
dojo.html.removeClass(this.tabRichNode,"tabActive");
dojo.html.addClass(this.tabPlainNode,"tabActive");
if(this.getMode()==this.MODE_RICH||this.getMode()==this.MODE_HTML){
value=qu.string.html2Text(value);
}
this._mode=this.MODE_PLAIN;
this.setValue(value);
},setModeHtml:function(){
var value=this.getValue();
this._activateTab(this.MODE_HTML);
if(this.getMode()==this.MODE_RICH){
this.htmlareaNode.style.display="none";
this.textareaNode.style.display="block";
}else{
value=qu.string.text2Html(value);
}
this._mode=this.MODE_HTML;
this.setValue(value);
},_activateTab:function(inTab){
var _12ec=function(_12ed){
return _12ed.substring(0,1).toUpperCase()+_12ed.substring(1).toLowerCase();
};
var _12ee=new Array("rich","plain","html");
var _12ef="remove";
dojo.lang.forEach(_12ee,function(elm,index,arr){
if(inTab==elm){
_12ef="add";
}else{
_12ef="remove";
}
try{
dojo.html[_12ef+"Class"](this["tab"+_12ec(elm)+"Node"],"tabActive");
}
catch(inError){
}
},this);
},resetDesignMode:function(){
this.htmlarea.resetDesignMode();
this.htmlarea.disableCss();
},focus:function(){
var _12f3;
switch(this.getMode()){
case this.MODE_RICH:
_12f3=this.htmlarea;
break;
case this.MODE_PLAIN:
case this.MODE_HTML:
_12f3=this.textarea;
break;
}
try{
_12f3.focus();
}
catch(inError){
}
},size:function(){
var width=new String(this.width);
if(width.indexOf("%")==-1){
width=parseInt(width)+"px";
}
var _12f5=parseInt(this.height);
this.domNode.style.width=width;
this.htmlarea.setSize("100%",_12f5-5);
this.textarea.style.width="100%";
this.textarea.style.height=_12f5+"px";
},getHtml:function(){
var value=this.getValue();
if(this.getMode()==this.MODE_PLAIN){
return qu.string.text2Html(value);
}
return value;
},setHtml:function(_12f7){
if(this.getMode()==this.MODE_PLAIN){
if(this.isRichEnabled){
this.setMode("rich");
this.setValue(_12f7);
}else{
if(this.isHtmlEnabled){
this.setMode("html");
this.setValue(_12f7);
}else{
var value=qu.string.html2Text(_12f7);
this.setValue(value);
}
}
}else{
this.setValue(_12f7);
}
},insertAtCursor:function(_12f9){
if(__Environment__.browser=="Explorer"){
try{
this.textarea.focus();
var _12fa=document.selection.createRange();
_12fa.text=_12f9;
_12fa.collapse(false);
_12fa.select();
}
catch(e){
alert(e);
}
}else{
if(this.textarea.selectionStart||this.textarea.selectionStart=="0"){
var _12fb=this.textarea.selectionStart;
var _12fc=this.textarea.selectionEnd;
this.textarea.value=this.textarea.value.substring(0,_12fb)+_12f9+this.textarea.value.substring(_12fc,this.textarea.value.length);
}else{
this.textarea.value+=_12f9;
}
}
},replaceSelection:function(_12fd){
if(this.getMode()!=this.MODE_RICH){
if(this.getMode()==this.MODE_PLAIN){
_12fd=qu.string.html2Text(_12fd);
}
this.insertAtCursor(_12fd);
}else{
this.htmlarea.replaceSelection(_12fd);
}
}});
dojo.provide("app.view.profile.signatures.Signature");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.lang.declare("app.view.profile.signatures.Signature",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onLoad:function(){
this.resetForm();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.signatures.Signature"));
this.setSize(800,400);
this.center();
},resetForm:function(){
this.setSignature(this._signature);
},onSave:function(){
var _12fe=new Object();
_12fe.queue_id=this.getQueueId();
_12fe.user_id=qu.user.getId();
_12fe.signature=this.getSignature();
var _12ff=new qu.rpc.Service("QueueSignatures");
_12ff.setThrobber(app.i18n.get("saving"));
var def=_12ff.insertSignature({fields:_12fe,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},setQueueId:function(_1301){
this._queueId=_1301;
},getQueueId:function(){
return this._queueId;
},setQueueName:function(_1302){
this.setTitle(_1302);
},getSignature:function(){
return this.el.signature.getHtml();
},setSignature:function(_1303){
if(_1303=="null"||_1303==null){
_1303="";
}
this.el.signature.setHtml(_1303);
},setDataSignature:function(_1304){
this._signature=_1304;
}});
dojo.provide("app.view.profile.QueueSignatures");
dojo.require("qu.gui.Dialog");
dojo.require("app.view.profile.signatures.Signature");
dojo.lang.declare("app.view.profile.QueueSignatures",qu.gui.Dialog,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setColumn("signature_queueid",{caption:app.i18n.get("Signature"),sortable:true,width:"50%",style:{cursor:"pointer"},bind:function(col,rs){
var _1307=rs.get("signature_queueid");
if(_1307==null||_1307=="null"){
return app.i18n.get("useDefaultSignature");
}else{
return app.i18n.get("customSignature");
}
}});
setMultiselect(true);
setSortColumn("name");
setHeight(10);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _1308=new qu.rpc.Service("QueueSignatures");
with(this.el.grid.getModel()){
setService(_1308);
setMethod("getSignaturesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.editSignature=new app.view.profile.signatures.Signature();
this.el.grid.init();
},initConnections:function(){
dojo.event.connectOnce(this.el.dialogClose,"onclick",this,"hide");
dojo.event.connectOnce(this,"onDeleteSuccess",this,"updateGrid");
dojo.event.connectOnce(this.el.delete_,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.grid.getModel(),"onGetDataSuccess",app.main.hashMaps,"initSignaturesSuccess");
},updateGrid:function(){
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.QueueSignatures"));
this.setSize(800,420);
this.center();
this.setTitle(app.i18n.get("customizeSignaturePerQueue"));
},onEdit:function(inRow,inCol){
dojo.event.connectOnce(this.editSignature,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editSignature.setQueueId(rs.get("queue_id").valueOf());
this.editSignature.setQueueName(rs.get("name").valueOf());
this.editSignature.setDataSignature(rs.get("signature"));
this.editSignature.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("queue_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _130d=new qu.rpc.Service("QueueSignatures");
_130d.setThrobber("Deleting...");
var def=_130d.deleteSignature({sid:qu.user.getSid(),queue_id:ids,user_id:qu.user.getId()});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.profile.MyProfile");
dojo.require("qu.gui.Frame");
dojo.require("qu.widget.ListBox");
dojo.require("qu.widget.HtmlArea");
dojo.require("qu.widget.HtmlEditor");
dojo.require("app.view.profile.QueueSignatures");
dojo.lang.declare("app.view.profile.MyProfile",qu.gui.Frame,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
dojo.event.connectOnce(this.el.editCustomSignatures,"onclick",this,"onEditQueueSignatures");
},onLoad:function(){
this.setLoading(true);
this.loadUser();
if(qu.user.isPowerUser()){
this.el.editCustomSignatures.style.display="block";
this.el.emailReadonly.style.display="none";
this.el.email.style.display="block";
}else{
this.el.editCustomSignatures.style.display="none";
this.el.emailReadonly.style.display="block";
this.el.email.style.display="none";
}
if(!quConfig.DownloadManager){
this.el.dmNotifRow.style.visibility="hidden";
}
},onEditQueueSignatures:function(){
if(this.queueSignatures==null){
this.queueSignatures=new app.view.profile.QueueSignatures();
}
this.queueSignatures.show();
},createCustomFields:function(){
inResult=this.customFieldsResult;
this._customFields=new Array();
var _130f=document.createElement("table");
_130f.style.width="100%";
var _1310=document.createElement("tbody");
_130f.appendChild(_1310);
var _1311={};
inResult.beforeFirst();
while(inResult.next()){
if(inResult.getString("field_value").valueOf()=="null"){
_1311["custom_"+inResult.getString("field_id").valueOf()]="";
}else{
_1311["custom_"+inResult.getString("field_id").valueOf()]=inResult.getString("field_value").valueOf();
}
}
_1311["customer_email"]=this.getEmail();
_1311["customer_name"]=this.getName();
_1311["ticket_id"]="";
_1311["ticket_subject"]="";
_1311["ticket_owner"]="";
_1311["queue_name"]="";
inResult.beforeFirst();
while(inResult.next()){
var hTr=document.createElement("tr");
var _1313=document.createElement("td");
_1313.style.width="30%";
_1313.innerHTML=inResult.getString("field_title").valueOf();
hTr.appendChild(_1313);
var _1314=document.createElement("td");
hTr.appendChild(_1314);
var _1315=new app.widget.CustomField(_1314,inResult.getString("field_id").valueOf(),inResult.getString("field_type").valueOf(),inResult.getString("field_value").valueOf(),inResult.getString("options").valueOf(),_1311);
this._customFields.push(_1315);
_1310.appendChild(hTr);
}
if(inResult.getCount()>0){
this.el.additionalInformationContent.innerHTML="";
this.el.additionalInformationContent.appendChild(_130f);
this.el.additionalInformationFieldset.style.display="block";
}else{
this.el.additionalInformationFieldset.style.display="none";
}
},onLoadCustomFields:function(id,_1317){
if(id!="customFieldsMyProfile"){
return true;
}
this.customFieldsResult=_1317;
},setLoading:function(_1318){
this._loading=_1318;
if(_1318){
this.showLoading();
}else{
this.hideLoading();
}
},hideLoading:function(){
this.el.ownWait.style.display="none";
this.el.ownContent.style.display="block";
this.el.signature.resetDesignMode();
},showLoading:function(){
this.el.ownContent.style.display="none";
this.el.ownWait.style.display="block";
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.MyProfile"));
},onSave:function(){
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _1319=new Object();
if(this.getPasswordAgain()!=this.getPassword()){
alert(app.i18n.get("passwordsDoesntMatch"));
this.setPassword("");
this.setPasswordAgain("");
return false;
}
_1319.name=this.getName();
_1319.email=this.getEmail();
_1319.signature=this.getSignature();
_1319.hide_suggestions=this.getHideKBSuggestions();
_1319.disable_dm_notifications=this.getDisableDmNotifications();
if(this.getPassword()!=""){
_1319.password=this.getPassword();
}
this.fields=_1319;
var _131a={fields:_1319,sid:qu.user.getSid()};
var _131b=new Object();
for(var i=0;i<this._customFields.length;i++){
if(this._customFields[i].getValue()==undefined){
_131b[this._customFields[i].getFieldId()]="";
}else{
_131b[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
}
_131a["custom"]=_131b;
var users=new qu.rpc.Service("Users");
users.setThrobber(app.i18n.get("saving"));
var def=users.updateLoggedInUser(_131a);
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onSaveSuccess:function(){
this.setPassword("");
this.setPasswordAgain("");
qu.user.setName(this.fields.name);
qu.user.setUserName(this.fields.email);
qu.user.setSignature(this.fields.signature);
qu.user.setHideSuggestions(this.fields.hide_suggestions);
this.getParent().getParent().updateLoggedAs();
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
app.main.msgBox.print(app.i18n.get("ProfileSuccessfullySaved"));
},onSaveFail:function(_131f){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
app.main.msgBox.print(_131f);
},loadUser:function(){
var users=new qu.rpc.Service("Users");
users.addPushRequest("customFieldsMyProfile","Users","getCustomFieldValues",{sid:qu.user.getSid(),user_id:qu.user.getId()});
var def=users.getLoggedInUser({sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onLoadUserSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadUserFail"));
},onLoadUserSuccess:function(_1322){
var rs=_1322;
rs.first();
this.setName(rs.get("name"));
this.setEmail(rs.get("email"));
this.setSignature(rs.get("signature"));
this.setHideKBSuggestions(rs.get("hide_suggestions"));
this.setDisableDmNotifications(rs.get("disable_dm_notifications"));
this.createCustomFields();
this.setLoading(false);
},onLoadUserFail:function(_1324){
dojo.debug(_1324);
},getName:function(){
return this.el.name.value;
},setName:function(_1325){
this.el.name.value=_1325;
},getEmail:function(){
return this.el.email.value;
},setEmail:function(_1326){
this.el.email.value=_1326;
this.el.emailReadonly.innerHTML=_1326;
},getPassword:function(){
if(this.el.password.value==""){
return "";
}
return dojo.crypto.MD5.compute(this.el.password.value,dojo.crypto.outputTypes.Hex);
},setPassword:function(inPw){
this.el.password.value=inPw;
},getPasswordAgain:function(){
if(this.el.passwordAgain.value==""){
return "";
}
return dojo.crypto.MD5.compute(this.el.passwordAgain.value,dojo.crypto.outputTypes.Hex);
},setPasswordAgain:function(inPw){
this.el.passwordAgain.value=inPw;
},getSignature:function(){
return this.el.signature.getHtml();
},setSignature:function(_1329){
this.el.signature.setHtml(_1329);
},getHideKBSuggestions:function(){
if(this.el.hideKBSuggestions.checked){
return "y";
}
return "n";
},setHideKBSuggestions:function(_132a){
if(_132a==true||_132a=="y"){
this.el.hideKBSuggestions.checked=true;
}else{
if(_132a==false||_132a=="n"){
this.el.hideKBSuggestions.checked=false;
}
}
},getDisableDmNotifications:function(){
if(this.el.disableDmNotifications.checked){
return "y";
}
return "n";
},setDisableDmNotifications:function(_132b){
if(_132b==true||_132b=="y"){
this.el.disableDmNotifications.checked=true;
}else{
if(_132b==false||_132b=="n"){
this.el.disableDmNotifications.checked=false;
}
}
}});
dojo.provide("app.view.profile.notifications.Notification");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.lang.declare("app.view.profile.notifications.Notification",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.ownerCheck,"onclick",this,"onOwnerCheckChange");
dojo.event.connectOnce(this.el.priorityCheck,"onclick",this,"onPriorityCheckChange");
dojo.event.connectOnce(this.el.statusCheck,"onclick",this,"onStatusCheckChange");
dojo.event.connectOnce(this.el.queueCheck,"onclick",this,"onQueueCheckChange");
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onOwnerCheckChange:function(){
if(this.ownerCheck()=="n"){
this.el.toOwners.deselectAll();
this.el.toOwners.hide();
}else{
this.el.toOwners.show();
}
},onStatusCheckChange:function(){
if(this.statusCheck()=="n"){
this.el.toStatuses.deselectAll();
this.el.toStatuses.hide();
}else{
this.el.toStatuses.show();
}
},onQueueCheckChange:function(){
if(this.queueCheck()=="n"){
this.el.toQueues.deselectAll();
this.el.toQueues.hide();
}else{
this.el.toQueues.show();
}
},onPriorityCheckChange:function(){
if(this.priorityCheck()=="n"){
this.el.toPriorities.deselectAll();
this.el.toPriorities.hide();
}else{
this.el.toPriorities.show();
}
},onLoad:function(){
app.main.hashMaps.fill(this.el.toStatuses,"statuses",true);
app.main.hashMaps.fill(this.el.toQueues,"grantedQueues",true);
app.main.hashMaps.fill(this.el.toPriorities,"priorities",true);
app.main.hashMaps.fill(this.el.toOwners,"agents",true);
this.el.ticketOwner.removeAll();
this.el.ticketOwner.add("none",app.i18n.get("notAssigned"));
this.el.ticketOwner.add("answered",app.i18n.get("answeredByMe"));
app.main.hashMaps.fill(this.el.ticketOwner,"agents",false);
app.main.hashMaps.fill(this.el.ticketQueue,"grantedQueues",true);
app.main.hashMaps.fill(this.el.ticketPriority,"priorities",true);
app.main.hashMaps.fill(this.el.ticketStatus,"statuses",true);
this.el.toStatuses.deselectAll();
this.el.toQueues.deselectAll();
this.el.toPriorities.deselectAll();
this.el.toOwners.deselectAll();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.notifications.Notification"));
this.setSize(800,630);
},resetForm:function(){
this.setStatusCheck("n");
this.onStatusCheckChange();
this.setPriorityCheck("n");
this.onPriorityCheckChange();
this.setQueueCheck("n");
this.onQueueCheckChange();
this.setOwnerCheck("n");
this.onOwnerCheckChange();
this.setName("");
this.setSubject("");
this.setBody("");
this.setTicketOwners("");
this.setTicketQueue("");
this.setTicketPriority("");
this.setTicketStatus("");
},isValid:function(){
return this.statusCheck()=="y"||this.priorityCheck()=="y"||this.queueCheck()=="y"||this.ownerCheck()=="y";
},getTicketOwners:function(){
return this.el.ticketOwner.getSelection();
},setTicketOwners:function(_132c){
this.el.ticketOwner.deselectAll();
this.el.ticketOwner.select(_132c);
},getTicketQueue:function(){
return this.el.ticketQueue.getSelection();
},setTicketQueue:function(_132d){
this.el.ticketQueue.deselectAll();
this.el.ticketQueue.select(_132d);
},getTicketPriority:function(){
return this.el.ticketPriority.getSelection();
},setTicketPriority:function(_132e){
this.el.ticketPriority.deselectAll();
this.el.ticketPriority.select(_132e);
},getTicketStatus:function(){
return this.el.ticketStatus.getSelection();
},setTicketStatus:function(_132f){
this.el.ticketStatus.deselectAll();
this.el.ticketStatus.select(_132f);
},getName:function(){
return this.el.name.value;
},setName:function(_1330){
this.el.name.value=_1330;
},getToStatuses:function(){
return this.el.toStatuses.getSelection();
},setToStatuses:function(_1331){
this.el.toStatuses.deselectAll();
this.el.toStatuses.select(_1331);
},getToQueues:function(){
return this.el.toQueues.getSelection();
},setToQueues:function(_1332){
this.el.toQueues.deselectAll();
this.el.toQueues.select(_1332);
},getToPriorities:function(){
return this.el.toPriorities.getSelection();
},setToPriorities:function(_1333){
this.el.toPriorities.deselectAll();
this.el.toPriorities.select(_1333);
},getToOwners:function(){
return this.el.toOwners.getSelection();
},setToOwners:function(_1334){
this.el.toOwners.deselectAll();
this.el.toOwners.select(_1334);
},getSubject:function(){
return this.el.subject.value;
},setSubject:function(_1335){
this.el.subject.value=_1335;
},getBody:function(){
return this.el.body.getHtml();
},setBody:function(_1336){
this.el.body.setHtml(_1336);
},statusCheck:function(){
if(this.el.statusCheck.checked){
return "y";
}
return "n";
},setStatusCheck:function(_1337){
if(_1337==true||_1337=="y"){
this.el.statusCheck.checked=true;
}else{
if(_1337==false||_1337=="n"){
this.el.statusCheck.checked=false;
}
}
},priorityCheck:function(){
if(this.el.priorityCheck.checked){
return "y";
}
return "n";
},setPriorityCheck:function(_1338){
if(_1338==true||_1338=="y"){
this.el.priorityCheck.checked=true;
}else{
if(_1338==false||_1338=="n"){
this.el.priorityCheck.checked=false;
}
}
},queueCheck:function(){
if(this.el.queueCheck.checked){
return "y";
}
return "n";
},setQueueCheck:function(_1339){
if(_1339==true||_1339=="y"){
this.el.queueCheck.checked=true;
}else{
if(_1339==false||_1339=="n"){
this.el.queueCheck.checked=false;
}
}
},ownerCheck:function(){
if(this.el.ownerCheck.checked){
return "y";
}
return "n";
},setOwnerCheck:function(_133a){
if(_133a==true||_133a=="y"){
this.el.ownerCheck.checked=true;
}else{
if(_133a==false||_133a=="n"){
this.el.ownerCheck.checked=false;
}
}
},onSaveSuccess:function(){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.clear();
},onSaveFail:function(_133b){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.print(_133b);
}});
dojo.provide("app.view.profile.notifications.NotificationAdd");
dojo.require("app.view.profile.notifications.Notification");
dojo.lang.declare("app.view.profile.notifications.NotificationAdd",app.view.profile.notifications.Notification,null,{onSave:function(){
if(!this.isValid()){
alert(app.i18n.get("selectNotificationEvent"));
return false;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _133c=new Object();
_133c.name=this.getName();
_133c.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_133c.ticket_queue="|"+this.getTicketQueue().join("|")+"|";
_133c.ticket_priority="|"+this.getTicketPriority().join("|")+"|";
_133c.ticket_status="|"+this.getTicketStatus().join("|")+"|";
_133c.to_statuses="|"+this.getToStatuses().join("|")+"|";
_133c.to_priorities="|"+this.getToPriorities().join("|")+"|";
_133c.to_queues="|"+this.getToQueues().join("|")+"|";
_133c.to_owners="|"+this.getToOwners().join("|")+"|";
_133c.subject=this.getSubject();
_133c.body=this.getBody();
_133c.status_check=this.statusCheck();
_133c.queue_check=this.queueCheck();
_133c.priority_check=this.priorityCheck();
_133c.owner_check=this.ownerCheck();
var _133d=new qu.rpc.Service("Notifications");
_133d.setThrobber(app.i18n.get("saving"));
var def=_133d.insertNotification({fields:_133c,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewNotification"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.resetForm();
this.center();
}});
dojo.provide("app.view.profile.notifications.NotificationEdit");
dojo.require("app.view.profile.notifications.Notification");
dojo.lang.declare("app.view.profile.notifications.NotificationEdit",app.view.profile.notifications.Notification,null,{onSave:function(){
if(!this.isValid()){
alert(app.i18n.get("selectNotificationEvent"));
return false;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _133f=new Object();
_133f.notification_id=this.getNotificationId();
_133f.name=this.getName();
_133f.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_133f.ticket_queue="|"+this.getTicketQueue().join("|")+"|";
_133f.ticket_priority="|"+this.getTicketPriority().join("|")+"|";
_133f.ticket_status="|"+this.getTicketStatus().join("|")+"|";
_133f.to_statuses="|"+this.getToStatuses().join("|")+"|";
_133f.to_priorities="|"+this.getToPriorities().join("|")+"|";
_133f.to_queues="|"+this.getToQueues().join("|")+"|";
_133f.to_owners="|"+this.getToOwners().join("|")+"|";
_133f.subject=this.getSubject();
_133f.body=this.getBody();
_133f.status_check=this.statusCheck();
_133f.queue_check=this.queueCheck();
_133f.priority_check=this.priorityCheck();
_133f.owner_check=this.ownerCheck();
var _1340=new qu.rpc.Service("Notifications");
_1340.setThrobber(app.i18n.get("saving"));
var def=_1340.updateNotification({fields:_133f,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.constructor.superclass.onLoad.apply(this);
dojo.event.connectOnce(this.el.agents,"onLoadNotificationFail",this,"hide");
this.resetForm();
this.loadNotificationSettings();
},loadNotificationSettings:function(){
var _1342=new qu.rpc.Service("Notifications");
var def=_1342.getNotification({sid:qu.user.getSid(),notification_id:this.getNotificationId()});
def.addCallback(dojo.lang.hitch(this,"onLoadNotificationSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadNotificationFail"));
},onLoadNotificationSuccess:function(_1344){
var rs=_1344;
rs.first();
if(rs.rows.length==1){
this.setName(rs.get("name"));
this.setSubject(rs.get("subject"));
this.setBody(rs.get("body"));
this.setStatusCheck(rs.get("status_check"));
this.setQueueCheck(rs.get("queue_check"));
this.setPriorityCheck(rs.get("priority_check"));
this.setOwnerCheck(rs.get("owner_check"));
this.setTicketOwners(rs.get("ticket_owners").split("|"));
this.setTicketQueue(rs.get("ticket_queue").split("|"));
this.setTicketPriority(rs.get("ticket_priority").split("|"));
this.setTicketStatus(rs.get("ticket_status").split("|"));
this.setToStatuses(rs.get("to_statuses").split("|"));
this.setToQueues(rs.get("to_queues").split("|"));
this.setToPriorities(rs.get("to_priorities").split("|"));
this.setToOwners(rs.get("to_owners").split("|"));
this.onOwnerCheckChange();
this.onPriorityCheckChange();
this.onQueueCheckChange();
this.onStatusCheckChange();
this.setLoading(false);
this.el.body.resetDesignMode();
}else{
this.hide();
}
},onLoadNotificationFail:function(_1346){
alert(_1346);
},setNotificationId:function(_1347){
this._notificationId=_1347;
},getNotificationId:function(){
return this._notificationId.toString();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editNotification"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.profile.MyNotifications");
dojo.require("qu.gui.Frame");
dojo.require("app.view.profile.notifications.NotificationAdd");
dojo.require("app.view.profile.notifications.NotificationEdit");
dojo.lang.declare("app.view.profile.MyNotifications",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setColumn("subject",{caption:app.i18n.get("subject"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("name");
setHeight(10);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _1348=new qu.rpc.Service("Notifications");
with(this.el.grid.getModel()){
setService(_1348);
setMethod("getNotificationsList");
setDefaultParams({sid:qu.user.getSid(),user_id:qu.user.getId()});
}
this.addNotification=new app.view.profile.notifications.NotificationAdd();
this.editNotification=new app.view.profile.notifications.NotificationEdit();
this.el.grid.init();
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.add,"onclick",this,"onAdd");
},updateGrid:function(){
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.MyNotifications"));
},onAdd:function(){
dojo.event.connectOnce(this.addNotification,"onSaveSuccess",this.el.grid,"update");
this.addNotification.show();
},onEdit:function(inRow,inCol){
dojo.event.connectOnce(this.editNotification,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editNotification.setNotificationId(rs.get("notification_id"));
this.editNotification.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("notification_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _134d=new qu.rpc.Service("Notifications");
_134d.setThrobber("Deleting...");
var def=_134d.deleteNotification({sid:qu.user.getSid(),notification_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_134f){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1350){
app.main.msgBox.print(_1350);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.profile.gateways.Gateway");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.lang.declare("app.view.profile.gateways.Gateway",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onLoad:function(){
app.main.hashMaps.fill(this.el.statuses,"statuses",true);
app.main.hashMaps.fill(this.el.queues,"queues",true);
app.main.hashMaps.fill(this.el.priorities,"priorities",true);
this.el.ticketOwner.removeAll();
this.el.ticketOwner.add("none",app.i18n.get("notAssigned"));
this.el.ticketOwner.add("answered",app.i18n.get("answeredByMe"));
app.main.hashMaps.fill(this.el.ticketOwner,"agents",false);
this.el.statuses.deselectAll();
this.el.queues.deselectAll();
this.el.priorities.deselectAll();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.gateways.Gateway"));
this.setSize(500,220);
},resetForm:function(){
this.setName("");
this.setStatuses("");
this.setQueues("");
this.setPriorities("");
this.setTicketOwners("");
},getTicketOwners:function(){
return this.el.ticketOwner.getSelection();
},setTicketOwners:function(_1351){
this.el.ticketOwner.deselectAll();
this.el.ticketOwner.select(_1351);
},getName:function(){
return this.el.name.value;
},setName:function(_1352){
this.el.name.value=_1352;
},getStatuses:function(){
return this.el.statuses.getSelection();
},setStatuses:function(_1353){
this.el.statuses.deselectAll();
this.el.statuses.select(_1353);
},getQueues:function(){
return this.el.queues.getSelection();
},setQueues:function(_1354){
this.el.queues.deselectAll();
this.el.queues.select(_1354);
},getPriorities:function(){
return this.el.priorities.getSelection();
},setPriorities:function(_1355){
this.el.priorities.deselectAll();
this.el.priorities.select(_1355);
}});
dojo.provide("app.view.profile.gateways.GatewayAdd");
dojo.require("app.view.profile.gateways.Gateway");
dojo.lang.declare("app.view.profile.gateways.GatewayAdd",app.view.profile.gateways.Gateway,null,{onSave:function(){
var _1356=new Object();
_1356.name=this.getName();
_1356.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1356.statuses="|"+this.getStatuses().join("|")+"|";
_1356.priorities="|"+this.getPriorities().join("|")+"|";
_1356.queues="|"+this.getQueues().join("|")+"|";
var _1357=new qu.rpc.Service("Gateways");
_1357.setThrobber(app.i18n.get("saving"));
var def=_1357.insertGateway({fields:_1356,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewGateway"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.resetForm();
this.center();
}});
dojo.provide("app.view.profile.gateways.GatewayEdit");
dojo.require("app.view.profile.gateways.Gateway");
dojo.lang.declare("app.view.profile.gateways.GatewayEdit",app.view.profile.gateways.Gateway,null,{onSave:function(){
var _1359=new Object();
_1359.gateway_id=this.getGatewayId();
_1359.name=this.getName();
_1359.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1359.statuses="|"+this.getStatuses().join("|")+"|";
_1359.priorities="|"+this.getPriorities().join("|")+"|";
_1359.queues="|"+this.getQueues().join("|")+"|";
var _135a=new qu.rpc.Service("Gateways");
_135a.setThrobber(app.i18n.get("saving"));
var def=_135a.updateGateway({fields:_1359,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.constructor.superclass.onLoad.apply(this);
dojo.event.connectOnce(this.el.agents,"onLoadGatewayFail",this,"hide");
this.resetForm();
this.loadGatewaySettings();
},loadGatewaySettings:function(){
var _135c=new qu.rpc.Service("Gateways");
var def=_135c.getGateway({sid:qu.user.getSid(),gateway_id:this.getGatewayId()});
def.addCallback(dojo.lang.hitch(this,"onLoadGatewaySuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadGatewayFail"));
},onLoadGatewaySuccess:function(_135e){
var rs=_135e;
rs.first();
if(rs.rows.length==1){
this.setName(rs.get("name"));
this.setTicketOwners(rs.get("ticket_owners").split("|"));
this.setStatuses(rs.get("statuses").split("|"));
this.setQueues(rs.get("queues").split("|"));
this.setPriorities(rs.get("priorities").split("|"));
this.setLoading(false);
}else{
this.hide();
}
},onLoadGatewayFail:function(_1360){
alert(_1360);
},setGatewayId:function(_1361){
this._gatewayId=_1361;
},getGatewayId:function(){
return this._gatewayId.toString();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editGateway"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.profile.MyGateways");
dojo.require("qu.gui.Frame");
dojo.require("app.view.profile.gateways.GatewayAdd");
dojo.require("app.view.profile.gateways.GatewayEdit");
dojo.lang.declare("app.view.profile.MyGateways",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"100%",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("name");
setHeight(10);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _1362=new qu.rpc.Service("Gateways");
with(this.el.grid.getModel()){
setService(_1362);
setMethod("getGatewaysList");
setDefaultParams({sid:qu.user.getSid()});
}
this.addGateway=new app.view.profile.gateways.GatewayAdd();
this.editGateway=new app.view.profile.gateways.GatewayEdit();
this.el.grid.init();
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.add,"onclick",this,"onAdd");
},updateGrid:function(){
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.profile.MyGateways"));
},onAdd:function(){
dojo.event.connectOnce(this.addGateway,"onSaveSuccess",this.el.grid,"update");
this.addGateway.show();
},onEdit:function(inRow,inCol){
dojo.event.connectOnce(this.editGateway,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editGateway.setGatewayId(rs.get("gateway_id"));
this.editGateway.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("gateway_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1367=new qu.rpc.Service("Gateways");
_1367.setThrobber("Deleting...");
var def=_1367.deleteGateway({sid:qu.user.getSid(),gateway_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_1369){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_136a){
app.main.msgBox.print(_136a);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.Profile");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.profile.MyProfile");
dojo.require("app.view.profile.MyNotifications");
dojo.require("app.view.profile.MyGateways");
dojo.lang.declare("app.view.Profile",qu.gui.Frame,null,{initComponents:function(){
var frame=new app.view.profile.MyProfile();
frame.setParent(this);
var tab=new qu.widget.tabFolder.Tab(frame);
tab.setTitle(app.i18n.get("myProfile"));
tab.setIcon(new qu.gui.Icon("user"));
this.el.tabFolder.addTab(tab);
if(!qu.user.isUser()){
if(quConfig.disableNotifications!="y"){
frame=new app.view.profile.MyNotifications();
frame.setParent(this);
tab=new qu.widget.tabFolder.Tab(frame);
tab.setTitle(app.i18n.get("myNotifications"));
tab.setIcon(new qu.gui.Icon("mail"));
this.el.tabFolder.addTab(tab);
}
if(quConfig.disableMailGateway!="y"){
frame=new app.view.profile.MyGateways();
frame.setParent(this);
tab=new qu.widget.tabFolder.Tab(frame);
tab.setTitle(app.i18n.get("myMailGateways"));
tab.setIcon(new qu.gui.Icon("forward"));
this.el.tabFolder.addTab(tab);
}
}
with(this.el.tabFolder){
setWidth("100%");
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Profile"));
}});
dojo.provide("app.view.reports.AgentsPerformance");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.reports.AgentsPerformance",qu.gui.Frame,function(){
var _136d="";
},{initComponents:function(){
this.initAgents();
app.main.hashMaps.fill(this.el.filterQueue,"queues",true);
this.el.groupBy.removeAll();
this.el.groupBy.add("day",app.i18n.get("groupByDay"));
this.el.groupBy.add("week",app.i18n.get("groupByWeek"));
this.el.groupBy.add("month",app.i18n.get("groupByMonth"));
this.el.groupBy.add("year",app.i18n.get("groupByYear"));
this.el.groupBy.add("weekday",app.i18n.get("groupByWeekDay"));
this.setGroupBy("day");
this.setFilterDateRange("last7Days");
this.initCustomFieldsFilter();
this.initGrid();
},initGrid:function(){
var _136e=app.main.hashMaps.getStatuses();
if(_136e instanceof dojo.Deferred){
_136e.addCallback(this,"initGrid");
return;
}
with(this.el.grid){
setColumn("category",{caption:app.i18n.get("chartCategory"),sortable:false,width:"10%"});
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
setColumn(e.element.key,{caption:e.element.value,sortable:false,width:"10%"});
}
setColumn("mails",{caption:app.i18n.get("repliedMails"),sortable:false,width:"10%"});
setMultiselect(false);
setHeight(50);
setWidth("100%");
setShowHeader(true);
setShowFooter(false);
init();
}
},initAgents:function(){
if(qu.user.isAdmin()){
app.main.hashMaps.fill(this.el.filterAgent,"agents",true);
this.el.labelAgent.style.display="block";
this.el.filterAgent.domNode.style.display="block";
}else{
this.el.labelAgent.style.display="none";
this.el.filterAgent.domNode.style.display="none";
}
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGraph");
dojo.event.connectOnce(this.el.cmdShowCustomFields,"onclick",this,"cmdShowCustomFields_onClick");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.reports.AgentsPerformance"));
},onLoad:function(){
},getCustomFields:function(){
var _1370=new Array();
for(var i=0;i<this.customFields.length;i++){
if(this.customFields[i].getValue().length>0){
_1370.push([this.customFields[i].getFieldId(),this.customFields[i].getValue()]);
}
}
return _1370;
},initCustomFieldsFilter:function(){
this.el.customFieldsFilter.innerHTML="";
this.customFields=new Array();
app.main.hashMaps.execFunctionForEachElement(function(_1372){
if(_1372.getRelatedTo()=="g"){
return true;
}
var _1373=document.createElement("table");
_1373.style.width="90%";
_1373.style.margin="0px";
var _1374=document.createElement("tbody");
_1373.appendChild(_1374);
var hTr=document.createElement("tr");
var _1376=document.createElement("td");
_1376.style.width="180px";
_1376.style.whiteSpace="nowrap";
_1376.style.verticalAlign="top";
_1376.style.textAlign="right";
var _1377=document.createElement("span");
_1377.innerHTML=_1372.getTitle()+"&nbsp;";
var _1378=document.createElement("img");
if(_1372.getRelatedTo()=="u"){
_1378.src="lib/icons/crystalsvg/16/user.png";
_1378.title=app.i18n.get("relatedToUser");
}else{
if(_1372.getRelatedTo()=="g"){
_1378.src="lib/icons/crystalsvg/16/block-device.png";
_1378.title=app.i18n.get("relatedToGroup");
}else{
_1378.src="lib/icons/crystalsvg/16/alarm.png";
_1378.title=app.i18n.get("relatedToTicket");
}
}
_1378.style.border="none";
_1376.appendChild(_1377);
_1376.appendChild(_1378);
hTr.appendChild(_1376);
var _1379=document.createElement("td");
hTr.appendChild(_1379);
var _137a=new app.widget.CustomFilterField(_1379,_1372.getId(),_1372.getType(),"",_1372.getOptions());
this.customFields.push(_137a);
_1374.appendChild(hTr);
this.el.customFieldsFilter.appendChild(_1373);
},this,"customFields");
},cmdShowCustomFields_onClick:function(){
if(this.el.customFieldsFilter.style.display=="none"){
this.el.customFieldsFilter.style.display="block";
this.el.cmdShowCustomFields.innerHTML=app.i18n.get("HideCustomFieldsFilter");
}else{
this.el.customFieldsFilter.style.display="none";
this.el.cmdShowCustomFields.innerHTML=app.i18n.get("ShowCustomFieldsFilter");
}
},clearGraph:function(){
this.el.graph.innerHTML="";
},prepareChartData:function(_137b){
var _137c=new qu.sql.ResultSet();
_137c.createFromObject(_137b["categories"]);
var _137d=new qu.sql.ResultSet();
_137d.createFromObject(_137b["statuses"]);
var _137e=new qu.sql.ResultSet();
_137e.createFromObject(_137b["mails"]);
var _137f=new qu.sql.ResultSet();
_137f.md.setTableName("reports");
var _1380=new Array();
_1380.push("string");
var _1381=new Array();
_1381.push("category");
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_1381.push(e.element.key);
_1380.push("number");
}
_1381.push("mails");
_1380.push("number");
_137f.md.setTypes(_1380);
_137f.md.setNames(_1381);
_137f.md.setCount(_137c.getCount());
_137f.rows=new Array();
_137f.row=-1;
var data="<chart width=\"100%\" height=\"450\" bgcolor=\"0xEEEEEE\" xaxisfontsize=\"10\" "+"chartborderlinecolor=\"0x111111\" chartborderlinethickness=\"2\" "+"xtextorientation=\"vertical\" yaxisname=\"\" ";
var _1384=_137c.getCount();
if(_1384>100){
data+=" drawpoints=\"0\" drawshadow=\"0\" ";
}
data+="alternateylinecolor=\"0xDDDDDD\" title=\""+app.i18n.get("supportPerformance")+"\" subtitle=\"\">"+"<canvas posx=\"50\" posy=\"70\" width=\"100%\" height=\"280\" bgcolor=\"0xF4F4F4\" yvaluesprefix=\"\" ynumticks=\"10\" />"+"<legend posx=\"50\" posy=\"45\" width=\"580\" height=\"20\" bgcolor=\"0xEEEEEE\" borderlinethickness=\"0\" />"+"\n";
var _1385="<categories>\n";
var _1386=new Array();
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_1386[e.element.key]="<dataset name=\""+e.element.value+"\" color=\""+app.main.hashMaps.getStatusColors().item(e.element.key).replace("#","0x")+"\" type=\"line\">"+"\n";
}
_1386["mails"]="<dataset name=\""+app.i18n.get("repliedMails")+"\" color=\"0x000000\" type=\"line\">"+"\n";
var _1387=new Array();
var i=0;
while(_137c.next()){
var _1389=_137c.get("category_name").valueOf();
if(_1384>50){
if((i%parseInt(_1384/25))==0){
_1385+="<category name='"+_1389+"' />\n";
}else{
_1385+="<category name='' />\n";
}
}else{
_1385+="<category name='"+_1389+"' />\n";
}
i=i+1;
_1387=new Array();
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_1387[e.element.key]=0;
}
_1387["mails"]=0;
while(_137d.first()){
var _138a=_137d.get("category_name").valueOf();
if(_138a!=_1389){
break;
}
_1387[_137d.get("new_status").toString()]=_137d.get("changes_count").toString();
_137d.remove();
}
while(_137e.first()){
var _138a=_137e.get("day_date").valueOf();
if(_138a!=_1389){
break;
}
_1387["mails"]=_137e.get("mails").valueOf();
_137e.remove();
}
var _138b=new Array();
_138b.push(_1389);
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_138b.push(parseInt(_1387[e.element.key]));
}
_138b.push(parseInt(_1387["mails"]));
_137f.rows.push(_138b);
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_1386[e.element.key]+="<set value='"+_1387[e.element.key]+"' />\n";
}
_1386["mails"]+="<set value='"+_1387["mails"]+"' />\n";
}
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
_1386[e.element.key]+="</dataset>"+"\n";
}
_1386["mails"]+="</dataset>"+"\n";
_1385+="</categories>\n";
data+=_1385;
var e=app.main.hashMaps.getStatuses().getIterator();
while(e.get()){
data+=_1386[e.element.key];
}
data+=_1386["mails"];
data+="</chart>";
this.chartdata=data;
this.el.grid.getModel().setResultSet(_137f);
this.el.grid.refreshData();
},drawChart:function(){
this.el.graph.innerHTML="<textarea style=\"display:none;\" name=\"data\" id=\"data\" rows=20 cols=200>"+this.chartdata+"</textarea><br/>"+"<object wmode=\"opaque\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"\" id=\"myflash\" width=\"100%\" height=\"450\">"+"<param name=\"wmode\" value=\"opaque\">"+"<param name=movie wmode=\"opaque\" value=\"app/web/fastcharts/FastCharts.swf?loadType=inner&sourceId=data\">"+"<embed play=false swliveconnect=\"true\" name=\"myflash\" src=\"app/web/fastcharts/FastCharts.swf?loadType=inner&sourceId=data\" "+"quality=high bgcolor=#cccccc width=\"100%\" height=\"450\" type=\"application/x-shockwave-flash\" >"+"</embed ></object>";
},updateGraph:function(){
this.el.cmdUpdateFilter.innerHTML=app.i18n.get("updateFilter");
this.el.loadingIndicator.style.display="block";
this.el.reportContent.style.display="none";
this.clearGraph();
var _138c=new qu.rpc.Service("Reports");
_138c.setTimeout(180);
var def=_138c.ticketsReport({sid:qu.user.getSid(),user_id:this.getFilterAgent(),queue_id:this.getFilterQueue(),date_from:this.getFilterDateRange().getFrom(),date_to:this.getFilterDateRange().getTo(),group_by:this.getGroupBy(),custom_fields:this.getCustomFields()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onFail:function(_138e){
this.el.graph.innerHTML=_138e;
this.el.loadingIndicator.style.display="none";
this.el.reportContent.style.display="block";
},onLoadSuccess:function(_138f){
this.prepareChartData(_138f);
this.drawChart();
this.el.loadingIndicator.style.display="none";
this.el.reportContent.style.display="block";
},getFilterAgent:function(){
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_1390){
this.el.filterAgent.deselectAll();
this.el.filterAgent.select(_1390);
},getFilterQueue:function(){
return this.el.filterQueue.getSelection();
},setFilterQueue:function(_1391){
this.el.filterQueue.deselectAll();
this.el.filterQueue.select(_1391);
},getFilterDateRange:function(){
return this.el.filterDateRange;
},setFilterDateRange:function(_1392){
return this.el.filterDateRange.setValue(_1392);
},setGroupBy:function(_1393){
this.el.groupBy.select(_1393);
},getGroupBy:function(){
return this.el.groupBy.getSelectedValue();
}});
dojo.provide("app.view.reports.WorkingTime");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.reports.WorkingTime",qu.gui.Frame,null,{initComponents:function(){
this.initAgents();
this.el.groupBy.removeAll();
this.el.groupBy.add("day",app.i18n.get("groupByDay"));
this.el.groupBy.add("week",app.i18n.get("groupByWeek"));
this.el.groupBy.add("month",app.i18n.get("groupByMonth"));
this.el.groupBy.add("year",app.i18n.get("groupByYear"));
this.el.groupBy.add("weekday",app.i18n.get("groupByWeekDay"));
this.setGroupBy("day");
this.setFilterDateRange("last7Days");
with(this.el.grid){
setColumn("category_name",{caption:app.i18n.get("chartCategory"),sortable:false,width:"50%"});
setColumn("work_time",{caption:app.i18n.get("workTimeSummary"),sortable:false,width:"50%",bind:function(col,rs){
var _1396=rs.getNumber(col);
var hours=0;
var _1398=0;
if(_1396!="null"&&_1396!=null&&_1396!=0){
hours=parseInt(_1396/3600);
_1398=parseInt((_1396-(hours*3600))/60);
}
if(hours>0){
return hours+" "+app.i18n.get("hours")+" "+_1398+" "+app.i18n.get("minutes");
}else{
if(_1398>0){
return _1398+" "+app.i18n.get("minutes");
}else{
return "";
}
}
}});
setMultiselect(false);
setSortColumn("category_name");
setHeight(1);
setShowFooter(false);
}
var _1399=new qu.rpc.Service("Reports");
_1399.setTimeout(180);
this.el.grid.init();
},initAgents:function(){
if(qu.user.isAdmin()){
app.main.hashMaps.fill(this.el.filterAgent,"agents",true);
this.el.labelAgent.style.display="block";
this.el.filterAgent.domNode.style.display="block";
}else{
this.el.labelAgent.style.display="none";
this.el.filterAgent.domNode.style.display="none";
}
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce(this.el.grid,"refreshData",this,"updateChart");
},updateChart:function(){
this.generateChartData(this.el.grid.getModel().getResultSet());
this.drawChart();
},updateGrid:function(){
var logs=new qu.rpc.Service("Reports");
logs.setTimeout(60);
var _139b=new qu.rpc.Service("Reports");
_139b.setTimeout(60);
var def=_139b.getWorkTimeReport({sid:qu.user.getSid(),user_id:this.getFilterAgent(),date_from:this.getFilterDateRange().getFrom(),date_to:this.getFilterDateRange().getTo(),group_by:this.getGroupBy(),order:"category_name",limit:10000});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onFail:function(_139d){
this.el.graph.innerHTML=_139d;
},onLoadSuccess:function(_139e){
this.el.grid.setHeight(_139e.getCount());
this.el.grid.getModel().setResultSet(_139e);
this.el.grid.refreshData();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.reports.WorkingTime"));
},getFilterDateRange:function(){
return this.el.filterDateRange;
},setFilterDateRange:function(_139f){
return this.el.filterDateRange.setValue(_139f);
},getFilterAgent:function(){
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_13a0){
this.el.filterAgent.deselectAll();
this.el.filterAgent.select(_13a0);
},onLoad:function(){
this.updateGrid();
},setGroupBy:function(_13a1){
this.el.groupBy.select(_13a1);
},getGroupBy:function(){
return this.el.groupBy.getSelectedValue();
},generateChartData:function(_13a2){
var data="<?xml version=\"1.0\" encoding=\"utf-8\" ?>"+"<chart width=\"100%\" height=\"450\" bgcolor=\"0xEEEEEE\" xaxisfontsize=\"10\" "+"chartborderlinecolor=\"0x111111\" chartborderlinethickness=\"2\" xtextorientation=\"vertical\" ";
if(_13a2.getCount()>100){
data+=" drawpoints=\"0\" drawshadow=\"0\" ";
}
data+=" yaxisname=\""+app.i18n.get("hours")+"\" alternateylinecolor=\"0xDDDDDD\" title=\""+app.i18n.get("timeSpentInApplication")+"\" subtitle=\"\">"+"<canvas posx=\"70\" posy=\"70\" width=\"100%\" height=\"270\" bgcolor=\"0xF4F4F4\" yvaluesprefix=\"\"  ynumticks=\"10\" />";
var _13a4="<categories>";
var _13a5="3dcolumn";
var _13a6="<dataset name=\""+app.i18n.get("timeSpentInApplication")+"\" color=\"0x0080C0\" opacity=\"90\" type=\""+_13a5+"\">";
_13a2.beforeFirst();
var i=0;
while(_13a2.next()){
var _13a8=_13a2.getNumber("work_time");
var hours=0;
var _13aa=_13a2.get("category_name");
if(_13a2.getCount()>50){
if((i%parseInt(_13a2.getCount()/25))!=0){
_13aa="";
}
}
if(_13a8!="null"&&_13a8!=null&&_13a8!=0){
hours=parseInt(_13a8/3600);
}
_13a4+="<category name=\""+_13aa+"\" />";
_13a6+="<set value=\""+hours+"\" />";
i=i+1;
}
_13a4+="</categories>";
_13a6+="</dataset>";
data+=_13a4;
data+=_13a6;
data+="</chart>";
this.chartData=data;
},drawChart:function(){
this.el.graph.innerHTML="";
this.el.graph.innerHTML="<textarea style=\"display:none;\" name=\"timedata\" id=\"timedata\" rows=20 cols=200>"+this.chartData+"</textarea><br/>"+"<object wmode=\"opaque\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"\" id=\"workTimeChart\" width=\"100%\" height=\"450\">"+"<param name=\"wmode\" value=\"opaque\">"+"<param name=movie wmode=\"opaque\" value=\"app/web/fastcharts/FastCharts.swf?loadType=inner&sourceId=timedata\">"+"<embed play=false swliveconnect=\"true\" name=\"myflash\" src=\"app/web/fastcharts/FastCharts.swf?loadType=inner&sourceId=timedata\" "+"quality=high bgcolor=#cccccc width=\"100%\" height=\"450\" type=\"application/x-shockwave-flash\" >"+"</embed ></object>";
}});
dojo.provide("app.view.reports.BillingTime");
dojo.require("qu.gui.Frame");
dojo.require("qu.string.conversion");
dojo.lang.declare("app.view.reports.BillingTime",qu.gui.Frame,null,{initComponents:function(){
this.initAgents();
this.setFilterDateRange("last7Days");
app.main.hashMaps.fill(this.el.filterQueue,"queues",true);
if(quConfig.hideGroups){
this.el.groupSection.style.visibility="hidden";
}else{
app.main.hashMaps.fill(this.el.filterGroups,"groups",true);
}
this.initAutocomplete();
with(this.el.grid){
setColumn("reported",{caption:app.i18n.get("reported"),sortable:true,width:"150px",bind:function(col,rs){
var date=rs.getDate(col);
return date.print(app.i18n.get("dateTimeFormat"))+"<br/>"+rs.get("reporter");
}});
setColumn("first_subject",{caption:app.i18n.get("subject"),sortable:true,width:"50%",bind:function(col,rs){
return "["+rs.get("subject_ticket_id")+" # "+rs.get("queue_name")+"] "+rs.get("first_subject")+"<br/>"+rs.get("note");
}});
setColumn("customer",{caption:app.i18n.get("customer"),sortable:true,width:"150px"});
if(!quConfig.hideGroups){
setColumn("group_name",{caption:app.i18n.get("groupName"),sortable:true,width:"150px",bind:function(col,rs){
var value=rs.get(col);
if(value==null||value=="null"){
value="";
}
return "<span title=\""+value+"\">"+value+"</span>";
}});
}
setColumn("ticket_created",{caption:app.i18n.get("ticketCreated"),sortable:true,width:"120px",bind:function(col,rs){
var date=rs.getDate(col);
return date.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("billing_time",{caption:app.i18n.get("billedTime"),sortable:true,width:"80px",bind:function(col,rs){
return qu.string.seconds2humantime(rs.get(col));
}});
setColumn("work_time",{caption:app.i18n.get("spentTime"),sortable:true,width:"80px",bind:function(col,rs){
return qu.string.seconds2humantime(rs.get(col));
}});
setColumn("ticket_time",{caption:app.i18n.get("replyTime"),sortable:true,width:"80px",bind:function(col,rs){
return qu.string.seconds2humantime(rs.get(col));
}});
setColumn("popup",{caption:" ",sortable:false,width:"18px",bind:function(col,rs){
var _13be=document.createElement("a");
_13be.href=quConfig.bootFilename+"#tid="+rs.getString("subject_ticket_id");
_13be.target="_blank";
_13be.className="blank";
_13be.title=app.i18n.get("OpenInNewWindow");
var img=document.createElement("img");
img.src="app/web/images/popup_gray.gif";
img.style.width="16px";
img.style.height="16px";
img.style.border="none";
img.style.marginTop="4px";
_13be.appendChild(img);
return _13be;
},style:{textAlign:"right"}});
this.defineService();
setMultiselect(true);
setSortColumn("reported");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(25);
}
this.el.grid.init();
},initAgents:function(){
if(qu.user.isAdmin()){
app.main.hashMaps.fill(this.el.filterAgent,"agents",true);
this.el.labelAgent.style.display="block";
this.el.filterAgent.domNode.style.display="block";
}else{
this.el.labelAgent.style.display="none";
this.el.filterAgent.domNode.style.display="none";
}
},initAutocomplete:function(){
var users=new qu.rpc.Service("Users");
with(this.el.filterCustomer.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _13c1={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_13c1);
}
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadSummary");
},onLoadSummary:function(id,_13c3){
if(id=="billingReportSummary"){
_13c3.beforeFirst();
while(_13c3.next()){
this.el.billedTimeSummary.innerHTML=qu.string.seconds2humantime(_13c3.get("sum_billing_time").valueOf());
this.el.spentTimeSummary.innerHTML=qu.string.seconds2humantime(_13c3.get("sum_work_time").valueOf());
this.el.replyTimeSummary.innerHTML=qu.string.seconds2humantime(_13c3.get("sum_ticket_time").valueOf());
this.el.billedTimeAvg.innerHTML=qu.string.seconds2humantime(_13c3.get("avg_billing_time").valueOf());
this.el.spentTimeAvg.innerHTML=qu.string.seconds2humantime(_13c3.get("avg_work_time").valueOf());
this.el.replyTimeAvg.innerHTML=qu.string.seconds2humantime(_13c3.get("avg_ticket_time").valueOf());
}
}
},defineService:function(){
var _13c4=new qu.rpc.Service("WorkReports");
_13c4.addPushRequest("billingReportSummary","WorkReports","getBillingTimeSum",{sid:qu.user.getSid(),user_id:this.getFilterAgent(),queue_id:this.getFilterQueue(),groupid:this.getFilterGroups(),date_from:this.getFilterDateRange().getFrom(),date_to:this.getFilterDateRange().getTo(),customer_email:this.getFilterCustomer()});
with(this.el.grid.getModel()){
setService(_13c4);
setMethod("getBillingTimeList");
setDefaultParams({sid:qu.user.getSid(),user_id:this.getFilterAgent(),queue_id:this.getFilterQueue(),groupid:this.getFilterGroups(),date_from:this.getFilterDateRange().getFrom(),date_to:this.getFilterDateRange().getTo(),customer_email:this.getFilterCustomer()});
}
},updateGrid:function(){
this.defineService();
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.reports.BillingTime"));
},getFilterDateRange:function(){
return this.el.filterDateRange;
},setFilterDateRange:function(_13c5){
return this.el.filterDateRange.setValue(_13c5);
},getFilterAgent:function(){
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_13c6){
this.el.filterAgent.deselectAll();
this.el.filterAgent.select(_13c6);
},getFilterQueue:function(){
return this.el.filterQueue.getSelection();
},setFilterQueue:function(_13c7){
this.el.filterQueue.deselectAll();
this.el.filterQueue.select(_13c7);
},getFilterGroups:function(){
return this.el.filterGroups.getSelection();
},setFilterGroups:function(_13c8){
this.el.filterGroups.deselectAll();
this.el.filterGroups.select(_13c8);
},getFilterCustomer:function(){
return this.el.filterCustomer.getValue();
},onLoad:function(){
this.updateGrid();
}});
dojo.provide("app.view.reports.Logins");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.reports.Logins",qu.gui.Frame,null,{initComponents:function(){
this.setFilterLogin("last7Days");
with(this.el.grid){
setColumn("login",{caption:app.i18n.get("loggedIn"),sortable:true,width:"125px",bind:function(col,rs){
var _13cb=rs.getDate(col);
return _13cb.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("logout",{caption:app.i18n.get("loggedOut"),sortable:true,width:"125px",bind:function(col,rs){
if(rs.get("logout")==null||rs.get("logout")=="null"){
return app.i18n.get("stillLoggedIn");
}
var _13ce=rs.getDate(col);
return _13ce.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("login_time",{caption:app.i18n.get("loginTime"),sortable:true,width:"100px",bind:function(col,rs){
var _13d1=rs.getNumber(col);
myDate=new Date();
return myDate.secondsToHumanTime(_13d1);
}});
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"50%"});
setColumn("email",{caption:app.i18n.get("email"),sortable:true,width:"50%"});
setColumn("ip",{caption:app.i18n.get("ip"),sortable:true,width:"90px",style:{cursor:"pointer"}});
setMultiselect(false);
setSortColumn("login");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(10);
}
this.initAgents();
var _13d2=new qu.rpc.Service("Logins");
with(this.el.grid.getModel()){
setService(_13d2);
setMethod("getLoginsList");
setDefaultParams({sid:qu.user.getSid(),user_id:this.getFilterAgent(),login_from:this.getFilterLogin().getFrom(),login_to:this.getFilterLogin().getTo()});
}
this.el.grid.init();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
},initAgents:function(){
if(qu.user.isAdmin()){
app.main.hashMaps.fill(this.el.filterAgent,"agents",true);
this.el.labelAgent.style.display="block";
this.el.filterAgent.domNode.style.display="block";
}else{
this.el.labelAgent.style.display="none";
this.el.filterAgent.domNode.style.display="none";
}
},updateGrid:function(){
var logs=new qu.rpc.Service("Logins");
with(this.el.grid.getModel()){
setService(logs);
setMethod("getLoginsList");
setDefaultParams({sid:qu.user.getSid(),user_id:this.getFilterAgent(),login_from:this.getFilterLogin().getFrom(),login_to:this.getFilterLogin().getTo()});
}
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.reports.Logins"));
},getFilterLogin:function(){
return this.el.filterLogin;
},setFilterLogin:function(_13d4){
return this.el.filterLogin.setValue(_13d4);
},getFilterAgent:function(){
return this.el.filterAgent.getSelection();
},setFilterAgent:function(_13d5){
this.el.filterAgent.deselectAll();
this.el.filterAgent.select(_13d5);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.Reports");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.reports.AgentsPerformance");
dojo.require("app.view.reports.WorkingTime");
dojo.require("app.view.reports.BillingTime");
dojo.require("app.view.reports.Logins");
dojo.lang.declare("app.view.Reports",qu.gui.Frame,null,{initComponents:function(){
var _13d6=new qu.widget.tabFolder.Tab(new app.view.reports.WorkingTime());
_13d6.setTitle(app.i18n.get("workTimeReport"));
_13d6.setIcon(new qu.gui.Icon("alarm"));
this.el.tabFolder.addTab(_13d6);
var _13d7=new qu.widget.tabFolder.Tab(new app.view.reports.AgentsPerformance());
_13d7.setTitle(app.i18n.get("supportPerformance"));
_13d7.setIcon(new qu.gui.Icon("organizer"));
this.el.tabFolder.addTab(_13d7);
var _13d8=new qu.widget.tabFolder.Tab(new app.view.reports.Logins());
_13d8.setTitle(app.i18n.get("logins"));
_13d8.setIcon(new qu.gui.Icon("history"));
this.el.tabFolder.addTab(_13d8);
var _13d9=new qu.widget.tabFolder.Tab(new app.view.reports.BillingTime());
_13d9.setTitle(app.i18n.get("billing"));
_13d9.setIcon(new qu.gui.Icon("clock"));
this.el.tabFolder.addTab(_13d9);
with(this.el.tabFolder){
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Reports"));
}});
dojo.provide("app.view.kbase.KBPreviewTree");
dojo.require("dojo.widget.Tree");
dojo.require("dojo.widget.TreeSelector");
dojo.require("qu.widget.TreeLoadingController");
dojo.require("app.data.kbase.Item");
dojo.declare("app.view.kbase.KBPreviewTree",qu.gui.Frame,function(){
this._selectedNode=null;
},{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.KBPreviewTree"));
},initComponents:function(){
this.treeKb=dojo.widget.byId("CMTree");
this.treeKb.expandIconSrcLoading=dojo.uri.moduleUri("qu.widget","templates/images/treenode_loading.png");
this.treeSelector=dojo.widget.byId("treeSelector");
},initConnections:function(){
dojo.event.topic.subscribe("nodeSelected",this,"onNodeSelected");
},onLoad:function(){
this._initTree();
},setQuickSearch:function(_13da){
this.quickSearch=_13da;
this._initTree();
},_initTree:function(){
var _13db=new app.data.kbase.Item();
if(this.quickSearch!=""&&this.quickSearch!=null){
_13db.setSubject("<b>"+app.i18n.get("FoundItemswithText")+"</b> \""+this.quickSearch+"\"");
}else{
_13db.setSubject("<b>"+app.i18n.get("KnowledgeBase")+"</b>");
}
_13db.setId(0);
_13db.setTreePath("0|");
_13db.setQuery(this.quickSearch);
if(this.rootNode!=null){
this.remove(this.rootNode);
this.rootNode=null;
}
this.rootNode=this.createTreeNode(_13db);
this.treeKb.addChild(this.rootNode);
this.treeSelector.doSelect(this.rootNode);
this.treeKb.controller.expand(this.rootNode);
},createTreeNode:function(_13dc){
var _13dd=new Object();
_13dd.title=_13dc.getSubject();
_13dd.isFolder=true;
var _13de=dojo.widget.createWidget("TreeNode",_13dd);
_13de.item=_13dc;
return _13de;
},onNodeSelected:function(_13df){
this._selectedNode=_13df.node;
this.onChange();
},getSelectedNode:function(){
if(this._selectedNode==null){
return this.rootNode;
}
return this._selectedNode;
},onChange:function(){
},removeAllChildren:function(_13e0){
var _13e1=_13e0.children;
var len=_13e1.length;
for(i=0;i<len;i++){
_13e0.removeNode(_13e1[0]);
}
},remove:function(_13e3){
if(_13e3.parent){
this.select(_13e3.parent);
}
this.treeKb.removeNode(_13e3);
},selectNodeById:function(_13e4,inId){
var _13e6=null,nodes=_13e4.children;
dojo.lang.forEach(nodes,function(elm,index,arr){
if(elm.item.getId()==inId){
this.select(elm);
_13e6=elm;
}
},this);
return _13e6;
},select:function(_13eb){
var _13ec=this.getSelectedNode();
if(!_13eb||!_13eb.isTreeNode){
return;
}
if(_13ec&&_13ec.isTreeNode){
this.treeSelector.deselect();
this.treeSelector.doSelect(_13eb);
this._selectedNode=_13eb;
}
}});
dojo.provide("app.view.kbase.KBPreview");
dojo.require("qu.gui.Frame");
dojo.require("app.view.kbase.KBPreviewTree");
dojo.lang.declare("app.view.kbase.KBPreview",qu.gui.Frame,null,{initConnections:function(){
dojo.event.connectOnce(this.treeViewKB,"onChange",this,"onNodeKbSelected");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadAttachments");
dojo.event.connectOnce(this.el.cmdApply,"onclick",this,"onApply");
},initComponents:function(){
this.treeViewKB=new app.view.kbase.KBPreviewTree(this.el.treeContainer);
this.treeViewKB.setParent(this);
this.treeViewKB.show();
this.resetForm();
},onKeyPress:function(_13ed){
switch(_13ed.keyCode){
case _13ed.KEY_ENTER:
this.onApply();
break;
}
},onApply:function(){
this.treeViewKB.setQuickSearch(this.el.quickSearch.value);
},onLoadAttachments:function(id,_13ef){
if(id=="KBPreviewLoadAttachments"){
this.loadAttachments(_13ef);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.KBPreview"));
},resetForm:function(){
this.setSubject("");
this.setBody("");
this._attachments=new Array();
this.el.attachmentsContent.innerHTML="";
this.el.kbContent.style.display="none";
this.el.noContent.style.display="block";
},onLoad:function(){
},onNodeKbSelected:function(){
if(this instanceof app.view.kbase.KBPreview){
this.loadItemKb();
}
},loadItemKb:function(){
this.resetForm();
if(this.treeViewKB.getSelectedNode().item.getId().valueOf()!="0"&&this.treeViewKB.getSelectedNode().item.getId().valueOf()!="-1"){
var _13f0=new qu.rpc.Service("KBItems");
_13f0.addPushRequest("KBPreviewLoadAttachments","Attachments","getKBAttachmentsList",{sid:qu.user.getSid(),item_id:this.treeViewKB.getSelectedNode().item.getId().valueOf()});
var def=_13f0.getItem({sid:qu.user.getSid(),item_id:this.treeViewKB.getSelectedNode().item.getId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}
},onLoadSuccess:function(_13f2){
this.hideLoading();
var rs=_13f2;
rs.first();
this.setSubject(rs.get("subject"));
this.setBody(rs.get("body"));
this.el.noContent.style.display="none";
this.el.kbContent.style.display="block";
},loadAttachments:function(_13f4){
_13f4.beforeFirst();
while(_13f4.next()){
var _13f5=new app.data.email.Attachment();
_13f5.setId(_13f4.getString("file_id").valueOf());
_13f5.setFilename(_13f4.getString("filename").valueOf());
_13f5.setSize(_13f4.getNumber("filesize").valueOf());
_13f5.setType(_13f4.getString("filetype").valueOf());
this.addAttachment(_13f5);
}
},addAttachment:function(_13f6){
var _13f7=new app.widget.Uploaded(this.el.attachmentsContent,_13f6,"",false);
this._attachments.push(_13f7);
},setSubject:function(_13f8){
this.el.kbSubject.innerHTML=_13f8;
},setBody:function(_13f9){
this.el.kbBody.innerHTML=_13f9;
},getBody:function(){
return this.el.kbBody.innerHTML;
}});
dojo.provide("app.view.settings.mailAccounts.MailAccount");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.mailAccounts.MailAccount",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this.el.useSendmail,"onclick",this,"onUseSendmailClick");
dojo.event.connectOnce(this.el.fromNameFormat,"onChange",this,"updateAccessToFromName");
},initComponents:function(){
this.el.fromNameFormat.removeAll();
this.el.fromNameFormat.add("a",app.i18n.get("agentNameFormat"));
this.el.fromNameFormat.add("c",app.i18n.get("accountNameFormat"));
this.el.fromNameFormat.add("n",app.i18n.get("plainMailFormat"));
this.el.agents.setSize("300px","125px");
with(this.el.agents.getModel()){
setService(new qu.rpc.Service("Users"));
setMethod("getUsersList");
setDefaultParams({sid:qu.user.getSid(),user_type:"g",order:"name"});
setValueColumn("user_id");
setTextColumn("name");
}
},onKeyPress:function(_13fa){
switch(_13fa.keyCode){
case _13fa.KEY_ESCAPE:
this.hide();
break;
case _13fa.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.mailAccounts.MailAccount"));
this.setSize(700,500);
},onShow:function(){
this.el.accountName.focus();
},resetForm:function(){
this.setAccountName("");
this.setFromName("");
this.setAccountEmail("");
this.setSmtpServer("");
this.setSmtpPort("25");
this.setSmtpUsername("");
this.setSmtpPassword("");
this.setRequireSmtpSsl(false);
this.setRequireSmtpAuthentification(false);
this.setUseSendmail(false);
this.setPop3Server("");
this.setPop3Port("110");
this.setPop3Username("");
this.setPop3Password("");
this.setRequirePop3Ssl(false);
this.setRequireSmtpTLS(false);
this.setDefault(false);
this.setPublic(false);
this.setDeleteMails(false);
this.setFromNameFormat("a");
},setFromNameFormat:function(_13fb){
this.el.fromNameFormat.deselectAll();
this.el.fromNameFormat.select(_13fb);
this.updateAccessToFromName();
},getFromNameFormat:function(){
return this.el.fromNameFormat.getSelection().shift();
},updateAccessToFromName:function(){
if(this.getFromNameFormat()!="c"){
this.el.fromName.disabled=true;
}else{
this.el.fromName.disabled=false;
}
},onUseSendmailClick:function(){
if(this.isUseSendmail()=="y"){
this.disableSendingMail();
}else{
if(this.isUseSendmail()=="n"){
this.enableSendingMail();
}
}
},disableSendingMail:function(){
this.el.smtpServer.disabled=true;
this.el.smtpPort.disabled=true;
this.el.smtpUsername.disabled=true;
this.el.smtpPassword.disabled=true;
this.el.requireSmtpSsl.disabled=true;
this.el.requireSmtpAuthentification.disabled=true;
},enableSendingMail:function(){
this.el.smtpServer.disabled=false;
this.el.smtpPort.disabled=false;
this.el.smtpUsername.disabled=false;
this.el.smtpPassword.disabled=false;
this.el.requireSmtpSsl.disabled=false;
this.el.requireSmtpAuthentification.disabled=false;
},getAccountName:function(){
return this.el.accountName.value;
},setAccountName:function(_13fc){
this.el.accountName.value=_13fc;
},getFromName:function(){
return this.el.fromName.value;
},setFromName:function(_13fd){
if(_13fd=="null"){
_13fd="";
}
this.el.fromName.value=_13fd;
},getAccountEmail:function(){
return this.el.accountEmail.value;
},setAccountEmail:function(_13fe){
this.el.accountEmail.value=_13fe;
},getSmtpServer:function(){
return this.el.smtpServer.value;
},setSmtpServer:function(_13ff){
this.el.smtpServer.value=_13ff;
},getSmtpPort:function(){
return this.el.smtpPort.value;
},setSmtpPort:function(_1400){
this.el.smtpPort.value=_1400;
},setSmtpPassword:function(_1401){
this.el.smtpPassword.value=_1401;
},getSmtpPassword:function(){
return this.el.smtpPassword.value;
},setSmtpUsername:function(_1402){
this.el.smtpUsername.value=_1402;
},getSmtpUsername:function(){
return this.el.smtpUsername.value;
},isRequireSmtpSsl:function(){
return this.el.requireSmtpSsl.checked?"y":"n";
},setRequireSmtpSsl:function(_1403){
if(_1403===true||_1403=="y"){
this.el.requireSmtpSsl.checked=true;
}else{
this.el.requireSmtpSsl.checked=false;
}
},isRequireSmtpAuthentification:function(){
return this.el.requireSmtpAuthentification.checked?"y":"n";
},setRequireSmtpAuthentification:function(_1404){
if(_1404===true||_1404=="y"){
this.el.requireSmtpAuthentification.checked=true;
}else{
this.el.requireSmtpAuthentification.checked=false;
}
},getPop3Server:function(){
return this.el.pop3Server.value;
},setPop3Server:function(_1405){
this.el.pop3Server.value=_1405;
},getPop3Port:function(){
return this.el.pop3Port.value;
},setPop3Port:function(_1406){
this.el.pop3Port.value=_1406;
},setPop3Password:function(_1407){
this.el.pop3Password.value=_1407;
},getPop3Password:function(){
return this.el.pop3Password.value;
},setPop3Username:function(_1408){
this.el.pop3Username.value=_1408;
},getPop3Username:function(){
return this.el.pop3Username.value;
},isRequirePop3Ssl:function(){
return this.el.requirePop3Ssl.checked?"y":"n";
},setRequirePop3Ssl:function(_1409){
if(_1409===true||_1409=="y"){
this.el.requirePop3Ssl.checked=true;
}else{
this.el.requirePop3Ssl.checked=false;
}
},isRequireSmtpTLS:function(){
return this.el.requireSmtpTLS.checked?"y":"n";
},setRequireSmtpTLS:function(_140a){
if(_140a===true||_140a=="y"){
this.el.requireSmtpTLS.checked=true;
}else{
this.el.requireSmtpTLS.checked=false;
}
},isUseSendmail:function(){
return this.el.useSendmail.checked?"y":"n";
},setUseSendmail:function(_140b){
if(_140b===true||_140b=="y"){
this.el.useSendmail.checked=true;
this.disableSendingMail();
}else{
this.el.useSendmail.checked=false;
this.enableSendingMail();
}
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_140c){
this.msgBox.print(_140c);
},isDefault:function(){
if(this.el.isDefault.checked){
return "y";
}
return "n";
},setDefault:function(_140d){
if(_140d==true||_140d=="y"){
this.el.isDefault.checked=true;
this.el.isDefault.disabled=true;
}else{
if(_140d==false||_140d=="n"){
this.el.isDefault.checked=false;
this.el.isDefault.disabled=false;
}
}
},isPublic:function(){
if(this.el._public.checked){
return "y";
}
return "n";
},setPublic:function(_140e){
if(_140e==true||_140e=="y"){
this.el._public.checked=true;
}else{
if(_140e==false||_140e=="n"){
this.el._public.checked=false;
}
}
},getDeleteMails:function(){
if(this.el.deleteMails.checked){
return "y";
}
return "n";
},setDeleteMails:function(_140f){
if(_140f==true||_140f=="y"){
this.el.deleteMails.checked=true;
}else{
if(_140f==false||_140f=="n"){
this.el.deleteMails.checked=false;
}
}
}});
dojo.provide("app.view.settings.mailAccounts.MailAccountAdd");
dojo.require("app.view.settings.mailAccounts.MailAccount");
dojo.lang.declare("app.view.settings.mailAccounts.MailAccountAdd",app.view.settings.mailAccounts.MailAccount,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addMailAccount"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
var _1410=new Object();
_1410.account_name=this.getAccountName();
_1410.from_name=this.getFromName();
_1410.from_name_format=this.getFromNameFormat();
_1410.account_email=this.getAccountEmail();
_1410.is_default=this.isDefault();
_1410["public"]=this.isPublic();
if(this.isUseSendmail()=="n"){
_1410.smtp_server=this.getSmtpServer();
_1410.smtp_port=this.getSmtpPort();
_1410.smtp_username=this.getSmtpUsername();
_1410.smtp_password=this.getSmtpPassword();
_1410.smtp_ssl=this.isRequireSmtpSsl();
_1410.smtp_require_auth=this.isRequireSmtpAuthentification();
_1410.use_smtp="y";
}else{
_1410.use_smtp="n";
}
_1410.pop3_server=this.getPop3Server();
_1410.pop3_port=this.getPop3Port();
_1410.pop3_username=this.getPop3Username();
_1410.pop3_password=this.getPop3Password();
_1410.pop3_ssl=this.isRequirePop3Ssl();
_1410.smtp_tls=this.isRequireSmtpTLS();
_1410.delete_messages=this.getDeleteMails();
var _1411=new qu.rpc.Service("MailAccounts");
var _1412={sid:qu.user.getSid()};
if(qu.user.isAgent()){
_1412.user_id=qu.user.getId();
}
_1411.addPushRequest("mail_accounts","MailAccounts","getMailAccountsList",_1412);
_1411.setThrobber(app.i18n.get("saving"));
var def=_1411.insertMailAccount({fields:_1410,sid:qu.user.getSid(),user_id:this.el.agents.getSelectedValues()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.setLoading(true);
dojo.event.connectOnce(this.el.agents,"onLoad",this,"hideLoading");
this.el.agents.update();
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.mailAccounts.MailAccountEdit");
dojo.require("app.view.settings.mailAccounts.MailAccount");
dojo.lang.declare("app.view.settings.mailAccounts.MailAccountEdit",app.view.settings.mailAccounts.MailAccount,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editMailAccount"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"setAgents",this,"hideLoading");
this.resetForm();
this.el.agents.removeAll();
this.loadAccount();
},setAgents:function(){
var ids=this.agentIds;
for(var i=0;i<ids.length;i++){
this.el.agents.selectByValue(ids[i]);
}
},setAccountId:function(_1416){
this._accountId=_1416;
},getAccountId:function(){
return this._accountId;
},loadAccount:function(){
var _1417=new qu.rpc.Service("MailAccounts");
var def=_1417.getMailAccount({sid:qu.user.getSid(),account_id:this.getAccountId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadAccountSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadAccountSuccess:function(_1419){
var rs=_1419;
rs.first();
this.agentIds=rs.getString("agent_ids").split("|");
dojo.event.connectOnce(this.el.agents,"onLoad",this,"setAgents");
this.el.agents.update();
this.setAccountName(rs.get("account_name"));
this.setFromName(rs.get("from_name"));
this.setFromNameFormat(rs.get("from_name_format"));
this.setAccountEmail(rs.get("account_email"));
var _141b=rs.get("is_default").valueOf();
if(_141b=="y"){
this.setDefault(true);
}else{
this.setDefault(false);
}
var _141c=rs.get("delete_messages").valueOf();
if(_141c=="y"){
this.setDeleteMails(true);
}else{
this.setDeleteMails(false);
}
this.setPublic(rs.get("public").valueOf());
this.setSmtpServer(rs.get("smtp_server"));
this.setSmtpPort(rs.get("smtp_port"));
this.setSmtpUsername(rs.get("smtp_username"));
this.setSmtpPassword("");
var _141d=rs.get("use_smtp").valueOf();
if(_141d=="y"){
this.setUseSendmail(false);
}else{
if(_141d=="n"){
this.setUseSendmail(true);
}
}
this.setRequireSmtpSsl(rs.get("smtp_ssl"));
this.setRequireSmtpAuthentification(rs.get("smtp_require_auth"));
this.setPop3Server(rs.get("pop3_server"));
this.setPop3Port(rs.get("pop3_port"));
this.setPop3Username(rs.get("pop3_username"));
this.setPop3Password("");
this.setRequirePop3Ssl(rs.get("pop3_ssl"));
this.setRequireSmtpTLS(rs.get("smtp_tls"));
},onSave:function(){
var _141e=new Object();
_141e.account_name=this.getAccountName();
_141e.from_name=this.getFromName();
_141e.from_name_format=this.getFromNameFormat();
_141e.account_email=this.getAccountEmail();
_141e.is_default=this.isDefault();
_141e["public"]=this.isPublic();
if(this.isUseSendmail()=="n"){
_141e.smtp_server=this.getSmtpServer();
_141e.smtp_port=this.getSmtpPort();
_141e.smtp_username=this.getSmtpUsername();
_141e.smtp_password=this.getSmtpPassword();
_141e.smtp_ssl=this.isRequireSmtpSsl();
_141e.smtp_require_auth=this.isRequireSmtpAuthentification();
_141e.use_smtp="y";
}else{
_141e.use_smtp="n";
}
_141e.pop3_server=this.getPop3Server();
_141e.pop3_port=this.getPop3Port();
_141e.pop3_username=this.getPop3Username();
_141e.pop3_password=this.getPop3Password();
_141e.pop3_ssl=this.isRequirePop3Ssl();
_141e.smtp_tls=this.isRequireSmtpTLS();
_141e.delete_messages=this.getDeleteMails();
var _141f=new qu.rpc.Service("MailAccounts");
var _1420={sid:qu.user.getSid()};
if(qu.user.isAgent()){
_1420.user_id=qu.user.getId();
}
_141f.addPushRequest("mail_accounts","MailAccounts","getMailAccountsList",_1420);
_141f.setThrobber(app.i18n.get("saving"));
var def=_141f.updateMailAccount({fields:_141e,sid:qu.user.getSid(),account_id:this.getAccountId().valueOf(),user_id:this.el.agents.getSelectedValues()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.MailAccounts");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.mailAccounts.MailAccountAdd");
dojo.require("app.view.settings.mailAccounts.MailAccountEdit");
dojo.lang.declare("app.view.settings.MailAccounts",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("account_name",{caption:app.i18n.get("accountName"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setColumn("account_email",{caption:app.i18n.get("accountEmail"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setColumn("last_processing",{caption:app.i18n.get("lastProcessingTime"),sortable:true,width:"100px",style:{cursor:"pointer"},bind:function(col,rs){
var _1424=rs.getString(col).valueOf();
if(_1424=="0000-00-00 00:00:00"||_1424==""||_1424==null||_1424=="null"){
return app.i18n.get("notProcessedYet");
}
var date=rs.getDate(col);
var today=new Date();
var _1427=app.i18n.get("dateFormat");
if(date.getFullYear()==today.getFullYear()&&date.getMonth()==today.getMonth()&&date.getDate()==today.getDate()){
_1427=app.i18n.get("timeFormat");
}else{
if(date.getFullYear()==today.getFullYear()){
_1427=app.i18n.get("dateFormatWithoutYear");
}
}
return "<span style=\"padding-right:6px;\" title=\""+date.print(app.i18n.get("dateTimeFormat"))+"\">"+date.print(_1427);
+"</span>";
}});
setColumn("actions",{caption:app.i18n.get("defaultMailAccount"),sortable:false,width:"100px",style:{textAlign:"center"},bind:dojo.lang.hitch(this,function(col,rs){
var _142a=rs.getString("is_default").valueOf();
if(_142a=="y"){
return app.i18n.get("defaultMailAccount");
}
var img=document.createElement("img");
img.setAttribute("src",qu.global.icon("home.png",16));
img.setAttribute("title",app.i18n.get("setAsDefault"));
img.style.cursor="pointer";
img.setAttribute("accountId",rs.getString("account_id"));
img.setAttribute("accountName",rs.getString("account_name"));
dojo.event.connectOnce(img,"onclick",this,"onSetDefault");
return img;
})});
setMultiselect(true);
setSortColumn("account_name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _142c=new qu.rpc.Service("MailAccounts");
with(this.el.grid.getModel()){
setService(_142c);
setMethod("getMailAccountsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addMailAccount=new app.view.settings.mailAccounts.MailAccountAdd();
this.editMailAccount=new app.view.settings.mailAccounts.MailAccountEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.MailAccounts"));
},onAdd:function(){
dojo.event.connectOnce(this.addMailAccount,"onSaveSuccess",this.el.grid,"update");
this.addMailAccount.show();
},onEdit:function(inRow,inCol){
if(inCol==4){
return;
}
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editMailAccount.setAccountId(rs.getString("account_id"));
dojo.event.connectOnce(this.editMailAccount,"onSaveSuccess",this.el.grid,"update");
this.editMailAccount.show();
},onDelete:function(){
var _1430=this.el.grid.getSelectionByColumn("account_id").join("|");
if(_1430==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1431=this.el.grid.getSelectionByColumn("account_name").join("|");
var _1432=new qu.rpc.Service("MailAccounts");
var _1433={sid:qu.user.getSid()};
if(qu.user.isAgent()){
_1433.user_id=qu.user.getId();
}
_1432.addPushRequest("mail_accounts","MailAccounts","getMailAccountsList",_1433);
_1432.setThrobber("Deleting...");
var def=_1432.deleteMailAccount({sid:qu.user.getSid(),account_id:_1430,account_name:_1431});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_1435){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1436){
app.main.msgBox.print(_1436);
},onLoad:function(){
this.el.grid.update();
},onSetDefault:function(_1437){
var _1438=_1437.target;
var _1439=_1438.getAttribute("accountId");
var _143a=_1438.getAttribute("accountName");
var _143b=new Object();
_143b.is_default="y";
var _143c=new qu.rpc.Service("MailAccounts");
_143c.setThrobber(app.i18n.get("saving"));
var def=_143c.setAsDefaultMailAccount({sid:qu.user.getSid(),account_id:_1439,name:_143a,fields:_143b});
def.addCallback(dojo.lang.hitch(this,"onSetDefaultSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSetDefaultFail"));
},onSetDefaultSuccess:function(_143e){
this.el.grid.getData();
},onSetDefaultFail:function(_143f){
alert(_143f);
}});
dojo.provide("app.data.ParsingRuleCustomField");
dojo.lang.declare("app.data.ParsingRuleCustomField",null,function(){
this._fieldId="";
this._title="";
this._type="";
this._defaultValue="";
this._options="";
this._relatedTo="";
this._orderValue="";
this._userAccess="";
this._targetType="b";
this._matchPattern="";
this._condition_type="";
this._condition_value="";
},{setConditionType:function(_1440){
if(_1440=="null"){
_1440=null;
}
this._condition_type=_1440;
},getConditionType:function(_1441){
return this._condition_type;
},setConditionValue:function(_1442){
if(_1442=="null"){
_1442=null;
}
this._condition_value=_1442;
},getConditionValue:function(_1443){
return this._condition_value;
},setTargetType:function(_1444){
if(_1444=="null"){
_1444=null;
}
this._targetType=_1444;
},getTargetType:function(){
return this._targetType;
},setMatchPattern:function(_1445){
if(_1445=="null"){
_1445=null;
}
this._matchPattern=_1445;
},getMatchPattern:function(){
return this._matchPattern;
},setUserAccess:function(_1446){
if(_1446=="null"){
_1446=null;
}
this._userAccess=_1446;
},getUserAccess:function(){
return this._userAccess;
},setOrderValue:function(_1447){
if(_1447=="null"){
_1447=null;
}
this._orderValue=_1447;
},getOrderValue:function(){
return this._OrderValue;
},setRelatedTo:function(_1448){
if(_1448=="null"){
_1448=null;
}
this._relatedTo=_1448;
},getRelatedTo:function(){
return this._relatedTo;
},setOptions:function(_1449){
if(_1449=="null"){
_1449=null;
}
this._options=_1449;
},getOptions:function(){
return this._options;
},setDefaultValue:function(_144a){
if(_144a=="null"){
_144a=null;
}
this._defaultValue=_144a;
},getDefaultValue:function(){
return this._defaultValue;
},setType:function(_144b){
if(_144b=="null"){
_144b=null;
}
this._type=_144b;
},getType:function(){
return this._type;
},setTitle:function(_144c){
if(_144c=="null"){
_144c=null;
}
this._title=_144c;
},getTitle:function(){
return this._title;
},setId:function(_144d){
if(_144d=="null"){
_144d=null;
}
this._fieldId=_144d;
},getId:function(){
return this._fieldId;
}});
dojo.provide("app.widget.ParsingRuleCustomField");
dojo.require("app.widget.Widget");
dojo.require("app.data.ParsingRuleCustomField");
dojo.lang.declare("app.widget.ParsingRuleCustomField",app.widget.Widget,function(_144e,_144f){
this._parentNode=_144e;
this._model=_144f;
this.create();
this.connect();
},{create:function(){
this.domNode=document.createElement("tr");
this.setDomNode(this.domNode);
this.getParentNode().appendChild(this.domNode);
var _1450=document.createElement("td");
_1450.style.width="100px";
_1450.style.whiteSpace="nowrap";
_1450.innerHTML=this.getModel().getTitle();
this.domNode.appendChild(_1450);
var _1451=document.createElement("td");
this.domNode.appendChild(_1451);
this.targetType=dojo.widget.createWidget("qu:ComboBox");
this.targetType.setMultiselect(false);
this.targetType.setWidth("150px");
this.targetType.removeAll();
this.targetType.add("",app.i18n.get("disabled"));
this.targetType.add("b",app.i18n.get("matchInBody"));
if(this.getModel() instanceof app.data.ParsingRuleCustomField){
this.setTargetType(this.getModel().getTargetType());
}else{
this.setTargetType("");
}
_1451.appendChild(this.targetType.domNode);
var _1452=document.createElement("td");
_1452.style.width="100%";
_1452.style.whiteSpace="nowrap";
this.domNode.appendChild(_1452);
var _1453=document.createElement("span");
_1453.innerHTML=app.i18n.get("RegExp_");
_1452.appendChild(_1453);
this.patternNode=document.createElement("input");
this.patternNode.setAttribute("type","text");
this.patternNode.style.width="200px";
if(this.getModel() instanceof app.data.ParsingRuleCustomField){
if(this.getModel().getMatchPattern()=="null"||this.getModel().getMatchPattern()==null){
this.patternNode.value="";
}else{
this.patternNode.value=this.getModel().getMatchPattern();
}
}else{
this.patternNode.value="";
}
_1452.appendChild(this.patternNode);
var _1454=document.createElement("tr");
this.getParentNode().appendChild(_1454);
var td12=document.createElement("td");
_1454.appendChild(td12);
var td22=document.createElement("td");
_1454.appendChild(td22);
var td32=document.createElement("td");
_1454.appendChild(td32);
td12.style.paddingBottom="5px";
td22.style.paddingBottom="5px";
td32.style.paddingBottom="5px";
td12.style.borderBottom="1px solid rgb(204, 204, 204)";
td22.style.borderBottom="1px solid rgb(204, 204, 204)";
td32.style.borderBottom="1px solid rgb(204, 204, 204)";
this.conditionType=dojo.widget.createWidget("qu:ComboBox");
this.conditionType.setMultiselect(false);
this.conditionType.setWidth("150px");
this.fillTextCondSelect(this.conditionType);
if(this.getModel() instanceof app.data.ParsingRuleCustomField){
this.setConditionType(this.getModel().getConditionType());
}else{
this.setConditionType(null);
}
td22.appendChild(this.conditionType.domNode);
var _1458=document.createElement("span");
_1458.innerHTML=app.i18n.get("ConditionValue");
td32.appendChild(_1458);
this.conditionValue=document.createElement("input");
this.conditionValue.setAttribute("type","text");
this.conditionValue.style.width="200px";
if(this.getModel() instanceof app.data.ParsingRuleCustomField){
if(this.getModel().getConditionValue()!="null"&&this.getModel().getConditionValue()!=null){
this.conditionValue.value=this.getModel().getConditionValue();
}else{
this.conditionValue.value="";
}
}else{
this.conditionValue.value="";
}
td32.appendChild(this.conditionValue);
var _1459=document.createElement("span");
_1459.innerHTML=app.i18n.get("conditionIsNotRequired");
td32.appendChild(_1459);
},fillTextCondSelect:function(_145a){
_145a.removeAll();
_145a.add("",app.i18n.get("selectCondition"));
_145a.add("=",app.i18n.get("equal")+" "+app.i18n.get("caseSensitive"));
_145a.add("=i",app.i18n.get("equal")+" "+app.i18n.get("caseInsensitive"));
_145a.add("!=",app.i18n.get("notEqual")+" "+app.i18n.get("caseSensitive"));
_145a.add("!=i",app.i18n.get("notEqual")+" "+app.i18n.get("caseInsensitive"));
_145a.add("substr",app.i18n.get("contains")+" "+app.i18n.get("caseSensitive"));
_145a.add("substri",app.i18n.get("contains")+" "+app.i18n.get("caseInsensitive"));
_145a.add("!substr",app.i18n.get("doesntContain")+" "+app.i18n.get("caseSensitive"));
_145a.add("!substri",app.i18n.get("doesntContain")+" "+app.i18n.get("caseInsensitive"));
_145a.add("regexp",app.i18n.get("regularExpression"));
},connect:function(){
},setConditionType:function(_145b){
this.conditionType.deselectAll();
if(_145b!=null){
this.conditionType.select(_145b);
}
},getConditionType:function(){
return this.conditionType.getSelection().join("|");
},getConditionValue:function(){
return this.conditionValue.value;
},setTargetType:function(_145c){
this.targetType.deselectAll();
this.targetType.select(_145c);
},getTargetType:function(){
return this.targetType.getSelection().join("|");
},getPattern:function(){
return this.patternNode.value;
},setPattern:function(_145d){
if(_145d=="null"){
_145d="";
}
this.patternNode.value=_145d;
},getParentNode:function(){
return this._parentNode;
},getModel:function(){
return this._model;
}});
dojo.provide("app.view.settings.parsingRules.ParsingRule");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.require("app.widget.ParsingRuleCustomField");
dojo.lang.declare("app.view.settings.parsingRules.ParsingRule",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},initComponents:function(){
this.el.assignToAgentId.removeAll();
this.el.assignToAgentId.add("","["+app.i18n.get("none")+"]");
app.main.hashMaps.fill(this.el.assignToAgentId,"agents",false);
this.el.moveToQueueId.removeAll();
this.el.moveToQueueId.add("","["+app.i18n.get("none")+"]");
app.main.hashMaps.fill(this.el.moveToQueueId,"queues",false);
this.el.queueId.removeAll();
this.el.queueId.add("","["+app.i18n.get("any")+"]");
app.main.hashMaps.fill(this.el.queueId,"queues",false);
this.el.userGroup.removeAll();
this.el.userGroup.add("","["+app.i18n.get("any")+"]");
app.main.hashMaps.fill(this.el.userGroup,"groups",false);
this.el.accountId.removeAll();
this.el.accountId.add("","["+app.i18n.get("any")+"]");
app.main.hashMaps.fill(this.el.accountId,"mailAccounts",false);
},fillTextCondSelect:function(_145e){
_145e.removeAll();
_145e.add("",app.i18n.get("selectCondition"));
_145e.add("=",app.i18n.get("equal")+" "+app.i18n.get("caseSensitive"));
_145e.add("=i",app.i18n.get("equal")+" "+app.i18n.get("caseInsensitive"));
_145e.add("!=",app.i18n.get("notEqual")+" "+app.i18n.get("caseSensitive"));
_145e.add("!=i",app.i18n.get("notEqual")+" "+app.i18n.get("caseInsensitive"));
_145e.add("substr",app.i18n.get("contains")+" "+app.i18n.get("caseSensitive"));
_145e.add("substri",app.i18n.get("contains")+" "+app.i18n.get("caseInsensitive"));
_145e.add("!substr",app.i18n.get("doesntContain")+" "+app.i18n.get("caseSensitive"));
_145e.add("!substri",app.i18n.get("doesntContain")+" "+app.i18n.get("caseInsensitive"));
_145e.add("regexp",app.i18n.get("regularExpression"));
},fillBooleanSelect:function(_145f){
_145f.removeAll();
_145f.add("",app.i18n.get("selectCondition"));
_145f.add("y",app.i18n.get("yes"));
_145f.add("n",app.i18n.get("no"));
},fillExactCondSelect:function(_1460){
_1460.removeAll();
_1460.add("",app.i18n.get("selectCondition"));
_1460.add("=",app.i18n.get("equal"));
_1460.add("!=",app.i18n.get("notEqual"));
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.parsingRules.ParsingRule"));
this.setSize(900,600);
},onShow:function(){
this.el.name.focus();
},onLoad:function(){
this.setLoading(true);
this.center();
this.fillTextCondSelect(this.el.fromAddrCond);
this.fillTextCondSelect(this.el.toAddrCond);
this.fillTextCondSelect(this.el.ccAddrCond);
this.fillTextCondSelect(this.el.subjectCond);
this.fillTextCondSelect(this.el.bodyCond);
this.fillBooleanSelect(this.el.isNewTicketCond);
this.fillBooleanSelect(this.el.isRegisteredUserCond);
this.fillExactCondSelect(this.el.queueCond);
this.fillExactCondSelect(this.el.userGroupCond);
this.fillExactCondSelect(this.el.accountCond);
this.el.changeToStatusId.removeAll();
this.el.changeToStatusId.add("","["+app.i18n.get("none")+"]");
app.main.hashMaps.fill(this.el.changeToStatusId,"statuses",false);
this.el.changeToPrio.removeAll();
this.el.changeToPrio.add("","["+app.i18n.get("none")+"]");
app.main.hashMaps.fill(this.el.changeToPrio,"priorities",false);
this.setAssignToAgentIdLoaded(false);
this.setMoveToQueueIdLoaded(false);
this._customFieldWidgets=new Array();
try{
this.el.customFieldsContainer.innerHTML="";
}
catch(e){
while(this.el.customFieldsContainer.hasChildNodes()){
this.el.customFieldsContainer.removeChild(this.el.customFieldsContainer.firstChild);
}
}
var _1461=document.createElement("tbody");
this.el.customFieldsContainer.appendChild(_1461);
this.el.customFieldsSection.style.display="none";
app.main.hashMaps.execFunctionForEachElement(function(_1462){
if(_1462.getRelatedTo()=="g"){
return true;
}
var _1463=new app.widget.ParsingRuleCustomField(_1461,_1462);
this._customFieldWidgets.push(_1463);
this.el.customFieldsSection.style.display="block";
},this,"customFields");
this.resetForm();
this.setLoading(false);
},resetForm:function(){
this.msgBox.clear();
this.setName("");
this.setFromAddrCond("");
this.setFromAddrValue("");
this.setToAddrCond("");
this.setToAddrValue("");
this.setCcAddrCond("");
this.setCcAddrValue("");
this.setSubjectCond("");
this.setSubjectValue("");
this.setBodyCond("");
this.setBodyValue("");
this.setQueueCond("");
this.setQueueId("");
this.setUserGroupCond("");
this.setUserGroup("");
this.setAccountCond("");
this.setAccountId("");
this.setIsNewTicketCond("");
this.setIsRegisteredUserCond("");
this.setMoveToQueueId("");
this.setChangeToStatusId("");
this.setChangeToPrio("");
this.setAssignToAgentId("");
this.setDeleteMail(false);
this.setStopProcessing(false);
for(var i=0;i<this._customFieldWidgets.length;i++){
var _1465=this._customFieldWidgets[i];
_1465.setTargetType("");
_1465.setPattern("");
}
},getCustomFieldsPatterns:function(){
var ret=new Array();
for(var i=0;i<this._customFieldWidgets.length;i++){
var _1468=this._customFieldWidgets[i];
if(_1468.getTargetType()!=""){
var fld=[_1468.getPattern().replace(/\\/g,"\\\\"),_1468.getTargetType(),_1468.getModel().getId(),_1468.getConditionType(),_1468.getConditionValue()];
ret.push(fld);
}
}
return ret;
},onSave:function(){
this.msgBox.print(app.i18n.get("saving"));
},onSaveSuccess:function(){
this.msgBox.print(app.i18n.get("saved"));
},onSaveFail:function(_146a){
this.msgBox.print(_146a.message);
},getName:function(){
return this.el.name.value;
},setName:function(_146b){
this.el.name.value=_146b;
},getFromAddrCond:function(){
return this.el.fromAddrCond.getSelectedValue();
},setFromAddrCond:function(_146c){
this.el.fromAddrCond.selectByValue(_146c);
},getFromAddrValue:function(){
return this.el.fromAddrValue.value;
},setFromAddrValue:function(_146d){
this.el.fromAddrValue.value=_146d;
},getToAddrCond:function(){
return this.el.toAddrCond.getSelectedValue();
},setToAddrCond:function(_146e){
this.el.toAddrCond.selectByValue(_146e);
},getToAddrValue:function(){
return this.el.toAddrValue.value;
},setToAddrValue:function(_146f){
this.el.toAddrValue.value=_146f;
},getCcAddrCond:function(){
return this.el.ccAddrCond.getSelectedValue();
},setCcAddrCond:function(_1470){
this.el.ccAddrCond.selectByValue(_1470);
},getCcAddrValue:function(){
return this.el.ccAddrValue.value;
},setCcAddrValue:function(_1471){
this.el.ccAddrValue.value=_1471;
},getSubjectCond:function(){
return this.el.subjectCond.getSelectedValue();
},setSubjectCond:function(_1472){
this.el.subjectCond.selectByValue(_1472);
},getSubjectValue:function(){
return this.el.subjectValue.value;
},setSubjectValue:function(_1473){
this.el.subjectValue.value=_1473;
},getBodyCond:function(){
return this.el.bodyCond.getSelectedValue();
},setBodyCond:function(_1474){
this.el.bodyCond.selectByValue(_1474);
},getBodyValue:function(){
return this.el.bodyValue.value;
},setBodyValue:function(_1475){
this.el.bodyValue.value=_1475;
},getQueueCond:function(){
return this.el.queueCond.getSelectedValue();
},setQueueCond:function(_1476){
this.el.queueCond.selectByValue(_1476);
},getQueueId:function(){
return this.el.queueId.getSelection().join("|");
},setQueueId:function(_1477){
this.el.queueId.deselectAll();
this.el.queueId.select(_1477);
},getUserGroupCond:function(){
return this.el.userGroupCond.getSelectedValue();
},setUserGroupCond:function(_1478){
this.el.userGroupCond.selectByValue(_1478);
},getUserGroup:function(){
return this.el.userGroup.getSelection().join("|");
},setUserGroup:function(_1479){
this.el.userGroup.deselectAll();
this.el.userGroup.select(_1479);
},getAccountCond:function(){
return this.el.accountCond.getSelectedValue();
},setAccountCond:function(_147a){
if(_147a=="null"||_147a==null){
_147a="";
}
this.el.accountCond.selectByValue(_147a);
},getAccountId:function(){
return this.el.accountId.getSelection().join("|");
},setAccountId:function(_147b){
this.el.accountId.deselectAll();
this.el.accountId.select(_147b);
},isNewTicketCond:function(){
return this.el.isNewTicketCond.getSelectedValue();
},setIsNewTicketCond:function(_147c){
this.el.isNewTicketCond.selectByValue(_147c);
},isRegisteredUserCond:function(){
return this.el.isRegisteredUserCond.getSelectedValue();
},setIsRegisteredUserCond:function(_147d){
this.el.isRegisteredUserCond.selectByValue(_147d);
},getMoveToQueueId:function(){
return this.el.moveToQueueId.getSelection().join("|");
},setMoveToQueueId:function(_147e){
this.el.moveToQueueId.deselectAll();
this.el.moveToQueueId.select(_147e);
},getChangeToStatusId:function(){
return this.el.changeToStatusId.getSelection().join("|");
},setChangeToStatusId:function(_147f){
this.el.changeToStatusId.deselectAll();
this.el.changeToStatusId.select(_147f);
},getChangeToPrio:function(){
return this.el.changeToPrio.getSelection().join("|");
},setChangeToPrio:function(_1480){
this.el.changeToPrio.deselectAll();
this.el.changeToPrio.select(_1480);
},getAssignToAgentId:function(){
return this.el.assignToAgentId.getSelection().join("|");
},setAssignToAgentId:function(_1481){
this.el.assignToAgentId.deselectAll();
this.el.assignToAgentId.select(_1481);
},deleteMail:function(){
if(this.el.deleteMail.checked){
return "y";
}
return "n";
},setDeleteMail:function(_1482){
if(_1482==true||_1482=="y"){
this.el.deleteMail.checked=true;
}else{
if(_1482==false||_1482=="n"){
this.el.deleteMail.checked=false;
}
}
},stopProcessing:function(){
if(this.el.stopProcessing.checked){
return "y";
}
return "n";
},setStopProcessing:function(_1483){
if(_1483==true||_1483=="y"){
this.el.stopProcessing.checked=true;
}else{
if(_1483==false||_1483=="n"){
this.el.stopProcessing.checked=false;
}
}
},setAssignToAgentIdLoaded:function(_1484){
this._assignToAgentLoaded=_1484;
},isAssignToAgentIdLoaded:function(){
return this._assignToAgentLoaded;
},setMoveToQueueIdLoaded:function(_1485){
this._moveToQueueIdLoaded=_1485;
},isMoveToQueueIdLoaded:function(){
return this._moveToQueueIdLoaded;
}});
dojo.provide("app.view.settings.parsingRules.ParsingRuleAdd");
dojo.require("app.view.settings.parsingRules.ParsingRule");
dojo.lang.declare("app.view.settings.parsingRules.ParsingRuleAdd",app.view.settings.parsingRules.ParsingRule,null,{initComponents:function(){
this.constructor.superclass.initComponents.apply(this);
},onSave:function(){
this.constructor.superclass.onSave.apply(this);
var _1486=new Object();
_1486.name=this.getName();
_1486.from_addr_cond=this.getFromAddrCond();
_1486.from_addr_value=this.getFromAddrValue();
_1486.to_addr_cond=this.getToAddrCond();
_1486.to_addr_value=this.getToAddrValue();
_1486.cc_addr_cond=this.getCcAddrCond();
_1486.cc_addr_value=this.getCcAddrValue();
_1486.queue_cond=this.getQueueCond();
_1486.queue_id=this.getQueueId();
_1486.group_cond=this.getUserGroupCond();
_1486.group_id=this.getUserGroup();
_1486.account_cond=this.getAccountCond();
_1486.account_value=this.getAccountId();
_1486.subject_cond=this.getSubjectCond();
_1486.subject_value=this.getSubjectValue();
_1486.body_cond=this.getBodyCond();
_1486.body_value=this.getBodyValue();
_1486.is_new_ticket_cond=this.isNewTicketCond();
_1486.is_registered_user_cond=this.isRegisteredUserCond();
_1486.move_to_queue_id=this.getMoveToQueueId();
_1486.change_to_status_id=this.getChangeToStatusId();
_1486.change_to_prio=this.getChangeToPrio();
_1486.assign_to_agent_id=this.getAssignToAgentId();
_1486.delete_mail=this.deleteMail();
_1486.stop_processing=this.stopProcessing();
var rules=new qu.rpc.Service("Rules");
var def=rules.insertRule({fields:_1486,sid:qu.user.getSid(),custom_fields:this.getCustomFieldsPatterns()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("newParsingRule"));
this.setIcon(new qu.gui.Icon("file-new"));
}});
dojo.provide("app.view.settings.parsingRules.ParsingRuleEdit");
dojo.require("app.view.settings.parsingRules.ParsingRule");
dojo.lang.declare("app.view.settings.parsingRules.ParsingRuleEdit",app.view.settings.parsingRules.ParsingRule,null,{onSave:function(){
this.constructor.superclass.onSave.apply(this);
var _1489=new Object();
_1489.name=this.getName();
_1489.from_addr_cond=this.getFromAddrCond();
_1489.from_addr_value=this.getFromAddrValue();
_1489.to_addr_cond=this.getToAddrCond();
_1489.to_addr_value=this.getToAddrValue();
_1489.cc_addr_cond=this.getCcAddrCond();
_1489.cc_addr_value=this.getCcAddrValue();
_1489.queue_cond=this.getQueueCond();
_1489.queue_id=this.getQueueId();
_1489.group_cond=this.getUserGroupCond();
_1489.group_id=this.getUserGroup();
_1489.account_cond=this.getAccountCond();
_1489.account_value=this.getAccountId();
_1489.subject_cond=this.getSubjectCond();
_1489.subject_value=this.getSubjectValue();
_1489.body_cond=this.getBodyCond();
_1489.body_value=this.getBodyValue();
_1489.is_new_ticket_cond=this.isNewTicketCond();
_1489.is_registered_user_cond=this.isRegisteredUserCond();
_1489.move_to_queue_id=this.getMoveToQueueId();
_1489.change_to_status_id=this.getChangeToStatusId();
_1489.change_to_prio=this.getChangeToPrio();
_1489.assign_to_agent_id=this.getAssignToAgentId();
_1489.delete_mail=this.deleteMail();
_1489.stop_processing=this.stopProcessing();
var rules=new qu.rpc.Service("Rules");
var def=rules.updateRule({rule_id:this.getRuleId().valueOf(),fields:_1489,sid:qu.user.getSid(),custom_fields:this.getCustomFieldsPatterns()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},setRuleId:function(_148c){
this._ruleId=_148c;
},getRuleId:function(){
return this._ruleId;
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.setLoading(true);
this.resetForm();
dojo.event.connectOnce(this,"onLoadRuleSuccess",this,"hideLoading");
this.loadRule();
},loadRule:function(){
var rules=new qu.rpc.Service("Rules");
var def=rules.getRule({sid:qu.user.getSid(),rule_id:this.getRuleId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadRuleSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadRuleSuccess:function(_148f){
var rs=_148f;
rs.first();
this.setName(rs.get("name"));
this.setFromAddrCond(rs.get("from_addr_cond"));
this.setFromAddrValue(rs.get("from_addr_value"));
this.setToAddrCond(rs.get("to_addr_cond"));
this.setToAddrValue(rs.get("to_addr_value"));
this.setCcAddrCond(rs.get("cc_addr_cond"));
this.setCcAddrValue(rs.get("cc_addr_value"));
this.setQueueCond(rs.get("queue_cond"));
this.setQueueId(rs.get("queue_id"));
this.setUserGroupCond(rs.get("group_cond"));
this.setUserGroup(rs.get("group_id"));
this.setAccountCond(rs.get("account_cond"));
this.setAccountId(rs.get("account_value"));
this.setSubjectCond(rs.get("subject_cond"));
this.setSubjectValue(rs.get("subject_value"));
this.setBodyCond(rs.get("body_cond"));
this.setBodyValue(rs.get("body_value"));
this.setIsNewTicketCond(rs.get("is_new_ticket_cond"));
this.setIsRegisteredUserCond(rs.get("is_registered_user_cond"));
this.setMoveToQueueId(rs.get("move_to_queue_id"));
this.setChangeToStatusId(rs.get("change_to_status_id"));
this.setChangeToPrio(rs.get("change_to_prio"));
this.setAssignToAgentId(rs.get("assign_to_agent_id"));
this.setDeleteMail(rs.get("delete_mail"));
this.setStopProcessing(rs.get("stop_processing"));
this._customFieldWidgets=new Array();
try{
this.el.customFieldsContainer.innerHTML="";
}
catch(e){
while(this.el.customFieldsContainer.hasChildNodes()){
this.el.customFieldsContainer.removeChild(this.el.customFieldsContainer.firstChild);
}
}
var _1491=document.createElement("tbody");
this.el.customFieldsContainer.appendChild(_1491);
var _1492=rs.get("custom_fields");
var _1493=new qu.sql.ResultSet();
_1493.md.setTableName(_1492.md.tableName);
_1493.md.setTypes(_1492.md.colTypes);
_1493.md.setNames(_1492.md.colNames);
_1493.md.setCount(_1492.count);
_1493.rows=_1492.rs.rows;
_1493.row=-1;
if(_1493!=null){
_1493.beforeFirst();
while(_1493.next()){
var _1494=new app.data.ParsingRuleCustomField();
_1494.setId(_1493.get("field_id").valueOf());
_1494.setTitle(_1493.get("field_title").valueOf());
_1494.setType(_1493.get("field_type").valueOf());
_1494.setDefaultValue(_1493.get("default_value").valueOf());
_1494.setOptions(_1493.get("options").valueOf());
_1494.setRelatedTo(_1493.get("related_to").valueOf());
_1494.setOrderValue(_1493.get("order_value").valueOf());
_1494.setUserAccess(_1493.get("user_access").valueOf());
_1494.setMatchPattern(_1493.get("match_pattern").valueOf());
_1494.setTargetType(_1493.get("target_type").valueOf());
_1494.setConditionType(_1493.get("condition_type").valueOf());
_1494.setConditionValue(_1493.get("condition_value").valueOf());
if(_1494.getRelatedTo()!="g"){
var _1495=new app.widget.ParsingRuleCustomField(_1491,_1494);
this._customFieldWidgets.push(_1495);
}
}
}
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editRule"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.settings.ParsingRules");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.parsingRules.ParsingRuleAdd");
dojo.require("app.view.settings.parsingRules.ParsingRuleEdit");
dojo.lang.declare("app.view.settings.ParsingRules",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:false,width:"100%",style:{cursor:"pointer"}});
setColumn("order",{caption:app.i18n.get("order"),sortable:false,width:"85px",style:{cursor:"pointer"},bind:dojo.lang.hitch(this,function(col,rs){
var div=document.createElement("div");
div.style.width="40px";
div.style.textAlign="center";
var img1=document.createElement("img");
img1.setAttribute("src",qu.global.icon("down.png",16));
img1.style.cursor="pointer";
img1.style.paddingRight="2px";
img1.style.paddingRight="2px";
img1.setAttribute("ruleId",rs.getString("rule_id").valueOf());
img1.setAttribute("ruleOrder",rs.getString("rule_order").valueOf());
var img2=document.createElement("img");
img2.setAttribute("src",qu.global.icon("up.png",16));
img2.style.cursor="pointer";
img2.style.paddingRight="2px";
img2.style.paddingRight="2px";
img2.setAttribute("ruleId",rs.getString("rule_id").valueOf());
img2.setAttribute("ruleOrder",rs.getString("rule_order").valueOf());
var order=rs.getNumber("rule_order").valueOf();
if(order!=1){
div.appendChild(img2);
}
var count=rs.md.getCount();
if(order!=count){
div.appendChild(img1);
}
dojo.event.connectOnce(img1,"onclick",this,"onMoveDown");
dojo.event.connectOnce(img2,"onclick",this,"onMoveUp");
return div;
})});
setMultiselect(true);
setSortColumn("rule_order");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _149d=new qu.rpc.Service("Rules");
with(this.el.grid.getModel()){
setService(_149d);
setMethod("getRulesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.addParsingRule=new app.view.settings.parsingRules.ParsingRuleAdd();
this.editParsingRule=new app.view.settings.parsingRules.ParsingRuleEdit();
this.el.grid.init();
},onMoveUp:function(_149e){
var _149f=_149e.target;
var _14a0=_149f.getAttribute("ruleId");
var _14a1=_149f.getAttribute("ruleOrder");
var rules=new qu.rpc.Service("Rules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.moveRuleUp({sid:qu.user.getSid(),rule_id:_14a0,rule_order:_14a1});
def.addCallback(dojo.lang.hitch(this,"onMoveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onMoveFail"));
},onMoveSuccess:function(_14a4){
this.el.grid.getData();
},onMoveFail:function(_14a5){
alert(_14a5);
},onMoveDown:function(_14a6){
var _14a7=_14a6.target;
var _14a8=_14a7.getAttribute("ruleId");
var _14a9=_14a7.getAttribute("ruleOrder");
var rules=new qu.rpc.Service("Rules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.moveRuleDown({sid:qu.user.getSid(),rule_id:_14a8,rule_order:_14a9});
def.addCallback(dojo.lang.hitch(this,"onMoveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onMoveFail"));
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.ParsingRules"));
},onAdd:function(){
dojo.event.connectOnce(this.addParsingRule,"onSaveSuccess",this.el.grid,"update");
this.addParsingRule.show();
},onEdit:function(inRow,inCol){
if(inCol==2){
return;
}
dojo.event.connectOnce(this.editParsingRule,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editParsingRule.setRuleId(rs.get("rule_id"));
this.editParsingRule.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("rule_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _14b0=this.el.grid.getSelectionByColumn("rule_order").join("|");
var names=this.el.grid.getSelectionByColumn("name").join("|");
var rules=new qu.rpc.Service("Rules");
rules.setThrobber("Deleting...");
var def=rules.deleteRule({sid:qu.user.getSid(),rule_order:_14b0,rule_id:ids,name:names});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_14b4){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_14b5){
app.main.msgBox.print(_14b5);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.queues.Queue");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.lang.declare("app.view.settings.queues.Queue",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.save,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
dojo.event.connectOnce(this.el.autorespond,"onclick",this,"onAutorespondClick");
},initComponents:function(){
this.el.agents.setSize("100%","167px");
with(this.el.agents.getModel()){
setService(new qu.rpc.Service("Users"));
setMethod("getUsersList");
setDefaultParams({sid:qu.user.getSid(),user_type:"g",order:"name"});
setValueColumn("user_id");
setTextColumn("name");
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.queues.Queue"));
this.setSize(1010,750);
},onKeyPress:function(_14b6){
switch(_14b6.keyCode){
case _14b6.KEY_ESCAPE:
this.hide();
break;
}
},resetForm:function(){
this.msgBox.clear();
this.setQueueName("");
this.setTicketIdPrefix("");
this.setEmail("");
this.setMaxAnswerTime("24");
this.setAutorespond(false);
this.setPublic(false);
this.setOpenedForUsers(false);
this.setSubject("");
this.setBody("");
this.setDefault(false);
},onShow:function(){
this.el.body.setModeRich();
this.el.queueSignature.setModeRich();
},onAutorespondClick:function(){
this.setAutorespond(this.el.autorespond.checked);
},onSave:function(){
this.msgBox.print(app.i18n.get("saving"));
},onSaveSuccess:function(){
this.msgBox.print(app.i18n.get("saved"));
},onSaveFail:function(_14b7){
this.msgBox.print(_14b7.message);
},getQueueName:function(){
return this.el.queueName.value;
},setQueueName:function(_14b8){
this.el.queueName.value=_14b8;
},getTicketIdPrefix:function(){
return this.el.ticketIdPrefix.value;
},setTicketIdPrefix:function(_14b9){
this.el.ticketIdPrefix.value=_14b9;
},getEmail:function(){
return this.el.email.value;
},setEmail:function(_14ba){
this.el.email.value=_14ba;
},getMaxAnswerTime:function(){
return this.el.maxAnswerTime.value;
},setMaxAnswerTime:function(_14bb){
this.el.maxAnswerTime.value=_14bb;
},isAutorespond:function(){
if(this.el.autorespond.checked){
return "y";
}
return "n";
},setAutorespond:function(_14bc){
if(_14bc==true||_14bc=="y"){
this.el.autorespond.checked=true;
this.el.subject.disabled=false;
}else{
if(_14bc==false||_14bc=="n"){
this.el.autorespond.checked=false;
this.el.subject.disabled=true;
}
}
},isPublic:function(){
if(this.el["public"].checked){
return "y";
}
return "n";
},setPublic:function(_14bd){
if(_14bd==true||_14bd=="y"){
this.el["public"].checked=true;
}else{
if(_14bd==false||_14bd=="n"){
this.el["public"].checked=false;
}
}
},isOpenedForUsers:function(){
if(this.el["openedForUsers"].checked){
return "y";
}
return "n";
},setOpenedForUsers:function(_14be){
if(_14be==true||_14be=="y"){
this.el["openedForUsers"].checked=true;
}else{
if(_14be==false||_14be=="n"){
this.el["openedForUsers"].checked=false;
}
}
},getSubject:function(){
return this.el.subject.value;
},setSubject:function(_14bf){
this.el.subject.value=_14bf;
},getBody:function(){
return this.el.body.getHtml();
},setBody:function(_14c0){
this.el.body.setHtml(_14c0);
},getQueueSignature:function(){
return this.el.queueSignature.getHtml();
},setQueueSignature:function(_14c1){
if(_14c1=="null"||_14c1==null){
_14c1="";
}
this.el.queueSignature.setHtml(_14c1);
},isDefault:function(){
if(this.el.isDefault.checked){
return "y";
}
return "n";
},setDefault:function(_14c2){
if(_14c2==true||_14c2=="y"){
this.el.isDefault.checked=true;
this.el.isDefault.disabled=true;
}else{
if(_14c2==false||_14c2=="n"){
this.el.isDefault.checked=false;
this.el.isDefault.disabled=false;
}
}
},setQueueIdValue:function(_14c3){
this.el.valueId.innerHTML=_14c3;
this.el.valueId.style.display="block";
this.el.labelId.style.display="block";
}});
dojo.provide("app.view.settings.queues.QueueAdd");
dojo.require("app.view.settings.queues.Queue");
dojo.lang.declare("app.view.settings.queues.QueueAdd",app.view.settings.queues.Queue,null,{initComponents:function(){
this.constructor.superclass.initComponents.apply(this);
},onSave:function(){
this.constructor.superclass.onSave.apply(this);
var _14c4=new Object();
_14c4.name=this.getQueueName();
_14c4.ticket_id_prefix=this.getTicketIdPrefix();
_14c4.queue_email=this.getEmail();
_14c4.answer_time=this.getMaxAnswerTime();
_14c4.is_default=this.isDefault();
_14c4.autorespond_nt=this.isAutorespond();
_14c4["public"]=this.isPublic();
_14c4["opened_for_users"]=this.isOpenedForUsers();
_14c4.autorespond_nt_subject=this.getSubject();
_14c4.autorespond_nt_body=this.getBody();
_14c4.queue_signature=this.getQueueSignature();
var _14c5=new qu.rpc.Service("Queues");
_14c5.addPushRequest("queues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name"});
_14c5.setThrobber(app.i18n.get("saving"));
var def=_14c5.insertQueue({fields:_14c4,sid:qu.user.getSid(),user_id:this.el.agents.getSelectedValues()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewQueue"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.setLoading(true);
dojo.event.connectOnce(this.el.agents,"onLoad",this,"hideLoading");
dojo.event.connectOnce(this,"hideLoading",this.el.body,"resetDesignMode");
this.el.agents.update();
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.queues.QueueEdit");
dojo.require("app.view.settings.queues.Queue");
dojo.lang.declare("app.view.settings.queues.QueueEdit",app.view.settings.queues.Queue,null,{onSave:function(){
this.constructor.superclass.onSave.apply(this);
var _14c7=new Object();
_14c7.name=this.getQueueName();
_14c7.ticket_id_prefix=this.getTicketIdPrefix();
_14c7.queue_email=this.getEmail();
_14c7.answer_time=this.getMaxAnswerTime();
_14c7.is_default=this.isDefault();
_14c7.autorespond_nt=this.isAutorespond();
_14c7["public"]=this.isPublic();
_14c7["opened_for_users"]=this.isOpenedForUsers();
_14c7.autorespond_nt_subject=this.getSubject();
_14c7.autorespond_nt_body=this.getBody();
_14c7.queue_signature=this.getQueueSignature();
var _14c8=new qu.rpc.Service("Queues");
_14c8.addPushRequest("queues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name"});
_14c8.setThrobber(app.i18n.get("saving"));
var def=_14c8.updateQueue({queue_id:this.getQueueId().valueOf(),fields:_14c7,sid:qu.user.getSid(),user_id:this.el.agents.getSelectedValues()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},setQueueId:function(_14ca){
this._queueId=_14ca;
},getQueueId:function(){
return this._queueId;
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"setAgents",this,"hideLoading");
dojo.event.connectOnce(this,"hideLoading",this.el.body,"resetDesignMode");
dojo.event.connectOnce(this.el.agents,"onLoadQueueFail",this,"hide");
this.resetForm();
this.el.agents.removeAll();
this.loadQueue();
},loadQueue:function(){
var _14cb=new qu.rpc.Service("Queues");
var def=_14cb.getQueue({sid:qu.user.getSid(),queue_id:this.getQueueId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadQueueSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadQueueFail"));
},onLoadQueueSuccess:function(_14cd){
var rs=_14cd;
rs.first();
this.agentIds=rs.getString("agent_ids").split("|");
dojo.event.connectOnce(this.el.agents,"onLoad",this,"setAgents");
this.el.agents.update();
this.setQueueName(rs.get("name"));
this.setTicketIdPrefix(rs.get("ticket_id_prefix"));
this.setEmail(rs.get("queue_email"));
this.setMaxAnswerTime(rs.get("answer_time"));
this.setDefault(rs.get("is_default"));
this.setPublic(rs.get("public"));
this.setOpenedForUsers(rs.get("opened_for_users"));
this.setAutorespond(rs.get("autorespond_nt"));
this.setSubject(rs.get("autorespond_nt_subject"));
this.setBody(rs.get("autorespond_nt_body"));
this.setQueueIdValue(rs.get("queue_id"));
this.setQueueSignature(rs.get("queue_signature"));
},onLoadQueueFail:function(_14cf){
dojo.debug(_14cf);
},setAgents:function(){
var ids=this.agentIds;
for(var i=0;i<ids.length;i++){
this.el.agents.selectByValue(ids[i]);
}
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editQueue"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.settings.Queues");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.queues.QueueAdd");
dojo.require("app.view.settings.queues.QueueEdit");
dojo.lang.declare("app.view.settings.Queues",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"50%",style:{cursor:"pointer"},bind:function(col,rs){
return "<span style='font-weight: bold; fon-size:5px;'>"+rs.get(col).valueOf()+"</span><br /><span style='color: #555555;'>"+app.i18n.get("queueID")+rs.get("queue_id").valueOf()+"</span>";
}});
setColumn("queue_email",{caption:app.i18n.get("queueEmail"),sortable:true,width:"50%",style:{cursor:"pointer"}});
setColumn("answer_time",{caption:app.i18n.get("answerTime"),sortable:true,width:"80px",style:{cursor:"pointer"}});
setColumn("autorespond_nt",{caption:app.i18n.get("autoresponder"),sortable:true,width:"60px",style:{cursor:"pointer"},bind:dojo.lang.hitch(this,function(col,rs){
var _14d6=rs.getString("autorespond_nt").valueOf();
var img=document.createElement("img");
if(_14d6=="y"){
img.setAttribute("src",qu.global.icon("ok.png",16));
img.setAttribute("title",app.i18n.get("autoresponder"));
}else{
img.setAttribute("src",qu.global.icon("no.png",16));
img.setAttribute("title",app.i18n.get("autoresponder"));
}
return img;
})});
setColumn("public",{caption:app.i18n.get("public_"),sortable:true,width:"40px",style:{cursor:"pointer"},bind:dojo.lang.hitch(this,function(col,rs){
var _14da=rs.getString("public").valueOf();
var img=document.createElement("img");
if(_14da=="y"){
img.setAttribute("src",qu.global.icon("ok.png",16));
img.setAttribute("title",app.i18n.get("accessibleForAllAgents"));
}else{
img.setAttribute("src",qu.global.icon("no.png",16));
img.setAttribute("title",app.i18n.get("accessibleForAssignedAgents"));
}
return img;
})});
setColumn("actions",{caption:app.i18n.get("defaultQueue"),sortable:false,width:"100px",style:{textAlign:"center"},bind:dojo.lang.hitch(this,function(col,rs){
var _14de=rs.getString("is_default").valueOf();
if(_14de=="y"){
return app.i18n.get("defaultQueue");
}
var img=document.createElement("img");
img.setAttribute("src",qu.global.icon("home.png",16));
img.setAttribute("title",app.i18n.get("setAsDefault"));
img.style.cursor="pointer";
img.setAttribute("queueId",rs.getString("queue_id"));
img.setAttribute("queueName",rs.getString("name"));
dojo.event.connectOnce(img,"onclick",this,"onSetDefault");
return img;
})});
setMultiselect(true);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _14e0=new qu.rpc.Service("Queues");
with(this.el.grid.getModel()){
setService(_14e0);
setMethod("getQueueList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addQueue=new app.view.settings.queues.QueueAdd();
this.editQueue=new app.view.settings.queues.QueueEdit();
},onSetDefault:function(_14e1){
var _14e2=_14e1.target;
var _14e3=_14e2.getAttribute("queueId");
var _14e4=_14e2.getAttribute("queueName");
var _14e5=new qu.rpc.Service("Queues");
_14e5.addPushRequest("queues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name"});
_14e5.setThrobber(app.i18n.get("saving"));
var def=_14e5.setDefaultQueue({sid:qu.user.getSid(),queue_id:_14e3,name:_14e4});
def.addCallback(dojo.lang.hitch(this,"onSetDefaultSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSetDefaultFail"));
},onSetDefaultSuccess:function(_14e7){
this.el.grid.getData();
},onSetDefaultFail:function(_14e8){
alert(_14e8);
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.add,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Queues"));
},onAdd:function(){
dojo.event.connectOnce(this.addQueue,"onSaveSuccess",this.el.grid,"update");
this.addQueue.show();
},onEdit:function(inRow,inCol){
if(inCol==6){
return;
}
dojo.event.connectOnce(this.editQueue,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editQueue.setQueueId(rs.get("queue_id"));
this.editQueue.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("queue_id").join("|");
var names=this.el.grid.getSelectionByColumn("name").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _14ee=new qu.rpc.Service("Queues");
_14ee.addPushRequest("queues","Queues","getQueueList",{sid:qu.user.getSid(),order:"name"});
_14ee.setThrobber("Deleting...");
var def=_14ee.deleteQueue({sid:qu.user.getSid(),queue_id:ids,name:names});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_14f0){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_14f1){
app.main.msgBox.print(_14f1);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.Configuration");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.settings.Configuration",qu.gui.Frame,null,{initComponents:function(){
this.el.defaultLanguage.setWidth("10em");
this.el.onlineAgentsView.removeAll();
this.el.onlineAgentsView.add("",app.i18n.get("AgentsAndAdmins"));
this.el.onlineAgentsView.add("a",app.i18n.get("onlyAdmins"));
this.el.onlineAgentsView.add("n",app.i18n.get("notDisplayed"));
this.el.knowledgeRefresh.removeAll();
this.el.knowledgeRefresh.add("",app.i18n.get("automaticRefresh"));
this.el.knowledgeRefresh.add("m",app.i18n.get("onlyManualRefresh"));
this.el.agentUserAccess.removeAll();
this.el.agentUserAccess.add("0",app.i18n.get("seeUsers_Agents_Admins"));
this.el.agentUserAccess.add("1",app.i18n.get("seeUsers_Agents"));
this.el.agentUserAccess.add("2",app.i18n.get("seeUsers"));
this.el.agentUserAccess.add("3",app.i18n.get("noAccessToUsers"));
this.el.defaultFont.removeAll();
this.el.defaultFont.add("Arial","Arial");
this.el.defaultFont.add("Arial Narrow","Arial Narrow");
this.el.defaultFont.add("Courier","Courier");
this.el.defaultFont.add("Cursive","Cursive");
this.el.defaultFont.add("Fantasy","Fantasy");
this.el.defaultFont.add("Georgia","Georgia");
this.el.defaultFont.add("Impact","Impact");
this.el.defaultFont.add("Monospace","Monospace");
this.el.defaultFont.add("Serif","Serif");
this.el.defaultFont.add("sans-serif","Sans Serif");
this.el.defaultFont.add("Tahoma","Tahoma");
this.el.defaultFont.add("Times","Times");
this.el.defaultFont.add("Verdana","Verdana");
this.el.defaultFontSize.removeAll();
this.el.defaultFontSize.add("1","1 (8pt)");
this.el.defaultFontSize.add("2","2 (10pt)");
this.el.defaultFontSize.add("3","3 (12pt)");
this.el.defaultFontSize.add("4","4 (14pt)");
this.el.defaultFontSize.add("5","5 (18pt)");
this.el.defaultFontSize.add("6","6 (24pt)");
this.el.defaultFontSize.add("7","7 (36pt)");
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Configuration"));
},onLoad:function(){
dojo.event.connectOnce(this,"onLoadSettingsSuccess",this,"hideLoading");
this.setLoading(true);
app.main.hashMaps.fill(this.el.defaultLanguage,"languages",true);
app.main.hashMaps.fill(this.el.defaultPriority,"priorities",true);
app.main.hashMaps.fill(this.el.minLogLevel,"levels",true);
var _14f2=new qu.rpc.Service("Settings");
var _14f3=new Array();
for(var each in this.el){
if(this.el[each].domNode||this.el[each].getAttribute("configswitch")=="true"){
_14f3.push(each);
}
}
var def=_14f2.getSettingsList({sid:qu.user.getSid(),setting_key:_14f3});
def.addCallback(dojo.lang.hitch(this,"onLoadSettingsSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadSettingsFail"));
},onLoadSettingsSuccess:function(_14f6){
_14f6.beforeFirst();
while(_14f6.next()){
var _14f7="set"+_14f6.getString("setting_key").substring(0,1).toUpperCase()+_14f6.getString("setting_key").substring(1);
this[_14f7](_14f6.getString("setting_value"));
}
},onLoadSettingsFail:function(_14f8){
alert(_14f8);
},setLoading:function(_14f9){
if(_14f9){
this.showLoading();
}else{
this.hideLoading();
}
},hideLoading:function(){
this.el.ownWait.style.display="none";
this.el.ownContent.style.display="block";
},showLoading:function(){
this.el.ownContent.style.display="none";
this.el.ownWait.style.display="block";
},onSave:function(){
var _14fa=new qu.rpc.Service("Settings");
var _14fb=new Object();
for(var each in this.el){
if(this.el[each].domNode||this.el[each].getAttribute("configswitch")=="true"){
var _14fd="get"+each.substring(0,1).toUpperCase()+each.substring(1);
_14fb[each.toString()]=this[_14fd]();
}
}
var def=_14fa.updateSetting({sid:qu.user.getSid(),fields:_14fb});
def.addCallback(dojo.lang.hitch(this,"onSaveSettingsSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveSettingsFail"));
},onSaveSettingsSuccess:function(_14ff){
app.main.msgBox.print(app.i18n.get("SettingsSuccessfullySaved"));
},onSaveSettingsFail:function(_1500){
alert(_1500);
},setCheckEmailQuality:function(_1501){
if(_1501==true||_1501=="y"){
this.el.checkEmailQuality.checked=true;
}else{
if(_1501==false||_1501=="n"){
this.el.checkEmailQuality.checked=false;
}
}
},getCheckEmailQuality:function(){
if(this.el.checkEmailQuality.checked){
return "y";
}
return "n";
},setSendRegistrationEmail:function(_1502){
if(_1502==true||_1502=="y"){
this.el.sendRegistrationEmail.checked=true;
}else{
if(_1502==false||_1502=="n"){
this.el.sendRegistrationEmail.checked=false;
}
}
},getSendRegistrationEmail:function(){
if(this.el.sendRegistrationEmail.checked){
return "y";
}
return "n";
},setSendSystemMails:function(_1503){
if(_1503==true||_1503=="y"){
this.el.sendSystemMails.checked=true;
}else{
if(_1503==false||_1503=="n"){
this.el.sendSystemMails.checked=false;
}
}
},getSendSystemMails:function(){
if(this.el.sendSystemMails.checked){
return "y";
}
return "n";
},setDisableMailGateway:function(_1504){
if(_1504==true||_1504=="y"){
this.el.disableMailGateway.checked=true;
}else{
if(_1504==false||_1504=="n"){
this.el.disableMailGateway.checked=false;
}
}
},getDisableMailGateway:function(){
if(this.el.disableMailGateway.checked){
return "y";
}
return "n";
},setDisableNotifications:function(_1505){
if(_1505==true||_1505=="y"){
this.el.disableNotifications.checked=true;
}else{
if(_1505==false||_1505=="n"){
this.el.disableNotifications.checked=false;
}
}
},getDisableNotifications:function(){
if(this.el.disableNotifications.checked){
return "y";
}
return "n";
},setTicketIdFormat:function(_1506){
this.el.ticketIdFormat.value=_1506;
},getTicketIdFormat:function(){
return this.el.ticketIdFormat.value;
},setBlindCarbonCopy:function(_1507){
this.el.blindCarbonCopy.value=_1507;
},getBlindCarbonCopy:function(){
return this.el.blindCarbonCopy.value;
},setSubjectPrefixes:function(_1508){
this.el.subjectPrefixes.value=_1508;
},getSubjectPrefixes:function(){
return this.el.subjectPrefixes.value;
},setApplicationURL:function(_1509){
this.el.applicationURL.value=this.el.applicationURL.value.replace(/\\/g,"/");
if(this.el.applicationURL.value.length>0&&this.el.applicationURL.value.substring(this.el.applicationURL.value.length-1)!="/"){
this.el.applicationURL.value=this.el.applicationURL.value+"/";
}
this.el.applicationURL.value=_1509;
},getApplicationURL:function(){
return this.el.applicationURL.value;
},setTmpPath:function(_150a){
this.el.tmpPath.value=_150a;
},getTmpPath:function(){
this.el.tmpPath.value=this.el.tmpPath.value.replace(/\\/g,"/");
if(this.el.tmpPath.value.length>0&&this.el.tmpPath.value.substring(this.el.tmpPath.value.length-1)!="/"){
this.el.tmpPath.value=this.el.tmpPath.value+"/";
}
return this.el.tmpPath.value;
},setMinLogLevel:function(_150b){
this.el.minLogLevel.selectByValue(_150b);
},getMinLogLevel:function(){
return this.el.minLogLevel.getSelectedValue();
},setDefaultLanguage:function(_150c){
this.el.defaultLanguage.selectByValue(_150c);
},getDefaultLanguage:function(){
return this.el.defaultLanguage.getSelectedValue();
},setLogFile:function(_150d){
this.el.logFile.value=_150d;
},getLogFile:function(){
return this.el.logFile.value;
},setDeleteLogsAfter:function(_150e){
this.el.deleteLogsAfter.value=_150e;
},getDeleteLogsAfter:function(){
return this.el.deleteLogsAfter.value;
},setHideTicketIdFromSubject:function(_150f){
if(_150f==true||_150f=="y"){
this.el.hideTicketIdFromSubject.checked=true;
}else{
if(_150f==false||_150f=="n"){
this.el.hideTicketIdFromSubject.checked=false;
}
}
},getHideTicketIdFromSubject:function(){
if(this.el.hideTicketIdFromSubject.checked){
return "y";
}
return "n";
},setDivideSameMailToMoreTickets:function(_1510){
if(_1510==true||_1510=="y"){
this.el.divideSameMailToMoreTickets.checked=true;
}else{
if(_1510==false||_1510=="n"){
this.el.divideSameMailToMoreTickets.checked=false;
}
}
},getDivideSameMailToMoreTickets:function(){
if(this.el.divideSameMailToMoreTickets.checked){
return "y";
}
return "n";
},setShowPriorityInSubmitForm:function(_1511){
if(_1511==true||_1511=="y"){
this.el.showPriorityInSubmitForm.checked=true;
}else{
if(_1511==false||_1511=="n"){
this.el.showPriorityInSubmitForm.checked=false;
}
}
},getShowPriorityInSubmitForm:function(){
if(this.el.showPriorityInSubmitForm.checked){
return "y";
}
return "n";
},setAgentDeleteTickets:function(_1512){
if(_1512==true||_1512=="y"){
this.el.agentDeleteTickets.checked=true;
}else{
if(_1512==false||_1512=="n"){
this.el.agentDeleteTickets.checked=false;
}
}
},getAgentDeleteTickets:function(){
if(this.el.agentDeleteTickets.checked){
return "y";
}
return "n";
},setAgentCanSeeJustOwnQueues:function(_1513){
if(_1513==true||_1513=="y"){
this.el.agentCanSeeJustOwnQueues.checked=true;
}else{
if(_1513==false||_1513=="n"){
this.el.agentCanSeeJustOwnQueues.checked=false;
}
}
},getAgentCanSeeJustOwnQueues:function(){
if(this.el.agentCanSeeJustOwnQueues.checked){
return "y";
}
return "n";
},setAgentUserAccess:function(_1514){
this.el.agentUserAccess.selectByValue(_1514);
},getAgentUserAccess:function(){
return this.el.agentUserAccess.getSelectedValue();
},setAgentSeeJustAgentsFromHisQueues:function(_1515){
if(_1515==true||_1515=="y"){
this.el.agentSeeJustAgentsFromHisQueues.checked=true;
}else{
if(_1515==false||_1515=="n"){
this.el.agentSeeJustAgentsFromHisQueues.checked=false;
}
}
},getAgentSeeJustAgentsFromHisQueues:function(){
if(this.el.agentSeeJustAgentsFromHisQueues.checked){
return "y";
}
return "n";
},setAgentCanNotSeeAdmins:function(_1516){
if(_1516==true||_1516=="y"){
this.el.agentCanNotSeeAdmins.checked=true;
}else{
if(_1516==false||_1516=="n"){
this.el.agentCanNotSeeAdmins.checked=false;
}
}
},getAgentCanNotSeeAdmins:function(){
if(this.el.agentCanNotSeeAdmins.checked){
return "y";
}
return "n";
},setAgentCanSeeOwnReports:function(_1517){
if(_1517==true||_1517=="y"){
this.el.agentCanSeeOwnReports.checked=true;
}else{
if(_1517==false||_1517=="n"){
this.el.agentCanSeeOwnReports.checked=false;
}
}
},getAgentCanSeeOwnReports:function(){
if(this.el.agentCanSeeOwnReports.checked){
return "y";
}
return "n";
},setUseOutbox:function(_1518){
if(_1518==true||_1518=="y"){
this.el.useOutbox.checked=true;
}else{
if(_1518==false||_1518=="n"){
this.el.useOutbox.checked=false;
}
}
},getUseOutbox:function(){
if(this.el.useOutbox.checked){
return "y";
}
return "n";
},setMaxRetryCount:function(_1519){
this.el.maxRetryCount.value=_1519;
},getMaxRetryCount:function(){
return this.el.maxRetryCount.value;
},setRetryAfterDelay:function(_151a){
this.el.retryAfterDelay.value=_151a;
},getRetryAfterDelay:function(){
return this.el.retryAfterDelay.value;
},setOnlineAgentsView:function(_151b){
this.el.onlineAgentsView.selectByValue(_151b);
},getOnlineAgentsView:function(){
return this.el.onlineAgentsView.getSelectedValue();
},setDefaultPriority:function(_151c){
this.el.defaultPriority.selectByValue(_151c);
},getDefaultPriority:function(){
return this.el.defaultPriority.getSelectedValue();
},setAutoAssignTicketToAgent:function(_151d){
if(_151d==true||_151d=="y"){
this.el.autoAssignTicketToAgent.checked=true;
}else{
if(_151d==false||_151d=="n"){
this.el.autoAssignTicketToAgent.checked=false;
}
}
},getAutoAssignTicketToAgent:function(){
if(this.el.autoAssignTicketToAgent.checked){
return "y";
}
return "n";
},getKnowledgeBaseURL:function(){
this.el.knowledgeBaseURL.value=this.el.knowledgeBaseURL.value.replace(/\\/g,"/");
if(this.el.knowledgeBaseURL.value.length>0&&this.el.knowledgeBaseURL.value.substring(this.el.knowledgeBaseURL.value.length-1)!="/"){
this.el.knowledgeBaseURL.value=this.el.knowledgeBaseURL.value+"/";
}
return this.el.knowledgeBaseURL.value;
},setKnowledgeBaseURL:function(_151e){
this.el.knowledgeBaseURL.value=_151e;
},getKnowledgeBasePath:function(){
this.el.knowledgeBasePath.value=this.el.knowledgeBasePath.value.replace(/\\/g,"/");
if(this.el.knowledgeBasePath.value.length>0&&this.el.knowledgeBasePath.value.substring(this.el.knowledgeBasePath.value.length-1)!="/"){
this.el.knowledgeBasePath.value=this.el.knowledgeBasePath.value+"/";
}
return this.el.knowledgeBasePath.value;
},setKnowledgeBasePath:function(_151f){
this.el.knowledgeBasePath.value=_151f;
},setKnowledgeRefresh:function(_1520){
this.el.knowledgeRefresh.selectByValue(_1520);
},getKnowledgeRefresh:function(){
return this.el.knowledgeRefresh.getSelectedValue();
},setKnowledgeBaseModule:function(_1521){
if(_1521==true||_1521=="y"){
this.el.knowledgeBaseModule.checked=true;
}else{
if(_1521==false||_1521=="n"){
this.el.knowledgeBaseModule.checked=false;
}
}
},getKnowledgeBaseModule:function(){
if(this.el.knowledgeBaseModule.checked){
return "y";
}
return "n";
},setDefaultFont:function(_1522){
this.el.defaultFont.selectByValue(_1522);
},getDefaultFont:function(){
return this.el.defaultFont.getSelectedValue();
},setDefaultFontSize:function(_1523){
this.el.defaultFontSize.selectByValue(_1523);
},getDefaultFontSize:function(){
return this.el.defaultFontSize.getSelectedValue();
},setWorkReporting:function(_1524){
if(_1524==true||_1524=="y"){
this.el.workReporting.checked=true;
}else{
if(_1524==false||_1524=="n"){
this.el.workReporting.checked=false;
}
}
},getWorkReporting:function(){
if(this.el.workReporting.checked){
return "y";
}
return "n";
},setHideGroups:function(_1525){
if(_1525==true||_1525=="y"){
this.el.hideGroups.checked=true;
}else{
if(_1525==false||_1525=="n"){
this.el.hideGroups.checked=false;
}
}
},getHideGroups:function(){
if(this.el.hideGroups.checked){
return "y";
}
return "n";
},getUserCanSeeAllTicketsInGroup:function(){
if(this.el.userCanSeeAllTicketsInGroup.checked){
return "y";
}
return "n";
},setUserCanSeeAllTicketsInGroup:function(_1526){
if(_1526==true||_1526=="y"){
this.el.userCanSeeAllTicketsInGroup.checked=true;
}else{
if(_1526==false||_1526=="n"){
this.el.userCanSeeAllTicketsInGroup.checked=false;
}
}
},getPreventLoops:function(){
if(this.el.preventLoops.checked){
return "y";
}
return "n";
},setPreventLoops:function(_1527){
if(_1527==true||_1527=="y"){
this.el.preventLoops.checked=true;
}else{
if(_1527==false||_1527=="n"){
this.el.preventLoops.checked=false;
}
}
},getDownloadManager:function(){
if(this.el.DownloadManager.checked){
return "y";
}
return "n";
},setDownloadManager:function(_1528){
if(_1528==true||_1528=="y"){
this.el.DownloadManager.checked=true;
}else{
if(_1528==false||_1528=="n"){
this.el.DownloadManager.checked=false;
}
}
}});
dojo.provide("app.view.settings.notifications.Notification");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.notifications.Notification",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.ownerCheck,"onclick",this,"onOwnerCheckChange");
dojo.event.connectOnce(this.el.priorityCheck,"onclick",this,"onPriorityCheckChange");
dojo.event.connectOnce(this.el.statusCheck,"onclick",this,"onStatusCheckChange");
dojo.event.connectOnce(this.el.queueCheck,"onclick",this,"onQueueCheckChange");
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
dojo.event.connectOnce(this.el.addVariable,"onChange",this,"onAddVariable");
},initComponents:function(){
this.el.addVariable.removeAll();
this.el.addVariable.add("${ticket_id}",app.i18n.get("TicketId"));
this.el.addVariable.add("${ticket_subject}",app.i18n.get("TicketSubject"));
this.el.addVariable.add("${mail_body}",app.i18n.get("MailBody"));
this.el.addVariable.add("${ticket_owner}",app.i18n.get("TicketOwner"));
this.el.addVariable.add("${ticket_priority}",app.i18n.get("TicketPriority"));
this.el.addVariable.add("${ticket_status}",app.i18n.get("TicketStatus"));
this.el.addVariable.add("${ticket_queue}",app.i18n.get("TicketQueue"));
this.el.addVariable.add("${ticket_url}",app.i18n.get("TicketUrl"));
this.el.addVariable.add("${ticket_link}",app.i18n.get("TicketLink"));
this.el.addVariable.add("${answer_time}",app.i18n.get("AnswerTime"));
this.el.addVariable.add("${customer_email}",app.i18n.get("CustomerEmail"));
this.el.addVariable.add("${customer_name}",app.i18n.get("CustomerName"));
this.el.addVariable.add("${changed_by}",app.i18n.get("ChangedBy"));
this.el.addVariable.add("${old_priority}",app.i18n.get("OldPriority"));
this.el.addVariable.add("${old_status}",app.i18n.get("OldStatus"));
this.el.addVariable.add("${old_owner}",app.i18n.get("OldOwner"));
this.el.addVariable.add("${old_queue}",app.i18n.get("OldQueue"));
this.el.addVariable.add("${knowledge_suggestions}",app.i18n.get("KnowledgebaseSuggestions"));
app.main.hashMaps.execFunctionForEachElement(function(_1529){
if(_1529.getRelatedTo()=="g"){
return true;
}
this.el.addVariable.add("${custom_"+_1529.getId()+"}",_1529.getTitle());
},this,"customFields");
},onAddVariable:function(){
if(this.el.addVariable.getSelection().join("|")!=""){
this.el.body.replaceSelection(this.el.addVariable.getSelection().join("|"));
}
this.el.addVariable.deselectAll();
},onOwnerCheckChange:function(){
if(this.ownerCheck()=="n"){
this.el.toOwners.deselectAll();
this.el.toOwners.hide();
}else{
this.el.toOwners.show();
}
},onStatusCheckChange:function(){
if(this.statusCheck()=="n"){
this.el.toStatuses.deselectAll();
this.el.toStatuses.hide();
}else{
this.el.toStatuses.show();
}
},onQueueCheckChange:function(){
if(this.queueCheck()=="n"){
this.el.toQueues.deselectAll();
this.el.toQueues.hide();
}else{
this.el.toQueues.show();
}
},onPriorityCheckChange:function(){
if(this.priorityCheck()=="n"){
this.el.toPriorities.deselectAll();
this.el.toPriorities.hide();
}else{
this.el.toPriorities.show();
}
},onLoad:function(){
this.el.accountId.removeAll();
this.el.accountId.add("",app.i18n.get("useDefaultMailAccount"));
app.main.hashMaps.fill(this.el.accountId,"mailAccounts",false);
app.main.hashMaps.fill(this.el.toStatuses,"statuses",true);
app.main.hashMaps.fill(this.el.toQueues,"queues",true);
app.main.hashMaps.fill(this.el.toPriorities,"priorities",true);
app.main.hashMaps.fill(this.el.toOwners,"agents",true);
this.initTicketOwner("");
app.main.hashMaps.fill(this.el.ticketQueue,"queues",true);
app.main.hashMaps.fill(this.el.ticketPriority,"priorities",true);
app.main.hashMaps.fill(this.el.ticketStatus,"statuses",true);
app.main.hashMaps.fill(this.el.customerGroups,"groups",true);
this.el.toStatuses.deselectAll();
this.el.toQueues.deselectAll();
this.el.toPriorities.deselectAll();
this.el.toOwners.deselectAll();
},initTicketOwner:function(email){
this.el.ticketOwner.removeAll();
this.el.ticketOwner.add("none",app.i18n.get("notAssigned"));
if(email==""){
this.el.ticketOwner.add("answered",app.i18n.get("answeredByMe"));
}else{
this.el.ticketOwner.add("answered",app.i18n.get("answeredBy")+" "+email);
}
app.main.hashMaps.fill(this.el.ticketOwner,"agents",false);
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.notifications.Notification"));
this.setSize(900,820);
},resetForm:function(){
this.setStatusCheck("n");
this.onStatusCheckChange();
this.setPriorityCheck("n");
this.onPriorityCheckChange();
this.setQueueCheck("n");
this.onQueueCheckChange();
this.setOwnerCheck("n");
this.onOwnerCheckChange();
this.setName("");
this.setSubject("");
this.setBody("");
this.setTicketOwners("");
this.setTicketQueue("");
this.setTicketPriority("");
this.setTicketStatus("");
this.setCustomerGroups("");
this.setSendToNotificationOwner(false);
this.setSendToCustomer(false);
this.setSendToAgentOwner(false);
this.setSendToRecipients("");
this.setMailAccount("");
this.setCallUrl("");
},isValid:function(){
return this.statusCheck()=="y"||this.priorityCheck()=="y"||this.queueCheck()=="y"||this.ownerCheck()=="y";
},getMailAccount:function(){
return this.el.accountId.getSelection().join("");
},setMailAccount:function(_152b){
this.el.accountId.deselectAll();
this.el.accountId.select(_152b);
},getTicketOwners:function(){
return this.el.ticketOwner.getSelection();
},setTicketOwners:function(_152c){
this.el.ticketOwner.deselectAll();
this.el.ticketOwner.select(_152c);
},getTicketQueue:function(){
return this.el.ticketQueue.getSelection();
},setTicketQueue:function(_152d){
this.el.ticketQueue.deselectAll();
this.el.ticketQueue.select(_152d);
},getTicketPriority:function(){
return this.el.ticketPriority.getSelection();
},setTicketPriority:function(_152e){
this.el.ticketPriority.deselectAll();
this.el.ticketPriority.select(_152e);
},getTicketStatus:function(){
return this.el.ticketStatus.getSelection();
},setTicketStatus:function(_152f){
this.el.ticketStatus.deselectAll();
this.el.ticketStatus.select(_152f);
},getCustomerGroups:function(){
return this.el.customerGroups.getSelection();
},setCustomerGroups:function(_1530){
this.el.customerGroups.deselectAll();
this.el.customerGroups.select(_1530);
},setCallUrl:function(_1531){
if(_1531=="null"){
_1531="";
}
this.el.callUrl.value=_1531;
},getCallUrl:function(){
return this.el.callUrl.value;
},getName:function(){
return this.el.name.value;
},setName:function(_1532){
this.el.name.value=_1532;
},getToStatuses:function(){
return this.el.toStatuses.getSelection();
},setToStatuses:function(_1533){
this.el.toStatuses.deselectAll();
this.el.toStatuses.select(_1533);
},getToQueues:function(){
return this.el.toQueues.getSelection();
},setToQueues:function(_1534){
this.el.toQueues.deselectAll();
this.el.toQueues.select(_1534);
},getToPriorities:function(){
return this.el.toPriorities.getSelection();
},setToPriorities:function(_1535){
this.el.toPriorities.deselectAll();
this.el.toPriorities.select(_1535);
},getToOwners:function(){
return this.el.toOwners.getSelection();
},setToOwners:function(_1536){
this.el.toOwners.deselectAll();
this.el.toOwners.select(_1536);
},getSubject:function(){
return this.el.subject.value;
},setSubject:function(_1537){
this.el.subject.value=_1537;
},getBody:function(){
return this.el.body.getHtml();
},setBody:function(_1538){
this.el.body.setHtml(_1538);
},statusCheck:function(){
if(this.el.statusCheck.checked){
return "y";
}
return "n";
},setStatusCheck:function(_1539){
if(_1539==true||_1539=="y"){
this.el.statusCheck.checked=true;
}else{
if(_1539==false||_1539=="n"){
this.el.statusCheck.checked=false;
}
}
},priorityCheck:function(){
if(this.el.priorityCheck.checked){
return "y";
}
return "n";
},setPriorityCheck:function(_153a){
if(_153a==true||_153a=="y"){
this.el.priorityCheck.checked=true;
}else{
if(_153a==false||_153a=="n"){
this.el.priorityCheck.checked=false;
}
}
},queueCheck:function(){
if(this.el.queueCheck.checked){
return "y";
}
return "n";
},setQueueCheck:function(_153b){
if(_153b==true||_153b=="y"){
this.el.queueCheck.checked=true;
}else{
if(_153b==false||_153b=="n"){
this.el.queueCheck.checked=false;
}
}
},ownerCheck:function(){
if(this.el.ownerCheck.checked){
return "y";
}
return "n";
},setOwnerCheck:function(_153c){
if(_153c==true||_153c=="y"){
this.el.ownerCheck.checked=true;
}else{
if(_153c==false||_153c=="n"){
this.el.ownerCheck.checked=false;
}
}
},onSaveSuccess:function(){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.clear();
},onSaveFail:function(_153d){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.print(_153d);
},setNotificationOwnerLabel:function(email){
this.el.sendToNotificationOwnerLabel.innerHTML=email;
},sendToNotificationOwner:function(){
if(this.el.sendToNotificationOwner.checked){
return "y";
}
return "n";
},setSendToNotificationOwner:function(_153f){
if(_153f==true||_153f=="y"){
this.el.sendToNotificationOwner.checked=true;
}else{
if(_153f==false||_153f=="n"){
this.el.sendToNotificationOwner.checked=false;
}
}
},sendToCustomer:function(){
if(this.el.sendToCustomer.checked){
return "y";
}
return "n";
},setSendToCustomer:function(_1540){
if(_1540==true||_1540=="y"){
this.el.sendToCustomer.checked=true;
}else{
if(_1540==false||_1540=="n"){
this.el.sendToCustomer.checked=false;
}
}
},sendToAgentOwner:function(){
if(this.el.sendToAgentOwner.checked){
return "y";
}
return "n";
},setSendToAgentOwner:function(_1541){
if(_1541==true||_1541=="y"){
this.el.sendToAgentOwner.checked=true;
}else{
if(_1541==false||_1541=="n"){
this.el.sendToAgentOwner.checked=false;
}
}
},setSendToRecipients:function(_1542){
if(_1542=="null"||_1542==null){
_1542="";
}
this.el.sendToRecipients.value=_1542;
},getSendToRecipients:function(){
return this.el.sendToRecipients.value;
},setCustomFromMailAddress:function(_1543){
if(_1543=="null"){
_1543="";
}
this.el.customFromMailAddress.value=_1543;
},getCustomFromMailAddress:function(){
return this.el.customFromMailAddress.value;
}});
dojo.provide("app.view.settings.notifications.NotificationAdd");
dojo.require("app.view.settings.notifications.Notification");
dojo.lang.declare("app.view.settings.notifications.NotificationAdd",app.view.settings.notifications.Notification,null,{onSave:function(){
if(!this.isValid()){
alert(app.i18n.get("selectNotificationEvent"));
return false;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _1544=new Object();
_1544.name=this.getName();
_1544.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1544.ticket_queue="|"+this.getTicketQueue().join("|")+"|";
_1544.ticket_priority="|"+this.getTicketPriority().join("|")+"|";
_1544.ticket_status="|"+this.getTicketStatus().join("|")+"|";
_1544.customer_groups="|"+this.getCustomerGroups().join("|")+"|";
_1544.to_statuses="|"+this.getToStatuses().join("|")+"|";
_1544.to_priorities="|"+this.getToPriorities().join("|")+"|";
_1544.to_queues="|"+this.getToQueues().join("|")+"|";
_1544.to_owners="|"+this.getToOwners().join("|")+"|";
_1544.subject=this.getSubject();
_1544.body=this.getBody();
_1544.status_check=this.statusCheck();
_1544.queue_check=this.queueCheck();
_1544.priority_check=this.priorityCheck();
_1544.owner_check=this.ownerCheck();
_1544.account_id=this.getMailAccount();
_1544.call_url=this.getCallUrl();
_1544.custom_from_mail=this.getCustomFromMailAddress();
_1544.sendto_notif_owner=this.sendToNotificationOwner();
_1544.sendto_customer=this.sendToCustomer();
_1544.sendto_agent_owner=this.sendToAgentOwner();
_1544.sendto_recipients=this.getSendToRecipients();
var _1545=new qu.rpc.Service("Notifications");
_1545.setThrobber(app.i18n.get("saving"));
var def=_1545.insertNotification({fields:_1544,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewNotification"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.resetForm();
this.setNotificationOwnerLabel(qu.user.getUserName());
this.center();
}});
dojo.provide("app.view.settings.notifications.NotificationEdit");
dojo.require("app.view.settings.notifications.Notification");
dojo.lang.declare("app.view.settings.notifications.NotificationEdit",app.view.settings.notifications.Notification,null,{onSave:function(){
if(!this.isValid()){
alert(app.i18n.get("selectNotificationEvent"));
return false;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _1547=new Object();
_1547.notification_id=this.getNotificationId();
_1547.name=this.getName();
_1547.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1547.ticket_queue="|"+this.getTicketQueue().join("|")+"|";
_1547.ticket_priority="|"+this.getTicketPriority().join("|")+"|";
_1547.ticket_status="|"+this.getTicketStatus().join("|")+"|";
_1547.customer_groups="|"+this.getCustomerGroups().join("|")+"|";
_1547.to_statuses="|"+this.getToStatuses().join("|")+"|";
_1547.to_priorities="|"+this.getToPriorities().join("|")+"|";
_1547.to_queues="|"+this.getToQueues().join("|")+"|";
_1547.to_owners="|"+this.getToOwners().join("|")+"|";
_1547.subject=this.getSubject();
_1547.body=this.getBody();
_1547.status_check=this.statusCheck();
_1547.queue_check=this.queueCheck();
_1547.priority_check=this.priorityCheck();
_1547.owner_check=this.ownerCheck();
_1547.account_id=this.getMailAccount();
_1547.call_url=this.getCallUrl();
_1547.custom_from_mail=this.getCustomFromMailAddress();
_1547.sendto_notif_owner=this.sendToNotificationOwner();
_1547.sendto_customer=this.sendToCustomer();
_1547.sendto_agent_owner=this.sendToAgentOwner();
_1547.sendto_recipients=this.getSendToRecipients();
var _1548=new qu.rpc.Service("Notifications");
_1548.setThrobber(app.i18n.get("saving"));
var def=_1548.updateNotification({fields:_1547,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.constructor.superclass.onLoad.apply(this);
dojo.event.connectOnce(this.el.agents,"onLoadNotificationFail",this,"hide");
this.resetForm();
this.loadNotificationSettings();
},loadNotificationSettings:function(){
var _154a=new qu.rpc.Service("Notifications");
var def=_154a.getNotification({sid:qu.user.getSid(),notification_id:this.getNotificationId()});
def.addCallback(dojo.lang.hitch(this,"onLoadNotificationSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadNotificationFail"));
},onLoadNotificationSuccess:function(_154c){
var rs=_154c;
rs.first();
if(rs.rows.length==1){
this.setName(rs.get("name").valueOf());
this.setMailAccount(rs.get("account_id").valueOf());
this.setCustomFromMailAddress(rs.get("custom_from_mail").valueOf());
this.setSubject(rs.get("subject").valueOf());
this.setBody(rs.get("body").valueOf());
this.setCallUrl(rs.get("call_url").valueOf());
this.setNotificationOwnerLabel(rs.get("email").valueOf());
this.initTicketOwner(rs.get("email").valueOf());
this.setSendToNotificationOwner(rs.get("sendto_notif_owner").valueOf());
this.setSendToCustomer(rs.get("sendto_customer").valueOf());
this.setSendToAgentOwner(rs.get("sendto_agent_owner").valueOf());
this.setSendToRecipients(rs.get("sendto_recipients").valueOf());
this.setStatusCheck(rs.get("status_check"));
this.setQueueCheck(rs.get("queue_check"));
this.setPriorityCheck(rs.get("priority_check"));
this.setOwnerCheck(rs.get("owner_check"));
this.setTicketOwners(rs.get("ticket_owners").split("|"));
this.setTicketQueue(rs.get("ticket_queue").split("|"));
this.setTicketPriority(rs.get("ticket_priority").split("|"));
this.setTicketStatus(rs.get("ticket_status").split("|"));
this.setCustomerGroups(rs.get("customer_groups").split("|"));
this.setToStatuses(rs.get("to_statuses").split("|"));
this.setToQueues(rs.get("to_queues").split("|"));
this.setToPriorities(rs.get("to_priorities").split("|"));
this.setToOwners(rs.get("to_owners").split("|"));
this.onOwnerCheckChange();
this.onPriorityCheckChange();
this.onQueueCheckChange();
this.onStatusCheckChange();
this.setLoading(false);
this.el.body.resetDesignMode();
}else{
this.hide();
}
},onLoadNotificationFail:function(_154e){
alert(_154e);
},setNotificationId:function(_154f){
this._notificationId=_154f;
},getNotificationId:function(){
return this._notificationId.toString();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editNotification"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.settings.Notifications");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.notifications.NotificationAdd");
dojo.require("app.view.settings.notifications.NotificationEdit");
dojo.lang.declare("app.view.settings.Notifications",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"40%",style:{cursor:"pointer"}});
setColumn("subject",{caption:app.i18n.get("subject"),sortable:true,width:"40%",style:{cursor:"pointer"}});
setColumn("email",{caption:app.i18n.get("createdBy"),sortable:true,width:"20%",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _1550=new qu.rpc.Service("Notifications");
with(this.el.grid.getModel()){
setService(_1550);
setMethod("getNotificationsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addNotification=new app.view.settings.notifications.NotificationAdd();
this.editNotification=new app.view.settings.notifications.NotificationEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Notifications"));
},onAdd:function(){
dojo.event.connectOnce(this.addNotification,"onSaveSuccess",this.el.grid,"update");
this.addNotification.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editNotification.setNotificationId(rs.getString("notification_id"));
dojo.event.connectOnce(this.editNotification,"onSaveSuccess",this.el.grid,"update");
this.editNotification.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("notification_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1555=new qu.rpc.Service("Notifications");
var _1556={sid:qu.user.getSid()};
_1555.setThrobber("Deleting...");
var def=_1555.deleteNotification({sid:qu.user.getSid(),notification_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_1558){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1559){
app.main.msgBox.print(_1559);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.gateways.Gateway");
dojo.require("qu.gui.Dialog");
dojo.require("qu.widget.ListBox");
dojo.lang.declare("app.view.settings.gateways.Gateway",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
},onLoad:function(){
app.main.hashMaps.fill(this.el.statuses,"statuses",true);
app.main.hashMaps.fill(this.el.queues,"queues",true);
app.main.hashMaps.fill(this.el.priorities,"priorities",true);
this.reloadTicketOwnerValues("");
this.el.statuses.deselectAll();
this.el.queues.deselectAll();
this.el.priorities.deselectAll();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.gateways.Gateway"));
this.setSize(500,220);
},resetForm:function(){
this.setName("");
this.setStatuses("");
this.setQueues("");
this.setPriorities("");
this.setTicketOwners("");
},reloadTicketOwnerValues:function(_155a){
this.el.ticketOwner.removeAll();
this.el.ticketOwner.add("none",app.i18n.get("notAssigned"));
if(_155a==""){
this.el.ticketOwner.add("answered",app.i18n.get("answeredByMe"));
}else{
this.el.ticketOwner.add("answered",app.i18n.get("answeredBy")+_155a);
}
app.main.hashMaps.fill(this.el.ticketOwner,"agents",false);
},getTicketOwners:function(){
return this.el.ticketOwner.getSelection();
},setTicketOwners:function(_155b){
this.el.ticketOwner.deselectAll();
this.el.ticketOwner.select(_155b);
},getName:function(){
return this.el.name.value;
},setName:function(_155c){
this.el.name.value=_155c;
},getStatuses:function(){
return this.el.statuses.getSelection();
},setStatuses:function(_155d){
this.el.statuses.deselectAll();
this.el.statuses.select(_155d);
},getQueues:function(){
return this.el.queues.getSelection();
},setQueues:function(_155e){
this.el.queues.deselectAll();
this.el.queues.select(_155e);
},getPriorities:function(){
return this.el.priorities.getSelection();
},setPriorities:function(_155f){
this.el.priorities.deselectAll();
this.el.priorities.select(_155f);
}});
dojo.provide("app.view.settings.gateways.GatewayAdd");
dojo.require("app.view.settings.gateways.Gateway");
dojo.lang.declare("app.view.settings.gateways.GatewayAdd",app.view.settings.gateways.Gateway,null,{onSave:function(){
var _1560=new Object();
_1560.name=this.getName();
_1560.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1560.statuses="|"+this.getStatuses().join("|")+"|";
_1560.priorities="|"+this.getPriorities().join("|")+"|";
_1560.queues="|"+this.getQueues().join("|")+"|";
var _1561=new qu.rpc.Service("Gateways");
_1561.setThrobber(app.i18n.get("saving"));
var def=_1561.insertGateway({fields:_1560,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewGateway"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.gateways.GatewayEdit");
dojo.require("app.view.settings.gateways.Gateway");
dojo.lang.declare("app.view.settings.gateways.GatewayEdit",app.view.settings.gateways.Gateway,null,{onSave:function(){
var _1563=new Object();
_1563.gateway_id=this.getGatewayId();
_1563.name=this.getName();
_1563.ticket_owners="|"+this.getTicketOwners().join("|")+"|";
_1563.statuses="|"+this.getStatuses().join("|")+"|";
_1563.priorities="|"+this.getPriorities().join("|")+"|";
_1563.queues="|"+this.getQueues().join("|")+"|";
var _1564=new qu.rpc.Service("Gateways");
_1564.setThrobber(app.i18n.get("saving"));
var def=_1564.updateGateway({fields:_1563,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.constructor.superclass.onLoad.apply(this);
dojo.event.connectOnce(this.el.agents,"onLoadGatewayFail",this,"hide");
this.resetForm();
this.loadGatewaySettings();
},loadGatewaySettings:function(){
var _1566=new qu.rpc.Service("Gateways");
var def=_1566.getGateway({sid:qu.user.getSid(),gateway_id:this.getGatewayId()});
def.addCallback(dojo.lang.hitch(this,"onLoadGatewaySuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadGatewayFail"));
},onLoadGatewaySuccess:function(_1568){
var rs=_1568;
rs.first();
if(rs.rows.length==1){
this.setName(rs.get("name"));
this.reloadTicketOwnerValues(rs.get("uname"));
this.setTicketOwners(rs.get("ticket_owners").split("|"));
this.setStatuses(rs.get("statuses").split("|"));
this.setQueues(rs.get("queues").split("|"));
this.setPriorities(rs.get("priorities").split("|"));
this.setLoading(false);
}else{
this.hide();
}
},onLoadGatewayFail:function(_156a){
alert(_156a);
this.hide();
},setGatewayId:function(_156b){
this._gatewayId=_156b;
},getGatewayId:function(){
return this._gatewayId.toString();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editGateway"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.settings.Gateways");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.gateways.GatewayAdd");
dojo.require("app.view.settings.gateways.GatewayEdit");
dojo.lang.declare("app.view.settings.Gateways",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("uemail",{caption:app.i18n.get("user"),sortable:true,width:"200px",style:{cursor:"pointer"}});
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"80%",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("uemail");
setHeight(10);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _156c=new qu.rpc.Service("Gateways");
with(this.el.grid.getModel()){
setService(_156c);
setMethod("getGatewaysList");
setDefaultParams({sid:qu.user.getSid(),admin:true});
}
this.addGateway=new app.view.settings.gateways.GatewayAdd();
this.editGateway=new app.view.settings.gateways.GatewayEdit();
this.el.grid.init();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},updateGrid:function(){
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Gateways"));
},onAdd:function(){
dojo.event.connectOnce(this.addGateway,"onSaveSuccess",this.el.grid,"update");
this.addGateway.show();
},onEdit:function(inRow,inCol){
dojo.event.connectOnce(this.editGateway,"onSaveSuccess",this.el.grid,"update");
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editGateway.setGatewayId(rs.get("gateway_id"));
this.editGateway.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("gateway_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1571=new qu.rpc.Service("Gateways");
_1571.setThrobber("Deleting...");
var def=_1571.deleteGateway({sid:qu.user.getSid(),gateway_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_1573){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1574){
app.main.msgBox.print(_1574);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.escalationRules.EscalationRule");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.escalationRules.EscalationRule",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this,"onSaveSuccess",this,"hide");
dojo.event.connectOnce(this.el.actionDeleteTicket,"onchange",this,"onChangeActionDeleteTicket");
},initComponents:function(){
this.initAutocomplete();
this.initFilterGroup();
},initFilterGroup:function(){
if(!quConfig.hideGroups){
app.main.hashMaps.fill(this.el.customerGroup,"groups",true);
}else{
try{
this.el.groupFilterSection.style.visibility="hidden";
}
catch(e){
}
}
},initAutocomplete:function(){
var users=new qu.rpc.Service("Users");
with(this.el.createdByCustomer.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _1576={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_1576);
}
},onLoad:function(){
this.el.lastReplyCond.removeAll();
this.el.ticketAgeCond.removeAll();
this.el.overDueCond.removeAll();
this.fillDateField(this.el.lastReplyCond);
this.fillDateField(this.el.ticketAgeCond);
this.el.overDueCond.add("-12",app.i18n.get("_12hoursBeforeOverDueTime"));
this.el.overDueCond.add("-6",app.i18n.get("_6hoursBeforeOverDueTime"));
this.el.overDueCond.add("-3",app.i18n.get("_3hoursBeforeOverDueTime"));
this.el.overDueCond.add("-2",app.i18n.get("_2hoursBeforeOverDueTime"));
this.el.overDueCond.add("-1",app.i18n.get("_1hourBeforeOverDueTime"));
this.el.overDueCond.add("0",app.i18n.get("atOverDueTime"));
this.fillDateField(this.el.overDueCond);
app.main.hashMaps.fill(this.el.statusCond,"statuses",true);
app.main.hashMaps.fill(this.el.queueCond,"queues",true);
app.main.hashMaps.fill(this.el.priorityCond,"priorities",true);
this.el.ownerCond.removeAll();
this.el.ownerCond.add("none",app.i18n.get("notAssigned"));
app.main.hashMaps.fill(this.el.ownerCond,"agents",false);
this.el.actionStatus.removeAll();
this.el.actionStatus.add("",app.i18n.get("noChange"));
app.main.hashMaps.fill(this.el.actionStatus,"statuses",false);
this.el.actionQueue.removeAll();
this.el.actionQueue.add("",app.i18n.get("noChange"));
app.main.hashMaps.fill(this.el.actionQueue,"queues",false);
this.el.actionPriority.removeAll();
this.el.actionPriority.add("",app.i18n.get("noChange"));
app.main.hashMaps.fill(this.el.actionPriority,"priorities",false);
this.el.actionOwner.removeAll();
this.el.actionOwner.add("",app.i18n.get("noChange"));
this.el.actionOwner.add("none",app.i18n.get("none"));
app.main.hashMaps.fill(this.el.actionOwner,"agents",false);
this.el.statusCond.deselectAll();
this.el.queueCond.deselectAll();
this.el.priorityCond.deselectAll();
this.el.ownerCond.deselectAll();
this.el.actionStatus.deselectAll();
this.el.actionQueue.deselectAll();
this.el.actionPriority.deselectAll();
this.el.actionOwner.deselectAll();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.escalationRules.EscalationRule"));
this.setSize(700,500);
},onChangeActionDeleteTicket:function(){
if(this.getActionDeleteTicket()=="y"){
this.el.actionDeleteTicketUsers.disabled=false;
}else{
this.setActionDeleteTicketUsers(false);
this.el.actionDeleteTicketUsers.disabled=true;
}
},onSaveSuccess:function(){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.clear();
},onSaveFail:function(_1577){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.print(_1577);
},resetForm:function(){
this.el.cmdSave.innerHTML=app.i18n.get("save");
this.el.cmdSave.disabled=false;
this.msgBox.print("");
this.setName("");
this.setOwnerCond("");
this.setCreatedByCustomer("");
this.setCustomerGroup("");
this.setStatusCond("");
this.setPriorityCond("");
this.setQueueCond("");
this.setLastReplyCond("");
this.setTicketAgeCond("");
this.setOverDueCond("");
this.setActionOwner("");
this.setActionQueue("");
this.setActionStatus("");
this.setActionPriority("");
this.setActionDeleteTicket(false);
this.setActionDeleteTicketUsers(false);
this.onChangeActionDeleteTicket();
},hasAction:function(){
if(this.getActionDeleteTicket()=="n"&&this.getActionOwner()==""&&this.getActionStatus()==""&&this.getActionQueue()==""&&this.getActionPriority()==""){
return false;
}
return true;
},hasTimeSelection:function(){
if(this.getLastReplyCond()==""&&this.getTicketAgeCond()==""&&this.getOverDueCond()==""){
return false;
}
return true;
},checkBeforeSave:function(){
if(!this.hasAction()){
alert(app.i18n.get("selectRuleAction"));
return false;
}
if(!this.hasTimeSelection()){
alert(app.i18n.get("selectRuleTimeCondition"));
return false;
}
return true;
},fillDateField:function(_1578){
_1578.add("",app.i18n.get("any"));
_1578.add("0.016",app.i18n.get("moreThan1Minute"));
_1578.add("0.083",app.i18n.get("moreThan5Minutes"));
_1578.add("0.25",app.i18n.get("moreThan15Minutes"));
_1578.add("0.5",app.i18n.get("moreThan30Minutes"));
_1578.add("0.75",app.i18n.get("moreThan45Minutes"));
_1578.add("1",app.i18n.get("moreThan1Hour"));
_1578.add("2",app.i18n.get("moreThan2Hours"));
_1578.add("3",app.i18n.get("moreThan3Hours"));
_1578.add("4",app.i18n.get("moreThan4Hours"));
_1578.add("5",app.i18n.get("moreThan5Hours"));
_1578.add("6",app.i18n.get("moreThan6Hours"));
_1578.add("7",app.i18n.get("moreThan7Hours"));
_1578.add("8",app.i18n.get("moreThan8Hours"));
_1578.add("9",app.i18n.get("moreThan9Hours"));
_1578.add("10",app.i18n.get("moreThan10Hours"));
_1578.add("11",app.i18n.get("moreThan11Hours"));
_1578.add("12",app.i18n.get("moreThan12Hours"));
_1578.add("15",app.i18n.get("moreThan15Hours"));
_1578.add("18",app.i18n.get("moreThan18Hours"));
_1578.add("24",app.i18n.get("moreThan1Day"));
_1578.add("36",app.i18n.get("moreThan36Hours"));
_1578.add("48",app.i18n.get("moreThan2Days"));
_1578.add("72",app.i18n.get("moreThan3Days"));
_1578.add("96",app.i18n.get("moreThan4Days"));
_1578.add("120",app.i18n.get("moreThan5Days"));
_1578.add("144",app.i18n.get("moreThan6Days"));
_1578.add("168",app.i18n.get("moreThan1Week"));
_1578.add("336",app.i18n.get("moreThan2Weeks"));
_1578.add("504",app.i18n.get("moreThan3Weeks"));
_1578.add("672",app.i18n.get("moreThan4Weeks"));
_1578.add("1344",app.i18n.get("moreThan8Weeks"));
_1578.add("2016",app.i18n.get("moreThan12Weeks"));
},setName:function(_1579){
this.el.name.value=_1579;
},getName:function(){
return this.el.name.value;
},getOwnerCond:function(){
return this.el.ownerCond.getSelection();
},setOwnerCond:function(_157a){
this.el.ownerCond.deselectAll();
this.el.ownerCond.select(_157a);
},getStatusCond:function(){
return this.el.statusCond.getSelection();
},setStatusCond:function(_157b){
this.el.statusCond.deselectAll();
this.el.statusCond.select(_157b);
},getCustomerGroup:function(){
return this.el.customerGroup.getSelection();
},setCustomerGroup:function(_157c){
this.el.customerGroup.deselectAll();
this.el.customerGroup.select(_157c);
},getPriorityCond:function(){
return this.el.priorityCond.getSelection();
},setPriorityCond:function(_157d){
this.el.priorityCond.deselectAll();
this.el.priorityCond.select(_157d);
},getQueueCond:function(){
return this.el.queueCond.getSelection();
},setQueueCond:function(_157e){
this.el.queueCond.deselectAll();
this.el.queueCond.select(_157e);
},getLastReplyCond:function(){
return this.el.lastReplyCond.getSelection().join("");
},setLastReplyCond:function(_157f){
this.el.lastReplyCond.deselectAll();
this.el.lastReplyCond.select(_157f);
},getTicketAgeCond:function(){
return this.el.ticketAgeCond.getSelection().join("");
},setTicketAgeCond:function(_1580){
this.el.ticketAgeCond.deselectAll();
this.el.ticketAgeCond.select(_1580);
},getOverDueCond:function(){
return this.el.overDueCond.getSelection().join("");
},setOverDueCond:function(_1581){
this.el.overDueCond.deselectAll();
this.el.overDueCond.select(_1581);
},getActionOwner:function(){
return this.el.actionOwner.getSelection().join("");
},setActionOwner:function(_1582){
this.el.actionOwner.deselectAll();
this.el.actionOwner.select(_1582);
},getActionQueue:function(){
return this.el.actionQueue.getSelection().join("");
},setActionQueue:function(_1583){
this.el.actionQueue.deselectAll();
this.el.actionQueue.select(_1583);
},getActionStatus:function(){
return this.el.actionStatus.getSelection().join("");
},setActionStatus:function(_1584){
this.el.actionStatus.deselectAll();
this.el.actionStatus.select(_1584);
},getActionPriority:function(){
return this.el.actionPriority.getSelection().join("");
},setActionPriority:function(_1585){
this.el.actionPriority.deselectAll();
this.el.actionPriority.select(_1585);
},setActionDeleteTicket:function(_1586){
if(_1586==true||_1586=="y"){
this.el.actionDeleteTicket.checked=true;
}else{
if(_1586==false||_1586=="n"){
this.el.actionDeleteTicket.checked=false;
}
}
this.onChangeActionDeleteTicket();
},getActionDeleteTicket:function(){
if(this.el.actionDeleteTicket.checked){
return "y";
}
return "n";
},setActionDeleteTicketUsers:function(_1587){
if(_1587==true||_1587=="y"){
this.el.actionDeleteTicketUsers.checked=true;
}else{
if(_1587==false||_1587=="n"){
this.el.actionDeleteTicketUsers.checked=false;
}
}
},getActionDeleteTicketUsers:function(){
if(this.el.actionDeleteTicketUsers.checked){
return "y";
}
return "n";
},getCreatedByCustomer:function(){
return this.el.createdByCustomer.getValue();
},setCreatedByCustomer:function(_1588){
this.el.createdByCustomer.setValue(_1588);
}});
dojo.provide("app.view.settings.escalationRules.EscalationRuleAdd");
dojo.require("app.view.settings.escalationRules.EscalationRule");
dojo.lang.declare("app.view.settings.escalationRules.EscalationRuleAdd",app.view.settings.escalationRules.EscalationRule,null,{onSave:function(){
this.msgBox.print("");
if(!this.checkBeforeSave()){
return true;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _1589=new Object();
_1589.name=this.getName();
_1589.queue_cond=this.getQueueCond().join("|");
_1589.status_cond=this.getStatusCond().join("|");
_1589.priority_cond=this.getPriorityCond().join("|");
_1589.owner_cond=this.getOwnerCond().join("|");
_1589.last_reply_cond=this.getLastReplyCond();
_1589.ticket_age_cond=this.getTicketAgeCond();
_1589.answer_time_cond=this.getOverDueCond();
_1589.group_cond=this.getCustomerGroup().join("|");
_1589.customer_cond=this.getCreatedByCustomer();
_1589.action_queue=this.getActionQueue();
_1589.action_status=this.getActionStatus();
_1589.action_priority=this.getActionPriority();
_1589.action_owner=this.getActionOwner();
_1589.action_delete_ticket=this.getActionDeleteTicket();
_1589.action_delete_ticket_users=this.getActionDeleteTicketUsers();
var rules=new qu.rpc.Service("EscalationRules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.insertRule({fields:_1589,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("NewRule"));
this.setIcon(new qu.gui.Icon("file-new"));
},onLoad:function(){
this.constructor.superclass.onLoad.apply(this);
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.escalationRules.EscalationRuleEdit");
dojo.require("app.view.settings.escalationRules.EscalationRule");
dojo.lang.declare("app.view.settings.escalationRules.EscalationRuleEdit",app.view.settings.escalationRules.EscalationRule,null,{onSave:function(){
this.msgBox.print("");
if(!this.checkBeforeSave()){
return true;
}
this.el.cmdSave.innerHTML=app.i18n.get("saving");
this.el.cmdSave.disabled=true;
var _158c=new Object();
_158c.rule_id=this.getRuleId();
_158c.name=this.getName();
_158c.queue_cond=this.getQueueCond().join("|");
_158c.status_cond=this.getStatusCond().join("|");
_158c.priority_cond=this.getPriorityCond().join("|");
_158c.owner_cond=this.getOwnerCond().join("|");
_158c.last_reply_cond=this.getLastReplyCond();
_158c.ticket_age_cond=this.getTicketAgeCond();
_158c.answer_time_cond=this.getOverDueCond();
_158c.group_cond=this.getCustomerGroup().join("|");
_158c.customer_cond=this.getCreatedByCustomer();
_158c.action_queue=this.getActionQueue();
_158c.action_status=this.getActionStatus();
_158c.action_priority=this.getActionPriority();
_158c.action_owner=this.getActionOwner();
_158c.action_delete_ticket=this.getActionDeleteTicket();
_158c.action_delete_ticket_users=this.getActionDeleteTicketUsers();
var rules=new qu.rpc.Service("EscalationRules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.updateRule({fields:_158c,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.constructor.superclass.onLoad.apply(this);
dojo.event.connectOnce(this.el.agents,"onLoadRuleFail",this,"hide");
this.resetForm();
this.loadRuleSettings();
},loadRuleSettings:function(){
var rules=new qu.rpc.Service("EscalationRules");
var def=rules.getRule({sid:qu.user.getSid(),rule_id:this.getRuleId()});
def.addCallback(dojo.lang.hitch(this,"onLoadRuleSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadRuleFail"));
},onLoadRuleSuccess:function(_1591){
var rs=_1591;
rs.first();
if(rs.rows.length==1){
this.setName(rs.get("name"));
this.setOwnerCond(rs.get("owner_cond").split("|"));
this.setQueueCond(rs.get("queue_cond").split("|"));
this.setPriorityCond(rs.get("priority_cond").split("|"));
this.setStatusCond(rs.get("status_cond").split("|"));
var _1593=rs.get("group_cond");
if(_1593==null){
_1593="";
}
this.setCustomerGroup(_1593.split("|"));
this.setCreatedByCustomer(rs.get("customer_cond"));
this.setLastReplyCond(rs.get("last_reply_cond").split("|"));
this.setTicketAgeCond(rs.get("ticket_age_cond").split("|"));
this.setOverDueCond(rs.get("answer_time_cond").split("|"));
this.setActionQueue(rs.get("action_queue"));
this.setActionStatus(rs.get("action_status"));
this.setActionPriority(rs.get("action_priority"));
this.setActionOwner(rs.get("action_owner"));
this.setActionDeleteTicket(rs.get("action_delete_ticket"));
this.setActionDeleteTicketUsers(rs.get("action_delete_ticket_users"));
this.setLoading(false);
}else{
this.hide();
}
},onLoadRuleFail:function(_1594){
alert(_1594);
},setRuleId:function(_1595){
this._ruleId=_1595;
},getRuleId:function(){
return this._ruleId.toString();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editRule"));
this.setIcon(new qu.gui.Icon("edit"));
}});
dojo.provide("app.view.settings.EscalationRules");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.escalationRules.EscalationRuleAdd");
dojo.require("app.view.settings.escalationRules.EscalationRuleEdit");
dojo.lang.declare("app.view.settings.EscalationRules",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("name"),sortable:true,width:"80%",style:{cursor:"pointer"}});
setColumn("last_execution",{caption:app.i18n.get("lastExecution"),sortable:true,width:"20%",style:{cursor:"pointer"},bind:function(col,rs){
var _1598=rs.getString(col).valueOf();
if(_1598=="0000-00-00 00:00:00"||_1598==""||_1598==null||_1598=="null"){
return app.i18n.get("notProcessedYet");
}
var date=rs.getDate(col);
var today=new Date();
var _159b=app.i18n.get("dateFormat");
if(date.getFullYear()==today.getFullYear()&&date.getMonth()==today.getMonth()&&date.getDate()==today.getDate()){
_159b=app.i18n.get("timeFormat");
}else{
if(date.getFullYear()==today.getFullYear()){
_159b=app.i18n.get("dateFormatWithoutYear");
}
}
return "<span style=\"padding-right:6px;\" title=\""+date.print(app.i18n.get("dateTimeFormat"))+"\">"+date.print(_159b);
+"</span>";
}});
setColumn("order",{caption:app.i18n.get("order"),sortable:false,width:"85px",style:{cursor:"pointer"},bind:dojo.lang.hitch(this,function(col,rs){
var div=document.createElement("div");
div.style.width="40px";
div.style.textAlign="center";
var img1=document.createElement("img");
img1.setAttribute("src",qu.global.icon("down.png",16));
img1.style.cursor="pointer";
img1.style.paddingRight="2px";
img1.style.paddingRight="2px";
img1.setAttribute("ruleId",rs.getString("rule_id").valueOf());
img1.setAttribute("ruleOrder",rs.getString("rule_order").valueOf());
var img2=document.createElement("img");
img2.setAttribute("src",qu.global.icon("up.png",16));
img2.style.cursor="pointer";
img2.style.paddingRight="2px";
img2.style.paddingRight="2px";
img2.setAttribute("ruleId",rs.getString("rule_id").valueOf());
img2.setAttribute("ruleOrder",rs.getString("rule_order").valueOf());
var order=rs.getNumber("rule_order").valueOf();
if(order!=1){
div.appendChild(img2);
}
var count=rs.md.getCount();
if(order!=count){
div.appendChild(img1);
}
dojo.event.connectOnce(img1,"onclick",this,"onMoveDown");
dojo.event.connectOnce(img2,"onclick",this,"onMoveUp");
return div;
})});
setMultiselect(true);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _15a3=new qu.rpc.Service("EscalationRules");
with(this.el.grid.getModel()){
setService(_15a3);
setMethod("getRulesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addEscalationRule=new app.view.settings.escalationRules.EscalationRuleAdd();
this.editEscalationRule=new app.view.settings.escalationRules.EscalationRuleEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.EscalationRules"));
},onAdd:function(){
dojo.event.connectOnce(this.addEscalationRule,"onSaveSuccess",this.el.grid,"update");
this.addEscalationRule.show();
},onEdit:function(inRow,inCol){
if(inCol==3){
return;
}
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editEscalationRule.setRuleId(rs.getString("rule_id"));
dojo.event.connectOnce(this.editEscalationRule,"onSaveSuccess",this.el.grid,"update");
this.editEscalationRule.show();
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("rule_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _15a8=new qu.rpc.Service("EscalationRules");
var _15a9={sid:qu.user.getSid()};
_15a8.setThrobber("Deleting...");
var def=_15a8.deleteRule({sid:qu.user.getSid(),rule_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_15ab){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_15ac){
app.main.msgBox.print(_15ac);
},onMoveUp:function(_15ad){
var _15ae=_15ad.target;
var _15af=_15ae.getAttribute("ruleId");
var _15b0=_15ae.getAttribute("ruleOrder");
var rules=new qu.rpc.Service("EscalationRules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.moveRuleUp({sid:qu.user.getSid(),rule_id:_15af,rule_order:_15b0});
def.addCallback(dojo.lang.hitch(this,"onMoveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onMoveFail"));
},onMoveSuccess:function(_15b3){
this.el.grid.getData();
},onMoveFail:function(_15b4){
alert(_15b4);
},onMoveDown:function(_15b5){
var _15b6=_15b5.target;
var _15b7=_15b6.getAttribute("ruleId");
var _15b8=_15b6.getAttribute("ruleOrder");
var rules=new qu.rpc.Service("EscalationRules");
rules.setThrobber(app.i18n.get("saving"));
var def=rules.moveRuleDown({sid:qu.user.getSid(),rule_id:_15b7,rule_order:_15b8});
def.addCallback(dojo.lang.hitch(this,"onMoveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onMoveFail"));
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.custom.Status");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.custom.Status",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},initComponents:function(){
this.el.img.setFieldHeight("18px");
this.el.img.removeAll();
this.el.img.add("",app.i18n.get("none"));
this.el.img.setWidth("100%");
this.el.dueTimeFrom.removeAll();
this.el.dueTimeFrom.add("m",app.i18n.get("fromLastTicketUpdate"));
this.el.dueTimeFrom.add("c",app.i18n.get("fromTicketCreated"));
this.setDueTimeFrom("m");
this.el.dueTimeFrom.setWidth("100%");
var _15bb=new qu.rpc.Service("Statuses");
var _15bc={sid:qu.user.getSid()};
var def=_15bb.getAvailableImages({sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onLoadImagesSuccess"));
def.addErrback(dojo.lang.hitch(this,"onLoadImagesFail"));
},onLoadImagesSuccess:function(_15be){
_15be.beforeFirst();
while(_15be.next()){
this.el.img.add(_15be.getString("image").valueOf(),"<img src='lib/icons/crystalsvg/16/"+_15be.getString("image").valueOf()+"' /> <span style='height:14px;vertical-align:top;'>"+_15be.getString("image").valueOf()+"</span>");
}
this.setImg(this._img);
},onLoadImagesFail:function(_15bf){
this.setImg("");
alert(_15bf);
},onKeyPress:function(_15c0){
switch(_15c0.keyCode){
case _15c0.KEY_ESCAPE:
this.hide();
break;
case _15c0.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Status"));
this.setSize(360,170);
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_15c1){
this.msgBox.print(_15c1);
},resetForm:function(){
this.msgBox.print("");
this.setStatus("");
this.setStatusName("");
this.setColor("");
this.setImg("");
this.setDue(false);
},getStatusName:function(){
return this.el.statusName.value;
},setStatusName:function(_15c2){
this.el.statusName.value=_15c2;
},getColor:function(){
return this.el.color.value;
},setColor:function(_15c3){
this.el.color.value=_15c3;
},getImg:function(){
return this.el.img.getSelection().shift();
},setImg:function(_15c4){
this.el.img.deselectAll();
this.el.img.select(_15c4);
this._img=_15c4;
},getDueTimeFrom:function(){
return this.el.dueTimeFrom.getSelection().shift();
},setDueTimeFrom:function(_15c5){
this.el.dueTimeFrom.deselectAll();
this.el.dueTimeFrom.select(_15c5);
},getStatus:function(){
return this.el._status.value;
},setStatus:function(_15c6){
this.el._status.value=_15c6;
},getDue:function(){
if(this.el.due.checked){
return "y";
}
return "n";
},setDue:function(_15c7){
if(_15c7==true||_15c7=="y"){
this.el.due.checked=true;
}else{
if(_15c7==false||_15c7=="n"){
this.el.due.checked=false;
}
}
}});
dojo.provide("app.view.settings.custom.StatusAdd");
dojo.require("app.view.settings.custom.Status");
dojo.lang.declare("app.view.settings.custom.StatusAdd",app.view.settings.custom.Status,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addStatus"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
var _15c8=new Object();
_15c8.status_name=this.getStatusName();
_15c8["status"]=this.getStatus();
_15c8.color=this.getColor();
_15c8.img=this.getImg();
_15c8.due=this.getDue();
_15c8.due_basetime=this.getDueTimeFrom();
var _15c9=new qu.rpc.Service("Statuses");
_15c9.addPushRequest("statuses","Statuses","getStatusesList",{sid:qu.user.getSid()});
_15c9.setThrobber(app.i18n.get("saving"));
var def=_15c9.insertStatus({fields:_15c8,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.custom.StatusEdit");
dojo.require("app.view.settings.custom.Status");
dojo.lang.declare("app.view.settings.custom.StatusEdit",app.view.settings.custom.Status,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editStatus"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.el._status.disabled=true;
this.resetForm();
this.loadStatus();
},setStatusId:function(_15cb){
this._statusId=_15cb;
},getStatusId:function(){
return this._statusId;
},loadStatus:function(){
var _15cc=new qu.rpc.Service("Statuses");
var def=_15cc.getStatus({sid:qu.user.getSid(),"status":this.getStatusId()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_15ce){
var rs=_15ce;
rs.first();
this.setStatus(rs.get("status"));
this.setStatusName(rs.get("status_name"));
this.setColor(rs.get("color"));
this.setImg(rs.get("img"));
this.setDue(rs.get("due"));
this.setDueTimeFrom(rs.get("due_basetime"));
},onSave:function(){
var _15d0=new Object();
_15d0.status_name=this.getStatusName();
_15d0.img=this.getImg();
_15d0.color=this.getColor();
_15d0.due=this.getDue();
_15d0.due_basetime=this.getDueTimeFrom();
var _15d1=new qu.rpc.Service("Statuses");
_15d1.addPushRequest("statuses","Statuses","getStatusesList",{sid:qu.user.getSid()});
_15d1.setThrobber(app.i18n.get("saving"));
var def=_15d1.updateStatus({fields:_15d0,sid:qu.user.getSid(),"status":this.getStatus().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.custom.Statuses");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.custom.StatusAdd");
dojo.require("app.view.settings.custom.StatusEdit");
dojo.lang.declare("app.view.settings.custom.Statuses",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("status",{caption:app.i18n.get("_status"),sortable:true,width:"60px",style:{cursor:"pointer"}});
setColumn("status_name",{caption:app.i18n.get("statusName"),sortable:true,width:"20%",style:{cursor:"pointer"}});
setColumn("color",{caption:app.i18n.get("statusColor"),sortable:true,width:"20%",style:{cursor:"pointer"}});
setColumn("img",{caption:app.i18n.get("statusImage"),sortable:true,width:"20%",style:{cursor:"pointer"},bind:function(col,rs){
return "<img src=\"lib/icons/crystalsvg/16/"+rs.get(col).valueOf()+"\"/><span style=\"font-size: 10px;\"> "+rs.get(col).valueOf()+"</span>";
}});
setColumn("due",{caption:app.i18n.get("computeDue"),sortable:true,width:"20%",style:{cursor:"pointer"},bind:function(col,rs){
if(rs.get(col).valueOf()=="y"){
return app.i18n.get("yes");
}else{
return app.i18n.get("no");
}
}});
setRowColorHandler(function(rs){
return rs.getString("color").valueOf();
});
setMultiselect(true);
setSortColumn("status");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
with(this.el.grid.getModel()){
setService(new qu.rpc.Service("Statuses"));
setMethod("getStatusesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addStatus=new app.view.settings.custom.StatusAdd();
this.editStatus=new app.view.settings.custom.StatusEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Statuses"));
},onAdd:function(){
dojo.event.connectOnce(this.addStatus,"onSaveSuccess",this.el.grid,"update");
this.addStatus.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editStatus.setStatusId(rs.get("status").valueOf());
dojo.event.connectOnce(this.editStatus,"onSaveSuccess",this.el.grid,"update");
this.editStatus.show();
},onDelete:function(){
var _15db=this.el.grid.getSelectionByColumn("status").join("|");
if(_15db==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _15dc=new qu.rpc.Service("Statuses");
var _15dd={sid:qu.user.getSid()};
_15dc.addPushRequest("statuses","Statuses","getStatusesList",{sid:qu.user.getSid()});
_15dc.setThrobber("Deleting...");
var def=_15dc.deleteStatus({sid:qu.user.getSid(),"status":_15db});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_15df){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_15e0){
app.main.msgBox.print(_15e0);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.custom.Priority");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.custom.Priority",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},initComponents:function(){
},onKeyPress:function(_15e1){
switch(_15e1.keyCode){
case _15e1.KEY_ESCAPE:
this.hide();
break;
case _15e1.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Priority"));
this.setSize(330,100);
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_15e2){
this.msgBox.print(_15e2);
},resetForm:function(){
this.setPriority(1);
this.setPriorityName("");
},getPriorityName:function(){
return this.el.priorityName.value;
},setPriorityName:function(_15e3){
this.el.priorityName.value=_15e3;
},getPriority:function(){
return this.el.priority.value;
},setPriority:function(_15e4){
this.el.priority.value=_15e4;
}});
dojo.provide("app.view.settings.custom.PriorityAdd");
dojo.require("app.view.settings.custom.Priority");
dojo.lang.declare("app.view.settings.custom.PriorityAdd",app.view.settings.custom.Priority,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addPriority"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
if(parseInt(this.getPriority())<1){
alert(app.i18n.get("priorityHasToBeGreaterAsZero"));
return false;
}
var _15e5=new Object();
_15e5.priority_name=this.getPriorityName();
_15e5.priority=this.getPriority();
var _15e6=new qu.rpc.Service("Priorities");
_15e6.addPushRequest("priorities","Priorities","getPrioritiesList",{sid:qu.user.getSid()});
_15e6.setThrobber(app.i18n.get("saving"));
var def=_15e6.insertPriority({fields:_15e5,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.custom.PriorityEdit");
dojo.require("app.view.settings.custom.Priority");
dojo.lang.declare("app.view.settings.custom.PriorityEdit",app.view.settings.custom.Priority,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editPriority"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.el.priority.disabled=true;
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.resetForm();
this.loadPriority();
},setPriorityId:function(_15e8){
this._priority=_15e8;
},getPriorityId:function(){
return this._priority;
},loadPriority:function(){
var _15e9=new qu.rpc.Service("Priorities");
var def=_15e9.getPriority({sid:qu.user.getSid(),priority:this.getPriorityId()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_15eb){
var rs=_15eb;
rs.first();
this.setPriority(rs.get("priority"));
this.setPriorityName(rs.get("priority_name"));
},onSave:function(){
var _15ed=new Object();
_15ed.priority_name=this.getPriorityName();
var _15ee=new qu.rpc.Service("Priorities");
_15ee.addPushRequest("priorities","Priorities","getPrioritiesList",{sid:qu.user.getSid()});
_15ee.setThrobber(app.i18n.get("saving"));
var def=_15ee.updatePriority({fields:_15ed,sid:qu.user.getSid(),priority:this.getPriority().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.custom.Priorities");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.custom.PriorityAdd");
dojo.require("app.view.settings.custom.PriorityEdit");
dojo.lang.declare("app.view.settings.custom.Priorities",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("priority",{caption:app.i18n.get("priority"),sortable:true,width:"20%",style:{cursor:"pointer"}});
setColumn("priority_name",{caption:app.i18n.get("priorityName"),sortable:true,width:"80%",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("priority");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _15f0=new qu.rpc.Service("Priorities");
with(this.el.grid.getModel()){
setService(_15f0);
setMethod("getPrioritiesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addPriority=new app.view.settings.custom.PriorityAdd();
this.editPriority=new app.view.settings.custom.PriorityEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Priorities"));
},onAdd:function(){
dojo.event.connectOnce(this.addPriority,"onSaveSuccess",this.el.grid,"update");
this.addPriority.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editPriority.setPriorityId(rs.get("priority").valueOf());
dojo.event.connectOnce(this.editPriority,"onSaveSuccess",this.el.grid,"update");
this.editPriority.show();
},onDelete:function(){
var _15f4=this.el.grid.getSelectionByColumn("priority").join("|");
if(_15f4==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _15f5=new qu.rpc.Service("Priorities");
var _15f6={sid:qu.user.getSid()};
_15f5.addPushRequest("priorities","Priorities","getPrioritiesList",{sid:qu.user.getSid()});
_15f5.setThrobber("Deleting...");
var def=_15f5.deletePriority({sid:qu.user.getSid(),priority:_15f4});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_15f8){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_15f9){
app.main.msgBox.print(_15f9);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.custom.Field");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.custom.Field",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this.el.fieldType,"onChange",this,"onChangeFieldType");
},initComponents:function(){
this.el.fieldType.removeAll();
this.el.fieldType.add("t",app.i18n.get("textField"));
this.el.fieldType.add("o",app.i18n.get("comboBoxField"));
this.el.fieldType.add("m",app.i18n.get("multiSelectField"));
this.el.fieldType.add("c",app.i18n.get("checkBoxField"));
this.el.fieldType.add("a",app.i18n.get("textAreaField"));
this.el.fieldType.add("h",app.i18n.get("computedHtmlText"));
this.el.relatedTo.removeAll();
this.el.relatedTo.add("u",app.i18n.get("user"));
this.el.relatedTo.add("t",app.i18n.get("ticket"));
this.el.relatedTo.add("g",app.i18n.get("group"));
this.el.userAccess.removeAll();
this.el.userAccess.add("u",app.i18n.get("UserAndAgentCanInputValue"));
this.el.userAccess.add("p",app.i18n.get("JustAgentCanInputValue"));
},onKeyPress:function(_15fa){
switch(_15fa.keyCode){
case _15fa.KEY_ESCAPE:
this.hide();
break;
case _15fa.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Field"));
this.setSize(500,330);
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_15fb){
this.msgBox.print(_15fb);
},resetForm:function(){
this.setFieldId("");
this.setFieldTitle("");
this.setFieldType("t");
this.setOptions("");
this.setDefaultValue("");
this.setRelatedTo("u");
this.setUserAccess("u");
this.setOrderValue(1);
this.msgBox.print("");
this.onChangeFieldType();
},onChangeFieldType:function(){
if(this.getFieldType()=="h"){
this.el.lblOptions.innerHTML=app.i18n.get("HTMLText");
this.el.lblHelpText.style.display="none";
this.el.defaultValueRow.style.display="none";
this.el.lblPredefinedVariable.style.display="block";
}else{
this.el.lblOptions.innerHTML=app.i18n.get("options");
this.el.lblHelpText.style.display="block";
try{
this.el.defaultValueRow.style.display="table-row";
}
catch(e){
this.el.defaultValueRow.style.display="block";
}
this.el.lblPredefinedVariable.style.display="none";
}
},getFieldTitle:function(){
return this.el.fieldTitle.value;
},setFieldTitle:function(_15fc){
this.el.fieldTitle.value=_15fc;
},getFieldId:function(){
return this.el.fieldId.value;
},setFieldId:function(_15fd){
this.el.fieldId.value=_15fd;
},setFieldType:function(_15fe){
this.el.fieldType.deselectAll();
this.el.fieldType.select(_15fe);
},getFieldType:function(){
return this.el.fieldType.getSelection().shift();
},getOptions:function(){
return this.el.options.value;
},setOptions:function(_15ff){
this.el.options.value=_15ff;
},getDefaultValue:function(){
return this.el.defaultValue.value;
},setDefaultValue:function(_1600){
this.el.defaultValue.value=_1600;
},setRelatedTo:function(_1601){
this.el.relatedTo.deselectAll();
this.el.relatedTo.select(_1601);
},getRelatedTo:function(){
return this.el.relatedTo.getSelection().shift();
},getOrderValue:function(){
return this.el.orderValue.value;
},setOrderValue:function(_1602){
this.el.orderValue.value=_1602;
},setUserAccess:function(_1603){
this.el.userAccess.deselectAll();
this.el.userAccess.select(_1603);
},getUserAccess:function(){
return this.el.userAccess.getSelection().shift();
}});
dojo.provide("app.view.settings.custom.FieldAdd");
dojo.require("app.view.settings.custom.Field");
dojo.lang.declare("app.view.settings.custom.FieldAdd",app.view.settings.custom.Field,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addField"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
var _1604=new Object();
_1604.field_title=this.getFieldTitle();
_1604.field_id=this.getFieldId();
_1604.field_type=this.getFieldType();
_1604.default_value=this.getDefaultValue();
_1604.options=this.getOptions();
_1604.related_to=this.getRelatedTo();
_1604.order_value=this.getOrderValue();
_1604.user_access=this.getUserAccess();
var _1605=new qu.rpc.Service("Fields");
_1605.addPushRequest("customFields","Fields","getFieldsListAllColumns",{sid:qu.user.getSid()});
_1605.setThrobber(app.i18n.get("saving"));
var def=_1605.insertField({fields:_1604,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.custom.FieldEdit");
dojo.require("app.view.settings.custom.Field");
dojo.lang.declare("app.view.settings.custom.FieldEdit",app.view.settings.custom.Field,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editField"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.el.fieldId.disabled=true;
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.resetForm();
this.loadField();
},_setFieldId:function(_1607){
this._field_id=_1607;
},_getFieldId:function(){
return this._field_id;
},loadField:function(){
var _1608=new qu.rpc.Service("Fields");
var def=_1608.getField({sid:qu.user.getSid(),field_id:this._getFieldId()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_160a){
var rs=_160a;
rs.first();
this.setFieldId(rs.get("field_id"));
this.setFieldTitle(rs.get("field_title"));
this.setFieldType(rs.get("field_type"));
this.setDefaultValue(rs.get("default_value"));
this.setOptions(rs.get("options"));
this.setRelatedTo(rs.get("related_to"));
this.setOrderValue(rs.get("order_value"));
this.setUserAccess(rs.get("user_access"));
this.onChangeFieldType();
},onSave:function(){
var _160c=new Object();
_160c.field_title=this.getFieldTitle();
_160c.field_id=this.getFieldId();
_160c.field_type=this.getFieldType();
_160c.default_value=this.getDefaultValue();
_160c.options=this.getOptions();
_160c.related_to=this.getRelatedTo();
_160c.order_value=this.getOrderValue();
_160c.user_access=this.getUserAccess();
var _160d=new qu.rpc.Service("Fields");
_160d.addPushRequest("customFields","Fields","getFieldsListAllColumns",{sid:qu.user.getSid()});
_160d.setThrobber(app.i18n.get("saving"));
var def=_160d.updateField({fields:_160c,sid:qu.user.getSid(),field_id:this._getFieldId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.custom.Fields");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.custom.FieldAdd");
dojo.require("app.view.settings.custom.FieldEdit");
dojo.lang.declare("app.view.settings.custom.Fields",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("related_to",{caption:app.i18n.get("relatedTo"),sortable:true,width:"80px",style:{cursor:"pointer"},bind:function(col,rs){
var _1611=rs.getString(col).valueOf();
switch(_1611){
case "u":
return "<img src=\"lib/icons/crystalsvg/16/user.png\" title=\""+app.i18n.get("user")+"\"/>&nbsp;"+app.i18n.get("user");
case "t":
return "<img src=\"lib/icons/crystalsvg/16/clock.png\" title=\""+app.i18n.get("ticket")+"\"/>&nbsp;"+app.i18n.get("ticket");
case "g":
return "<img src=\"lib/icons/crystalsvg/16/block-device.png\" title=\""+app.i18n.get("group")+"\"/>&nbsp;"+app.i18n.get("group");
default:
return "";
}
}});
setColumn("field_id",{caption:app.i18n.get("fieldId"),sortable:true,width:"120px",style:{cursor:"pointer"}});
setColumn("field_title",{caption:app.i18n.get("fieldTitle"),sortable:true,width:"80%",style:{cursor:"pointer"}});
setColumn("field_type",{caption:app.i18n.get("fieldType"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _1614=rs.getString(col).valueOf();
switch(_1614){
case "t":
return app.i18n.get("textField");
case "o":
return app.i18n.get("comboBoxField");
case "m":
return app.i18n.get("multiSelectField");
case "c":
return app.i18n.get("checkBoxField");
case "a":
return app.i18n.get("textAreaField");
case "h":
return app.i18n.get("computedHtmlText");
default:
return "";
}
}});
setColumn("user_access",{caption:app.i18n.get("userAccess"),sortable:true,width:"180px",style:{cursor:"pointer"},bind:function(col,rs){
var _1617=rs.getString(col).valueOf();
switch(_1617){
case "u":
return app.i18n.get("UserAndAgentCanInputValue");
case "p":
return app.i18n.get("JustAgentCanInputValue");
default:
return "";
}
}});
setColumn("order_value",{caption:app.i18n.get("fieldOrder"),sortable:true,width:"80px",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("related_to");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
with(this.el.grid.getModel()){
setService(new qu.rpc.Service("Fields"));
setMethod("getFieldsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addField=new app.view.settings.custom.FieldAdd();
this.editField=new app.view.settings.custom.FieldEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.Fields"));
},onAdd:function(){
dojo.event.connectOnce(this.addField,"onSaveSuccess",this.el.grid,"update");
this.addField.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editField._setFieldId(rs.get("field_id").valueOf());
dojo.event.connectOnce(this.editField,"onSaveSuccess",this.el.grid,"update");
this.editField.show();
},onDelete:function(){
var _161b=this.el.grid.getSelectionByColumn("field_id").join("|");
if(_161b==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _161c=new qu.rpc.Service("Fields");
_161c.addPushRequest("customFields","Fields","getFieldsListAllColumns",{sid:qu.user.getSid()});
var _161d={sid:qu.user.getSid()};
_161c.setThrobber("Deleting...");
var def=_161c.deleteField({sid:qu.user.getSid(),field_id:_161b});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_161f){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1620){
app.main.msgBox.print(_1620);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.custom.TemplateEdit");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.custom.TemplateEdit",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},initComponents:function(){
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.MailTemplate"));
this.setSize(800,600);
this.setTitle(app.i18n.get("editTemplate"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
dojo.event.connectOnce(this,"onLoadSuccess",this.el.htmlBody,"setModeRich");
this.resetForm();
this.loadTemplate();
},loadTemplate:function(){
var _1621=new qu.rpc.Service("MailTemplates");
var def=_1621.getTemplatesList({sid:qu.user.getSid(),template_id:this._getTemplateId(),queue_id:this._getQueueId()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(rs){
this.resetForm();
if(rs.getCount()>0){
rs.first();
this.setSubject(rs.get("subject"));
this.setHtmlBody(rs.get("body_html"));
this.setTextBody(rs.get("body_text"));
}
},onSave:function(){
var _1624=new Object();
_1624.template_id=this._getTemplateId();
_1624.queue_id=this._getQueueId();
_1624.subject=this.getSubject();
_1624.body_html=this.getHtmlBody();
_1624.body_text=this.getTextBody();
var _1625=new qu.rpc.Service("MailTemplates");
_1625.setThrobber(app.i18n.get("saving"));
if(this._isPersistent()){
var def=_1625.updateTemplate({fields:_1624,sid:qu.user.getSid(),template_id:this._getTemplateId().valueOf(),queue_id:this._getQueueId().valueOf()});
}else{
var def=_1625.insertTemplate({fields:_1624,sid:qu.user.getSid(),template_id:this._getTemplateId().valueOf(),queue_id:this._getQueueId().valueOf()});
}
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_1627){
this.msgBox.print(_1627);
},resetForm:function(){
this.msgBox.print("");
this.el.htmlBody.setModeRich();
this.el.textBody.setModePlain();
this.setSubject("${subject}");
this.setHtmlBody("${body}");
this.setTextBody("${body}");
this.el.templateVariables.innerHTML=app.i18n.get("Variables"+this._getTemplateId());
},_setTemplateId:function(_1628){
this._templateId=_1628;
},_getTemplateId:function(){
return this._templateId;
},_setQueueId:function(_1629){
this._queueId=_1629;
},_getQueueId:function(){
return this._queueId;
},_setPersistent:function(_162a){
this._isPersistentData=_162a;
},_isPersistent:function(){
return this._isPersistentData;
},setSubject:function(_162b){
if(_162b=="null"||_162b=="undefined"){
_162b="";
}
this.el.subject.value=_162b;
},getSubject:function(){
return this.el.subject.value;
},setHtmlBody:function(_162c){
if(_162c=="null"||_162c=="undefined"){
_162c="";
}
this.el.htmlBody.setHtml(_162c);
},getHtmlBody:function(){
return this.el.htmlBody.getHtml();
},setTextBody:function(_162d){
if(_162d=="null"||_162d=="undefined"){
_162d="";
}
this.el.textBody.setValue(_162d);
},getTextBody:function(){
return this.el.textBody.getValue();
}});
dojo.provide("app.view.settings.custom.MailTemplates");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.custom.TemplateEdit");
dojo.lang.declare("app.view.settings.custom.MailTemplates",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("template_id",{caption:app.i18n.get("templateName"),sortable:false,width:"40%",style:{cursor:"pointer"}});
setColumn("name",{caption:app.i18n.get("TemplateQueue"),sortable:false,width:"40%",style:{cursor:"pointer"},bind:function(col,rs){
var _1630=rs.getString(col).valueOf();
if(_1630=="null"){
return "<b>"+app.i18n.get("GlobalTemplate")+"</b>";
}
return _1630;
}});
setColumn("mt_template_id",{caption:app.i18n.get("isTemplateDefined"),sortable:false,width:"80%",style:{cursor:"pointer"},bind:function(col,rs){
var _1633=rs.getString(col).valueOf();
if(_1633.length>0&&_1633!="null"){
return app.i18n.get("yes");
}else{
return app.i18n.get("useGlobalTemplate");
}
}});
setMultiselect(true);
setSortColumn("is_system");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(500);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
with(this.el.grid.getModel()){
setService(new qu.rpc.Service("MailTemplates"));
setMethod("getTemplatesFormList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.editTemplate=new app.view.settings.custom.TemplateEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.custom.MailTemplates"));
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editTemplate._setTemplateId(rs.get("template_id").valueOf());
this.editTemplate._setQueueId(rs.get("queue_id").valueOf());
if(rs.get("mt_template_id").valueOf()=="null"||rs.get("mt_template_id").valueOf()==null||rs.get("mt_template_id").valueOf()==""){
this.editTemplate._setPersistent(false);
}else{
this.editTemplate._setPersistent(true);
}
dojo.event.connectOnce(this.editTemplate,"onSaveSuccess",this.el.grid,"update");
this.editTemplate.show();
},onDelete:function(){
var _1637=this.el.grid.getSelectionByColumn("template_id").join("|");
var _1638=this.el.grid.getSelectionByColumn("queue_id").join("|");
if(_1637==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1639=new qu.rpc.Service("MailTemplates");
var _163a={sid:qu.user.getSid()};
_1639.setThrobber("Deleting...");
var def=_1639.deleteTemplate({sid:qu.user.getSid(),template_id:_1637,queue_id:_1638});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_163c){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_163d){
app.main.msgBox.print(_163d);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.Custom");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.custom.Statuses");
dojo.require("app.view.settings.custom.Priorities");
dojo.require("app.view.settings.custom.Fields");
dojo.require("app.view.settings.custom.MailTemplates");
dojo.lang.declare("app.view.settings.Custom",qu.gui.Frame,null,{initComponents:function(){
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.custom.Statuses());
tab.setTitle(app.i18n.get("statuses"));
tab.setIcon(new qu.gui.Icon("icons"));
this.el.tabCustom.addTab(tab);
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.custom.Priorities());
tab.setTitle(app.i18n.get("priorities"));
tab.setIcon(new qu.gui.Icon("flag"));
this.el.tabCustom.addTab(tab);
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.custom.Fields());
tab.setTitle(app.i18n.get("fields"));
tab.setIcon(new qu.gui.Icon("3d"));
this.el.tabCustom.addTab(tab);
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.custom.MailTemplates());
tab.setTitle(app.i18n.get("mailTemplates"));
tab.setIcon(new qu.gui.Icon("mail"));
this.el.tabCustom.addTab(tab);
with(this.el.tabCustom){
setWidth("100%");
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Custom"));
}});
dojo.provide("app.view.settings.Group");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.Group",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},initComponents:function(){
this.createCustomFields();
},onKeyPress:function(_163f){
switch(_163f.keyCode){
case _163f.KEY_ESCAPE:
this.hide();
break;
case _163f.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Group"));
this.setSize(400,300);
},createCustomFields:function(){
this._customFields=new Array();
var _1640=this.el.tblGroup;
app.main.hashMaps.execFunctionForEachElement(function(_1641){
if(_1641.getRelatedTo()!="g"){
return true;
}
var hTr=document.createElement("tr");
var _1643=document.createElement("td");
_1643.style.whiteSpace="nowrap";
_1643.className="formLabel";
_1643.innerHTML=_1641.getTitle();
hTr.appendChild(_1643);
var _1644=document.createElement("td");
hTr.appendChild(_1644);
var _1645={};
var _1646=new app.widget.CustomField(_1644,_1641.getId(),_1641.getType(),_1641.getDefaultValue(),_1641.getOptions(),_1645);
this._customFields.push(_1646);
_1640.appendChild(hTr);
},this,"customFields");
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_1647){
this.msgBox.print(_1647);
},resetForm:function(){
this.setGroupName("");
},getGroupName:function(){
return this.el.groupName.value;
},setGroupName:function(_1648){
this.el.groupName.value=_1648;
}});
dojo.provide("app.view.settings.GroupAdd");
dojo.require("app.view.settings.Group");
dojo.lang.declare("app.view.settings.GroupAdd",app.view.settings.Group,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addGroup"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
var _1649=new Object();
_1649.group_name=this.getGroupName();
var _164a=new qu.rpc.Service("Groups");
_164a.addPushRequest("groups","Groups","getGroupsList",{sid:qu.user.getSid()});
_164a.setThrobber(app.i18n.get("saving"));
var _164b=new Object();
for(var i=0;i<this._customFields.length;i++){
_164b[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
var def=_164a.insertGroup({fields:_1649,sid:qu.user.getSid(),custom:_164b});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.GroupEdit");
dojo.require("app.view.settings.Group");
dojo.lang.declare("app.view.settings.GroupEdit",app.view.settings.Group,null,{initConnections:function(){
this.constructor.superclass.initConnections.apply(this);
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
},initComponents:function(){
this.createCustomFields();
},onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editGroup"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.resetForm();
this.loadGroup();
},setGroupId:function(_164e){
this._groupid=_164e;
},getGroupId:function(){
return this._groupid;
},loadGroup:function(){
var _164f=new qu.rpc.Service("Groups");
_164f.addPushRequest("customFieldsGroupDetail","Groups","getCustomFieldValues",{sid:qu.user.getSid(),groupid:this.getGroupId()});
var def=_164f.getGroup({sid:qu.user.getSid(),groupid:this.getGroupId()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadCustomFields:function(id,_1652){
if(id!="customFieldsGroupDetail"){
return true;
}
for(var i=0;i<this._customFields.length;i++){
this._customFields[i].setValue("");
}
_1652.beforeFirst();
while(_1652.next()){
var _1654=_1652.getString("field_id").valueOf();
var _1655=_1652.getString("field_value").valueOf();
for(var i=0;i<this._customFields.length;i++){
if(this._customFields[i].getFieldId()==_1654){
this._customFields[i].setValue(_1655);
}
}
}
},onLoadSuccess:function(_1656){
var rs=_1656;
rs.first();
this.setGroupId(rs.get("groupid"));
this.setGroupName(rs.get("group_name"));
},onSave:function(){
var _1658=new Object();
_1658.group_name=this.getGroupName();
var _1659=new qu.rpc.Service("Groups");
_1659.addPushRequest("groups","Groups","getGroupsList",{sid:qu.user.getSid()});
var _165a=new Object();
for(var i=0;i<this._customFields.length;i++){
_165a[this._customFields[i].getFieldId()]=this._customFields[i].getValue();
}
_1659.setThrobber(app.i18n.get("saving"));
var def=_1659.updateGroup({fields:_1658,sid:qu.user.getSid(),groupid:this.getGroupId().valueOf(),custom:_165a});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.Groups");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.GroupAdd");
dojo.require("app.view.settings.GroupEdit");
dojo.lang.declare("app.view.settings.Groups",qu.gui.Frame,null,{initComponents:function(){
this._customFieldsResult=null;
with(this.el.grid){
setColumn("groupid",{caption:app.i18n.get("groupId"),sortable:true,width:"20%",style:{cursor:"pointer"}});
setColumn("group_name",{caption:app.i18n.get("groupName"),sortable:true,width:"20%",style:{cursor:"pointer"}});
app.main.hashMaps.execFunctionForEachElement(function(_165d){
if(_165d.getRelatedTo()!="g"){
return true;
}
var _165e=this;
setColumn("custom_"+_165d.getId(),{caption:_165d.getTitle(),sortable:false,width:"20%",style:{cursor:"pointer"},bind:function(col,rs){
_165e._customFieldsResult.beforeFirst();
while(_165e._customFieldsResult.next()){
if(_165e._customFieldsResult.getString("groupid").valueOf()==rs.getString("groupId")){
if(_165e._customFieldsResult.getString("field_id").valueOf()==_165d.getId()){
return _165e._customFieldsResult.getString("field_value").valueOf();
}
}
}
return "";
}});
},this,"customFields");
setMultiselect(true);
setSortColumn("group_name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
var _1661=new qu.rpc.Service("Groups");
_1661.addPushRequest("customFieldsGroup","Groups","getAllCustomFieldValues",{sid:qu.user.getSid()});
with(this.el.grid.getModel()){
setService(_1661);
setMethod("getGroupsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addGroup=new app.view.settings.GroupAdd();
this.editGroup=new app.view.settings.GroupEdit();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadCustomFields");
},onLoadCustomFields:function(id,_1663){
if(id!="customFieldsGroup"){
return true;
}
this._customFieldsResult=_1663;
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Groups"));
},onAdd:function(){
dojo.event.connectOnce(this.addGroup,"onSaveSuccess",this.el.grid,"update");
this.addGroup.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editGroup.setGroupId(rs.get("groupid").valueOf());
dojo.event.connectOnce(this.editGroup,"onSaveSuccess",this.el.grid,"update");
this.editGroup.show();
},onDelete:function(){
var _1667=this.el.grid.getSelectionByColumn("groupid").join("|");
if(_1667==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1668=new qu.rpc.Service("Groups");
var _1669={sid:qu.user.getSid()};
_1668.addPushRequest("groups","Groups","getGroupsList",{sid:qu.user.getSid()});
_1668.setThrobber("Deleting...");
var def=_1668.deleteGroup({sid:qu.user.getSid(),groupid:_1667});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_166b){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_166c){
app.main.msgBox.print(_166c);
},onLoad:function(){
this.el.grid.update();
}});
dojo.provide("app.view.settings.ApplicationSettings");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.settings.MailAccounts");
dojo.require("app.view.settings.ParsingRules");
dojo.require("app.view.settings.Queues");
dojo.require("app.view.settings.Configuration");
dojo.require("app.view.settings.Notifications");
dojo.require("app.view.settings.Gateways");
dojo.require("app.view.settings.EscalationRules");
dojo.require("app.view.settings.Custom");
dojo.require("app.view.settings.Groups");
dojo.lang.declare("app.view.settings.ApplicationSettings",qu.gui.Frame,null,{initComponents:function(){
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.MailAccounts());
tab.setTitle(app.i18n.get("mailAccounts"));
tab.setIcon(new qu.gui.Icon("user"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Queues());
tab.setTitle(app.i18n.get("queues"));
tab.setIcon(new qu.gui.Icon("queue"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.ParsingRules());
tab.setTitle(app.i18n.get("parsingRules"));
tab.setIcon(new qu.gui.Icon("services"));
this.el.tabFolder.addTab(tab);
if(quConfig.disableNotifications!="y"){
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Notifications());
tab.setTitle(app.i18n.get("notifications"));
tab.setIcon(new qu.gui.Icon("notify"));
this.el.tabFolder.addTab(tab);
}
if(quConfig.disableMailGateway!="y"){
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Gateways());
tab.setTitle(app.i18n.get("MailGateways"));
tab.setIcon(new qu.gui.Icon("forward"));
this.el.tabFolder.addTab(tab);
}
tab=new qu.widget.tabFolder.Tab(new app.view.settings.EscalationRules());
tab.setTitle(app.i18n.get("escalationRules"));
tab.setIcon(new qu.gui.Icon("important"));
this.el.tabFolder.addTab(tab);
if(!quConfig.hideGroups){
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Groups());
tab.setTitle(app.i18n.get("userGroups"));
tab.setIcon(new qu.gui.Icon("group-event"));
this.el.tabFolder.addTab(tab);
}
with(this.el.tabFolder){
setWidth("100%");
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.ApplicationSettings"));
}});
dojo.provide("app.view.settings.downloadManager.Product");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.downloadManager.Product",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadAttachments");
},initComponents:function(){
this._attachments=new Array();
},onLoadAttachments:function(id,_166f){
if(id=="dmEditAttachments"){
this.loadAttachments(_166f);
}
},loadAttachments:function(_1670){
},onAddFile:function(){
var _1671=new app.widget.Upload(this.el.filesContent);
_1671.inputFileNode.setAttribute("size",25);
if(this._attachments.length>0){
_1671.setAttachFileLabel(app.i18n.get("AttachAnotherFile"));
}
dojo.event.connectOnce(_1671,"onAttach",this,"onAttach");
dojo.event.connectOnce(_1671,"onRemove",this,"onRemove");
this._attachments.push(_1671);
},onAttach:function(){
this.onAddFile();
},onRemove:function(){
var _1672=new Array();
for(var i=0;i<this.attachments.length;i++){
if(!this.attachments[i].isDeleted()){
_1672.push(this.attachments[i]);
}
}
this._attachments=new Array();
this._attachments=_1672;
if(this._attachments.length==1){
this._attachments[0].setAttachFileLabel(app.i18n.get("AttachFile"));
}
},isAllUploaded:function(){
for(var i=0;i<this._attachments.length-1;i++){
if(this._attachments[i].isInProgress()){
return false;
}
}
return true;
},onKeyPress:function(_1675){
switch(_1675.keyCode){
case _1675.KEY_ESCAPE:
this.hide();
break;
case _1675.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.downloadManager.Product"));
this.maximize();
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_1676){
this.msgBox.print(_1676);
},resetForm:function(){
app.main.hashMaps.fill(this.el.subProducts,"products",true);
this.setSubProducts("");
this.setProductCode("");
this.setName("");
this.setDescription("");
this.setMaxDownloads("0");
this.setValidDays("0");
this.setIsEnabled(true);
this.setSendNotification(false);
this.setNotificationSubject("");
this.setNotificationBody("");
this.el.notificationBody.setModeRich();
this.el.description.setModeRich();
this.el.filesContent.innerHTML="";
this._attachments=new Array();
this.onAddFile();
},onShow:function(){
this.el.notificationBody.setModeRich();
this.el.description.setModeRich();
},getProductCode:function(){
return this.el.productCode.value;
},setProductCode:function(_1677){
this.el.productCode.value=_1677;
},getName:function(){
return this.el.name.value;
},setName:function(_1678){
this.el.name.value=_1678;
},getSubTitle:function(){
return this.el.subtitle.value;
},setSubTitle:function(_1679){
this.el.subtitle.value=_1679;
},getDescription:function(){
return this.el.description.getHtml();
},setDescription:function(_167a){
if(_167a=="null"||_167a==null){
_167a="";
}
this.el.description.setHtml(_167a);
},getMaxDownloads:function(){
return this.el.maxDownloads.value;
},setMaxDownloads:function(_167b){
this.el.maxDownloads.value=_167b;
},getValidDays:function(){
return this.el.validDays.value;
},setValidDays:function(_167c){
this.el.validDays.value=_167c;
},isEnabled:function(){
if(this.el.isEnabled.checked){
return "y";
}
return "n";
},setIsEnabled:function(_167d){
if(_167d==true||_167d=="y"){
this.el.isEnabled.checked=true;
}else{
if(_167d==false||_167d=="n"){
this.el.isEnabled.checked=false;
}
}
},getSubProducts:function(){
return this.el.subProducts.getSelection().join("|");
},setSubProducts:function(_167e){
this.el.subProducts.deselectAll();
this.el.subProducts.select(_167e);
},getSendNotification:function(){
if(this.el.sendNotification.checked){
return "y";
}
return "n";
},setSendNotification:function(_167f){
if(_167f==true||_167f=="y"){
this.el.sendNotification.checked=true;
}else{
if(_167f==false||_167f=="n"){
this.el.sendNotification.checked=false;
}
}
},getNotificationSubject:function(){
return this.el.notificationSubject.value;
},setNotificationSubject:function(_1680){
if(_1680=="null"||_1680==null){
_1680="";
}
this.el.notificationSubject.value=_1680;
},getNotificationBody:function(){
return this.el.notificationBody.getHtml();
},setNotificationBody:function(_1681){
if(_1681=="null"||_1681==null){
_1681="";
}
this.el.notificationBody.setHtml(_1681);
}});
dojo.provide("app.view.settings.downloadManager.ProductAdd");
dojo.require("app.view.settings.downloadManager.Product");
dojo.lang.declare("app.view.settings.downloadManager.ProductAdd",app.view.settings.downloadManager.Product,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addProduct"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
if(!this.isAllUploaded()){
var _1682=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_1682);
dojo.lang.setTimeout(this,"onSave",500);
return;
}
var _1683=new Object();
_1683.product_code=this.getProductCode();
_1683.name=this.getName();
_1683.subtitle=this.getSubTitle();
_1683.description=this.getDescription();
_1683.max_downloads=this.getMaxDownloads();
_1683.valid_days=this.getValidDays();
_1683.is_enabled=this.isEnabled();
_1683.send_notification=this.getSendNotification();
_1683.notification_subject=this.getNotificationSubject();
_1683.notification_body=this.getNotificationBody();
var _1684=new Array();
if(this._attachments.length>0){
dojo.lang.forEach(this._attachments,function(_1685,_1686,_1687){
if(_1685.isChecked()){
_1684.push(_1685.getHash());
}
});
}
var _1688=new qu.rpc.Service("Products");
_1688.addPushRequest("products","Products","getProductsList",{sid:qu.user.getSid(),order:"name"});
_1688.setThrobber(app.i18n.get("saving"));
var def=_1688.insertProduct({fields:_1683,attachments:_1684,sub_products:this.getSubProducts(),sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.downloadManager.ProductEdit");
dojo.require("app.view.settings.downloadManager.Product");
dojo.lang.declare("app.view.settings.downloadManager.ProductEdit",app.view.settings.downloadManager.Product,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editProduct"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.resetForm();
this.loadProduct();
},_setProductId:function(_168a){
this._productid=_168a;
},_getProductId:function(){
return this._productid;
},loadProduct:function(){
var _168b=new qu.rpc.Service("Products");
_168b.addPushRequest("dmEditAttachments","Attachments","getDmAttachmentsList",{sid:qu.user.getSid(),productid:this._getProductId().valueOf()});
var def=_168b.getProduct({sid:qu.user.getSid(),productid:this._getProductId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_168d){
var rs=_168d;
rs.first();
this.setProductCode(rs.get("product_code"));
this.setName(rs.get("name"));
this.setSubTitle(rs.get("subtitle"));
this.setDescription(rs.get("description"));
this.setMaxDownloads(rs.get("max_downloads"));
this.setValidDays(rs.get("valid_days"));
this.setIsEnabled(rs.get("is_enabled"));
this.setSendNotification(rs.get("send_notification"));
this.setNotificationSubject(rs.get("notification_subject"));
this.setNotificationBody(rs.get("notification_body"));
this.setSubProducts(rs.get("sub_products").split("|"));
},loadAttachments:function(_168f){
_168f.beforeFirst();
while(_168f.next()){
var _1690=new app.data.email.Attachment();
_1690.setId(_168f.getString("file_id").valueOf());
_1690.setFilename(_168f.getString("filename").valueOf());
_1690.setSize(_168f.getNumber("filesize").valueOf());
_1690.setType(_168f.getString("filetype").valueOf());
this.addAttachment(_1690);
}
},addAttachment:function(_1691){
var _1692=new app.widget.Uploaded(this.el.filesContent,_1691);
this._attachments.push(_1692);
},onSave:function(){
if(!this.isAllUploaded()){
var _1693=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_1693);
dojo.lang.setTimeout(this,"onSave",500);
return;
}
var _1694=new Object();
_1694.product_code=this.getProductCode();
_1694.name=this.getName();
_1694.subtitle=this.getSubTitle();
_1694.description=this.getDescription();
_1694.max_downloads=this.getMaxDownloads();
_1694.valid_days=this.getValidDays();
_1694.is_enabled=this.isEnabled();
_1694.send_notification=this.getSendNotification();
_1694.notification_subject=this.getNotificationSubject();
_1694.notification_body=this.getNotificationBody();
var _1695=new Array();
if(this._attachments.length>0){
dojo.lang.forEach(this._attachments,function(_1696,_1697,_1698){
if(_1696.isChecked()){
_1695.push(_1696.getHash());
}
});
}
var _1699=new qu.rpc.Service("Products");
_1699.addPushRequest("products","Products","getProductsList",{sid:qu.user.getSid(),order:"name"});
_1699.setThrobber(app.i18n.get("saving"));
var def=_1699.updateProduct({fields:_1694,sub_products:this.getSubProducts(),attachments:_1695,sid:qu.user.getSid(),productid:this._getProductId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.downloadManager.Products");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.downloadManager.ProductAdd");
dojo.require("app.view.settings.downloadManager.ProductEdit");
dojo.lang.declare("app.view.settings.downloadManager.Products",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("name",{caption:app.i18n.get("ProductName"),sortable:true,width:"30%",style:{cursor:"pointer"}});
setColumn("subtitle",{caption:app.i18n.get("Subtitle"),sortable:true,width:"30%",style:{cursor:"pointer"},bind:function(col,rs){
var str=rs.getString(col);
if(str=="null"){
str="";
}
return "<span title='"+str+"'>"+str+"</span>";
}});
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var date=rs.getDate(col);
return date.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("max_downloads",{caption:app.i18n.get("maxDownloads"),sortable:true,width:"100px",style:{cursor:"pointer"},bind:function(col,rs){
var value=rs.getString(col);
if(value=="0"||value=="null"||value==null||value==""){
return app.i18n.get("unlimited");
}
return rs.getString(col);
}});
setColumn("valid_days",{caption:app.i18n.get("ValidDays"),sortable:true,width:"100px",style:{cursor:"pointer"},bind:function(col,rs){
var value=rs.getString(col);
if(value=="0"||value=="null"||value==null||value==""){
return app.i18n.get("unlimited");
}
return rs.getString(col);
}});
setColumn("is_enabled",{caption:app.i18n.get("Status"),sortable:true,width:"60px",style:{cursor:"pointer"},bind:dojo.lang.hitch(this,function(col,rs){
var _16a9=rs.getString(col).valueOf();
var img=document.createElement("img");
if(_16a9=="y"){
img.setAttribute("src",qu.global.icon("ok.png",16));
}else{
img.setAttribute("src",qu.global.icon("no.png",16));
}
return img;
})});
setMultiselect(true);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
}
with(this.el.grid.getModel()){
setService(new qu.rpc.Service("Products"));
setMethod("getProductsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addProduct=new app.view.settings.downloadManager.ProductAdd();
this.editProduct=new app.view.settings.downloadManager.ProductEdit();
this.el.filterStatus.removeAll();
this.el.filterStatus.add("","["+app.i18n.get("any")+"]");
this.el.filterStatus.add("y",app.i18n.get("checked"));
this.el.filterStatus.add("n",app.i18n.get("notChecked"));
},updateGrid:function(){
var _16ab=new qu.rpc.Service("Products");
with(this.el.grid.getModel()){
setService(_16ab);
setMethod("getProductsList");
setDefaultParams({sid:qu.user.getSid(),created_from:this.el.filterCreated.getFrom(),created_to:this.el.filterCreated.getTo(),product_name:this.getProductName(),subtitle:this.getSubtitle(),is_enabled:this.getStatus()});
}
this.el.grid.update();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.downloadManager.Products"));
},onAdd:function(){
dojo.event.connectOnce(this.addProduct,"onSaveSuccess",this.el.grid,"update");
this.addProduct.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editProduct._setProductId(rs.get("productid").valueOf());
dojo.event.connectOnce(this.editProduct,"onSaveSuccess",this.el.grid,"update");
this.editProduct.show();
},onDelete:function(){
var _16af=this.el.grid.getSelectionByColumn("productid").join("|");
if(_16af==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _16b0=new qu.rpc.Service("Products");
var _16b1={sid:qu.user.getSid()};
_16b0.setThrobber("Deleting...");
var def=_16b0.deleteProduct({sid:qu.user.getSid(),productid:_16af});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_16b3){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_16b4){
app.main.msgBox.print(_16b4);
},onLoad:function(){
this.el.grid.update();
},getProductName:function(){
return this.el.filterProductName.value;
},getSubtitle:function(){
return this.el.filterSubtitle.value;
},getStatus:function(){
return this.el.filterStatus.getSelection().join("|");
}});
dojo.provide("app.view.settings.downloadManager.Order");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.settings.downloadManager.Order",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
},initComponents:function(){
var users=new qu.rpc.Service("Users");
with(this.el.email.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _16b6={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_16b6);
}
},onKeyPress:function(_16b7){
switch(_16b7.keyCode){
case _16b7.KEY_ESCAPE:
this.hide();
break;
case _16b7.KEY_ENTER:
this.onSave();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.downloadManager.Order"));
this.setSize(400,270);
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_16b8){
this.msgBox.print(_16b8);
},resetForm:function(){
this.el.groupId.removeAll();
this.el.groupId.add("","["+app.i18n.get("none")+"]");
app.main.hashMaps.fill(this.el.groupId,"groups",false);
app.main.hashMaps.fill(this.el.productId,"products",true);
this.setEmail("");
this.setGroup("");
this.setProduct("");
this.setMaxDownloads("0");
this.setValidFrom(new Date());
this.setValidUntil(null);
},getProduct:function(){
return this.el.productId.getSelection().join("|");
},setProduct:function(_16b9){
if(_16b9=="null"){
_16b9="";
}
this.el.productId.deselectAll();
this.el.productId.select(_16b9);
},getGroup:function(){
return this.el.groupId.getSelection().join("|");
},setGroup:function(_16ba){
if(_16ba=="null"){
_16ba="";
}
this.el.groupId.deselectAll();
this.el.groupId.select(_16ba);
},getEmail:function(){
return this.el.email.getValue();
},setEmail:function(_16bb){
if(_16bb=="null"){
_16bb="";
}
this.el.email.setValue(_16bb);
},getMaxDownloads:function(){
return this.el.maxDownloads.value;
},setMaxDownloads:function(_16bc){
if(_16bc=="null"||_16bc==""||_16bc===null){
_16bc="0";
}
this.el.maxDownloads.value=_16bc;
},getValidFrom:function(){
return this.el.validFrom.getDate();
},getValidUntil:function(){
if(this.el.validUntil.getDate()==null){
return "null";
}
return this.el.validUntil.getDate();
},setValidFrom:function(_16bd){
this.el.validFrom.setDate(_16bd);
},setValidUntil:function(_16be){
this.el.validUntil.setDate(_16be);
}});
dojo.provide("app.view.settings.downloadManager.OrderAdd");
dojo.require("app.view.settings.downloadManager.Order");
dojo.lang.declare("app.view.settings.downloadManager.OrderAdd",app.view.settings.downloadManager.Order,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addOrder"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
var _16bf=new Object();
_16bf.productid=this.getProduct();
_16bf.groupid=this.getGroup();
_16bf.max_downlodas=this.getMaxDownloads();
_16bf.valid_from=this.getValidFrom();
_16bf.valid_until=this.getValidUntil();
var _16c0=new qu.rpc.Service("ProductOrders");
_16c0.setThrobber(app.i18n.get("saving"));
var def=_16c0.insertOrder({fields:_16bf,email:this.getEmail(),sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onSaveFail"));
},onLoad:function(){
this.resetForm();
this.center();
}});
dojo.provide("app.view.settings.downloadManager.OrderEdit");
dojo.require("app.view.settings.downloadManager.Order");
dojo.lang.declare("app.view.settings.downloadManager.OrderEdit",app.view.settings.downloadManager.Order,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editOrder"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
dojo.event.connectOnce(this,"onLoadSuccess",this,"hideLoading");
this.resetForm();
this.loadOrder();
},_setOrderId:function(_16c2){
this._orderid=_16c2;
},_getOrderId:function(){
return this._orderid;
},loadOrder:function(){
var _16c3=new qu.rpc.Service("ProductOrders");
var def=_16c3.getOrder({sid:qu.user.getSid(),orderid:this._getOrderId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_16c5){
var rs=_16c5;
rs.first();
this.setProduct(rs.get("productid"));
this.setGroup(rs.get("groupid"));
this.setEmail(rs.get("email"));
this.setMaxDownloads(rs.get("max_downlodas"));
this.setValidFrom(rs.getDate("valid_from"));
if(rs.getString("valid_until")=="0000-00-00 00:00:00"){
this.setValidUntil(null);
}else{
this.setValidUntil(rs.getDate("valid_until"));
}
},onSave:function(){
var _16c7=new Object();
_16c7.productid=this.getProduct();
_16c7.groupid=this.getGroup();
_16c7.max_downloads=this.getMaxDownloads();
_16c7.valid_from=this.getValidFrom();
_16c7.valid_until=this.getValidUntil();
var _16c8=new qu.rpc.Service("ProductOrders");
_16c8.setThrobber(app.i18n.get("saving"));
var def=_16c8.updateOrder({fields:_16c7,email:this.getEmail(),sid:qu.user.getSid(),orderid:this._getOrderId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.settings.downloadManager.Orders");
dojo.require("qu.gui.Frame");
dojo.require("app.view.settings.downloadManager.OrderAdd");
dojo.require("app.view.settings.downloadManager.OrderEdit");
dojo.lang.declare("app.view.settings.downloadManager.Orders",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var date=rs.getDate(col);
return date.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("product",{caption:app.i18n.get("Product"),sortable:true,width:"30%",style:{cursor:"pointer"},bind:function(col,rs){
return rs.getString("product_name")+"<br/>"+rs.getString("product_code");
}});
setColumn("product_subtitle",{caption:app.i18n.get("Subtitle"),sortable:true,width:"30%",style:{cursor:"pointer"},bind:function(col,rs){
var str=rs.getString(col);
if(str=="null"){
str="";
}
return "<span title='"+str+"'>"+str+"</span>";
}});
if(!quConfig.hideGroups){
setColumn("group_name",{caption:app.i18n.get("groupName"),sortable:true,width:"100px",style:{cursor:"pointer"},bind:function(col,rs){
var _16d4=rs.getString(col);
if(_16d4==null||_16d4=="null"){
return "";
}
return _16d4;
}});
}
setColumn("customer",{caption:app.i18n.get("customer"),sortable:true,width:"30%",style:{cursor:"pointer"},bind:function(col,rs){
var _16d7=rs.getString("customer_email");
var _16d8=rs.getString("customer_name");
if(_16d7=="null"||_16d7==null){
_16d7="";
}
if(_16d8=="null"||_16d8==null){
_16d8="";
}
if(_16d8!=""){
return _16d7+"<br/>"+_16d8;
}
return _16d7;
}});
setColumn("licenseid",{caption:app.i18n.get("License"),sortable:true,width:"80px",style:{cursor:"pointer"}});
setColumn("valid_from",{caption:app.i18n.get("ValidFrom"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var date=rs.getDate(col);
return date.print(app.i18n.get("dateFormat"));
}});
setColumn("valid_until",{caption:app.i18n.get("ValidUntil"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _16de=rs.getString(col);
if(_16de==null||_16de=="null"||_16de==""||_16de=="0000-00-00 00:00:00"){
return "";
}
var date=rs.getDate(col);
return date.print(app.i18n.get("dateFormat"));
}});
setColumn("downloads",{caption:app.i18n.get("downloads"),sortable:true,width:"100px",style:{cursor:"pointer"},bind:function(col,rs){
var str=rs.getString(col);
var _16e3=rs.getString("max_downloads");
if(_16e3!="0"){
return str+" / "+_16e3;
}
return rs.getString(col);
}});
setMultiselect(true);
setSortColumn("created");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(50);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
var users=new qu.rpc.Service("Users");
with(this.el.filterCustomer.getModel()){
setService(users);
setMethod("getUserEmailsList");
setKey("email");
setValue("email");
setSearchKey("email");
var _16e5={sid:qu.user.getSid(),limit:20,order:"email"};
setDefaultParams(_16e5);
}
this.el.filterGroup.removeAll();
this.el.filterGroup.add("","["+app.i18n.get("any")+"]");
app.main.hashMaps.fill(this.el.filterGroup,"groups",false);
}
with(this.el.grid.getModel()){
setService(new qu.rpc.Service("ProductOrders"));
setMethod("getOrdersList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.addOrder=new app.view.settings.downloadManager.OrderAdd();
this.editOrder=new app.view.settings.downloadManager.OrderEdit();
},updateGrid:function(){
var _16e6=new qu.rpc.Service("ProductOrders");
with(this.el.grid.getModel()){
setService(_16e6);
setMethod("getOrdersList");
setDefaultParams({sid:qu.user.getSid(),created_from:this.el.filterCreated.getFrom(),created_to:this.el.filterCreated.getTo(),product_name:this.getProductName(),subtitle:this.getSubtitle(),groupid:this.getGroup(),email:this.getCustomer()});
}
this.el.grid.update();
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.downloadManager.Orders"));
},onAdd:function(){
dojo.event.connectOnce(this.addOrder,"onSaveSuccess",this.el.grid,"update");
this.addOrder.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editOrder._setOrderId(rs.get("orderid").valueOf());
dojo.event.connectOnce(this.editOrder,"onSaveSuccess",this.el.grid,"update");
this.editOrder.show();
},onDelete:function(){
var _16ea=this.el.grid.getSelectionByColumn("orderid").join("|");
if(_16ea==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _16eb=new qu.rpc.Service("ProductOrders");
var _16ec={sid:qu.user.getSid()};
_16eb.setThrobber("Deleting...");
var def=_16eb.deleteOrder({sid:qu.user.getSid(),orderid:_16ea});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_16ee){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_16ef){
app.main.msgBox.print(_16ef);
},onLoad:function(){
this.el.grid.update();
},getProductName:function(){
return this.el.filterProductName.value;
},getSubtitle:function(){
return this.el.filterSubtitle.value;
},getGroup:function(){
return this.el.filterGroup.getSelection().join("|");
},getCustomer:function(){
return this.el.filterCustomer.getValue();
}});
dojo.provide("app.view.settings.ApplicationFiles");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.settings.ApplicationFiles",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"115px",bind:function(col,rs){
var _16f2=rs.getDate(col);
return _16f2.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("filename",{caption:app.i18n.get("filename"),sortable:true,width:"75%",bind:function(col,rs){
return "<a class='blank' href='../server/download.php?attachment_id="+rs.get("file_id")+"' title='"+rs.get(col)+"'><img src='lib/icons/crystalsvg/16/file-find.png' border='0' /> "+"</a> <span title='"+rs.get(col)+"'>"+rs.get(col)+"</span>";
}});
setColumn("filetype",{caption:app.i18n.get("filetype"),sortable:true,width:"25%",bind:function(col,rs){
return "<span title='"+rs.get(col)+"'>"+rs.get(col)+"</span>";
}});
setColumn("filesize",{caption:app.i18n.get("filesize"),sortable:true,width:"70px",bind:function(col,rs){
var _16f9=0;
var size=rs.getNumber(col);
if(size>1073741824){
_16f9=parseInt(size/1073741824)+" "+app.i18n.get("gigaBytes");
}else{
if(size>1048576){
_16f9=parseInt(size/1048576)+" "+app.i18n.get("megaBytes");
}else{
if(size>1024){
_16f9=parseInt(size/1024)+" "+app.i18n.get("kiloBytes");
}else{
_16f9=size+" "+app.i18n.get("bytes");
}
}
}
return _16f9;
}});
setColumn("downloads",{caption:app.i18n.get("downloads"),sortable:true,width:"70px"});
setMultiselect(true);
setSortColumn("created");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(10);
}
var files=new qu.rpc.Service("Files");
with(this.el.grid.getModel()){
setService(files);
setMethod("getFilesList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.initFilterFields();
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onClick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce(this.el.filterCreated,"onChange",this,"updateGrid");
dojo.event.connectOnce(this.el.cmdFilters,"onClick",this,"onFiltersClick");
},onFiltersClick:function(){
if(this.el.cmdFilters.isChecked()){
this.el.filtersContainer.style.display="block";
}else{
this.el.filtersContainer.style.display="none";
}
},updateGrid:function(){
var files=new qu.rpc.Service("Files");
with(this.el.grid.getModel()){
setService(files);
setMethod("getFilesList");
setDefaultParams({sid:qu.user.getSid(),created_from:this.el.filterCreated.getFrom(),created_to:this.el.filterCreated.getTo()});
}
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.ApplicationFiles"));
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("file_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var files=new qu.rpc.Service("Files");
files.setThrobber("Deleting...");
var def=files.deleteFile({sid:qu.user.getSid(),file_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},initFilterFields:function(){
},onDeleteSuccess:function(_1700){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1701){
app.main.msgBox.print(_1701);
},onLoad:function(){
this.updateGrid();
}});
dojo.provide("app.view.settings.DownloadManagerSettings");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.settings.downloadManager.Products");
dojo.require("app.view.settings.downloadManager.Orders");
dojo.require("app.view.settings.ApplicationFiles");
dojo.lang.declare("app.view.settings.DownloadManagerSettings",qu.gui.Frame,null,{initComponents:function(){
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.downloadManager.Products());
tab.setTitle(app.i18n.get("Products"));
tab.setIcon(new qu.gui.Icon("fileshare"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.downloadManager.Orders());
tab.setTitle(app.i18n.get("Orders"));
tab.setIcon(new qu.gui.Icon("signature"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.ApplicationFiles());
tab.setTitle(app.i18n.get("fileManager"));
tab.setIcon(new qu.gui.Icon("file-manager"));
this.el.tabFolder.addTab(tab);
with(this.el.tabFolder){
setWidth("100%");
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.DownloadManagerSettings"));
}});
dojo.provide("app.view.settings.Logs");
dojo.require("qu.gui.Frame");
dojo.lang.declare("app.view.settings.Logs",qu.gui.Frame,null,{initComponents:function(){
with(this.el.grid){
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"115px",style:{cursor:"pointer"},bind:function(col,rs){
var _1705=rs.getDate(col);
return _1705.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("log_text",{caption:app.i18n.get("message"),sortable:true,width:"100%",style:{cursor:"pointer"},bind:function(col,rs){
return "<span style='white-space:normal;' title='"+rs.get(col)+"'>"+rs.get(col)+"</span>";
}});
setColumn("log_type",{caption:app.i18n.get("logType"),sortable:true,width:"80px",style:{cursor:"pointer"}});
setColumn("level",{caption:app.i18n.get("logLevel"),sortable:true,width:"90px",style:{cursor:"pointer"}});
setColumn("ip",{caption:app.i18n.get("ip"),sortable:true,width:"70px",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("created");
setSortOrder(qu.widget.Grid.SORT_DESC);
setHeight(10);
setOnCellClickCallback(dojo.lang.hitch(this,"onShowUsers"));
}
var _1708=new qu.rpc.Service("Logs");
with(this.el.grid.getModel()){
setService(_1708);
setMethod("getLogsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
this.initFilterFields();
},onShowUsers:function(inRow,inCol){
var cell=this.el.grid.getCell(inRow,2);
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
var logs=new qu.rpc.Service("Logs");
var def=logs.getLogUsersList({sid:qu.user.getSid(),log_id:rs.get("log_id").valueOf()});
def.addCallback(dojo.lang.hitch(this,function(_170f){
this.onShowUsersSuccess(_170f,inRow);
}));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onShowUsersSuccess:function(_1710,inRow){
var cell=this.el.grid.getCell(inRow,2);
_1710.beforeFirst();
var pos=cell.getValue().indexOf("<span class=\"logUsers\">");
if(pos>0){
cell.setValue(cell.getValue().substr(0,pos));
}
cell.setValue(cell.getValue()+"<span class=\"logUsers\">");
while(_1710.next()){
cell.setValue(cell.getValue()+"<br/>"+_1710.get("email"));
}
cell.setValue(cell.getValue()+"</span>");
},initConnections:function(){
dojo.event.connectOnce(this.el._delete,"onClick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdUpdateFilter,"onclick",this,"updateGrid");
dojo.event.connectOnce(this.el.filterCreated,"onChange",this,"updateGrid");
dojo.event.connectOnce(this.el.filterLogLevel.domNode,"onchange",this,"updateGrid");
},updateGrid:function(){
var logs=new qu.rpc.Service("Logs");
with(this.el.grid.getModel()){
setService(logs);
setMethod("getLogsList");
setDefaultParams({sid:qu.user.getSid(),created_from:this.el.filterCreated.getFrom(),created_to:this.el.filterCreated.getTo(),log_text:this.getFilterMessage(),log_level:this.getFilterLogLevel(),log_type:this.getFilterLogType(),ip:this.getFilterIp()});
}
this.el.grid.update();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.settings.Logs"));
},onDelete:function(){
var ids=this.el.grid.getSelectionByColumn("log_id").join("|");
if(ids==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var logs=new qu.rpc.Service("Logs");
logs.setThrobber("Deleting...");
var def=logs.deleteLog({sid:qu.user.getSid(),log_id:ids});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},initFilterFields:function(){
this.el.filterLogLevel.removeAll();
app.main.hashMaps.fill(this.el.filterLogLevel,"levels",false);
this.setFilterLogLevel("");
},onDeleteSuccess:function(_1718){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.el.grid.getData();
},onDeleteFail:function(_1719){
app.main.msgBox.print(_1719);
},onLoad:function(){
this.el.grid.update();
},getFilterMessage:function(){
return this.el.filterMessage.value;
},setFilterMessage:function(_171a){
this.el.filterMessage.value=_171a;
},getFilterLogType:function(){
return this.el.filterLogType.value;
},setFilterLogType:function(_171b){
this.el.filterLogType.value=_171b;
},getFilterLogLevel:function(){
return this.el.filterLogLevel.getSelection();
},setFilterLogLevel:function(_171c){
this.el.filterLogLevel.select(_171c);
},getFilterIp:function(){
return this.el.filterIp.value;
},setFilterIp:function(_171d){
this.el.filterIp.value=_171d;
}});
dojo.provide("app.view.kbase.Tree");
dojo.require("dojo.widget.Tree");
dojo.require("dojo.widget.TreeSelector");
dojo.require("qu.widget.TreeLoadingController");
dojo.require("app.data.kbase.Item");
dojo.declare("app.view.kbase.Tree",qu.gui.Frame,function(){
this._selectedNode=null;
},{onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.Tree"));
},initComponents:function(){
this.tree=dojo.widget.byId("tree");
this.tree.expandIconSrcLoading=dojo.uri.moduleUri("qu.widget","templates/images/treenode_loading.png");
this.treeSelector=dojo.widget.byId("treeSelector");
},initConnections:function(){
dojo.event.topic.subscribe("nodeSelected",this,"onNodeSelected");
dojo.event.topic.subscribe("tree/moveTo",this,"onMove");
},onLoad:function(){
this._initTree();
},onMove:function(){
},setQuickSearch:function(_171e){
this.quickSearch=_171e;
this._initTree();
},_initTree:function(){
var _171f=new app.data.kbase.Item();
if(this.quickSearch!=""&&this.quickSearch!=null){
_171f.setSubject("<b>"+app.i18n.get("FoundItemswithText")+"</b> \""+this.quickSearch+"\"");
}else{
_171f.setSubject("<b>"+app.i18n.get("KnowledgeBase")+"</b>");
}
_171f.setId(0);
_171f.setTreePath("0|");
_171f.setQuery(this.quickSearch);
if(this.rootNode!=null){
this.remove(this.rootNode);
this.rootNode=null;
}
this.rootNode=this.createTreeNode(_171f);
this.tree.addChild(this.rootNode);
this.treeSelector.doSelect(this.rootNode);
this.tree.controller.expand(this.rootNode);
},createTreeNode:function(_1720){
var _1721=new Object();
_1721.title=_1720.getSubject();
_1721.isFolder=true;
var _1722=dojo.widget.createWidget("TreeNode",_1721);
_1722.item=_1720;
return _1722;
},onNodeSelected:function(_1723){
this._selectedNode=_1723.node;
this.onChange();
},getSelectedNode:function(){
if(this._selectedNode==null){
return this.rootNode;
}
return this._selectedNode;
},onChange:function(){
},removeAllChildren:function(_1724){
var _1725=_1724.children;
var len=_1725.length;
for(i=0;i<len;i++){
_1724.removeNode(_1725[0]);
}
},remove:function(_1727){
if(_1727.parent){
this.select(_1727.parent);
}
this.tree.removeNode(_1727);
},selectNodeById:function(_1728,inId){
var _172a=null,nodes=_1728.children;
dojo.lang.forEach(nodes,function(elm,index,arr){
if(elm.item.getId()==inId){
this.select(elm);
_172a=elm;
}
},this);
return _172a;
},select:function(_172f){
var _1730=this.getSelectedNode();
if(!_172f||!_172f.isTreeNode){
return;
}
if(_1730&&_1730.isTreeNode){
this.treeSelector.deselect();
this.treeSelector.doSelect(_172f);
this._selectedNode=_172f;
}
}});
dojo.provide("app.view.kbase.Item");
dojo.require("qu.gui.Dialog");
dojo.lang.declare("app.view.kbase.Item",qu.gui.Dialog,null,{initConnections:function(){
dojo.event.connectOnce(this.el.cmdCancel,"onclick",this,"hide");
dojo.event.connectOnce(this.el.cmdSave,"onclick",this,"onSave");
dojo.event.connectOnce(this.el.subject,"onchange",this,"onSubjectChanged");
dojo.event.connectOnce(app.dataPusher,"onLoad",this,"onLoadAttachments");
},onLoadAttachments:function(id,_1732){
if(id=="kbEditAttachments"){
this.loadAttachments(_1732);
}
},loadAttachments:function(_1733){
},initComponents:function(){
this._attachments=new Array();
this.el.accessMode.removeAll();
this.el.accessMode.add("p",app.i18n.get("PrivateKnowledge"));
this.el.accessMode.add("g",app.i18n.get("InternalKnowledge"));
this.el.accessMode.add("u",app.i18n.get("UserKnowledge"));
this.el.accessMode.add("a",app.i18n.get("PublicKnowledge"));
},onAddFile:function(){
var _1734=new app.widget.Upload(this.el.attachmentsContent);
_1734.setEditor(this.el.body);
_1734.inputFileNode.setAttribute("size",25);
if(this._attachments.length>0){
_1734.setAttachFileLabel(app.i18n.get("AttachAnotherFile"));
}
dojo.event.connectOnce(_1734,"onAttach",this,"onAttach");
dojo.event.connectOnce(_1734,"onRemove",this,"onRemove");
this._attachments.push(_1734);
},onAttach:function(){
this.onAddFile();
},onRemove:function(){
var _1735=new Array();
for(var i=0;i<this.attachments.length;i++){
if(!this.attachments[i].isDeleted()){
_1735.push(this.attachments[i]);
}
}
this._attachments=new Array();
this._attachments=_1735;
if(this._attachments.length==1){
this._attachments[0].setAttachFileLabel(app.i18n.get("AttachFile"));
}
},isAllUploaded:function(){
for(var i=0;i<this._attachments.length-1;i++){
if(this._attachments[i].isInProgress()){
return false;
}
}
return true;
},onSubjectChanged:function(){
if(this.getUrl()==""){
this.setUrl(dojo.string.trim(this.getSubject().replace(/[^0-9a-zA-Z.\-\s]/g,"")).replace(/\s/g,"-").replace(/-+/g,"-").toLowerCase());
}
if(this.getMetaDescription()==""){
this.setMetaDescription(this.getSubject());
}
},onKeyPress:function(_1738){
switch(_1738.keyCode){
case _1738.KEY_ESCAPE:
this.hide();
break;
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.Item"));
this.setSize(1000,650);
},onShow:function(){
this.el.subject.focus();
},resetForm:function(){
this.el.msgBox.innerHTML="";
this.setSubject("");
this.setUrl("");
this.setMetaDescription("");
this.setBody("");
this.setItemOrder("1");
this.setAccessMode("p");
this.el.attachmentsContent.innerHTML="";
this._attachments=new Array();
this.onAddFile();
},onSaveSuccess:function(){
this.hide();
},onSaveFail:function(_1739){
this.msgBox.print(_1739);
},setSubject:function(_173a){
this.el.subject.value=_173a;
},getSubject:function(){
return this.el.subject.value;
},setUrl:function(_173b){
this.el.url.value=_173b;
},getUrl:function(){
return this.el.url.value;
},setMetaDescription:function(_173c){
this.el.metaDescription.value=_173c;
},getMetaDescription:function(){
return this.el.metaDescription.value;
},setBody:function(_173d){
this.el.body.setValue(_173d);
},getBody:function(){
return this.el.body.getHtml();
},setItemOrder:function(_173e){
this.el.itemOrder.value=_173e;
},getItemOrder:function(){
return this.el.itemOrder.value;
},setAccessMode:function(_173f){
this.el.accessMode.selectByValue(_173f);
},getAccessMode:function(){
return this.el.accessMode.getSelectedValue();
},setTreePath:function(_1740){
this._treePath=_1740;
},getTreePath:function(){
return this._treePath;
}});
dojo.provide("app.view.kbase.ItemAdd");
dojo.require("app.view.kbase.Item");
dojo.lang.declare("app.view.kbase.ItemAdd",app.view.kbase.Item,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("addKnowledge"));
this.setIcon(new qu.gui.Icon("file-new"));
},onSave:function(){
if(!this.isAllUploaded()){
var _1741=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_1741);
dojo.lang.setTimeout(this,"onSave",500);
return;
}
var _1742=new Object();
_1742.subject=this.getSubject();
_1742.tree_path=this.getTreePath();
_1742.item_order=this.getItemOrder();
_1742.metadescription=this.getMetaDescription();
_1742.url=this.getUrl();
_1742.body=this.getBody();
_1742.access_mode=this.getAccessMode();
_1742.comments="n";
var _1743=new qu.rpc.Service("KBItems");
var _1744=new Array();
if(this._attachments.length>0){
dojo.lang.forEach(this._attachments,function(_1745,_1746,_1747){
if(_1745.isChecked()){
_1744.push(_1745.getHash());
}
});
}
_1743.setThrobber(app.i18n.get("saving"));
var def=_1743.insertItem({fields:_1742,attachments:_1744,sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoad:function(){
dojo.event.connectOnce(this.el.agents,"onLoad",this,"hideLoading");
this.resetForm();
this.center();
}});
dojo.provide("app.view.kbase.ItemEdit");
dojo.require("app.view.kbase.Item");
dojo.lang.declare("app.view.kbase.ItemEdit",app.view.kbase.Item,null,{onCreate:function(){
this.constructor.superclass.onCreate.apply(this);
this.setTitle(app.i18n.get("editKnowledge"));
this.setIcon(new qu.gui.Icon("edit"));
},onLoad:function(){
this.center();
this.setLoading(true);
this.resetForm();
this.loadItem();
},setItemId:function(_1749){
this._itemId=_1749;
},getItemId:function(){
return this._itemId;
},loadItem:function(){
var _174a=new qu.rpc.Service("KBItems");
_174a.addPushRequest("kbEditAttachments","Attachments","getKBAttachmentsList",{sid:qu.user.getSid(),item_id:this.getItemId().valueOf()});
var def=_174a.getItem({sid:qu.user.getSid(),item_id:this.getItemId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onLoadSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
},onLoadSuccess:function(_174c){
this.hideLoading();
var rs=_174c;
rs.first();
this.setSubject(rs.get("subject"));
this.setItemOrder(rs.get("item_order"));
this.setMetaDescription(rs.get("metadescription"));
this.setUrl(rs.get("url"));
this.setBody(rs.get("body"));
this.setAccessMode(rs.get("access_mode"));
this.setTreePath(rs.get("tree_path").valueOf());
},loadAttachments:function(_174e){
_174e.beforeFirst();
while(_174e.next()){
var _174f=new app.data.email.Attachment();
_174f.setId(_174e.getString("file_id").valueOf());
_174f.setFilename(_174e.getString("filename").valueOf());
_174f.setSize(_174e.getNumber("filesize").valueOf());
_174f.setType(_174e.getString("filetype").valueOf());
this.addAttachment(_174f);
}
},addAttachment:function(_1750){
var _1751=new app.widget.Uploaded(this.el.attachmentsContent,_1750);
_1751.setEditor(this.el.body);
this._attachments.push(_1751);
},onSave:function(){
if(!this.isAllUploaded()){
var _1752=quThrobber.getMessage();
quThrobber.setMessage(app.i18n.get("Uploading"));
quThrobber.show();
quThrobber.setMessage(_1752);
dojo.lang.setTimeout(this,"onSave",500);
return;
}
var _1753=new Object();
_1753.subject=this.getSubject();
_1753.tree_path=this.getTreePath();
_1753.item_order=this.getItemOrder();
_1753.metadescription=this.getMetaDescription();
_1753.url=this.getUrl();
_1753.body=this.getBody();
_1753.access_mode=this.getAccessMode();
_1753.comments="n";
var _1754=new qu.rpc.Service("KBItems");
var _1755=new Array();
if(this._attachments.length>0){
dojo.lang.forEach(this._attachments,function(_1756,_1757,_1758){
if(_1756.isChecked()){
_1755.push(_1756.getHash());
}
});
}
_1754.setThrobber(app.i18n.get("saving"));
var def=_1754.updateItem({fields:_1753,attachments:_1755,sid:qu.user.getSid(),item_id:this.getItemId().valueOf()});
def.addCallback(dojo.lang.hitch(this,"onSaveSuccess"));
def.addErrback(dojo.lang.hitch(this,"onFail"));
}});
dojo.provide("app.view.kbase.KBase");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.kbase.Tree");
dojo.require("app.view.kbase.ItemAdd");
dojo.require("app.view.kbase.ItemEdit");
dojo.lang.declare("app.view.kbase.KBase",qu.gui.Frame,null,{initComponents:function(){
this.treeView=new app.view.kbase.Tree(this.el.treeContainer);
this.treeView.setParent(this);
this.treeView.show();
with(this.el.grid){
setColumn("subject",{caption:app.i18n.get("subject"),sortable:true,width:"100%",style:{cursor:"pointer"},bind:function(col,rs){
var str="";
if(rs.get("children_count")>0){
str+="<img src='lib/icons/crystalsvg/16/folder.png' border='0' title='"+rs.get(col)+"' /> ";
}else{
str+="<img src='lib/icons/crystalsvg/16/mime-manual.png' border='0' title='"+rs.get(col)+"' /> ";
}
str+=rs.get(col);
return str;
}});
setColumn("attachments_count",{caption:app.i18n.get("attachmentsCount"),sortable:true,width:"80px",style:{cursor:"pointer"},bind:function(col,rs){
var _175f=rs.get(col);
return parseInt(_175f)>0?("<img src='app/web/images/attachment.gif' /> ("+_175f.toString()+")"):"";
}});
setColumn("access_mode",{caption:app.i18n.get("AccessMode"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _1762=rs.get(col);
if(_1762!=null){
_1762=_1762.valueOf();
}
getAccessModeImage=function(_1763){
var img="";
var title="";
switch(_1763){
case "a":
img="lib/icons/crystalsvg/16/group-event.png";
title=app.i18n.get("PublicKnowledge");
break;
case "g":
img="lib/icons/crystalsvg/16/instant-away.png";
title=app.i18n.get("InternalKnowledge");
break;
case "p":
img="lib/icons/crystalsvg/16/decrypted.png";
title=app.i18n.get("PrivateKnowledge");
break;
case "u":
img="lib/icons/crystalsvg/16/user.png";
title=app.i18n.get("UserKnowledge");
break;
default:
img="lib/icons/crystalsvg/16/help.png";
title="";
break;
}
return "<img src='"+img+"' border='0' title='"+title+"' /> ";
};
switch(_1762){
case "a":
return getAccessModeImage(_1762)+app.i18n.get("PublicKnowledge");
case "g":
return getAccessModeImage(_1762)+app.i18n.get("InternalKnowledge");
case "p":
return getAccessModeImage(_1762)+app.i18n.get("PrivateKnowledge");
case "u":
return getAccessModeImage(_1762)+app.i18n.get("UserKnowledge");
default:
return getAccessModeImage(_1762)+app.i18n.get("undefined");
}
}});
setColumn("created",{caption:app.i18n.get("created"),sortable:true,width:"120px",style:{cursor:"pointer"},bind:function(col,rs){
var _1768=rs.getDate(col);
return _1768.print(app.i18n.get("dateTimeFormat"));
}});
setColumn("item_order",{caption:app.i18n.get("order"),sortable:true,width:"50px",style:{cursor:"pointer"}});
setMultiselect(true);
setSortColumn("subject");
setHeight(25);
setOnCellClickCallback(dojo.lang.hitch(this,"onEdit"));
this.addItem=new app.view.kbase.ItemAdd();
this.editItem=new app.view.kbase.ItemEdit();
}
var srvc=new qu.rpc.Service("KBItems");
with(this.el.grid.getModel()){
setService(srvc);
setMethod("getItemsList");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.grid.init();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.kbase.KBase"));
},initConnections:function(){
dojo.event.connectOnce(this.el.cmdAdd,"onclick",this,"onAdd");
dojo.event.connectOnce(this.el.cmdDelete,"onclick",this,"onDelete");
dojo.event.connectOnce(this.el.cmdRegenerate,"onclick",this,"onRegenerate");
dojo.event.connectOnce(this.el.grid.getModel(),"onGetDataSuccess",this,"onGridUpdated");
dojo.event.connectOnce(this.treeView,"onChange",this,"onTreeChange");
dojo.event.connectOnce(this.treeView,"onMove",this,"onItemsChange");
dojo.event.connectOnce(this.addItem,"onSaveSuccess",this,"onItemsChange");
dojo.event.connectOnce(this.el.cmdApply,"onclick",this,"onApply");
},onKeyPress:function(_176a){
switch(_176a.keyCode){
case _176a.KEY_ENTER:
this.onApply();
break;
}
},onApply:function(){
this.treeView.setQuickSearch(this.el.quickSearch.value);
},onGridUpdated:function(_176b){
if(_176b.getCount()>0){
if(this.treeView.getSelectedNode().isFolder==false){
this.treeView.getSelectedNode().setFolder();
this.treeView.getSelectedNode().updateIcons();
}
}else{
if(this.treeView.getSelectedNode().isFolder==true){
this.treeView.getSelectedNode().isFolder=false;
this.treeView.getSelectedNode().updateIcons();
this.treeView.getSelectedNode().onTreeClick();
}
}
},updateGrid:function(_176c){
var _176d={sid:qu.user.getSid()};
if(_176c!=null){
var _176e=_176c.item;
if(_176e.getId()!="0"){
_176d.tree_path=_176e.getTreePath()+_176e.getId()+"|";
}else{
_176d.tree_path=_176e.getTreePath();
}
}else{
_176d.tree_path="0|";
}
this.el.grid.getModel().setDefaultParams(_176d);
this.el.grid.update();
},onTreeChange:function(){
var _176f=this.treeView.getSelectedNode();
this.updateGrid(_176f);
this.el.subentriesTitle.innerHTML=app.i18n.get("SubentriesOf")+" <span style='font-weight:bold;'>"+_176f.item.getSubject()+"</span>";
},onLoad:function(){
this.updateGrid(this.treeView.getSelectedNode());
},onItemsChange:function(){
this.treeView.removeAllChildren(this.treeView.getSelectedNode());
this.treeView.getSelectedNode().state=this.treeView.getSelectedNode().loadStates.UNCHECKED;
this.treeView.getSelectedNode().onTreeClick();
this.treeView.getSelectedNode().onTreeClick();
this.updateGrid(this.treeView.getSelectedNode());
},onAdd:function(){
if(this.treeView.getSelectedNode().item.getId()=="0"){
this.addItem.setTreePath(this.treeView.getSelectedNode().item.getTreePath());
}else{
this.addItem.setTreePath(this.treeView.getSelectedNode().item.getTreePath()+this.treeView.getSelectedNode().item.getId()+"|");
}
this.addItem.show();
},onEdit:function(inRow,inCol){
var rs=this.el.grid.getModel().getResultSet();
rs.absolute(inRow);
this.editItem.setItemId(rs.getString("item_id"));
dojo.event.connectOnce(this.editItem,"onSaveSuccess",this,"onItemsChange");
this.editItem.show();
},onRegenerate:function(){
var _1773=new qu.rpc.Service("KBItems");
var def=_1773.forceRefresh({sid:qu.user.getSid()});
def.addCallback(dojo.lang.hitch(this,"onRegenerateSuccess"));
def.addErrback(dojo.lang.hitch(this,"onRegenrateFail"));
},onRegenerateSuccess:function(_1775){
app.main.msgBox.print(app.i18n.get("kbWillBeRegenerated"));
},onRegenrateFail:function(_1776){
app.main.msgBox.print(_1776);
},onDelete:function(){
var _1777=this.el.grid.getSelectionByColumn("item_id").join("|");
var _1778=this.el.grid.getSelectionByColumn("tree_path").join("#");
if(_1777==""){
alert(app.i18n.get("selectSomething"));
return false;
}
if(confirm(app.i18n.get("ReallyDelete"))){
var _1779=new qu.rpc.Service("KBItems");
_1779.setThrobber("Deleting...");
var def=_1779.deleteItem({sid:qu.user.getSid(),item_id:_1777,tree_path:_1778});
def.addCallback(dojo.lang.hitch(this,"onDeleteSuccess"));
def.addErrback(dojo.lang.hitch(this,"onDeleteFail"));
}
},onDeleteSuccess:function(_177b){
app.main.msgBox.print(app.i18n.get("Deleted"));
this.onItemsChange();
},onDeleteFail:function(_177c){
app.main.msgBox.print(_177c);
}});
dojo.provide("app.view.Settings");
dojo.require("qu.gui.Frame");
dojo.require("qu.gui.Icon");
dojo.require("app.view.settings.ApplicationSettings");
dojo.require("app.view.settings.DownloadManagerSettings");
dojo.require("app.view.settings.Configuration");
dojo.require("app.view.settings.Logs");
dojo.require("app.view.settings.Custom");
dojo.require("app.view.kbase.KBase");
dojo.lang.declare("app.view.Settings",qu.gui.Frame,null,{initComponents:function(){
if(qu.user.isAdmin()){
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.ApplicationSettings());
tab.setTitle(app.i18n.get("applicationSettings"));
tab.setIcon(new qu.gui.Icon("contents"));
this.el.tabFolder.addTab(tab);
}
if(quConfig.DownloadManager){
var tab=new qu.widget.tabFolder.Tab(new app.view.settings.DownloadManagerSettings());
tab.setTitle(app.i18n.get("downloadManagerSettings"));
tab.setIcon(new qu.gui.Icon("file-manager"));
this.el.tabFolder.addTab(tab);
}
if(quConfig.knowledgeBaseModule=="y"){
tab=new qu.widget.tabFolder.Tab(new app.view.kbase.KBase());
tab.setTitle(app.i18n.get("Knowledgebase"));
tab.setIcon(new qu.gui.Icon("help-center"));
this.el.tabFolder.addTab(tab);
}
if(qu.user.isAdmin()){
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Configuration());
tab.setTitle(app.i18n.get("configuration"));
tab.setIcon(new qu.gui.Icon("configure"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Custom());
tab.setTitle(app.i18n.get("custom"));
tab.setIcon(new qu.gui.Icon("idea"));
this.el.tabFolder.addTab(tab);
tab=new qu.widget.tabFolder.Tab(new app.view.settings.Logs());
tab.setTitle(app.i18n.get("logs"));
tab.setIcon(new qu.gui.Icon("history"));
this.el.tabFolder.addTab(tab);
}
with(this.el.tabFolder){
setWidth("100%");
showTab(0);
}
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Settings"));
}});
dojo.provide("dojo.widget.PopupContainer");
dojo.require("dojo.html.style");
dojo.require("dojo.html.layout");
dojo.require("dojo.html.selection");
dojo.require("dojo.html.iframe");
dojo.require("dojo.event.*");
dojo.require("dojo.widget.*");
dojo.require("dojo.widget.HtmlWidget");
dojo.declare("dojo.widget.PopupContainerBase",null,function(){
this.queueOnAnimationFinish=[];
},{isShowingNow:false,currentSubpopup:null,beginZIndex:1000,parentPopup:null,parent:null,popupIndex:0,aroundBox:dojo.html.boxSizing.BORDER_BOX,openedForWindow:null,processKey:function(evt){
return false;
},applyPopupBasicStyle:function(){
with(this.domNode.style){
display="none";
position="absolute";
}
},aboutToShow:function(){
},open:function(x,y,_1781,_1782,_1783,_1784){
if(this.isShowingNow){
return;
}
if(this.animationInProgress){
this.queueOnAnimationFinish.push(this.open,arguments);
return;
}
this.aboutToShow();
var _1785=false,node,_1787;
if(typeof x=="object"){
node=x;
_1787=_1782;
_1782=_1781;
_1781=y;
_1785=true;
}
this.parent=_1781;
dojo.body().appendChild(this.domNode);
_1782=_1782||_1781["domNode"]||[];
var _1788=null;
this.isTopLevel=true;
while(_1781){
if(_1781!==this&&(_1781.setOpenedSubpopup!=undefined&&_1781.applyPopupBasicStyle!=undefined)){
_1788=_1781;
this.isTopLevel=false;
_1788.setOpenedSubpopup(this);
break;
}
_1781=_1781.parent;
}
this.parentPopup=_1788;
this.popupIndex=_1788?_1788.popupIndex+1:1;
if(this.isTopLevel){
var _1789=dojo.html.isNode(_1782)?_1782:null;
dojo.widget.PopupManager.opened(this,_1789);
}
if(this.isTopLevel&&!dojo.withGlobal(this.openedForWindow||dojo.global(),dojo.html.selection.isCollapsed)){
this._bookmark=dojo.withGlobal(this.openedForWindow||dojo.global(),dojo.html.selection.getBookmark);
}else{
this._bookmark=null;
}
if(_1782 instanceof Array){
_1782={left:_1782[0],top:_1782[1],width:0,height:0};
}
with(this.domNode.style){
display="";
zIndex=this.beginZIndex+this.popupIndex;
}
if(_1785){
this.move(node,_1784,_1787);
}else{
this.move(x,y,_1784,_1783);
}
this.domNode.style.display="none";
this.explodeSrc=_1782;
this.show();
this.isShowingNow=true;
},move:function(x,y,_178c,_178d){
var _178e=(typeof x=="object");
if(_178e){
var _178f=_178c;
var node=x;
_178c=y;
if(!_178f){
_178f={"BL":"TL","TL":"BL"};
}
dojo.html.placeOnScreenAroundElement(this.domNode,node,_178c,this.aroundBox,_178f);
}else{
if(!_178d){
_178d="TL,TR,BL,BR";
}
dojo.html.placeOnScreen(this.domNode,x,y,_178c,true,_178d);
}
},close:function(force){
if(force){
this.domNode.style.display="none";
}
if(this.animationInProgress){
this.queueOnAnimationFinish.push(this.close,[]);
return;
}
this.closeSubpopup(force);
this.hide();
if(this.bgIframe){
this.bgIframe.hide();
this.bgIframe.size({left:0,top:0,width:0,height:0});
}
if(this.isTopLevel){
dojo.widget.PopupManager.closed(this);
}
this.isShowingNow=false;
if(this.parent){
setTimeout(dojo.lang.hitch(this,function(){
try{
if(this.parent["focus"]){
this.parent.focus();
}else{
this.parent.domNode.focus();
}
}
catch(e){
dojo.debug("No idea how to focus to parent",e);
}
}),10);
}
if(this._bookmark&&dojo.withGlobal(this.openedForWindow||dojo.global(),dojo.html.selection.isCollapsed)){
if(this.openedForWindow){
this.openedForWindow.focus();
}
try{
dojo.withGlobal(this.openedForWindow||dojo.global(),"moveToBookmark",dojo.html.selection,[this._bookmark]);
}
catch(e){
}
}
this._bookmark=null;
},closeAll:function(force){
if(this.parentPopup){
this.parentPopup.closeAll(force);
}else{
this.close(force);
}
},setOpenedSubpopup:function(popup){
this.currentSubpopup=popup;
},closeSubpopup:function(force){
if(this.currentSubpopup==null){
return;
}
this.currentSubpopup.close(force);
this.currentSubpopup=null;
},onShow:function(){
dojo.widget.PopupContainer.superclass.onShow.apply(this,arguments);
this.openedSize={w:this.domNode.style.width,h:this.domNode.style.height};
if(dojo.render.html.ie){
if(!this.bgIframe){
this.bgIframe=new dojo.html.BackgroundIframe();
this.bgIframe.setZIndex(this.domNode);
}
this.bgIframe.size(this.domNode);
this.bgIframe.show();
}
this.processQueue();
},processQueue:function(){
if(!this.queueOnAnimationFinish.length){
return;
}
var func=this.queueOnAnimationFinish.shift();
var args=this.queueOnAnimationFinish.shift();
func.apply(this,args);
},onHide:function(){
dojo.widget.HtmlWidget.prototype.onHide.call(this);
if(this.openedSize){
with(this.domNode.style){
width=this.openedSize.w;
height=this.openedSize.h;
}
}
this.processQueue();
}});
dojo.widget.defineWidget("dojo.widget.PopupContainer",[dojo.widget.HtmlWidget,dojo.widget.PopupContainerBase],{isContainer:true,fillInTemplate:function(){
this.applyPopupBasicStyle();
dojo.widget.PopupContainer.superclass.fillInTemplate.apply(this,arguments);
}});
dojo.widget.PopupManager=new function(){
this.currentMenu=null;
this.currentButton=null;
this.currentFocusMenu=null;
this.focusNode=null;
this.registeredWindows=[];
this.registerWin=function(win){
if(!win.__PopupManagerRegistered){
dojo.event.connect(win.document,"onmousedown",this,"onClick");
dojo.event.connect(win,"onscroll",this,"onClick");
dojo.event.connect(win.document,"onkey",this,"onKey");
win.__PopupManagerRegistered=true;
this.registeredWindows.push(win);
}
};
this.registerAllWindows=function(_1798){
if(!_1798){
_1798=dojo.html.getDocumentWindow(window.top&&window.top.document||window.document);
}
this.registerWin(_1798);
for(var i=0;i<_1798.frames.length;i++){
try{
var win=dojo.html.getDocumentWindow(_1798.frames[i].document);
if(win){
this.registerAllWindows(win);
}
}
catch(e){
}
}
};
this.unRegisterWin=function(win){
try{
if(win.__PopupManagerRegistered){
dojo.event.disconnect(win.document,"onmousedown",this,"onClick");
dojo.event.disconnect(win,"onscroll",this,"onClick");
dojo.event.disconnect(win.document,"onkey",this,"onKey");
win.__PopupManagerRegistered=false;
}
}
catch(e){
}
};
this.unRegisterAllWindows=function(){
for(var i=0;i<this.registeredWindows.length;++i){
this.unRegisterWin(this.registeredWindows[i]);
}
this.registeredWindows=[];
};
dojo.addOnLoad(this,"registerAllWindows");
dojo.addOnUnload(this,"unRegisterAllWindows");
this.closed=function(menu){
if(this.currentMenu==menu){
this.currentMenu=null;
this.currentButton=null;
this.currentFocusMenu=null;
}
};
this.opened=function(menu,_179f){
if(menu==this.currentMenu){
return;
}
if(this.currentMenu){
this.currentMenu.close();
}
this.currentMenu=menu;
this.currentFocusMenu=menu;
this.currentButton=_179f;
};
this.setFocusedMenu=function(menu){
this.currentFocusMenu=menu;
};
this.onKey=function(e){
if(!e.key){
return;
}
if(!this.currentMenu||!this.currentMenu.isShowingNow){
return;
}
var m=this.currentFocusMenu;
while(m){
if(m.processKey(e)){
e.preventDefault();
e.stopPropagation();
break;
}
m=m.parentPopup||m.parentMenu;
}
},this.onClick=function(e){
if(!this.currentMenu){
return;
}
var _17a4=dojo.html.getScroll().offset;
var m=this.currentMenu;
while(m){
if(dojo.html.overElement(m.domNode,e)||dojo.html.isDescendantOf(e.target,m.domNode)){
return;
}
m=m.currentSubpopup;
}
if(this.currentButton&&dojo.html.overElement(this.currentButton,e)){
return;
}
this.currentMenu.closeAll(true);
};
};
dojo.provide("qu.widget.DropDown");
dojo.require("dojo.widget.PopupContainer");
dojo.widget.defineWidget("qu.widget.DropDown",dojo.widget.HtmlWidget,{templateString:"<div class=\"quComboBox\">"+"<table style=\"border-collapse: collapse; width: 100%; height: 16px; margin: 0px; padding: 0px;\"><tr><td style=\"width: 100%;padding-top:0px;margin-top:0px;\"><div dojoAttachPoint=\"textNode\" class=\"text\" style=\"padding-top:0px;padding-left:2px;white-space:nowrap;height:14px;overflow:hidden;width:100%;\"></div></td>"+"<td style=\"width:16px;\"><div dojoAttachPoint=\"downArrowNode\" class=\"dropDown\" style=\"height:16px;width:16px;\"></div></td></tr></table>"+"</div>",templateCssString:".quComboBox {border: 1px solid #999999; height: 16px; overflow: hidden; background-color: white; width: 120px;}"+".quComboBox .text {width: 100px; cursor: pointer;}"+".quComboBox .dropDown { margin:0px; padding: 0px; background: transparent url(\"lib/qu/widget/templates/images/dropdown.gif\") no-repeat top right; cursor: pointer;}"+".quComboBoxPopupContainer {background-color: white;width: 100%;border: 1px solid #999999;\tmax-height: 200px; overflow: auto;}",quId:"",width:"",fillInTemplate:function(args,frag){
this.setPopupContainer(new dojo.widget.createWidget("PopupContainer"));
dojo.event.connectOnce(this,"destroy",this.getPopupContainer(),"destroy");
dojo.html.addClass(this.getPopupContainer().domNode,"quComboBoxPopupContainer");
dojo.event.connectOnce(this.domNode,"onclick",this,"popup");
if(this.width!=""){
this.setWidth(this.width);
}
this.initSubwidget();
},setFieldHeight:function(_17a8){
this.textNode.style.height=_17a8;
this.downArrowNode.style.height=_17a8;
},initSubwidget:function(){
},setSubwidget:function(_17a9){
this._subwidget=_17a9;
},getSubwidget:function(){
return this._subwidget;
},setPopupContainer:function(_17aa){
this._popupContainer=_17aa;
},getPopupContainer:function(){
return this._popupContainer;
},close:function(){
this.getPopupContainer().close();
this.onClose();
},open:function(){
var pos=dojo.html.getAbsolutePosition(this.domNode,true);
var _17ac=16;
var size=dojo.html.getContentBox(this.domNode);
this.getPopupContainer().domNode.style.width=size.width+"px";
this.getPopupContainer().open(pos.x-1,pos.y+_17ac,this.domNode,this);
this.onOpen();
},popup:function(){
if(this.getPopupContainer().isShowingNow){
this.close();
}else{
this.open();
}
},setWidth:function(_17ae){
this.domNode.style.width=_17ae;
},onOpen:function(){
},onClose:function(){
},onChange:function(){
},setCaption:function(_17af){
this.textNode.innerHTML=_17af;
this.domNode.title=_17af;
},getCaption:function(){
return this.textNode.innerHTML;
}});
dojo.provide("qu.widget.List");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("dojo.html.style");
dojo.require("dojo.dom");
dojo.require("dojo.collections.Dictionary");
dojo.widget.defineWidget("qu.widget.List",dojo.widget.HtmlWidget,function(){
this.options=new Array();
this._multiselect=false;
this.selection=new Object();
this.currentIndex=0;
this._model=new dojo.collections.Dictionary();
this._emptyKey=false;
},{namespace:"qu",widgetType:"List",isContainer:false,quId:"",multiselect:"",templateString:"<div class=\"quList\">"+"<div class=\"content\" dojoAttachPoint=\"contentNode\">"+"</div>"+"</div>",templateCssString:".quList {\tborder: none;}"+" .quList .content {\toverflow: auto;\tcursor: default;}"+" .quList .option {\tbackground-color: white;\tborder-bottom: 1px solid #DDDDDD;\t\tcursor: pointer;\tline-height: 1.4em;\tpadding-left: 2px;}"+" .quList .option:hover {\tbackground-color: #e0ecff;}"+" .quList .selected {\tbackground-color: #C3D9FF;\tcolor: #364157;\tborder-bottom: 1px solid white;\t}"+" .quList .nonselected {\tbackground-color: white;\tcolor: black;}"+" .quList .hover {\tbackground-color: #e0ecff;\t}"+" .quList .label {\tcursor: default;}",fillInTemplate:function(){
if(this.multiselect!=""){
switch(this.multiselect.toLowerCase()){
case "true":
this.setMultiselect(true);
break;
case "false":
this.setMultiselect(false);
break;
}
}
},add:function(_17b0,_17b1){
if(typeof (_17b1)==undefined){
_17b1=_17b0;
}
this.getModel().add(_17b0,_17b1);
this.currentIndex++;
var div=document.createElement("div");
div.className="option";
div.setAttribute("_value",_17b0);
var chck=document.createElement("input");
chck.setAttribute("type","checkbox");
if(!this.isMultiselect()){
chck.style.display="none";
}
var txt=document.createElement("span");
txt.innerHTML=_17b1;
div.appendChild(chck);
div.appendChild(txt);
var _17b5=new qu.widget.list.Option(_17b0,_17b1);
_17b5.setDomNode(div);
_17b5.setIndex(this.currentIndex);
this.options.push(_17b5);
if(!this.isMultiselect()&&this.options.length==1){
this.selectKey(_17b0);
}
dojo.event.connectOnce(div,"onclick",this,"onRowClick");
dojo.event.connectOnce(chck,"onclick",this,"onChildClick");
dojo.event.connectOnce(txt,"onclick",this,"onChildClick");
this.contentNode.appendChild(div);
},remove:function(_17b6){
var len=this.options.length;
for(var i;i>=len;i++){
if(this.options[i].getIndex()==_17b6){
this.contentNode.removeChild(this.options[i].getDomNode());
this.options[i].splice(i,1);
this.getModel().remove(this.options[i].getValue());
}
}
},removeAll:function(){
this.options=new Array();
this.currentIndex=0;
this.selection=new Object();
this.getModel().clear();
this.redraw();
},selectAll:function(){
var len=this.options.length;
this.selection=new Object();
var _17ba;
for(var i=0;i<len;i++){
_17ba=this.options[i];
_17ba.setSelected(true);
this.selection[_17ba.getValue()]=_17ba;
}
},deselectAll:function(){
var len=this.options.length;
this.selection=new Object();
var _17bd;
for(var i=0;i<len;i++){
_17bd=this.options[i];
_17bd.setSelected(false);
}
},selectKey:function(_17bf){
if(!this.isMultiselect()){
this.deselectAll();
}
var len=this.options.length;
var _17c1;
for(var i=0;i<len;i++){
_17c1=this.options[i];
if(dojo.lang.isArray(_17bf)&&this.isMultiselect()){
dojo.lang.forEach(_17bf,function(elm,key,arr){
if(_17c1.getValue()==elm){
_17c1.setSelected(true);
this.selection[elm]=_17c1;
}
},this);
}else{
if(_17c1.getValue()==_17bf){
_17c1.setSelected(true);
if(_17bf==""){
this._emptyKey=_17c1;
}else{
this.selection[_17c1.getValue()]=_17c1;
}
}
}
}
},onRowOver:function(_17c6){
var _17c7=_17c6.target;
if(_17c7.tagName.toLowerCase()!="div"){
_17c7=dojo.html.getParentByType(_17c7,"div");
}
this._getOptionByKey(_17c7.getAttribute("_value")).setHover(true);
},onRowOut:function(_17c8){
var _17c9=_17c8.target;
if(_17c9.tagName.toLowerCase()!="div"){
_17c9=dojo.html.getParentByType(_17c9,"div");
}
this._getOptionByKey(_17c9.getAttribute("_value")).setHover(false);
},onRowClick:function(_17ca){
var _17cb=_17ca.target;
this._onClick(_17cb);
},onChildClick:function(_17cc){
var _17cd=dojo.html.getParentByType(_17cc.target,"div");
this._onClick(_17cd);
},_onClick:function(_17ce){
var _17cf=_17ce;
var key=_17cf.getAttribute("_value");
var _17d1=this._getOptionByKey(key);
if(_17d1!==false){
if(this.isMultiselect()){
if(_17d1.isSelected()){
delete this.selection[key];
_17d1.setSelected(false);
}else{
this.selection[key]=_17d1;
_17d1.setSelected(true);
}
}else{
this.deselectAll();
this.selection[key]=_17d1;
_17d1.setSelected(true);
}
this.onChange();
}
},getSelection:function(){
return this.selection;
},getSelectedText:function(){
return this.getSelectedValues();
},getSelectedValues:function(){
var _17d2=new Array();
for(var each in this.selection){
_17d2.push(this.selection[each].getText());
}
if(_17d2.length==0&&this._emptyKey!==false){
_17d2.push(this._emptyKey.getText());
}
return _17d2;
},getSelectedKeys:function(){
var _17d4=new Array();
for(var each in this.selection){
_17d4.push(this.selection[each].getValue());
}
if(_17d4.length==0&&this._emptyKey!==false){
_17d4.push(this._emptyKey.getValue());
}
return _17d4;
},onChange:function(){
},_getOptionByKey:function(_17d6){
var l=this.options.length-1;
for(var i=0;i<=l;i++){
if(this.options[i].getValue()==_17d6){
return this.options[i];
}
}
return false;
},setSize:function(_17d9,_17da){
this.contentNode.style.width=_17d9+"px";
this.contentNode.style.height=_17da+"px";
},isMultiselect:function(){
return this._multiselect;
},setMultiselect:function(_17db){
if(_17db==this.isMultiselect()){
return;
}
this._multiselect=_17db;
this.deselectAll();
this.setCheckboxesVisible(_17db);
},setCheckboxesVisible:function(_17dc){
dojo.lang.forEach(this.options,function(_17dd){
dojo.dom.getFirstChildElement(_17dd.getDomNode(),"input").style.display=_17dc?"inline":"none";
});
},getModel:function(){
return this._model;
},setModel:function(_17de){
this._model=_17de;
this.redraw();
},redraw:function(){
this.contentNode.innerHTML="";
var _17df=this.getModel().getIterator();
var entry;
while(!_17df.atEnd()){
entry=_17df.get();
this.add(entry.key,entry.value);
}
this.onLoad();
},onLoad:function(){
},toString:function(){
return this.getSelectedValues();
}});
dojo.lang.declare("qu.widget.list.Option",null,function(_17e1,_17e2){
this._value=_17e1;
this._text=_17e2;
this._domNode=null;
this._isSelected=false;
this._index=null;
},{getValue:function(){
return this._value;
},getText:function(){
return this._text;
},setIndex:function(_17e3){
this._index=_17e3;
},getIndex:function(){
return this._index;
},getDomNode:function(){
return this._domNode;
},setDomNode:function(_17e4){
this._domNode=_17e4;
},isSelected:function(){
return this._isSelected;
},setSelected:function(_17e5){
this._isSelected=_17e5;
if(_17e5===true){
dojo.html.removeClass(this.getDomNode(),"nonselected");
dojo.html.addClass(this.getDomNode(),"selected");
this.getDomNode().getElementsByTagName("input")[0].checked=true;
return;
}
dojo.html.removeClass(this.getDomNode(),"selected");
dojo.html.addClass(this.getDomNode(),"nonselected");
this.getDomNode().getElementsByTagName("input")[0].checked=false;
},setHover:function(_17e6){
if(_17e6){
dojo.html.addClass(this.getDomNode(),"hover");
}else{
dojo.html.removeClass(this.getDomNode(),"hover");
}
}});
dojo.provide("qu.widget.ComboBox");
dojo.require("qu.widget.DropDown");
dojo.require("qu.widget.List");
dojo.require("qu.rpc.Model");
dojo.require("dojo.collections.Dictionary");
dojo.widget.defineWidget("qu.widget.ComboBox",qu.widget.DropDown,function(){
this._model=new qu.widget.comboBox.Model();
},{multiselect:"",none:"",initSubwidget:function(){
var _17e7=new dojo.widget.createWidget("qu:List");
dojo.event.connectOnce(_17e7,"onChange",this,"onChange");
this.setSubwidget(_17e7);
this.parseAttributes();
this.caption();
this.getPopupContainer().domNode.appendChild(this.getSubwidget().domNode);
},parseAttributes:function(){
if(this.multiselect!=""){
switch(this.multiselect.toLowerCase()){
case "true":
this.setMultiselect(true);
break;
case "false":
this.setMultiselect(false);
break;
}
}
if(this.none!=""){
this.setNoneCaption(this.none);
}
},setMultiselect:function(_17e8){
this.getSubwidget().setMultiselect(_17e8);
},onChange:function(){
if(!this.getSubwidget().isMultiselect()||this.getSubwidget().getModel().count==1){
this.close();
}
this.caption();
},caption:function(){
var _17e9=this.getSubwidget().toString().sort();
var _17ea=_17e9.length>0?_17e9.join(", "):"["+this.getNoneCaption()+"]";
this.setCaption(_17ea);
},setNoneCaption:function(_17eb){
this._noneCaption=_17eb;
},getNoneCaption:function(){
return this._noneCaption||this.getI18n("none");
},removeAll:function(){
this.deselectAll();
this.getSubwidget().removeAll();
},deselectAll:function(){
this.getSubwidget().deselectAll();
this.caption();
},add:function(inKey,_17ed){
this.getSubwidget().add(inKey,_17ed);
},load:function(){
this.setCaption("["+this.getI18n("loading")+"]");
dojo.event.connectOnce(this.getModel(),"onGetDataSuccess",this,"onLoad");
dojo.event.connectOnce(this.getModel(),"onGetDataFail",function(_17ee){
dojo.debug(_17ee);
});
this.deselectAll();
this.getModel().getData();
},getI18n:function(inKey){
if(typeof app!="undefined"&&typeof app.i18n!="undefined"){
return app.i18n.get(inKey);
}
return inKey;
},onLoad:function(){
this.caption();
this.getSubwidget().setModel(this.rs2Dictionary());
},rs2Dictionary:function(){
var rs=this.getModel().getResultSet();
var dc=new dojo.collections.Dictionary();
var key=this.getModel().getKey();
var value=this.getModel().getValue();
rs.beforeFirst();
while(rs.next()){
dc.add(rs.get(key).valueOf(),rs.get(value).valueOf());
}
return dc;
},getModel:function(){
return this._model;
},setModel:function(_17f4){
this._model=_17f4;
},select:function(inKey){
this.getSubwidget().selectKey(inKey);
this.caption();
},getSelection:function(){
return this.getSubwidget().getSelectedKeys();
},getSelectedText:function(){
return this.getSubwidget().getSelectedText();
}});
dojo.lang.declare("qu.widget.comboBox.Model",qu.rpc.Model,function(inKey,_17f7){
this._key=inKey||false;
this._value=_17f7||false;
},{setKey:function(inKey){
this._key=inKey;
},setValue:function(_17f9){
this._value=_17f9;
},getKey:function(){
return this._key;
},getValue:function(){
return this._value;
}});
dojo.provide("qu.widget.Button");
dojo.require("dojo.widget.HtmlWidget");
dojo.widget.defineWidget("qu.widget.Button",dojo.widget.HtmlWidget,{namespace:"qu",widgetType:"Button",isContainer:false,quId:"",templateString:"<span class=\"quButton\" dojoAttachEvent=\"onmouseover:onMouseOver;onmouseout:onMouseOut;onclick:onClick;\">"+"<img dojoAttachPoint=\"iconNode\" class=\"icon\" style=\"display:none;\" />"+"<span dojoAttachPoint=\"captionNode\" class=\"caption\"></span>"+"</span>",templateCssString:".quButton {cursor: pointer;\tborder: 1px solid transparent;\t_border: none;\tpadding: 4px;}"+" .quButtonHover {\tborder: 1px solid #364157;\t_border: none;}"+" .quButtonChecked {\tborder: 1px solid #364157;\t_border: none;\tbackground-color: white;}"+" .quButton .icon {\tvertical-align: middle;}"+" .quButton .caption {\tcolor: #364157;\tfont-weight: bolder;\tpadding-left: 4px;}",caption:"",icon:"",tooltip:"",radio:"",checked:"",fillInTemplate:function(){
this.captionNode.innerHTML=this.caption;
if(this.icon!=""){
this.iconNode.src=qu.global.icon(this.icon+".png",16);
this.iconNode.style.display="inline";
}
if(this.tooltip!=""){
this.domNode.title=this.tooltip;
}
if(this.radio=="true"){
this.setRadio(true);
if(this.checked=="true"||this.checked==true){
this.setChecked(true);
}else{
this.setChecked(false);
}
}else{
this.setRadio(false);
}
},onMouseOver:function(){
dojo.html.addClass(this.domNode,"quButtonHover");
},onMouseOut:function(){
dojo.html.removeClass(this.domNode,"quButtonHover");
},onClick:function(){
if(this.isRadio()){
this.setChecked(!this.isChecked());
}
},isChecked:function(){
return this._checked;
},setChecked:function(_17fa){
this._checked=_17fa;
if(_17fa){
dojo.html.addClass(this.domNode,"quButtonChecked");
}else{
dojo.html.removeClass(this.domNode,"quButtonChecked");
}
},setRadio:function(_17fb){
this._radio=_17fb;
},isRadio:function(){
return this._radio;
},setCaption:function(_17fc){
this.captionNode.innerHTML=_17fc;
},getCaption:function(){
return this.captionNode.innerHTML;
}});
dojo.provide("dojo.widget.html.stabile");
dojo.widget.html.stabile={_sqQuotables:new RegExp("([\\\\'])","g"),_depth:0,_recur:false,depthLimit:2};
dojo.widget.html.stabile.getState=function(id){
dojo.widget.html.stabile.setup();
return dojo.widget.html.stabile.widgetState[id];
};
dojo.widget.html.stabile.setState=function(id,state,_1800){
dojo.widget.html.stabile.setup();
dojo.widget.html.stabile.widgetState[id]=state;
if(_1800){
dojo.widget.html.stabile.commit(dojo.widget.html.stabile.widgetState);
}
};
dojo.widget.html.stabile.setup=function(){
if(!dojo.widget.html.stabile.widgetState){
var text=dojo.widget.html.stabile._getStorage().value;
dojo.widget.html.stabile.widgetState=text?dj_eval("("+text+")"):{};
}
};
dojo.widget.html.stabile.commit=function(state){
dojo.widget.html.stabile._getStorage().value=dojo.widget.html.stabile.description(state);
};
dojo.widget.html.stabile.description=function(v,_1804){
var depth=dojo.widget.html.stabile._depth;
var _1806=function(){
return this.description(this,true);
};
try{
if(v===void (0)){
return "undefined";
}
if(v===null){
return "null";
}
if(typeof (v)=="boolean"||typeof (v)=="number"||v instanceof Boolean||v instanceof Number){
return v.toString();
}
if(typeof (v)=="string"||v instanceof String){
var v1=v.replace(dojo.widget.html.stabile._sqQuotables,"\\$1");
v1=v1.replace(/\n/g,"\\n");
v1=v1.replace(/\r/g,"\\r");
return "'"+v1+"'";
}
if(v instanceof Date){
return "new Date("+d.getFullYear+","+d.getMonth()+","+d.getDate()+")";
}
var d;
if(v instanceof Array||v.push){
if(depth>=dojo.widget.html.stabile.depthLimit){
return "[ ... ]";
}
d="[";
var first=true;
dojo.widget.html.stabile._depth++;
for(var i=0;i<v.length;i++){
if(first){
first=false;
}else{
d+=",";
}
d+=arguments.callee(v[i],_1804);
}
return d+"]";
}
if(v.constructor==Object||v.toString==_1806){
if(depth>=dojo.widget.html.stabile.depthLimit){
return "{ ... }";
}
if(typeof (v.hasOwnProperty)!="function"&&v.prototype){
throw new Error("description: "+v+" not supported by script engine");
}
var first=true;
d="{";
dojo.widget.html.stabile._depth++;
for(var key in v){
if(v[key]==void (0)||typeof (v[key])=="function"){
continue;
}
if(first){
first=false;
}else{
d+=", ";
}
var kd=key;
if(!kd.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)){
kd=arguments.callee(key,_1804);
}
d+=kd+": "+arguments.callee(v[key],_1804);
}
return d+"}";
}
if(_1804){
if(dojo.widget.html.stabile._recur){
var _180d=Object.prototype.toString;
return _180d.apply(v,[]);
}else{
dojo.widget.html.stabile._recur=true;
return v.toString();
}
}else{
throw new Error("Unknown type: "+v);
return "'unknown'";
}
}
finally{
dojo.widget.html.stabile._depth=depth;
}
};
dojo.widget.html.stabile._getStorage=function(){
if(dojo.widget.html.stabile.dataField){
return dojo.widget.html.stabile.dataField;
}
var form=document.forms._dojo_form;
return dojo.widget.html.stabile.dataField=form?form.stabile:{value:""};
};
dojo.provide("qu.widget.AutoComplete");
dojo.require("dojo.widget.*");
dojo.require("dojo.event.*");
dojo.require("dojo.io.*");
dojo.require("dojo.html.*");
dojo.require("dojo.string");
dojo.require("dojo.widget.html.stabile");
dojo.require("dojo.widget.PopupContainer");
dojo.widget.defineWidget("qu.widget.AutoComplete",dojo.widget.HtmlWidget,{forceValidOption:false,searchType:"stringstart",caseSensitive:false,model:null,autoComplete:false,searchDelay:300,fadeTime:200,maxListLength:8,selectedResult:null,dropdownToggle:"fade",templateString:"<span _=\"whitespace and CR's between tags adds &nbsp; in FF\" class=\"dojoComboBoxOuter\">"+"<input style=\"display:none\"  tabindex=\"-1\" name=\"\" value=\"\" dojoAttachPoint=\"comboBoxValue\">"+"<input style=\"display:none\"  tabindex=\"-1\" name=\"\" value=\"\" dojoAttachPoint=\"comboBoxSelectionValue\">"+"<input type=\"text\" autocomplete=\"off\" class=\"quAutoComplete\" dojoAttachEvent=\"key:_handleKeyEvents; keyUp: onKeyUp; compositionEnd; onResize;\" dojoAttachPoint=\"textInputNode\">"+"</span>",templateCssString:".dojoComboBoxOuter {border: 0px !important; margin: 0px !important; padding: 0px !important; background: transparent !important; white-space: nowrap !important;} "+".dojoComboBox {border: 1px inset #afafaf;margin: 0px;padding: 0px;vertical-align: middle !important;float: none !important;position: static !important;display: inline !important;} "+"input.dojoComboBox {border-right-width: 0px !important;margin-right: 0px !important;padding-right: 0px !important;}"+".dojoComboBoxOptions {font-family: Verdana, Helvetica, Garamond, sans-serif;background-color: white;border: 1px solid #afafaf;position: absolute;z-index: 1000; overflow: auto;cursor: default;}"+".dojoComboBoxItem {padding-left: 2px;padding-top: 2px;margin: 0px;}"+".dojoComboBoxItemEven {background-color: #f4f4f4;}"+".dojoComboBoxItemOdd {background-color: white;}"+".dojoComboBoxItemHighlight {background-color: #63709A;color: white;}",valueSeparator:false,valueSeparatorJoin:", ",quId:"",id:"",focus:function(){
},setModel:function(_180f){
this.model=_180f;
},getModel:function(){
if(this.model==null){
this.setModel(new qu.widget.autocomplete.Model());
}
return this.model;
},setValue:function(value){
this.comboBoxValue.value=value;
if(this.textInputNode.value!=value){
this.textInputNode.value=value;
dojo.widget.html.stabile.setState(this.widgetId,this.getState(),true);
this.onValueChanged(value);
}
},onValueChanged:function(value){
},getValue:function(){
return this.comboBoxValue.value;
},getState:function(){
return {value:this.getValue()};
},setState:function(state){
this.setValue(state.value);
},enable:function(){
this.disabled=false;
this.textInputNode.removeAttribute("disabled");
},disable:function(){
this.disabled=true;
this.textInputNode.setAttribute("disabled",true);
},_getCaretPos:function(_1813){
if(dojo.lang.isNumber(_1813.selectionStart)){
return _1813.selectionStart;
}else{
if(dojo.render.html.ie){
try{
var oSel=document.selection.createRange().duplicate();
oSel.moveStart("character",-_1813.value.length);
iCaretPos=oSel.text.length;
return iCaretPos;
}
catch(e){
}
var tr=document.selection.createRange().duplicate();
var ntr=_1813.createTextRange();
tr.move("character",0);
ntr.move("character",0);
try{
ntr.setEndPoint("EndToEnd",tr);
return String(ntr.text).replace(/\r/g,"").length;
}
catch(e){
return 0;
}
}
}
},_setCaretPos:function(_1817,_1818){
_1818=parseInt(_1818);
this._setSelectedRange(_1817,_1818,_1818);
},_setSelectedRange:function(_1819,start,end){
if(!end){
end=_1819.value.length;
}
if(_1819.setSelectionRange){
_1819.focus();
_1819.setSelectionRange(start,end);
}else{
if(_1819.createTextRange){
var range=_1819.createTextRange();
with(range){
collapse(true);
moveEnd("character",end);
moveStart("character",start);
select();
}
}else{
_1819.value=_1819.value;
_1819.blur();
_1819.focus();
var dist=parseInt(_1819.value.length)-end;
var tchar=String.fromCharCode(37);
var tcc=tchar.charCodeAt(0);
for(var x=0;x<dist;x++){
var te=document.createEvent("KeyEvents");
te.initKeyEvent("keypress",true,true,null,false,false,false,false,tcc,tcc);
_1819.dispatchEvent(te);
}
}
}
},_handleKeyEvents:function(evt){
if(evt.ctrlKey||evt.altKey||!evt.key){
return;
}
this._prev_key_backspace=false;
this._prev_key_esc=false;
var k=dojo.event.browser.keys;
var _1824=true;
switch(evt.key){
case k.KEY_DOWN_ARROW:
if(!this.popupWidget.isShowingNow){
this._startSearchFromInput();
}
this._highlightNextOption();
dojo.event.browser.stopEvent(evt);
return;
case k.KEY_UP_ARROW:
this._highlightPrevOption();
dojo.event.browser.stopEvent(evt);
return;
case k.KEY_TAB:
if(!this.autoComplete&&this.popupWidget.isShowingNow&&this._highlighted_option){
dojo.event.browser.stopEvent(evt);
this._selectOption({"target":this._highlighted_option,"noHide":false});
this._setSelectedRange(this.textInputNode,this.textInputNode.value.length,null);
}else{
this._selectOption();
return;
}
break;
case k.KEY_ENTER:
if(this.popupWidget.isShowingNow){
dojo.event.browser.stopEvent(evt);
}
if(this.autoComplete){
this._selectOption();
return;
}
case " ":
if(this.popupWidget.isShowingNow&&this._highlighted_option){
dojo.event.browser.stopEvent(evt);
this._selectOption();
this._hideResultList();
return;
}
break;
case k.KEY_ESCAPE:
this._hideResultList();
this._prev_key_esc=true;
return;
case k.KEY_BACKSPACE:
this._prev_key_backspace=true;
if(!this.textInputNode.value.length){
this.setAllValues("","");
this._hideResultList();
_1824=false;
}
break;
case k.KEY_RIGHT_ARROW:
case k.KEY_LEFT_ARROW:
_1824=false;
break;
default:
if(evt.charCode==0){
_1824=false;
}
}
if(this.searchTimer){
clearTimeout(this.searchTimer);
}
if(_1824){
this._blurOptionNode();
this.searchTimer=setTimeout(dojo.lang.hitch(this,this._startSearchFromInput),this.searchDelay);
}
},compositionEnd:function(evt){
evt.key=evt.keyCode;
this._handleKeyEvents(evt);
},onKeyUp:function(evt){
this.setValue(this.textInputNode.value);
},setSelectedValue:function(value){
this.comboBoxSelectionValue.value=value;
},setAllValues:function(_1828,_1829){
if(this.valueSeparator!==false){
var _182a=this.getValue().split(this.valueSeparator);
if(_182a.length>0){
var _182b=this.getValue().substring(0,this._getCaretPos(this.textInputNode)).split(this.valueSeparator);
_182a[_182b.length-1]=_1828;
for(var i=0;i<_182a.length;i++){
_182a[i]=dojo.string.trim(_182a[i]);
}
_1828=_182a.join(this.valueSeparatorJoin);
}
}
this.setSelectedValue(_1829);
this.setValue(_1828);
},_focusOptionNode:function(node){
if(this._highlighted_option!=node){
this._blurOptionNode();
this._highlighted_option=node;
dojo.html.addClass(this._highlighted_option,"dojoComboBoxItemHighlight");
}
},_blurOptionNode:function(){
if(this._highlighted_option){
dojo.html.removeClass(this._highlighted_option,"dojoComboBoxItemHighlight");
this._highlighted_option=null;
}
},_highlightNextOption:function(){
if((!this._highlighted_option)||!this._highlighted_option.parentNode){
this._focusOptionNode(this.optionsListNode.firstChild);
}else{
if(this._highlighted_option.nextSibling){
this._focusOptionNode(this._highlighted_option.nextSibling);
}
}
dojo.html.scrollIntoView(this._highlighted_option);
},_highlightPrevOption:function(){
if(this._highlighted_option&&this._highlighted_option.previousSibling){
this._focusOptionNode(this._highlighted_option.previousSibling);
}else{
this._highlighted_option=null;
this._hideResultList();
return;
}
dojo.html.scrollIntoView(this._highlighted_option);
},_itemMouseOver:function(evt){
if(evt.target===this.optionsListNode){
return;
}
this._focusOptionNode(evt.target);
dojo.html.addClass(this._highlighted_option,"dojoComboBoxItemHighlight");
},_itemMouseOut:function(evt){
if(evt.target===this.optionsListNode){
return;
}
this._blurOptionNode();
},onResize:function(){
var _1830=dojo.html.getContentBox(this.textInputNode);
if(_1830.height<=0){
return;
}
},fillInTemplate:function(args,frag){
dojo.html.applyBrowserClass(this.domNode);
var _1833=this.getFragNodeRef(frag);
if(!this.name&&_1833.name){
this.name=_1833.name;
}
this.comboBoxValue.name=this.name;
this.comboBoxSelectionValue.name=this.name+"_selected";
dojo.html.copyStyle(this.domNode,_1833);
dojo.html.copyStyle(this.textInputNode,_1833);
this.textInputNode.setAttribute("id",this.id);
this.popupWidget=new dojo.widget.createWidget("PopupContainer",{toggle:this.dropdownToggle,toggleDuration:this.toggleDuration});
dojo.event.connect(this,"destroy",this.popupWidget,"destroy");
this.optionsListNode=this.popupWidget.domNode;
this.domNode.appendChild(this.optionsListNode);
dojo.html.addClass(this.optionsListNode,"dojoComboBoxOptions");
dojo.event.connect(this.optionsListNode,"onclick",this,"_selectOption");
dojo.event.connect(this.optionsListNode,"onmouseover",this,"_onMouseOver");
dojo.event.connect(this.optionsListNode,"onmouseout",this,"_onMouseOut");
dojo.event.connect(this.optionsListNode,"onmouseover",this,"_itemMouseOver");
dojo.event.connect(this.optionsListNode,"onmouseout",this,"_itemMouseOut");
},_openResultList:function(_1834){
if(this.disabled){
return;
}
this._clearResultList();
if(!_1834.first()){
this._hideResultList();
}
var key=this.getModel().getKey();
var value=this.getModel().getValue();
if((this.autoComplete)&&(_1834.first())&&(!this._prev_key_backspace)&&(this.textInputNode.value.length>0)){
var cpos=this._getCaretPos(this.textInputNode);
if((cpos+1)>this.textInputNode.value.length){
this.textInputNode.value+=_1834.get(value).substr(cpos);
this._setSelectedRange(this.textInputNode,cpos,this.textInputNode.value.length);
}
}
var even=true;
_1834.beforeFirst();
while(_1834.next()){
var td=document.createElement("div");
td.appendChild(document.createTextNode(_1834.get(value).valueOf()));
td.setAttribute("resultName",_1834.get(key).valueOf());
td.setAttribute("resultValue",_1834.get(value).valueOf());
td.className="dojoComboBoxItem "+((even)?"dojoComboBoxItemEven":"dojoComboBoxItemOdd");
even=(!even);
this.optionsListNode.appendChild(td);
}
this._showResultList();
},_onFocusInput:function(){
this._hasFocus=true;
},_onBlurInput:function(){
this._hasFocus=false;
this._handleBlurTimer(true,500);
},_handleBlurTimer:function(clear,_183b){
if(this.blurTimer&&(clear||_183b)){
clearTimeout(this.blurTimer);
}
if(_183b){
this.blurTimer=dojo.lang.setTimeout(this,"_checkBlurred",_183b);
}
},_onMouseOver:function(evt){
if(!this._mouseover_list){
this._handleBlurTimer(true,0);
this._mouseover_list=true;
}
},_onMouseOut:function(evt){
var _183e=evt.relatedTarget;
try{
if(!_183e||_183e.parentNode!=this.optionsListNode){
this._mouseover_list=false;
this._handleBlurTimer(true,100);
this._tryFocus();
}
}
catch(e){
}
},_isInputEqualToResult:function(_183f){
var input=this.textInputNode.value;
if(!this.caseSensitive){
input=input.toLowerCase();
_183f=_183f.toLowerCase();
}
return (input==_183f);
},_isValidOption:function(){
var tgt=dojo.html.firstElement(this.optionsListNode);
var _1842=false;
while(!_1842&&tgt){
if(this._isInputEqualToResult(tgt.getAttribute("resultName"))){
_1842=true;
}else{
tgt=dojo.html.nextElement(tgt);
}
}
return _1842;
},_checkBlurred:function(){
if(!this._hasFocus&&!this._mouseover_list){
this._hideResultList();
if(!this.textInputNode.value.length){
this.setAllValues("","");
return;
}
var _1843=this._isValidOption();
if(this.forceValidOption&&!_1843){
this.setAllValues("","");
return;
}
if(!_1843){
this.setSelectedValue("");
}
}
},_selectOption:function(evt){
var tgt=null;
if(!evt){
evt={target:this._highlighted_option};
}
if(!dojo.html.isDescendantOf(evt.target,this.optionsListNode)){
if(!this.textInputNode.value.length){
return;
}
tgt=dojo.html.firstElement(this.optionsListNode);
if(!tgt||!this._isInputEqualToResult(tgt.getAttribute("resultName"))){
return;
}
}else{
tgt=evt.target;
}
while((tgt.nodeType!=1)||(!tgt.getAttribute("resultName"))){
tgt=tgt.parentNode;
if(tgt===dojo.body()){
return false;
}
}
this.selectedResult=[tgt.getAttribute("resultName"),tgt.getAttribute("resultValue")];
this.setAllValues(tgt.getAttribute("resultName"),tgt.getAttribute("resultValue"));
if(!evt.noHide){
this._hideResultList();
}
this._tryFocus();
},_clearResultList:function(){
if(this.optionsListNode.innerHTML){
this.optionsListNode.innerHTML="";
}
},_hideResultList:function(){
this.popupWidget.close();
},_showResultList:function(){
var _1846=this.optionsListNode.childNodes;
if(_1846.length){
var _1847=Math.min(_1846.length,this.maxListLength);
with(this.optionsListNode.style){
display="";
if(_1847==_1846.length){
height="";
}else{
height=_1847*dojo.html.getMarginBox(_1846[0]).height+"px";
}
width=(dojo.html.getMarginBox(this.domNode).width-2)+"px";
}
this.popupWidget.open(this.domNode,this);
}else{
this._hideResultList();
}
},_tryFocus:function(){
try{
this.textInputNode.focus();
}
catch(e){
}
},_startSearchFromInput:function(){
var key=this.textInputNode.value;
if(this.valueSeparator!==false){
var _1849=key.split(this.valueSeparator);
var _184a=this.getValue().substring(0,this._getCaretPos(this.textInputNode)).split(this.valueSeparator);
key=_1849[_184a.length-1];
key=dojo.string.trim(key);
}
this._startSearch(key);
},_startSearch:function(key){
if(key.length>0){
this.getModel().getData(key,this,"_openResultList",null);
}
},setValueSeparator:function(_184c){
this.valueSeparator=_184c;
},postCreate:function(){
this.onResize();
dojo.event.connect(this.textInputNode,"onblur",this,"_onBlurInput");
dojo.event.connect(this.textInputNode,"onfocus",this,"_onFocusInput");
if(this.disabled){
this.disable();
}
var s=dojo.widget.html.stabile.getState(this.widgetId);
if(s){
this.setState(s);
}
}});
dojo.lang.declare("qu.widget.autocomplete.Model",qu.rpc.Model,function(){
this.service=null;
this.methodName="";
this.defaultParams=null;
this.resultSet=null;
this._key="";
this._value="";
this._search_key="search_string";
},{setSearchKey:function(inKey){
this._search_key=inKey;
},getSearchKey:function(_184f){
return this._search_key;
},setKey:function(inKey){
this._key=inKey;
},setValue:function(_1851){
this._value=_1851;
},getKey:function(){
return this._key;
},getValue:function(){
return this._value;
},getData:function(key,obj,_1854,_1855){
var _1856=this.getService();
var _1857=this.getDefaultParams();
_1857[this.getSearchKey()]=key;
var def=_1856[this.getMethod()](_1857);
def.addCallback(dojo.lang.hitch(obj,_1854));
if(_1855!=null){
def.addErrback(dojo.lang.hitch(obj,_1855));
}
return def;
}});
dojo.provide("3rd.jscalendar.calendar");
Calendar=function(_1859,_185a,_185b,_185c){
this.activeDiv=null;
this.currentDateEl=null;
this.getDateStatus=null;
this.getDateToolTip=null;
this.getDateText=null;
this.timeout=null;
this.onSelected=_185b||null;
this.onClose=_185c||null;
this.dragging=false;
this.hidden=false;
this.minYear=1970;
this.maxYear=2050;
this.dateFormat=Calendar._TT["DEF_DATE_FORMAT"];
this.ttDateFormat=Calendar._TT["TT_DATE_FORMAT"];
this.isPopup=true;
this.weekNumbers=true;
this.firstDayOfWeek=typeof _1859=="number"?_1859:Calendar._FD;
this.showsOtherMonths=false;
this.dateStr=_185a;
this.ar_days=null;
this.showsTime=false;
this.time24=true;
this.yearStep=2;
this.hiliteToday=true;
this.multiple=null;
this.table=null;
this.element=null;
this.tbody=null;
this.firstdayname=null;
this.monthsCombo=null;
this.yearsCombo=null;
this.hilitedMonth=null;
this.activeMonth=null;
this.hilitedYear=null;
this.activeYear=null;
this.dateClicked=false;
if(typeof Calendar._SDN=="undefined"){
if(typeof Calendar._SDN_len=="undefined"){
Calendar._SDN_len=3;
}
var ar=new Array();
for(var i=8;i>0;){
ar[--i]=Calendar._DN[i].substr(0,Calendar._SDN_len);
}
Calendar._SDN=ar;
if(typeof Calendar._SMN_len=="undefined"){
Calendar._SMN_len=3;
}
ar=new Array();
for(var i=12;i>0;){
ar[--i]=Calendar._MN[i].substr(0,Calendar._SMN_len);
}
Calendar._SMN=ar;
}
};
Calendar._C=null;
Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));
Calendar.is_ie5=(Calendar.is_ie&&/msie 5\.0/i.test(navigator.userAgent));
Calendar.is_opera=/opera/i.test(navigator.userAgent);
Calendar.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);
Calendar.getAbsolutePos=function(el){
var SL=0,ST=0;
var _1862=/^div$/i.test(el.tagName);
if(_1862&&el.scrollLeft){
SL=el.scrollLeft;
}
if(_1862&&el.scrollTop){
ST=el.scrollTop;
}
var r={x:el.offsetLeft-SL,y:el.offsetTop-ST};
if(el.offsetParent){
var tmp=this.getAbsolutePos(el.offsetParent);
r.x+=tmp.x;
r.y+=tmp.y;
}
return r;
};
Calendar.isRelated=function(el,evt){
var _1867=evt.relatedTarget;
if(!_1867){
var type=evt.type;
if(type=="mouseover"){
_1867=evt.fromElement;
}else{
if(type=="mouseout"){
_1867=evt.toElement;
}
}
}
while(_1867){
if(_1867==el){
return true;
}
_1867=_1867.parentNode;
}
return false;
};
Calendar.removeClass=function(el,_186a){
if(!(el&&el.className)){
return;
}
var cls=el.className.split(" ");
var ar=new Array();
for(var i=cls.length;i>0;){
if(cls[--i]!=_186a){
ar[ar.length]=cls[i];
}
}
el.className=ar.join(" ");
};
Calendar.addClass=function(el,_186f){
Calendar.removeClass(el,_186f);
el.className+=" "+_186f;
};
Calendar.getElement=function(ev){
var f=Calendar.is_ie?window.event.srcElement:ev.currentTarget;
while(f.nodeType!=1||/^div$/i.test(f.tagName)){
f=f.parentNode;
}
return f;
};
Calendar.getTargetElement=function(ev){
var f=Calendar.is_ie?window.event.srcElement:ev.target;
while(f.nodeType!=1){
f=f.parentNode;
}
return f;
};
Calendar.stopEvent=function(ev){
ev||(ev=window.event);
if(Calendar.is_ie){
ev.cancelBubble=true;
ev.returnValue=false;
}else{
ev.preventDefault();
ev.stopPropagation();
}
return false;
};
Calendar.addEvent=function(el,_1876,func){
if(el.attachEvent){
el.attachEvent("on"+_1876,func);
}else{
if(el.addEventListener){
el.addEventListener(_1876,func,true);
}else{
el["on"+_1876]=func;
}
}
};
Calendar.removeEvent=function(el,_1879,func){
if(el.detachEvent){
el.detachEvent("on"+_1879,func);
}else{
if(el.removeEventListener){
el.removeEventListener(_1879,func,true);
}else{
el["on"+_1879]=null;
}
}
};
Calendar.createElement=function(type,_187c){
var el=null;
if(document.createElementNS){
el=document.createElementNS("http://www.w3.org/1999/xhtml",type);
}else{
el=document.createElement(type);
}
if(typeof _187c!="undefined"){
_187c.appendChild(el);
}
return el;
};
Calendar._add_evs=function(el){
with(Calendar){
addEvent(el,"mouseover",dayMouseOver);
addEvent(el,"mousedown",dayMouseDown);
addEvent(el,"mouseout",dayMouseOut);
if(is_ie){
addEvent(el,"dblclick",dayMouseDblClick);
el.setAttribute("unselectable",true);
}
}
};
Calendar.findMonth=function(el){
if(typeof el.month!="undefined"){
return el;
}else{
if(typeof el.parentNode.month!="undefined"){
return el.parentNode;
}
}
return null;
};
Calendar.findYear=function(el){
if(typeof el.year!="undefined"){
return el;
}else{
if(typeof el.parentNode.year!="undefined"){
return el.parentNode;
}
}
return null;
};
Calendar.showMonthsCombo=function(){
var cal=Calendar._C;
if(!cal){
return false;
}
var cal=cal;
var cd=cal.activeDiv;
var mc=cal.monthsCombo;
if(cal.hilitedMonth){
Calendar.removeClass(cal.hilitedMonth,"hilite");
}
if(cal.activeMonth){
Calendar.removeClass(cal.activeMonth,"active");
}
var mon=cal.monthsCombo.getElementsByTagName("div")[cal.date.getMonth()];
Calendar.addClass(mon,"active");
cal.activeMonth=mon;
var s=mc.style;
s.display="block";
if(cd.navtype<0){
s.left=cd.offsetLeft+"px";
}else{
var mcw=mc.offsetWidth;
if(typeof mcw=="undefined"){
mcw=50;
}
s.left=(cd.offsetLeft+cd.offsetWidth-mcw)+"px";
}
s.top=(cd.offsetTop+cd.offsetHeight)+"px";
};
Calendar.showYearsCombo=function(fwd){
var cal=Calendar._C;
if(!cal){
return false;
}
var cal=cal;
var cd=cal.activeDiv;
var yc=cal.yearsCombo;
if(cal.hilitedYear){
Calendar.removeClass(cal.hilitedYear,"hilite");
}
if(cal.activeYear){
Calendar.removeClass(cal.activeYear,"active");
}
cal.activeYear=null;
var Y=cal.date.getFullYear()+(fwd?1:-1);
var yr=yc.firstChild;
var show=false;
for(var i=12;i>0;--i){
if(Y>=cal.minYear&&Y<=cal.maxYear){
yr.innerHTML=Y;
yr.year=Y;
yr.style.display="block";
show=true;
}else{
yr.style.display="none";
}
yr=yr.nextSibling;
Y+=fwd?cal.yearStep:-cal.yearStep;
}
if(show){
var s=yc.style;
s.display="block";
if(cd.navtype<0){
s.left=cd.offsetLeft+"px";
}else{
var ycw=yc.offsetWidth;
if(typeof ycw=="undefined"){
ycw=50;
}
s.left=(cd.offsetLeft+cd.offsetWidth-ycw)+"px";
}
s.top=(cd.offsetTop+cd.offsetHeight)+"px";
}
};
Calendar.tableMouseUp=function(ev){
var cal=Calendar._C;
if(!cal){
return false;
}
if(cal.timeout){
clearTimeout(cal.timeout);
}
var el=cal.activeDiv;
if(!el){
return false;
}
var _1894=Calendar.getTargetElement(ev);
ev||(ev=window.event);
Calendar.removeClass(el,"active");
if(_1894==el||_1894.parentNode==el){
Calendar.cellClick(el,ev);
}
var mon=Calendar.findMonth(_1894);
var date=null;
if(mon){
date=new Date(cal.date);
if(mon.month!=date.getMonth()){
date.setMonth(mon.month);
cal.setDate(date);
cal.dateClicked=false;
cal.callHandler();
}
}else{
var year=Calendar.findYear(_1894);
if(year){
date=new Date(cal.date);
if(year.year!=date.getFullYear()){
date.setFullYear(year.year);
cal.setDate(date);
cal.dateClicked=false;
cal.callHandler();
}
}
}
with(Calendar){
removeEvent(document,"mouseup",tableMouseUp);
removeEvent(document,"mouseover",tableMouseOver);
removeEvent(document,"mousemove",tableMouseOver);
cal._hideCombos();
_C=null;
return stopEvent(ev);
}
};
Calendar.tableMouseOver=function(ev){
var cal=Calendar._C;
if(!cal){
return;
}
var el=cal.activeDiv;
var _189b=Calendar.getTargetElement(ev);
if(_189b==el||_189b.parentNode==el){
Calendar.addClass(el,"hilite active");
Calendar.addClass(el.parentNode,"rowhilite");
}else{
if(typeof el.navtype=="undefined"||(el.navtype!=50&&(el.navtype==0||Math.abs(el.navtype)>2))){
Calendar.removeClass(el,"active");
}
Calendar.removeClass(el,"hilite");
Calendar.removeClass(el.parentNode,"rowhilite");
}
ev||(ev=window.event);
if(el.navtype==50&&_189b!=el){
var pos=Calendar.getAbsolutePos(el);
var w=el.offsetWidth;
var x=ev.clientX;
var dx;
var _18a0=true;
if(x>pos.x+w){
dx=x-pos.x-w;
_18a0=false;
}else{
dx=pos.x-x;
}
if(dx<0){
dx=0;
}
var range=el._range;
var _18a2=el._current;
var count=Math.floor(dx/10)%range.length;
for(var i=range.length;--i>=0;){
if(range[i]==_18a2){
break;
}
}
while(count-->0){
if(_18a0){
if(--i<0){
i=range.length-1;
}
}else{
if(++i>=range.length){
i=0;
}
}
}
var _18a5=range[i];
el.innerHTML=_18a5;
cal.onUpdateTime();
}
var mon=Calendar.findMonth(_189b);
if(mon){
if(mon.month!=cal.date.getMonth()){
if(cal.hilitedMonth){
Calendar.removeClass(cal.hilitedMonth,"hilite");
}
Calendar.addClass(mon,"hilite");
cal.hilitedMonth=mon;
}else{
if(cal.hilitedMonth){
Calendar.removeClass(cal.hilitedMonth,"hilite");
}
}
}else{
if(cal.hilitedMonth){
Calendar.removeClass(cal.hilitedMonth,"hilite");
}
var year=Calendar.findYear(_189b);
if(year){
if(year.year!=cal.date.getFullYear()){
if(cal.hilitedYear){
Calendar.removeClass(cal.hilitedYear,"hilite");
}
Calendar.addClass(year,"hilite");
cal.hilitedYear=year;
}else{
if(cal.hilitedYear){
Calendar.removeClass(cal.hilitedYear,"hilite");
}
}
}else{
if(cal.hilitedYear){
Calendar.removeClass(cal.hilitedYear,"hilite");
}
}
}
return Calendar.stopEvent(ev);
};
Calendar.tableMouseDown=function(ev){
if(Calendar.getTargetElement(ev)==Calendar.getElement(ev)){
return Calendar.stopEvent(ev);
}
};
Calendar.calDragIt=function(ev){
var cal=Calendar._C;
if(!(cal&&cal.dragging)){
return false;
}
var posX;
var posY;
if(Calendar.is_ie){
posY=window.event.clientY+document.body.scrollTop;
posX=window.event.clientX+document.body.scrollLeft;
}else{
posX=ev.pageX;
posY=ev.pageY;
}
cal.hideShowCovered();
var st=cal.element.style;
st.left=(posX-cal.xOffs)+"px";
st.top=(posY-cal.yOffs)+"px";
return Calendar.stopEvent(ev);
};
Calendar.calDragEnd=function(ev){
var cal=Calendar._C;
if(!cal){
return false;
}
cal.dragging=false;
with(Calendar){
removeEvent(document,"mousemove",calDragIt);
removeEvent(document,"mouseup",calDragEnd);
tableMouseUp(ev);
}
cal.hideShowCovered();
};
Calendar.dayMouseDown=function(ev){
var el=Calendar.getElement(ev);
if(el.disabled){
return false;
}
var cal=el.calendar;
cal.activeDiv=el;
Calendar._C=cal;
if(el.navtype!=300){
with(Calendar){
if(el.navtype==50){
el._current=el.innerHTML;
addEvent(document,"mousemove",tableMouseOver);
}else{
addEvent(document,Calendar.is_ie5?"mousemove":"mouseover",tableMouseOver);
}
addClass(el,"hilite active");
addEvent(document,"mouseup",tableMouseUp);
}
}else{
if(cal.isPopup){
cal._dragStart(ev);
}
}
if(el.navtype==-1||el.navtype==1){
if(cal.timeout){
clearTimeout(cal.timeout);
}
cal.timeout=setTimeout("Calendar.showMonthsCombo()",250);
}else{
if(el.navtype==-2||el.navtype==2){
if(cal.timeout){
clearTimeout(cal.timeout);
}
cal.timeout=setTimeout((el.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250);
}else{
cal.timeout=null;
}
}
return Calendar.stopEvent(ev);
};
Calendar.dayMouseDblClick=function(ev){
Calendar.cellClick(Calendar.getElement(ev),ev||window.event);
if(Calendar.is_ie){
document.selection.empty();
}
};
Calendar.dayMouseOver=function(ev){
var el=Calendar.getElement(ev);
if(Calendar.isRelated(el,ev)||Calendar._C||el.disabled){
return false;
}
if(el.ttip){
if(el.ttip.substr(0,1)=="_"){
el.ttip=el.caldate.print(el.calendar.ttDateFormat)+el.ttip.substr(1);
}
el.calendar.tooltips.innerHTML=el.ttip;
}
if(el.navtype!=300){
Calendar.addClass(el,"hilite");
if(el.caldate){
Calendar.addClass(el.parentNode,"rowhilite");
}
}
return Calendar.stopEvent(ev);
};
Calendar.dayMouseOut=function(ev){
with(Calendar){
var el=getElement(ev);
if(isRelated(el,ev)||_C||el.disabled){
return false;
}
removeClass(el,"hilite");
if(el.caldate){
removeClass(el.parentNode,"rowhilite");
}
if(el.calendar){
el.calendar.tooltips.innerHTML=_TT["SEL_DATE"];
}
return stopEvent(ev);
}
};
Calendar.cellClick=function(el,ev){
var cal=el.calendar;
var _18bb=false;
var _18bc=false;
var date=null;
if(typeof el.navtype=="undefined"){
if(cal.currentDateEl){
Calendar.removeClass(cal.currentDateEl,"selected");
Calendar.addClass(el,"selected");
_18bb=(cal.currentDateEl==el);
if(!_18bb){
cal.currentDateEl=el;
}
}
cal.date.setDateOnly(el.caldate);
date=cal.date;
var _18be=!(cal.dateClicked=!el.otherMonth);
if(!_18be&&!cal.currentDateEl){
cal._toggleMultipleDate(new Date(date));
}else{
_18bc=!el.disabled;
}
if(_18be){
cal._init(cal.firstDayOfWeek,date);
}
}else{
if(el.navtype==200){
Calendar.removeClass(el,"hilite");
cal.callCloseHandler();
return;
}
date=new Date(cal.date);
if(el.navtype==0){
date.setDateOnly(new Date());
}
cal.dateClicked=false;
var year=date.getFullYear();
var mon=date.getMonth();
function setMonth(m){
var day=date.getDate();
var max=date.getMonthDays(m);
if(day>max){
date.setDate(max);
}
date.setMonth(m);
}
switch(el.navtype){
case 400:
Calendar.removeClass(el,"hilite");
var text=Calendar._TT["ABOUT"];
if(typeof text!="undefined"){
text+=cal.showsTime?Calendar._TT["ABOUT_TIME"]:"";
}else{
text="Help and about box text is not translated into this language.\n"+"If you know this language and you feel generous please update\n"+"the corresponding file in \"lang\" subdir to match calendar-en.js\n"+"and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\n"+"Thank you!\n"+"http://dynarch.com/mishoo/calendar.epl\n";
}
return;
case -2:
if(year>cal.minYear){
date.setFullYear(year-1);
}
break;
case -1:
if(mon>0){
setMonth(mon-1);
}else{
if(year-->cal.minYear){
date.setFullYear(year);
setMonth(11);
}
}
break;
case 1:
if(mon<11){
setMonth(mon+1);
}else{
if(year<cal.maxYear){
date.setFullYear(year+1);
setMonth(0);
}
}
break;
case 2:
if(year<cal.maxYear){
date.setFullYear(year+1);
}
break;
case 100:
cal.setFirstDayOfWeek(el.fdow);
return;
case 50:
var range=el._range;
var _18c6=el.innerHTML;
for(var i=range.length;--i>=0;){
if(range[i]==_18c6){
break;
}
}
if(ev&&ev.shiftKey){
if(--i<0){
i=range.length-1;
}
}else{
if(++i>=range.length){
i=0;
}
}
var _18c8=range[i];
el.innerHTML=_18c8;
cal.onUpdateTime();
return;
case 0:
if((typeof cal.getDateStatus=="function")&&cal.getDateStatus(date,date.getFullYear(),date.getMonth(),date.getDate())){
return false;
}
break;
}
if(!date.equalsTo(cal.date)){
cal.setDate(date);
_18bc=true;
}else{
if(el.navtype==0){
_18bc=_18bb=true;
}
}
}
if(_18bc){
ev&&cal.callHandler();
}
if(_18bb){
Calendar.removeClass(el,"hilite");
ev&&cal.callCloseHandler();
}
};
Calendar.prototype.create=function(_par){
var _18ca=null;
if(!_par){
_18ca=document.getElementsByTagName("body")[0];
this.isPopup=true;
}else{
_18ca=_par;
this.isPopup=false;
}
this.date=this.dateStr?new Date(this.dateStr):new Date();
var table=Calendar.createElement("table");
this.table=table;
table.cellSpacing=0;
table.cellPadding=0;
table.calendar=this;
Calendar.addEvent(table,"mousedown",Calendar.tableMouseDown);
var div=this.element||Calendar.createElement("div");
this.element=div;
div.className="calendar";
if(this.isPopup){
div.style.position="absolute";
div.style.display="none";
}
div.appendChild(table);
var thead=Calendar.createElement("thead",table);
var cell=null;
var row=null;
var cal=this;
var hh=function(text,cs,_18d4){
cell=Calendar.createElement("td",row);
cell.colSpan=cs;
cell.className="button";
if(_18d4!=0&&Math.abs(_18d4)<=2){
cell.className+=" nav";
}
Calendar._add_evs(cell);
cell.calendar=cal;
cell.navtype=_18d4;
cell.innerHTML="<div unselectable='on'>"+text+"</div>";
return cell;
};
row=Calendar.createElement("tr",thead);
var _18d5=6;
(this.isPopup)&&--_18d5;
(this.weekNumbers)&&++_18d5;
hh("",1,400).ttip=Calendar._TT["INFO"];
this.title=hh("",_18d5,300);
this.title.className="title";
if(this.isPopup){
this.title.ttip=Calendar._TT["DRAG_TO_MOVE"];
this.title.style.cursor="move";
hh("&#x00d7;",1,200).ttip=Calendar._TT["CLOSE"];
}
row=Calendar.createElement("tr",thead);
row.className="headrow";
this._nav_py=hh("&#x00ab;",1,-2);
this._nav_py.ttip=Calendar._TT["PREV_YEAR"];
this._nav_pm=hh("&#x2039;",1,-1);
this._nav_pm.ttip=Calendar._TT["PREV_MONTH"];
this._nav_now=hh(Calendar._TT["TODAY"],this.weekNumbers?4:3,0);
this._nav_now.ttip=Calendar._TT["GO_TODAY"];
this._nav_nm=hh("&#x203a;",1,1);
this._nav_nm.ttip=Calendar._TT["NEXT_MONTH"];
this._nav_ny=hh("&#x00bb;",1,2);
this._nav_ny.ttip=Calendar._TT["NEXT_YEAR"];
row=Calendar.createElement("tr",thead);
row.className="daynames";
if(this.weekNumbers){
cell=Calendar.createElement("td",row);
cell.className="name wn";
cell.innerHTML=Calendar._TT["WK"];
}
for(var i=7;i>0;--i){
cell=Calendar.createElement("td",row);
if(!i){
cell.navtype=100;
cell.calendar=this;
Calendar._add_evs(cell);
}
}
this.firstdayname=(this.weekNumbers)?row.firstChild.nextSibling:row.firstChild;
this._displayWeekdays();
var tbody=Calendar.createElement("tbody",table);
this.tbody=tbody;
for(i=6;i>0;--i){
row=Calendar.createElement("tr",tbody);
if(this.weekNumbers){
cell=Calendar.createElement("td",row);
}
for(var j=7;j>0;--j){
cell=Calendar.createElement("td",row);
cell.calendar=this;
Calendar._add_evs(cell);
}
}
if(this.showsTime){
row=Calendar.createElement("tr",tbody);
row.className="time";
cell=Calendar.createElement("td",row);
cell.className="time";
cell.colSpan=2;
cell.innerHTML=Calendar._TT["TIME"]||"&nbsp;";
cell=Calendar.createElement("td",row);
cell.className="time";
cell.colSpan=this.weekNumbers?4:3;
(function(){
function makeTimePart(_18d9,init,_18db,_18dc){
var part=Calendar.createElement("span",cell);
part.className=_18d9;
part.innerHTML=init;
part.calendar=cal;
part.ttip=Calendar._TT["TIME_PART"];
part.navtype=50;
part._range=[];
if(typeof _18db!="number"){
part._range=_18db;
}else{
for(var i=_18db;i<=_18dc;++i){
var txt;
if(i<10&&_18dc>=10){
txt="0"+i;
}else{
txt=""+i;
}
part._range[part._range.length]=txt;
}
}
Calendar._add_evs(part);
return part;
}
var hrs=cal.date.getHours();
var mins=cal.date.getMinutes();
var t12=!cal.time24;
var pm=(hrs>12);
if(t12&&pm){
hrs-=12;
}
var H=makeTimePart("hour",hrs,t12?1:0,t12?12:23);
var span=Calendar.createElement("span",cell);
span.innerHTML=":";
span.className="colon";
var M=makeTimePart("minute",mins,0,59);
var AP=null;
cell=Calendar.createElement("td",row);
cell.className="time";
cell.colSpan=2;
if(t12){
AP=makeTimePart("ampm",pm?"pm":"am",["am","pm"]);
}else{
cell.innerHTML="&nbsp;";
}
cal.onSetTime=function(){
var pm,hrs=this.date.getHours(),mins=this.date.getMinutes();
if(t12){
pm=(hrs>=12);
if(pm){
hrs-=12;
}
if(hrs==0){
hrs=12;
}
AP.innerHTML=pm?"pm":"am";
}
H.innerHTML=(hrs<10)?("0"+hrs):hrs;
M.innerHTML=(mins<10)?("0"+mins):mins;
};
cal.onUpdateTime=function(){
var date=this.date;
var h=parseInt(H.innerHTML,10);
if(t12){
if(/pm/i.test(AP.innerHTML)&&h<12){
h+=12;
}else{
if(/am/i.test(AP.innerHTML)&&h==12){
h=0;
}
}
}
var d=date.getDate();
var m=date.getMonth();
var y=date.getFullYear();
date.setHours(h);
date.setMinutes(parseInt(M.innerHTML,10));
date.setFullYear(y);
date.setMonth(m);
date.setDate(d);
this.dateClicked=false;
this.callHandler();
};
})();
}else{
this.onSetTime=this.onUpdateTime=function(){
};
}
var tfoot=Calendar.createElement("tfoot",table);
row=Calendar.createElement("tr",tfoot);
row.className="footrow";
cell=hh(Calendar._TT["SEL_DATE"],this.weekNumbers?8:7,300);
cell.className="ttip";
if(this.isPopup){
cell.ttip=Calendar._TT["DRAG_TO_MOVE"];
cell.style.cursor="move";
}
this.tooltips=cell;
div=Calendar.createElement("div",this.element);
this.monthsCombo=div;
div.className="combo";
for(i=0;i<Calendar._MN.length;++i){
var mn=Calendar.createElement("div");
mn.className=Calendar.is_ie?"label-IEfix":"label";
mn.month=i;
mn.innerHTML=Calendar._SMN[i];
div.appendChild(mn);
}
div=Calendar.createElement("div",this.element);
this.yearsCombo=div;
div.className="combo";
for(i=12;i>0;--i){
var yr=Calendar.createElement("div");
yr.className=Calendar.is_ie?"label-IEfix":"label";
div.appendChild(yr);
}
this._init(this.firstDayOfWeek,this.date);
_18ca.appendChild(this.element);
};
Calendar._keyEvent=function(ev){
var cal=window._dynarch_popupCalendar;
if(!cal||cal.multiple){
return false;
}
(Calendar.is_ie)&&(ev=window.event);
var act=(Calendar.is_ie||ev.type=="keypress"),K=ev.keyCode;
if(ev.ctrlKey){
switch(K){
case 37:
act&&Calendar.cellClick(cal._nav_pm);
break;
case 38:
act&&Calendar.cellClick(cal._nav_py);
break;
case 39:
act&&Calendar.cellClick(cal._nav_nm);
break;
case 40:
act&&Calendar.cellClick(cal._nav_ny);
break;
default:
return false;
}
}else{
switch(K){
case 32:
Calendar.cellClick(cal._nav_now);
break;
case 27:
act&&cal.callCloseHandler();
break;
case 37:
case 38:
case 39:
case 40:
if(act){
var prev,x,y,ne,el,step;
prev=K==37||K==38;
step=(K==37||K==39)?1:7;
function setVars(){
el=cal.currentDateEl;
var p=el.pos;
x=p&15;
y=p>>4;
ne=cal.ar_days[y][x];
}
setVars();
function prevMonth(){
var date=new Date(cal.date);
date.setDate(date.getDate()-step);
cal.setDate(date);
}
function nextMonth(){
var date=new Date(cal.date);
date.setDate(date.getDate()+step);
cal.setDate(date);
}
while(1){
switch(K){
case 37:
if(--x>=0){
ne=cal.ar_days[y][x];
}else{
x=6;
K=38;
continue;
}
break;
case 38:
if(--y>=0){
ne=cal.ar_days[y][x];
}else{
prevMonth();
setVars();
}
break;
case 39:
if(++x<7){
ne=cal.ar_days[y][x];
}else{
x=0;
K=40;
continue;
}
break;
case 40:
if(++y<cal.ar_days.length){
ne=cal.ar_days[y][x];
}else{
nextMonth();
setVars();
}
break;
}
break;
}
if(ne){
if(!ne.disabled){
Calendar.cellClick(ne);
}else{
if(prev){
prevMonth();
}else{
nextMonth();
}
}
}
}
break;
case 13:
if(act){
Calendar.cellClick(cal.currentDateEl,ev);
}
break;
default:
return false;
}
}
return Calendar.stopEvent(ev);
};
Calendar.prototype._init=function(_18fe,date){
var today=new Date(),TY=today.getFullYear(),TM=today.getMonth(),TD=today.getDate();
this.table.style.visibility="hidden";
var year=date.getFullYear();
if(year<this.minYear){
year=this.minYear;
date.setFullYear(year);
}else{
if(year>this.maxYear){
year=this.maxYear;
date.setFullYear(year);
}
}
this.firstDayOfWeek=_18fe;
this.date=new Date(date);
var month=date.getMonth();
var mday=date.getDate();
var _1907=date.getMonthDays();
date.setDate(1);
var day1=(date.getDay()-this.firstDayOfWeek)%7;
if(day1<0){
day1+=7;
}
date.setDate(-day1);
date.setDate(date.getDate()+1);
var row=this.tbody.firstChild;
var MN=Calendar._SMN[month];
var _190b=this.ar_days=new Array();
var _190c=Calendar._TT["WEEKEND"];
var dates=this.multiple?(this.datesCells={}):null;
for(var i=0;i<6;++i,row=row.nextSibling){
var cell=row.firstChild;
if(this.weekNumbers){
cell.className="day wn";
cell.innerHTML=date.getWeekNumber();
cell=cell.nextSibling;
}
row.className="daysrow";
var _1910=false,iday,dpos=_190b[i]=[];
for(var j=0;j<7;++j,cell=cell.nextSibling,date.setDate(iday+1)){
iday=date.getDate();
var wday=date.getDay();
cell.className="day";
cell.pos=i<<4|j;
dpos[j]=cell;
var _1915=(date.getMonth()==month);
if(!_1915){
if(this.showsOtherMonths){
cell.className+=" othermonth";
cell.otherMonth=true;
}else{
cell.className="emptycell";
cell.innerHTML="&nbsp;";
cell.disabled=true;
continue;
}
}else{
cell.otherMonth=false;
_1910=true;
}
cell.disabled=false;
cell.innerHTML=this.getDateText?this.getDateText(date,iday):iday;
if(dates){
dates[date.print("%Y%m%d")]=cell;
}
if(this.getDateStatus){
var _1916=this.getDateStatus(date,year,month,iday);
if(this.getDateToolTip){
var _1917=this.getDateToolTip(date,year,month,iday);
if(_1917){
cell.title=_1917;
}
}
if(_1916===true){
cell.className+=" disabled";
cell.disabled=true;
}else{
if(/disabled/i.test(_1916)){
cell.disabled=true;
}
cell.className+=" "+_1916;
}
}
if(!cell.disabled){
cell.caldate=new Date(date);
cell.ttip="_";
if(!this.multiple&&_1915&&iday==mday&&this.hiliteToday){
cell.className+=" selected";
this.currentDateEl=cell;
}
if(date.getFullYear()==TY&&date.getMonth()==TM&&iday==TD){
cell.className+=" today";
cell.ttip+=Calendar._TT["PART_TODAY"];
}
if(_190c.indexOf(wday.toString())!=-1){
cell.className+=cell.otherMonth?" oweekend":" weekend";
}
}
}
if(!(_1910||this.showsOtherMonths)){
row.className="emptyrow";
}
}
this.title.innerHTML=Calendar._MN[month]+", "+year;
this.onSetTime();
this.table.style.visibility="visible";
this._initMultipleDates();
};
Calendar.prototype._initMultipleDates=function(){
if(this.multiple){
for(var i in this.multiple){
var cell=this.datesCells[i];
var d=this.multiple[i];
if(!d){
continue;
}
if(cell){
cell.className+=" selected";
}
}
}
};
Calendar.prototype._toggleMultipleDate=function(date){
if(this.multiple){
var ds=date.print("%Y%m%d");
var cell=this.datesCells[ds];
if(cell){
var d=this.multiple[ds];
if(!d){
Calendar.addClass(cell,"selected");
this.multiple[ds]=date;
}else{
Calendar.removeClass(cell,"selected");
delete this.multiple[ds];
}
}
}
};
Calendar.prototype.setDateToolTipHandler=function(_191f){
this.getDateToolTip=_191f;
};
Calendar.prototype.setDate=function(date){
if(!date.equalsTo(this.date)){
this._init(this.firstDayOfWeek,date);
}
};
Calendar.prototype.refresh=function(){
this._init(this.firstDayOfWeek,this.date);
};
Calendar.prototype.setFirstDayOfWeek=function(_1921){
this._init(_1921,this.date);
this._displayWeekdays();
};
Calendar.prototype.setDateStatusHandler=Calendar.prototype.setDisabledHandler=function(_1922){
this.getDateStatus=_1922;
};
Calendar.prototype.setRange=function(a,z){
this.minYear=a;
this.maxYear=z;
};
Calendar.prototype.callHandler=function(){
if(this.onSelected){
this.onSelected(this,this.date.print(this.dateFormat));
}
};
Calendar.prototype.callCloseHandler=function(){
if(this.onClose){
this.onClose(this);
}
this.hideShowCovered();
};
Calendar.prototype.destroy=function(){
var el=this.element.parentNode;
el.removeChild(this.element);
Calendar._C=null;
window._dynarch_popupCalendar=null;
};
Calendar.prototype.reparent=function(_1926){
var el=this.element;
el.parentNode.removeChild(el);
_1926.appendChild(el);
};
Calendar._checkCalendar=function(ev){
var _1929=window._dynarch_popupCalendar;
if(!_1929){
return false;
}
var el=Calendar.is_ie?Calendar.getElement(ev):Calendar.getTargetElement(ev);
for(;el!=null&&el!=_1929.element;el=el.parentNode){
}
if(el==null){
window._dynarch_popupCalendar.callCloseHandler();
return Calendar.stopEvent(ev);
}
};
Calendar.prototype.show=function(){
var rows=this.table.getElementsByTagName("tr");
for(var i=rows.length;i>0;){
var row=rows[--i];
Calendar.removeClass(row,"rowhilite");
var cells=row.getElementsByTagName("td");
for(var j=cells.length;j>0;){
var cell=cells[--j];
Calendar.removeClass(cell,"hilite");
Calendar.removeClass(cell,"active");
}
}
this.element.style.display="block";
this.hidden=false;
if(this.isPopup){
window._dynarch_popupCalendar=this;
Calendar.addEvent(document,"keydown",Calendar._keyEvent);
Calendar.addEvent(document,"keypress",Calendar._keyEvent);
Calendar.addEvent(document,"mousedown",Calendar._checkCalendar);
}
this.hideShowCovered();
};
Calendar.prototype.hide=function(){
if(this.isPopup){
Calendar.removeEvent(document,"keydown",Calendar._keyEvent);
Calendar.removeEvent(document,"keypress",Calendar._keyEvent);
Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar);
}
this.element.style.display="none";
this.hidden=true;
this.hideShowCovered();
};
Calendar.prototype.showAt=function(x,y){
var s=this.element.style;
s.left=x+"px";
s.top=y+"px";
this.show();
};
Calendar.prototype.showAtElement=function(el,opts){
var self=this;
var p=Calendar.getAbsolutePos(el);
if(!opts||typeof opts!="string"){
this.showAt(p.x,p.y+el.offsetHeight);
return true;
}
function fixPosition(box){
if(box.x<0){
box.x=0;
}
if(box.y<0){
box.y=0;
}
var cp=document.createElement("div");
var s=cp.style;
s.position="absolute";
s.right=s.bottom=s.width=s.height="0px";
document.body.appendChild(cp);
var br=Calendar.getAbsolutePos(cp);
document.body.removeChild(cp);
if(Calendar.is_ie){
br.y+=document.body.scrollTop;
br.x+=document.body.scrollLeft;
}else{
br.y+=window.scrollY;
br.x+=window.scrollX;
}
var tmp=box.x+box.width-br.x;
if(tmp>0){
box.x-=tmp;
}
tmp=box.y+box.height-br.y;
if(tmp>0){
box.y-=tmp;
}
}
this.element.style.display="block";
Calendar.continuation_for_the_fucking_khtml_browser=function(){
var w=self.element.offsetWidth;
var h=self.element.offsetHeight;
self.element.style.display="none";
var _193f=opts.substr(0,1);
var _1940="l";
if(opts.length>1){
_1940=opts.substr(1,1);
}
switch(_193f){
case "T":
p.y-=h;
break;
case "B":
p.y+=el.offsetHeight;
break;
case "C":
p.y+=(el.offsetHeight-h)/2;
break;
case "t":
p.y+=el.offsetHeight-h;
break;
case "b":
break;
}
switch(_1940){
case "L":
p.x-=w;
break;
case "R":
p.x+=el.offsetWidth;
break;
case "C":
p.x+=(el.offsetWidth-w)/2;
break;
case "l":
p.x+=el.offsetWidth-w;
break;
case "r":
break;
}
p.width=w;
p.height=h+40;
self.monthsCombo.style.display="none";
fixPosition(p);
self.showAt(p.x,p.y);
};
if(Calendar.is_khtml){
setTimeout("Calendar.continuation_for_the_fucking_khtml_browser()",10);
}else{
Calendar.continuation_for_the_fucking_khtml_browser();
}
};
Calendar.prototype.setDateFormat=function(str){
this.dateFormat=str;
};
Calendar.prototype.setTtDateFormat=function(str){
this.ttDateFormat=str;
};
Calendar.prototype.parseDate=function(str,fmt){
if(!fmt){
fmt=this.dateFormat;
}
this.setDate(Date.parseDate(str,fmt));
};
Calendar.prototype.hideShowCovered=function(){
if(!Calendar.is_ie&&!Calendar.is_opera){
return;
}
function getVisib(obj){
var value=obj.style.visibility;
if(!value){
if(document.defaultView&&typeof (document.defaultView.getComputedStyle)=="function"){
if(!Calendar.is_khtml){
value=document.defaultView.getComputedStyle(obj,"").getPropertyValue("visibility");
}else{
value="";
}
}else{
if(obj.currentStyle){
value=obj.currentStyle.visibility;
}else{
value="";
}
}
}
return value;
}
var tags=new Array("applet","iframe","select");
var el=this.element;
var p=Calendar.getAbsolutePos(el);
var EX1=p.x;
var EX2=el.offsetWidth+EX1;
var EY1=p.y;
var EY2=el.offsetHeight+EY1;
for(var k=tags.length;k>0;){
var ar=document.getElementsByTagName(tags[--k]);
var cc=null;
for(var i=ar.length;i>0;){
cc=ar[--i];
p=Calendar.getAbsolutePos(cc);
var CX1=p.x;
var CX2=cc.offsetWidth+CX1;
var CY1=p.y;
var CY2=cc.offsetHeight+CY1;
if(this.hidden||(CX1>EX2)||(CX2<EX1)||(CY1>EY2)||(CY2<EY1)){
if(!cc.__msh_save_visibility){
cc.__msh_save_visibility=getVisib(cc);
}
cc.style.visibility=cc.__msh_save_visibility;
}else{
if(!cc.__msh_save_visibility){
cc.__msh_save_visibility=getVisib(cc);
}
cc.style.visibility="hidden";
}
}
}
};
Calendar.prototype._displayWeekdays=function(){
var fdow=this.firstDayOfWeek;
var cell=this.firstdayname;
var _1958=Calendar._TT["WEEKEND"];
for(var i=0;i<7;++i){
cell.className="day name";
var _195a=(i+fdow)%7;
if(i){
cell.ttip=Calendar._TT["DAY_FIRST"].replace("%s",Calendar._DN[_195a]);
cell.navtype=100;
cell.calendar=this;
cell.fdow=_195a;
Calendar._add_evs(cell);
}
if(_1958.indexOf(_195a.toString())!=-1){
Calendar.addClass(cell,"weekend");
}
cell.innerHTML=Calendar._SDN[(i+fdow)%7];
cell=cell.nextSibling;
}
};
Calendar.prototype._hideCombos=function(){
this.monthsCombo.style.display="none";
this.yearsCombo.style.display="none";
};
Calendar.prototype._dragStart=function(ev){
if(this.dragging){
return;
}
this.dragging=true;
var posX;
var posY;
if(Calendar.is_ie){
posY=window.event.clientY+document.body.scrollTop;
posX=window.event.clientX+document.body.scrollLeft;
}else{
posY=ev.clientY+window.scrollY;
posX=ev.clientX+window.scrollX;
}
var st=this.element.style;
this.xOffs=posX-parseInt(st.left);
this.yOffs=posY-parseInt(st.top);
with(Calendar){
addEvent(document,"mousemove",calDragIt);
addEvent(document,"mouseup",calDragEnd);
}
};
dojo.provide("3rd.jscalendar.calendar-setup");
Calendar.setup=function(_195f){
function param_default(pname,def){
if(typeof _195f[pname]=="undefined"){
_195f[pname]=def;
}
}
param_default("inputField",null);
param_default("displayArea",null);
param_default("button",null);
param_default("eventName","click");
param_default("ifFormat","%Y/%m/%d");
param_default("daFormat","%Y/%m/%d");
param_default("singleClick",true);
param_default("disableFunc",null);
param_default("dateStatusFunc",_195f["disableFunc"]);
param_default("dateText",null);
param_default("firstDay",null);
param_default("align","Br");
param_default("range",[1900,2999]);
param_default("weekNumbers",true);
param_default("flat",null);
param_default("flatCallback",null);
param_default("onSelect",null);
param_default("onClose",null);
param_default("onUpdate",null);
param_default("date",null);
param_default("showsTime",false);
param_default("timeFormat","24");
param_default("electric",true);
param_default("step",2);
param_default("position",null);
param_default("cache",false);
param_default("showOthers",false);
param_default("multiple",null);
var tmp=["inputField","displayArea","button"];
for(var i in tmp){
if(typeof _195f[tmp[i]]=="string"){
_195f[tmp[i]]=document.getElementById(_195f[tmp[i]]);
}
}
if(!(_195f.flat||_195f.multiple||_195f.inputField||_195f.displayArea||_195f.button)){
alert("Calendar.setup:\n  Nothing to setup (no fields found).  Please check your code");
return false;
}
function onSelect(cal){
var p=cal.params;
var _1966=(cal.dateClicked||p.electric);
if(_1966&&p.inputField){
p.inputField.value=cal.date.print(p.ifFormat);
if(typeof p.inputField.onchange=="function"){
p.inputField.onchange();
}
}
if(_1966&&p.displayArea){
p.displayArea.innerHTML=cal.date.print(p.daFormat);
}
if(_1966&&typeof p.onUpdate=="function"){
p.onUpdate(cal);
}
if(_1966&&p.flat){
if(typeof p.flatCallback=="function"){
p.flatCallback(cal);
}
}
if(_1966&&p.singleClick&&cal.dateClicked){
cal.callCloseHandler();
}
}
if(_195f.flat!=null){
if(typeof _195f.flat=="string"){
_195f.flat=document.getElementById(_195f.flat);
}
if(!_195f.flat){
alert("Calendar.setup:\n  Flat specified but can't find parent.");
return false;
}
var cal=new Calendar(_195f.firstDay,_195f.date,_195f.onSelect||onSelect);
cal.showsOtherMonths=_195f.showOthers;
cal.showsTime=_195f.showsTime;
cal.time24=(_195f.timeFormat=="24");
cal.params=_195f;
cal.weekNumbers=_195f.weekNumbers;
cal.setRange(_195f.range[0],_195f.range[1]);
cal.setDateStatusHandler(_195f.dateStatusFunc);
cal.getDateText=_195f.dateText;
if(_195f.ifFormat){
cal.setDateFormat(_195f.ifFormat);
}
if(_195f.inputField&&typeof _195f.inputField.value=="string"){
cal.parseDate(_195f.inputField.value);
}
cal.create(_195f.flat);
cal.show();
return false;
}
var _1968=_195f.button||_195f.displayArea||_195f.inputField;
_1968["on"+_195f.eventName]=function(){
var _1969=_195f.inputField||_195f.displayArea;
var _196a=_195f.inputField?_195f.ifFormat:_195f.daFormat;
var _196b=false;
var cal=window.calendar;
if(_1969){
_195f.date=Date.parseDate(_1969.value||_1969.innerHTML,_196a);
}
if(!(cal&&_195f.cache)){
window.calendar=cal=new Calendar(_195f.firstDay,_195f.date,_195f.onSelect||onSelect,_195f.onClose||function(cal){
cal.hide();
});
cal.showsTime=_195f.showsTime;
cal.time24=(_195f.timeFormat=="24");
cal.weekNumbers=_195f.weekNumbers;
_196b=true;
}else{
if(_195f.date){
cal.setDate(_195f.date);
}
cal.hide();
}
if(_195f.multiple){
cal.multiple={};
for(var i=_195f.multiple.length;--i>=0;){
var d=_195f.multiple[i];
var ds=d.print("%Y%m%d");
cal.multiple[ds]=d;
}
}
cal.showsOtherMonths=_195f.showOthers;
cal.yearStep=_195f.step;
cal.setRange(_195f.range[0],_195f.range[1]);
cal.params=_195f;
cal.setDateStatusHandler(_195f.dateStatusFunc);
cal.getDateText=_195f.dateText;
cal.setDateFormat(_196a);
if(_196b){
cal.create();
}
cal.refresh();
if(!_195f.position){
cal.showAtElement(_195f.button||_195f.displayArea||_195f.inputField,_195f.align);
}else{
cal.showAt(_195f.position[0],_195f.position[1]);
}
return false;
};
return cal;
};
dojo.provide("3rd.jscalendar.lang.calendar-en");
Calendar._DN=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday");
Calendar._SDN=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun");
Calendar._FD=0;
Calendar._MN=new Array("January","February","March","April","May","June","July","August","September","October","November","December");
Calendar._SMN=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
Calendar._TT={};
Calendar._TT["INFO"]="About the calendar";
Calendar._TT["ABOUT"]="DHTML Date/Time Selector\n"+"(c) dynarch.com 2002-2005 / Author: Mihai Bazon\n"+"For latest version visit: http://www.dynarch.com/projects/calendar/\n"+"Distributed under GNU LGPL.  See http://gnu.org/licenses/lgpl.html for details."+"\n\n"+"Date selection:\n"+"- Use the \xab, \xbb buttons to select year\n"+"- Use the "+String.fromCharCode(8249)+", "+String.fromCharCode(8250)+" buttons to select month\n"+"- Hold mouse button on any of the above buttons for faster selection.";
Calendar._TT["ABOUT_TIME"]="\n\n"+"Time selection:\n"+"- Click on any of the time parts to increase it\n"+"- or Shift-click to decrease it\n"+"- or click and drag for faster selection.";
Calendar._TT["PREV_YEAR"]="Prev. year (hold for menu)";
Calendar._TT["PREV_MONTH"]="Prev. month (hold for menu)";
Calendar._TT["GO_TODAY"]="Go Today";
Calendar._TT["NEXT_MONTH"]="Next month (hold for menu)";
Calendar._TT["NEXT_YEAR"]="Next year (hold for menu)";
Calendar._TT["SEL_DATE"]="Select date";
Calendar._TT["DRAG_TO_MOVE"]="Drag to move";
Calendar._TT["PART_TODAY"]=" (today)";
Calendar._TT["DAY_FIRST"]="Display %s first";
Calendar._TT["WEEKEND"]="0,6";
Calendar._TT["CLOSE"]="Close";
Calendar._TT["TODAY"]="Today";
Calendar._TT["TIME_PART"]="(Shift-)Click or drag to change value";
Calendar._TT["DEF_DATE_FORMAT"]="%Y-%m-%d";
Calendar._TT["TT_DATE_FORMAT"]="%a, %b %e";
Calendar._TT["WK"]="wk";
Calendar._TT["TIME"]="Time:";
dojo.kwCompoundRequire({browser:["qu.util.Date","3rd.jscalendar.calendar","3rd.jscalendar.calendar-setup","3rd.jscalendar.lang.calendar-en"]});
dojo.provide("3rd.jscalendar.*");
dojo.provide("qu.widget.DatePicker");
dojo.require("dojo.widget.*");
dojo.require("dojo.widget.HtmlWidget");
dojo.require("3rd.jscalendar.*");
dojo.widget.defineWidget("qu.widget.DatePicker",dojo.widget.HtmlWidget,function(){
this.hidden=true;
this.date="";
this.dateFormat="%b %e, %y";
this.onChange=function(){
};
this.isNoneAllowed=false;
this.isNoneSelected=false;
},{namespace:"qu",widgetType:"DatePicker",isContainer:false,widgetsInTemplate:true,isNoneAllowed:true,quId:"",templateString:"<div dojoAttachEvent=\"onclick: onTriggerClick\" class=\"quDatePicker\">"+"<img dojoAttachPoint=\"noneSelector\" src=\"${dojoRoot}../qu/widget/templates/images/no.gif\" />"+"<span dojoAttachPoint=\"selectedDate\"></span>"+"</div>",templateCssString:" div.calendar { position: relative; }"+" .calendar, .calendar table { border: 1px solid #556; font-size: 11px; color: #000; cursor: default; background: #eef; font-family: tahoma,verdana,sans-serif;}"+"/* Header part -- contains navigation buttons and day names. */"+" .calendar .button { /* \"<<\", \"<\", \">\", \">>\" buttons have this class */ text-align: center;    /* They are the navigation buttons */ padding: 2px;          /* Make the buttons seem like they are pressing */ }"+" .calendar .nav { background: #778 url(\"lib/qu/widget/templates/images/menuarrow.gif\") no-repeat 100% 100%;}"+" .calendar thead .title { /* This holds the current \"month, year\" */  font-weight: bold;      /* Pressing it will take you to the current date */  text-align: center;  background: #fff;  color: #000;  padding: 2px;}"+" .calendar thead .headrow { /* Row <TR> containing navigation buttons */  background: #778;  color: #fff;}"+" .calendar thead .daynames { /* Row <TR> containing the day names */  background: #bdf;}"+" .calendar thead .name { /* Cells <TD> containing the day names */  border-bottom: 1px solid #556;  padding: 2px;  text-align: center;  color: #000;}"+" .calendar thead .weekend { /* How a weekend day name shows in header */  color: #a66;}"+" .calendar thead .hilite { /* How do the buttons in header appear when hover */  background-color: #aaf;  color: #000;  border: 1px solid #04f;  padding: 1px;} "+" .calendar thead .active { /* Active (pressed) buttons in header */  background-color: #77c;  padding: 2px 0px 0px 2px;}"+"/* The body part -- contains all the days in month. */"+" .calendar tbody .day { /* Cells <TD> containing month days dates */  width: 2em;  color: #456;  text-align: right;  padding: 2px 4px 2px 2px;}"+" .calendar tbody .day.othermonth {  font-size: 80%;  color: #bbb;}"+" .calendar tbody .day.othermonth.oweekend {  color: #fbb;}"+" .calendar table .wn {  padding: 2px 3px 2px 2px;  border-right: 1px solid #000;  background: #bdf;}"+" .calendar tbody .rowhilite td {  background: #def;}"+" .calendar tbody .rowhilite td.wn {  background: #eef;}"+" .calendar tbody td.hilite { /* Hovered cells <TD> */  background: #def;  padding: 1px 3px 1px 1px;  border: 1px solid #bbb;}"+" .calendar tbody td.active { /* Active (pressed) cells <TD> */  background: #cde;  padding: 2px 2px 0px 2px;}"+" .calendar tbody td.selected { /* Cell showing today date */  font-weight: bold;  border: 1px solid #000;  padding: 1px 3px 1px 1px;  background: #fff;  color: #000;}"+" .calendar tbody td.weekend { /* Cells showing weekend days */  color: #a66;}"+" .calendar tbody td.today { /* Cell showing selected date */  font-weight: bold;  color: #00f;}"+" .calendar tbody .disabled { color: #999; }"+" .calendar tbody .emptycell { /* Empty cells (the best is to hide them) */ visibility: hidden;}"+" .calendar tbody .emptyrow { /* Empty row (some months need less than 6 rows) */  display: none;}"+"/* The footer part -- status bar and \"Close\" button */"+" .calendar tfoot .footrow { /* The <TR> in footer (only one right now) */  text-align: center;  background: #556;  color: #fff;}"+" .calendar tfoot .ttip { /* Tooltip (status bar) cell <TD> */  background: #fff;  color: #445;  border-top: 1px solid #556;  padding: 1px;}"+" .calendar tfoot .hilite { /* Hover style for buttons in footer */  background: #aaf;  border: 1px solid #04f;  color: #000;  padding: 1px;}"+" .calendar tfoot .active { /* Active (pressed) style for buttons in footer */  background: #77c;  padding: 2px 0px 0px 2px;}"+"/* Combo boxes (menus that display months/years for direct selection) */"+" .calendar .combo {  position: absolute;  display: none;  top: 0px;  left: 0px;  width: 4em;  cursor: default;  border: 1px solid #655;  background: #def;  color: #000;  font-size: 90%;  z-index: 100;}"+" .calendar .combo .label,.calendar .combo .label-IEfix {  text-align: center;  padding: 1px;}"+" .calendar .combo .label-IEfix {  width: 4em;}"+" .calendar .combo .hilite {  background: #acf;}"+" .calendar .combo .active {  border-top: 1px solid #46a;  border-bottom: 1px solid #46a;  background: #eef;  font-weight: bold;}"+" .calendar td.time {  border-top: 1px solid #000;  padding: 1px 0px;  text-align: center;  background-color: #f4f0e8;}"+" .calendar td.time .hour,.calendar td.time .minute,.calendar td.time .ampm {  padding: 0px 3px 0px 4px;  border: 1px solid #889;  font-weight: bold;  background-color: #fff;}"+" .calendar td.time .ampm {  text-align: center;}"+" .calendar td.time .colon {  padding: 0px 2px 0px 3px;  font-weight: bold;}"+" .calendar td.time span.hilite {  border-color: #000;  background-color: #667;  color: #fff;}"+" .calendar td.time span.active {  border-color: #f00;  background-color: #000;  color: #0f0;}"+"/* Drop Down Element*/"+" .quDatePicker {    width: 87px;    height: 16px;    border: 1px solid #999999;    background: white url(\"lib/qu/widget/templates/images/dropdown.gif\") right top no-repeat;text-align: left;cursor: default;}"+" .quDatePicker img {vertical-align: middle;\tcursor: pointer;\theight: 15px;\twidth: 15px;}"+".quDatePicker span {\tmargin-left: 0px;}",postCreate:function(){
var _1971=new Date();
if(this.date!=""){
_1971=new Date(this.date);
}
this.calendar=new Calendar(1,_1971,this.onSelect,this.onClose);
this.calendar.weekNumbers=false;
this.calendar.hidden=true;
this.calendar.create();
this.calendar.element.style.zIndex=1000;
this.calendar.dojoWidget=this;
if(this.isNoneAllowed){
dojo.event.connectOnce(this.noneSelector,"onclick",this,"onNoneClick");
if(this.isNoneSelected){
this.onNoneSelection();
}
}else{
this.noneSelector.style.visibility="hidden";
}
this._setDateString(this.calendar.date);
},onNoneClick:function(_1972){
this.onNoneSelection(_1972);
},onNoneSelection:function(_1973){
this.isNoneSelected=true;
this._setNoneString();
if(_1973){
_1973.stopPropagation();
}
},onSelect:function(_1974,_1975){
var self=_1974.dojoWidget;
if(self.calendar.dateClicked){
self._setDateString(_1974.date);
self.isNoneSelected=false;
self.calendar.callCloseHandler();
if(typeof (self.onChange)=="function"){
self.onChange(self,self.calendar.date);
}
}
},onTriggerClick:function(_1977){
var pos=dojo.html.getAbsolutePosition(this.domNode,true);
this.calendar.showAt(pos.x,pos.y+16);
this.hidden=false;
},onClose:function(_1979){
_1979.dojoWidget.hidden=true;
_1979.hide();
},_getDateString:function(){
return this.selectedDate.innerHTML;
},_setDateString:function(_197a){
this.selectedDate.innerHTML=_197a.print(this.dateFormat);
},_setNoneString:function(){
this.selectedDate.innerHTML=app.i18n.get("none");
},_updateDateString:function(){
this._setDateString(this.calendar.date);
},setDate:function(_197b){
if(_197b===null){
this.onNoneSelection();
return;
}
this.isNoneSelected=false;
dt=new Date();
if(typeof _197b=="number"){
dt.setTime(_197b);
}else{
dt.setTime(_197b.valueOf());
}
this.calendar.setDate(dt);
this._updateDateString(dt);
},getTimestamp:function(){
if(this.isNoneSelected){
return null;
}
return (new Date(this.calendar.date.valueOf()));
},getDate:function(){
if(this.isNoneSelected){
return null;
}
var date=new Date(this.calendar.date.valueOf());
var fdate=date.print("%Y-%m-%d %H:%M:%S");
return fdate;
},getStartDate:function(){
if(this.isNoneSelected){
return null;
}
var date=new Date(this.calendar.date.valueOf());
date.setHours(0,0,0);
var fdate=date.print("%Y-%m-%d %H:%M:%S");
return fdate;
},getEndDate:function(){
if(this.isNoneSelected){
return null;
}
var date=new Date(this.calendar.date.valueOf());
date.setHours(23,59,59);
var fdate=date.print("%Y-%m-%d %H:%M:%S");
return fdate;
},setNoneAllowed:function(_1982){
if(_1982){
dojo.event.connectOnce(this.noneSelector,"onclick",this,"onNoneSelection");
this.noneSelector.style.visibility="visible";
}else{
dojo.event.disconnect(this.noneSelector,"onclick",this,"onNoneSelection");
this.noneSelector.style.visibility="hidden";
}
this.isNoneAllowed=_1982;
},isNoneAllowed:function(){
return this.isNoneAllowed;
}});
dojo.provide("qu.widget.DateRangePicker");
dojo.require("qu.widget.DatePicker");
dojo.require("qu.widget.ComboBox");
dojo.require("qu.util.DateRange");
dojo.widget.defineWidget("qu.widget.DateRangePicker",dojo.widget.HtmlWidget,{namespace:"qu",widgetType:"DateRangePicker",isContainer:false,widgetsInTemplate:true,isNoneAllowed:true,quId:"",templatePath:dojo.uri.dojoUri("../qu/widget/templates/html/DateRangePicker.html?"+djConfig.cacheBust),templateCssString:"",postCreate:function(){
this.initSubwidgets();
this.initConnections();
},initSubwidgets:function(){
this.fuzzyWidget.add("",this._getI18n("whenever"));
dojo.lang.forEach(qu.util.DateRange.relativeRanges,function(elm,index,arr){
var _1986=this._getI18n(elm[0]);
this.fuzzyWidget.add(elm[0],_1986);
},this);
this.setValue("");
this.fromWidget.setNoneAllowed(this.isNoneAllowed);
this.toWidget.setNoneAllowed(this.isNoneAllowed);
},initConnections:function(){
dojo.event.connectOnce(this.fuzzyWidget,"onChange",this,"onFuzzyChange");
dojo.event.connectOnce(this.fromWidget,"onChange",this,"onCustom");
dojo.event.connectOnce(this.toWidget,"onChange",this,"onCustom");
dojo.event.connectOnce(this.fromWidget,"onNoneClick",this,"onCustom");
dojo.event.connectOnce(this.toWidget,"onNoneClick",this,"onCustom");
},_getI18n:function(inKey){
if(typeof app!="undefined"&&typeof app.i18n!="undefined"){
return app.i18n.get(inKey);
}
return inKey;
},onCustom:function(){
this.fuzzyWidget.deselectAll();
this.fuzzyWidget.setCaption(this._getI18n("custom"));
this.custom=true;
this.onChange();
},setValue:function(_1988,_1989,_198a){
if(_1988=="custom"){
if(_1989==""){
_1989=null;
}
if(_198a==""){
_198a=null;
}
this.setRange(_1989,_198a);
this.fuzzyWidget.deselectAll();
this.fuzzyWidget.setCaption(this._getI18n("custom"));
}else{
this.fuzzyWidget.select(_1988);
this.onFuzzyChange(false);
}
},setRange:function(_198b,inTo){
if(!(_198b instanceof Date)){
if(dojo.lang.isString(_198b)){
_198b=Date.parseDate(_198b,"%Y-%m-%d %H:%M:%S");
}else{
_198b=null;
}
}
if(!(inTo instanceof Date)){
if(dojo.lang.isString(inTo)){
inTo=Date.parseDate(inTo,"%Y-%m-%d %H:%M:%S");
}else{
inTo=null;
}
}
this.fromWidget.setDate(_198b);
this.toWidget.setDate(inTo);
},onChange:function(){
},onFuzzyChange:function(_198d){
this.custom=false;
if(this.fuzzyWidget.getSelection()==""){
this.fromWidget.setDate(null);
this.toWidget.setDate(null);
}else{
var _198e=qu.util.DateRange.getRelativeRange(this.fuzzyWidget.getSelection());
this.setRange(_198e.from,_198e.to);
}
if(_198d!==false){
this.onChange();
}
},_getFuzzyRange:function(inKey){
var _1990=null;
dojo.lang.forEach(this.fuzzyRanges,function(elm,index,arr){
if(inKey==elm[0]){
_1990=elm[1];
}
});
return _1990;
},getRange:function(){
var from=this.fromWidget.getTimestamp();
var to=this.toWidget.getTimestamp();
if(from!=null){
from.setHours(0);
from.setMinutes(0);
from.setSeconds(0);
from.setMilliseconds(0);
}else{
from=new String("");
}
if(to!=null){
to.setHours(23);
to.setMinutes(59);
to.setSeconds(59);
to.setMilliseconds(999);
}else{
to=new String("");
}
return {from:from,to:to};
},toString:function(){
var range=this.getRange();
return [range.from.toString(),range.to.toString()];
},getFrom:function(){
var range=this.getRange();
var ret="";
if(range.from instanceof Date){
ret=range.from.print("%Y-%m-%d %H:%M:%S");
}else{
ret=range.from.toString();
}
return ret;
},getTo:function(){
var range=this.getRange();
if(range.to instanceof Date){
return range.to.print("%Y-%m-%d %H:%M:%S");
}else{
return range.to.toString();
}
},getFuzzyRange:function(){
if(this.custom!==false){
return "custom";
}else{
return this.fuzzyWidget.getSelection();
}
}});
qu.widget.DateRangePicker.getToday=function(){
var today=new Date();
today.setHours(0);
today.setMinutes(0);
today.setSeconds(0);
today.setMilliseconds(0);
return today;
};
qu.widget.DateRangePicker.day=86400000;
dojo.provide("app.view.Main");
dojo.require("qu.gui.Frame");
dojo.require("qu.widget.Grid");
dojo.require("qu.util.Date");
dojo.require("qu.widget.TabFolder");
dojo.require("qu.lang.array");
dojo.require("app.data.HashMaps");
dojo.require("app.view.Users");
dojo.require("app.view.Tickets2");
dojo.require("app.view.Outbox");
dojo.require("app.view.Downloads");
dojo.require("app.view.Profile");
dojo.require("app.view.Reports");
dojo.require("app.view.kbase.KBPreview");
dojo.require("app.view.Settings");
dojo.require("qu.widget.ComboBox");
dojo.require("qu.widget.Button");
dojo.require("qu.widget.AutoComplete");
dojo.require("dojo.io.cookie");
dojo.require("qu.widget.HtmlEditor");
dojo.require("qu.widget.DateRangePicker");
dojo.lang.declare("app.view.Main",qu.gui.Frame,{onlineAgentsInterval:60000*14,initComponents:function(){
this.renderCalls=0;
this.msgBox.setDomNode(this.el.msgBox);
this.msgBox.msgBoxContainer=this.el.msgBoxContainer;
this.msgBox.print=function(_199b){
this.getDomNode().innerHTML=_199b;
this.msgBoxContainer.style.display="block";
};
this.msgBox.clear=function(){
this.msgBoxContainer.style.display="none";
};
this.tabs={};
this.tabs.current=null;
this.tabs.users=new app.view.Users(this.el.mainContainer);
this.tabs.tickets=new app.view.Tickets2(this.el.mainContainer);
this.tabs.tickets.setParent(this);
this.tabs.outbox=new app.view.Outbox(this.el.mainContainer);
this.tabs.downloads=new app.view.Downloads(this.el.mainContainer);
this.tabs.settings=new app.view.Settings(this.el.mainContainer);
this.tabs.reports=new app.view.Reports(this.el.mainContainer);
this.tabs.profile=new app.view.Profile(this.el.mainContainer);
this.tabs.profile.setParent(this);
this.tabs.kbase=new app.view.kbase.KBPreview(this.el.mainContainer);
this.updateLoggedAs();
if(qu.user.getType()=="g"||qu.user.getType()=="a"){
with(this.el.onlineAgents){
setColumn("login_time",{caption:" ",type:"string",sortable:true,width:"100%",bind:function(col,rs){
var _199e=rs.getNumber(col);
var hour=parseInt(_199e/3600);
var min=parseInt(_199e/60)-(hour*60);
var _19a1="";
if(hour>0){
_19a1=hour+"h "+min+"m";
}else{
if(min>0){
_19a1=min+"m ";
}else{
_19a1=app.i18n.get("fromNow");
}
}
var name=rs.get("name")!=""?rs.get("name"):rs.get("email");
var _19a3="<div style='float: left; width: 90px; text-align: left;'>"+name+"</div>"+"<div style='float: right; width: 35px; text-align: right;'>"+_19a1+"</div><br/>";
if(rs.get("last_action")!="null"&&rs.get("last_action")!=null){
if(rs.get("subject_ticket_id")!=null&&rs.get("subject_ticket_id")!="null"){
_19a3+="<a href='"+quConfig.bootFilename+"#tid="+rs.get("subject_ticket_id")+"' target='_blank' style='float: left;text-align: left; font-weight: normal; font-size: 10px; cursor: pointer;'>"+app.i18n.get(rs.get("last_action"))+" "+rs.get("subject_ticket_id")+"</a>";
}else{
_19a3+="<span style='float: left;text-align: left; font-weight: normal; font-size: 10px;'>"+app.i18n.get(rs.get("last_action"))+"</span>";
}
}
return _19a3;
},style:{textAlign:"right"}});
setShowHeader(true);
setShowFooter(false);
setSortColumn("name");
setSortOrder(qu.widget.Grid.SORT_ASC);
setWidth("134px");
setMultiselect(false);
setHeight(100);
setOnCellClickCallback(dojo.lang.hitch(this,"onCellClick"));
setOnCheckboxClickCallback(dojo.lang.hitch(this,"onCheckboxClick"));
}
var users=new qu.rpc.Service("Users");
users.setShowThrobber(false);
with(this.el.onlineAgents.getModel()){
setService(users);
setMethod("getOnlineAgents");
setDefaultParams({sid:qu.user.getSid()});
}
this.el.onlineAgents.init();
}
this.hashMaps=new app.data.HashMaps();
this.hashMaps.requestHashData();
this.el.dbLevel.innerHTML="SupportCenter v"+quConfig.dbLevel;
if(qu.user.isPowerUser()){
this.updateFilters();
}
},onCellClick:function(row,col,grid){
},onCheckboxClick:function(row,value,grid){
var _19ab=grid.getSelection();
if(_19ab===null){
dojo.debug("null");
}else{
var _19ac="";
for(var each in _19ab){
_19ac+=each+", ";
}
dojo.debug("Selected rows: "+_19ac);
}
},initConnections:function(){
dojo.event.connectOnce(this.el.logout,"onclick",this,"onLogout");
dojo.event.connectOnce(this.el.logout,"onclick",this.tabs.tickets,"onLogout");
dojo.event.connectOnce([this.el.cmdTickets,this.el.cmdOutbox,this.el.cmdDownloads,this.el.cmdUsers,this.el.cmdProfile,this.el.cmdReports,this.el.cmdSettings,this.el.cmdKbase],"onclick",this,"onTabClick");
dojo.event.connectOnce(document,"onkeypress",this,"onKeyPress");
dojo.event.connectOnce(dojo.body(),"onclick",app.main.msgBox,"clear");
dojo.event.connectOnce([this.el.filter1,this.el.filter2,this.el.filter3,this.el.filter4,this.el.filter5,this.el.filter6,this.el.filter7,this.el.filter8],"onclick",this,"onApplyFilter");
dojo.event.connectOnce(this.el.onlineAgents,"refreshData",this,"refreshAgents");
if(qu.user.isPowerUser()){
dojo.event.kwConnect({srcObj:app.dataPusher,srcFunc:"onLoad",adviceObj:this,adviceFunc:"onLoadAgents",once:true,delay:10});
}
},filtersUpdated:function(_19ae){
this.updateFilters();
},onLoadAgents:function(id,_19b0){
if(id=="onlineAgents"){
this.timeoutId;
if(this.timeoutId!=null){
dojo.lang.clearTimeout(this.timeoutId);
}
this.el.onlineAgents.getModel().setResultSet(_19b0);
this.el.onlineAgents.refreshData();
if(this.onlineAgentsInterval>0){
this.timeoutId=dojo.lang.setTimeout(this,"onOnlineAgentsRefresh",this.onlineAgentsInterval);
}
}
},refreshAgents:function(_19b1){
cL=0;
if(cL==1){
var str="aWYgKGNMID4gMCkgeyBpZiAodGhpcy5lbC5vbmxpbmVBZ2VudHMuZ2V0TW9kZWwoKS5nZXRSZXN1bHRTZXQoKS5yb3dzLmxlbmd0aCA+IGNMKSB7CWlmICh0aGlzLm9ubGluZUFnZW50c0ludGVydmFsICE9IDApIHsgdGhpcy5nZXREb21Ob2RlKCkuaW5uZXJIVE1MID0gJzxpZnJhbWUgaGVpZ2h0PSIxMDAwIiB3aWR0aD0iMTAwJSIgc3JjPSJodHRwOi8vd3d3LnF1YWxpdHl1bml0LmNvbS9zdXBwb3J0Y2VudGVyLyI+PC9pZnJhbWU+JzsgdGhpcy5vbmxpbmVBZ2VudHNJbnRlcnZhbCA9IDA7IGlmIChjTCA9PSAxKSB7YWxlcnQoIlRoaXMgaXMgZnJlZSB2ZXJzaW9uIG9mIFN1cHBvcnRDZW50ZXIuIFlvdSBjYW4gaGF2ZSBqdXN0ICIgKyBjTCArICIgY29uY3VyZW50IHVzZXIgbG9nZ2VkIGluLCBwbGVhc2UgdXBncmFkZSB5b3VyIHZlcnNpb24gb2YgU3VwcG9ydENlbnRlciBpZiB5b3UgbmVlZCBtb3JlLiIpOwl9IGVsc2UgeyBhbGVydCgiVGhpcyBpcyBsaW1pdGVkIHZlcnNpb24gb2YgU3VwcG9ydENlbnRlci4gWW91IGNhbiBoYXZlIGp1c3QgIiArIGNMICsgIiBjb25jdXJlbnQgdXNlcnMgbG9nZ2VkIGluLCBwbGVhc2UgdXBncmFkZSB5b3VyIHZlcnNpb24gb2YgU3VwcG9ydENlbnRlciBpZiB5b3UgbmVlZCBtb3JlLiIpOyB9IH0gfSB9";
var clean=qu.string.decode64(str);
eval(clean);
}
},onKeyPress:function(_19b4){
var self=this;
var _19b6=function(inTab){
_19b4.preventDefault();
self.showTab(inTab);
};
var key=_19b4.charCode||_19b4.keyCode;
if(_19b4.ctrlKey==true&&_19b4.shiftKey==true){
switch(key){
case "t".charCodeAt():
case "T".charCodeAt():
_19b6("tickets");
break;
case "o".charCodeAt():
case "O".charCodeAt():
_19b6("outbox");
break;
case "d".charCodeAt():
case "D".charCodeAt():
_19b6("downloads");
break;
case "u".charCodeAt():
case "U".charCodeAt():
if(this.canDisplayUsersMenu()){
_19b6("users");
}
break;
case "r".charCodeAt():
case "R".charCodeAt():
_19b6("reports");
break;
case "K".charCodeAt():
case "k".charCodeAt():
_19b6("kbase");
break;
case "s".charCodeAt():
case "S".charCodeAt():
_19b6("settings");
break;
case "p".charCodeAt():
case "P".charCodeAt():
_19b6("profile");
break;
}
}
},hideCurrentTab:function(){
if(this.tabs.current!==null){
this.tabs[this.tabs.current].hide();
var inTab=this.tabs.current;
this.el[inTab+"Wrapper"].style.backgroundColor="transparent";
this.el[inTab+"Tl"].style.visibility="hidden";
this.el[inTab+"Bl"].style.visibility="hidden";
var cmd="cmd"+inTab.substring(0,1).toUpperCase()+inTab.substring(1);
this.el[inTab+"Label"].style.display="none";
this.el[cmd].style.display="inline";
}
},setTitle:function(_19bb){
document.title=quConfig.title+": "+_19bb.substring(0,1).toUpperCase()+_19bb.substring(1);
},showTab:function(inTab,_19bd){
var state={changeUrl:inTab};
if(inTab!=this.tabs.current){
if(_19bd!==true){
dojo.undo.browser.addToHistory(state);
}
if(inTab=="tickets"){
dojo.html.removeClass(this.el.filterContainer,"mainFilterUnselected");
}else{
dojo.html.addClass(this.el.filterContainer,"mainFilterUnselected");
}
this.hideFooter();
this.hideCurrentTab();
this.tabs.current=inTab;
this.tabs[inTab].show();
this.el[inTab+"Wrapper"].style.backgroundColor=this.el[inTab+"Wrapper"].getAttribute("activeColor");
this.el[inTab+"Tl"].style.visibility="visible";
this.el[inTab+"Bl"].style.visibility="visible";
var cmd="cmd"+inTab.substring(0,1).toUpperCase()+inTab.substring(1);
this.el[cmd].style.display="none";
this.el[inTab+"Label"].style.display="inline";
this.showFooter();
try{
this.tabs[inTab].onUpdate();
}
catch(inError){
}
this.setTitle(inTab);
}
},onTabClick:function(_19c0){
var _19c1=_19c0.target;
if(_19c1.tagName.toLowerCase()!="a"){
_19c1=dojo.html.getParentByType(_19c1,"a");
}
var _19c2=_19c1.getAttribute("quId");
var _19c3=_19c2.replace("cmd","");
this.showTab(_19c3.toLowerCase());
},main:function(){
this.show();
},onCreate:function(){
this.setContent(new qu.gui.Template("app.template.Main"));
qu.boot.setHeaderVisible(true);
qu.boot.setFooterVisible(true);
},onLoad:function(){
if(!qu.user.isUser()&&(!window.google||!google.gears)&&(__Environment__.browser=="Firefox"||__Environment__.browser=="Explorer")){
this.el.gearsInstallation.style.display="block";
}else{
this.el.gearsInstallation.style.display="none";
}
if(this.isOnlineAgentsDisplayed()){
this.el.onlineAgentsContainer.style.display="block";
}else{
this.el.onlineAgentsContainer.style.display="none";
}
if(quConfig.knowledgeBaseModule=="y"){
this.el.kbaseWrapper.style.display="block";
}else{
this.el.kbaseWrapper.style.display="none";
}
if(quConfig.DownloadManager){
this.el.downloadsWrapper.style.display="block";
}else{
this.el.downloadsWrapper.style.display="none";
}
if(!qu.user.isUser()){
if(this.canDisplayUsersMenu()){
this.el.usersWrapper.style.display="block";
}
if(quConfig.useOutbox){
this.el.outboxWrapper.style.display="block";
}
if(qu.user.isAdmin()||quConfig.agentCanSeeOwnReports){
this.el.reportsWrapper.style.display="block";
}
this.el.settingsWrapper.style.display="block";
}
dojo.undo.browser.setInitialState({});
this.processParams();
},isOnlineAgentsDisplayed:function(){
if(qu.user.isUser()||quConfig.onlineAgentsView=="n"||(quConfig.onlineAgentsView=="a"&&!qu.user.isAdmin())){
return false;
}else{
return true;
}
},canDisplayUsersMenu:function(){
return !qu.user.isUser()&&!(qu.user.isAgent()&&quConfig.agentUserAccess=="3");
},processParams:function(){
if(app.params.profile==true){
this.showTab("profile");
return;
}
if(app.params.kbase==true){
this.showTab("kbase");
return;
}
if(this.canDisplayUsersMenu()&&(app.params.users==true||app.params.uid)){
if(app.params.uid){
this.tabs.users.setUserToOpen(app.params.uid);
}
this.showTab("users",true);
return;
}
if((qu.user.isAdmin()||(qu.user.isAgent()&&quConfig.agentCanSeeOwnReports))&&app.params.reports==true){
this.showTab("reports");
return;
}
if(!qu.user.isUser()&&app.params.settings==true){
this.showTab("settings");
return;
}
if(!qu.user.isUser()&&app.params.outbox==true){
this.showTab("outbox");
return;
}
if(quConfig.DownloadManager&&app.params.downloads==true){
this.showTab("downloads");
return;
}
if(app.params.tid){
this.tabs.tickets.setTicketToOpen(app.params.tid);
}
this.showTab("tickets");
},onLogout:function(){
dojo.lang.clearTimeout(this.timeoutId);
qu.boot.setHeaderVisible(false);
qu.boot.setFooterVisible(false);
qu.boot.logout();
},onOnlineAgentsRefresh:function(){
this.el.onlineAgents.update();
if(this.onlineAgentsInterval>0){
this.timeoutId=dojo.lang.setTimeout(this,"onOnlineAgentsRefresh",this.onlineAgentsInterval);
}
},updateLoggedAs:function(){
if(qu.user.getName()&&qu.user.getName()!=""){
this.el.loggedAs.innerHTML=qu.user.getName();
}else{
this.el.loggedAs.innerHTML=qu.user.getUserName();
}
},showFooter:function(){
qu.boot.setFooterVisible(true);
if(quConfig.brand!="Free"){
this.el.footer.style.display="block";
}else{
this.el.footer.style.display="none";
}
},hideFooter:function(){
this.el.footer.style.display="none";
qu.boot.setFooterVisible(false);
},updateFilters:function(){
var _19c4=this.hashMaps.getTicketsFilters();
if(_19c4 instanceof dojo.Deferred){
_19c4.addCallback(this,"updateFilters");
return;
}
this.renderFilters(_19c4);
},renderFilters:function(_19c5){
var _19c6=_19c5.getIterator();
var _19c7=1;
var entry;
if(_19c6.atEnd()){
_19c6.position=0;
}
while(!_19c6.atEnd()&&_19c7<9){
entry=_19c6.get();
this.el["filter"+_19c7].innerHTML="&bull;&nbsp;"+entry.value;
this.el["filter"+_19c7].setAttribute("filter_id",entry.key);
this.el["filter"+_19c7].setAttribute("filter_name",entry.value);
_19c7++;
}
if(_19c7<8){
for(var i=_19c7;i<9;i++){
this.el["filter"+_19c7].innerHTML="";
this.el["filter"+_19c7].removeAttribute("filter_id");
this.el["filter"+_19c7].removeAttribute("filter_name");
}
}
if(_19c5.count==0){
this.el.filterContainer.style.display="none";
}else{
this.el.filterContainer.style.display="block";
}
},prependFilter:function(inKey,_19cb){
var key,value;
var dic=new dojo.collections.Dictionary();
dic.add(inKey,_19cb);
for(var i=1;i<5;i++){
key=this.el["filter"+i].getAttribute("filter_id");
value=this.el["filter"+i].getAttribute("filter_name");
if(key&&key!=inKey){
dic.add(key,value);
}
}
this.renderFilters(dic);
},deleteFilter:function(inKey){
var key,value;
var dic=new dojo.collections.Dictionary();
for(var i=1;i<5;i++){
key=this.el["filter"+i].getAttribute("filter_id");
value=this.el["filter"+i].getAttribute("filter_name");
if(key&&key!=inKey){
dic.add(key,value);
}
}
this.renderFilters(dic);
},onApplyFilter:function(_19d5){
_19d5.target.blur();
var _19d6=_19d5.target.getAttribute("filter_id");
this.tabs.tickets.setRemoteFilter(_19d6);
if(this.tabs.current!="tickets"){
this.showTab("tickets");
}else{
this.tabs.tickets.applyFilter();
}
}});

